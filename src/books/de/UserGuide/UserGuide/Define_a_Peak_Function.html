<h1 class="firstHeading">Peakfunktion definieren</h1>

  <p class='urlname' style='display: none'>PeakAnalyzer-DefinePeakFunc</p>

  <p><br>
  Wenn Sie den Assistenten <b>Peaks analysieren</b> verwenden, um Peaks anzupassen (OriginPro), können Sie eine Standardfunktion für jeden Peak im Dialog <b>Peak-Fit Parameter</b> auswählen oder Sie können eine benutzerdefinierte Funktion mit den Dialogen <b><a href="../../UserGuide/UserGuide/The_Fitting_Function_Organizer_Dialog_Box.html" title="UserGuide:The Fitting Function Organizer Dialog Box">Fitfunktionen verwalten</a></b> bzw. <b><a href="../../UserGuide/Category/The_Fitting_Function_Builder.html" title="Category:The Fitting Function Builder">Fitfunktionen erstellen</a></b> erstellen. Das Definieren einer Peakfunktion ähnelt dem Erstellen einer <a href="../../UserGuide/UserGuide/User-Defined_Fitting_Functions.html" title="UserGuide:User-Defined Fitting Functions">benutzerdefinierten Anpassungsfunktion</a> mit diesen zusätzlichen <i>Vorbehalten</i>:</p>

  <ul>
    <li>Um im Assistenten Peaks analysieren verwendet zu werden, sollte sich die Funktion in der Kategorie <b>PFW</b> befinden und das Kontrollkästchen <b>Peakfunktion</b> sollten beim Definieren der Funktion aktiviert sein.</li>

    <li>Um existierende Anpassungsfunktionen in anderen Kategorien für die Peakanpassung verfügbar zu machen, wählen Sie <b>Hilfsmittel: Fitfunktionen verwalten</b>. Klicken Sie mit der rechten Maustaste auf eine Funktion und wählen Sie <b>Verschieben in</b> oder <b>Teilen mit</b> und wählen Sie in der Auswahlliste die Option <b>PFW</b> aus.</li>

    <li>Damit die Peakfunktionen im <a href="../../UserGuide/UserGuide/Quick_Peaks_Gadget.html" title="UserGuide:Quick Peaks Gadget">Minitool Peakanalyse</a> oder im <a href="../../UserGuide/UserGuide/Fitting_Multiple_Peaks_with_the_Multiple_Peak_Fit_Tool.html" title="UserGuide:Fitting Multiple Peaks with the Multiple Peak Fit Tool">Hilfsmittel Mehrere Peaks anpassen</a> verfügbar ist, sollten Sie sie stattdessen in die Kategorie <b>Peak Function</b> einordnen.</li>

    <li>Falls Sie eine Funktion zur Anpassung Ihrer Basislinie (nur OriginPro) mit <b>Peaks analysieren</b> definieren möchten, müssen Sie die benutzerdefinierte Funktion in der Kategorie <b>Basislinie</b> ablegen.</li>

    <li>Die Funktion muss mindestens vier Parameter haben, die den verschiedenen Peakeigenschaften entsprechen. Die Parameterattribute werden mit den Spalte <b>Peakattribute</b> auf <a href="../../UserGuide/UserGuide/The_Function_Body_Page.html#Dialog_Box_Controls" title="UserGuide:The Function Body Page">der Seite <b>Funktionskörper</b></a> des Dialogs Fitfunktionen erstellen festgelegt. Der erste Parameter sollte den Namen <b>y0</b> tragen und dem Attribut <b>Versatz/Basislinie</b> zugewiesen sein. Den anderen Parameter können beliebige Namen zugeordnet sein. Ihnen sollten aber Attribute wie <b>X-Zentrum</b>, <b>X-Breite</b> und <b>Amplitude/Bereich</b> zugewiesen sein.</li>
  </ul>

  <table class="noborder">
    <tr>
      <td style="vertical-align:top" width="60"><img src="../images/Define_a_Peak_Function/Tip_icon.png" width="57" border="0" alt=""></td>

      <td>
        <p>Wenn ein Kollege eine FDF-Datei (Origin Function Definition File) mit Ihnen geteilt hat, können Sie sie durch einfaches Ziehen in Ihren Origin-Arbeitsbereich zu Ihrer Origin-Installation hinzufügen:</p>

        <ul>
          <li>Seit Origin 2018 werden die Informationen zur Kategorie in der FDF-Datei gespeichert. Wenn diese Datei in Origin gezogen wird, wird die Kategorie automatisch zur dem Autor zugewiesenen Kategorie zugeordnet.</li>

          <li>In älteren Versionen wird, wenn Sie die FDF-Datei in den Origin-Arbeitsbereich ziehen, der Dialog <b>Kategorie zum Hinzufügen der Funktion auswählen</b> geöffnet, so dass Sie eine Kategorie zuweisen können.</li>
        </ul>
      </td>
    </tr>
  </table>

  <h2><a name="Example_1:_Origin_C"></a><span class="mw-headline">Beispiel 1: Origin C</span></h2>

  <p>Das folgende Beispiel zeigt, wie eine Peakfunktion mit dem Namen AsymmetricGauss definiert und im Assistenten <b>Peaks analysieren</b> verwendet wird.</p>

  <p>Die zu definierende Peakfunktion wird, wie unten zu sehen, ausgedrückt:</p>

  <dl>
    <dd><i>double B,sig;</i></dd>

    <dd><i>B=A/(0,5*(sig1+sig2)*sqrt(2*pi));</i></dd>

    <dd><i>sig = x&lt;xc&#160;? sig1:sig2;</i></dd>

    <dd><i>y = y0 + B * exp(-0,5 *((x-xc)/sig)^2);</i></dd>
  </dl>

  <p>wobei <i>x</i> die unabhängige Variable, <i>y</i> die abhängige Variable und <i>y0</i>, <i>sig1</i>, <i>sig2</i>, <i>xc</i> die Parameter sind, die den Attributen Versatz, Peakbereich, linke Peakbreite, rechte Peakbreite bzw. Peakzentrum entsprechen.</p>

  <p><br>
  Es gibt sieben allgemeine Schritte beim Definieren einer Peakfunktion zum Anpassen im Assistenten <b>Peaks analysieren</b>:</p>

  <p>1. Drücken Sie die <b>F8</b>-Taste oder gehen Sie zum Menü <b>Hilfsmittel: Fitfunktion erstellen</b>, um es zu öffnen.</p>

  <p>2. Klicken Sie auf <b>Weiter</b>, um zur Seite <b>Name und Typ</b> zu gelangen, wählen Sie die Kategorie <b>PFW</b> aus der Auswahlliste <b>Eine Kategorie auswählen oder erstellen</b> aus und geben Sie <i>AsymmetricGauss</i> als <b>Funktionsname</b> ein. Wählen Sie <b>Origin C</b> im Feld <b>Funktionstyp</b>.</p>

  <p>3. Klicken Sie auf <b>Weiter</b>, um zur Seite <b>Variablen und Parameter</b> zu gelangen, geben Sie Variablen und Parameter, wie unten gezeigt, ein und aktivieren Sie das Kontrollkästchen <b>Impulsfunktion</b>:</p>

  <dl>
    <dd>
      <dl>
        <dd><a class="image"><img alt="Define Peak Function 01.png" src="../images/Define_a_Peak_Function/Define_Peak_Function_01.png" width="788"></a></dd>
      </dl>
    </dd>
  </dl>

  <p>4. Klicken Sie auf die Schaltfläche <b>Weiter</b>, um zur Seite <b>Origin C-Ausdrucksfunktion</b> zu gelangen. Klicken Sie auf jede Zelle in der Spalte <b>Peakattribut</b>, um die Peakattribute für jeden Parameter festzulegen. Geben Sie die Anfangsparameterwerte ein. Geben Sie die Bedeutung für jeden Parameter ein. Geben Sie die Funktionsgleichungen im Bearbeitungsfeld <b>Funktionskörper</b> ein und führen Sie eine Schnellprüfung bei <i>x = 1120</i> durch, um sicherzustellen, dass der Ausdruck richtig geschrieben ist, wie auch unten zu sehen:</p>

  <dl>
    <dd>
      <dl>
        <dd><a class="image"><img alt="Define Peak Function 02.png" src="../images/Define_a_Peak_Function/Define_Peak_Function_02.png" width="788"></a></dd>
      </dl>
    </dd>
  </dl>

  <p>5. Klicken Sie auf die Schaltfläche <b>Weiter</b>, um zur Seite <b>Parameterinitialisierungscode</b> zu gelangen, und geben Sie die folgenden Codes in das Bearbeitungsfeld <b>Initialisierungscode</b> ein.</p>

  <dl>
    <dd>
      <dl>
        <dd><a class="image"><img alt="Define Peak Function 03.png" src="../images/Define_a_Peak_Function/Define_Peak_Function_03.png" width="788"></a></dd>
      </dl>
    </dd>
  </dl>

  <p>6. Klicken Sie auf die Schaltfläche <b>Weiter</b>, um zur Seite <b>Grenzen und allgemeine lineare Nebenbedingungen</b> zu wechseln. Klicken Sie doppelt in Zellen in der Spalte &lt; oder &lt;=, um die Operatoren umzuschalten, und geben Sie dann die oberen und unteren Grenzen ein. Das Festlegen der Grenzen für jeden Parameter beschränkt die angepassten Ergebnisse auf einen sinnvollen Bereich, wie unten zu sehen:</p>

  <dl>
    <dd>
      <dl>
        <dd><a class="image"><img alt="Define Peak Function 04.png" src="../images/Define_a_Peak_Function/Define_Peak_Function_04.png" width="788"></a></dd>
      </dl>
    </dd>
  </dl>

  <p>7. Klicken Sie auf die Schaltfläche <b>Fertigstellen</b> und die Peakfunktion wird erstellt und in der Kategorie <b>PFW</b> abgelegt.</p>

  <p>Danach können Sie die Impulsanpassung mit dieser Funktion in <b>Peaks analysieren</b> durchführen, indem Sie die Funktion in der Auswahlliste <b>Peaktyp</b> des Dialogs <b>Peak-Fit Parameter</b> auswählen.</p>

  <dl>
    <dd><a class="image"><img alt="Define Peak Function 05.png" src="../images/Define_a_Peak_Function/Define_Peak_Function_05.png" width="712"></a></dd>
  </dl>

  <h2><a name="Example_2:_Python"></a><span class="mw-headline">Beispiel 2: Python</span></h2>

  <p>Seit <b>Origin 2021b</b> können Sie Funktionen zur Peakanpassung mit Hilfe von Python definieren. Diese Funktionen können dann im Assisstenten Peaks analysieren, im Hilfsmittel <a href="../../UserGuide/UserGuide/Fitting_Multiple_Peaks_with_the_Multiple_Peak_Fit_Tool.html" title="UserGuide:Fitting Multiple Peaks with the Multiple Peak Fit Tool">Mehrere Peaks anpassen</a> und im <a href="../../UserGuide/UserGuide/Fitting_Multiple_Peaks_with_Replicas.html" title="UserGuide:Fitting Multiple Peaks with Replicas">Dialog NLFit</a> verwendet werden.</p>

  <ol>
    <li>Öffnen Sie Fitfunktionen erstellen (<b>Hilfsmittel: Fitfunktionen erstellen</b> oder <b>F8</b>), wählen Sie die Option <b>Eine neue Funktion erstellen</b> und klicken Sie dann auf <b>Weiter</b>.</li>

    <li>Setzen Sie <b>Eine Kategorie auswählen oder erstellen</b> = <i>PFW</i> und geben Sie unter <b>Funktionsname</b> <i>MyPyGaussV</i> ein. Setzen Sie <b>Funktionsmodell</b> = <b>Explizit</b> und <b>Funktionstyp</b> = <b>Python-Funktion (Vektor)</b>.</li>

    <li>Geben Sie für <b>Unabhängige Variablen</b> = <i>x</i> und für <b>Abhängige Variablen</b> = <i>y</i> ein. Im Feld <b>Parameter</b> fügen Sie <i>y0</i>, <i>xc</i>, <i>A</i>, <i>w</i> hinzu (allesamt durch Komma getrennt).</li>

    <li>Aktivieren Sie das Kontrollkästchen <b>Peakfunktion</b> und klicken Sie auf <b>Weiter</b>.</li>

    <li>Geben Sie die folgenden Informationen ein und stellen Sie dabei sicher, dass die Auswahlliste <b>Peakattribute</b> für jede Zeile festgelegt ist (jeden <b>Param</b>):</li>

    <li style="list-style: none">
      <dl>
        <dd><a class="image"><img alt="FFB Mult Equations PythonV.png" src="../images/Define_a_Peak_Function/FFB_Mult_Equations_PythonV.png" width="630"></a></dd>

        <dd><i><b>Python-Funktion (Vektor)</b></i></dd>
      </dl>
      <pre class="python" style="font-family:monospace;">
<span style="color: #ff7700;font-weight:bold;">from</span> numpy <span style="color: #ff7700;font-weight:bold;">import</span> pi<span style="color: #000;">,</span> sqrt<span style="color: #000;">,</span> log<span style="color: #000;">,</span> exp <span style="color: #ff7700;font-weight:bold;">def</span> pyGaussVector<span style="color: #000;">(</span>xvalues<span style="color: #000;">,</span>y0<span style="color: #000;">,</span>xc<span style="color: #000;">,</span>A<span style="color: #000;">,</span>w<span style="color: #000;">)</span>: <span style="color: #d00; font-style: italic;"># The same definition as in the built-in Gaussian.FDF:</span> <span style="color: #d00; font-style: italic;">#yvalues = [y0 + A/(w*sqrt(pi/(4*log(2)))) * exp(-4*log(2)*(x-xc)*(x-xc)/(w*w)) for x in xvalues]</span> fct <span style="color: #000;">=</span> A/<span style="color: #000;">(</span>w*sqrt<span style="color: #000;">(</span>pi/<span style="color: #000;">(</span><span style="color: #000;">4</span>*log<span style="color: #000;">(</span><span style="color: #000;">2</span><span style="color: #000;">)</span><span style="color: #000;">)</span><span style="color: #000;">)</span><span style="color: #000;">)</span> inexp <span style="color: #000;">=</span> -<span style="color: #000;">4</span>*log<span style="color: #000;">(</span><span style="color: #000;">2</span><span style="color: #000;">)</span>/<span style="color: #000;">(</span>w*w<span style="color: #000;">)</span> yvalues <span style="color: #000;">=</span> <span style="color: #000;">[</span>y0 + fct * exp<span style="color: #000;">(</span>inexp*<span style="color: #000;">(</span>x-xc<span style="color: #000;">)</span>*<span style="color: #000;">(</span>x-xc<span style="color: #000;">)</span><span style="color: #000;">)</span> <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> xvalues<span style="color: #000;">]</span> <span style="color: #ff7700;font-weight:bold;">return</span> yvalues
</pre>

      <dl>
        <dd><i><b>Funktionskörper</b></i></dd>
      </dl>
      <pre class="python" style="font-family:monospace;">
y <span style="color: #000;">=</span> pyGaussVector<span style="color: #000;">(</span>x<span style="color: #000;">,</span>y0<span style="color: #000;">,</span>xc<span style="color: #000;">,</span>A<span style="color: #000;">,</span>w<span style="color: #000;">)</span>
</pre>

      <dl>
        <dd><i>Die nächste Seite -- die Seite <b>Skript vor Installation</b> -- ist eine Seite nur für Python, auf der Sie LabTalk-Code festlegen, der zum Überprüfen des Anwendersystems auf Python-Pakete, die für die Funktion erforderlich sind, verwendet wird. Beachten Sie, dass die Seite nicht leer bleiben kann.</i></dd>
      </dl>
    </li>

    <li>Klicken Sie auf <b>Weiter</b>, um zur Seite <b>Skript vor Installation</b> zu gelangen, und fügen Sie Folgendes hinzu:

      <dl>
        <dd><a class="image"><img alt="FFB Package Check PythonV.png" src="../images/Define_a_Peak_Function/FFB_Package_Check_PythonV.png" width="607"></a></dd>

        <dd><i><b>Python-Paket-Prüfung (Labtalk-Skript)</b></i></dd>
      </dl>
      <pre class="lt" style="font-family:monospace;">
if<span style="color: #000000;">(</span>Python.<span style="color: #000080;">chk</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"pandas cv2(opencv-python)"</span><span style="color: #000000;">)</span> <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> return <span style="color: #0000dd;">1</span>;<span style="color: #008000;">//should not install FDF</span> return <span style="color: #0000dd;">0</span>;<span style="color: #008000;">//proceed</span>
</pre>
    </li>

    <li>Da wir damit alle Einstellungen vorgenommen haben, klicken wir auf <b>Fertigstellen</b>, um Ihre Funktion zu speichern und den Dialog zu schließen.</li>

    <li>Wählen Sie <b>Daten: Mit Datei verbinden: Text/CSV</b>, navigieren Sie zu <i>&lt;Origin&gt;\Samples\Curve Fitting</i>, wählen Sie <b>MultiplePeaks.dat</b>, übernehmen Sie die Standardimportoptionen und klicken Sie auf <b>OK</b>, um die Datei zu importieren.</li>

    <li>Klicken Sie auf den Header von Spalte <b>D(Y)</b>, um die Spalte zu markieren, und klicken Sie dann auf die Schaltfläche <b>Punktdiagramm</b> <a class="image"><img alt="Button Scatter.png" src="../images/Define_a_Peak_Function/Button_Scatter.png" width="22"></a>, um ein Punktdiagramm zu erstellen.</li>

    <li>Klicken Sie auf <b>Analyse: Peaks und Basislinie: Peaks analysieren: Dialog öffnen</b></li>

    <li style="list-style: none">Klicken Sie auf der Seite <b>Ziel</b> auf <b>Peaks anpassen (Pro)</b>, dann viermal auf <b>Weiter</b>, um zur Seite <b>Peaks anpassen (Pro)</b> zu gelangen:</li>

    <li>Klicken Sie auf die Schaltfläche <b>Fit-Steuerung</b> unten auf der Seite. Ändern Sie in der Mitte des Dialogs <b>Peak-Fit Parameter</b> die Option <i>Gaussian</i> in <i>MyPyGaussV (User)</i> und klicken Sie auf <b>OK</b>, um diesen Dialog zu schließen.</li>

    <li>Klicken Sie auf die Schaltfläche <b>Fertig</b>, um mehrere Peaks mit Hilfe Ihrer benutzerdefinierten Python-Funktion anzupassen.</li>

    <li style="list-style: none">
      <dl>
        <dd><a class="image"><img alt="FFB PythonV Results.png" src="../images/Define_a_Peak_Function/FFB_PythonV_Results.png" width="604"></a></dd>
      </dl>
    </li>
  </ol>
