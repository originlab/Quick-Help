<h1 class="firstheading">ワークシートクエリ - クイックスタート</h1><p class='urlname' style='display: none'>Wks-Query-QS</p>
<p><br />
</p><p><b>ワークシートクエリ</b>ダイアログは、ユーザ指定の条件式に従って、ワークシート・データの行単位の選択、抽出、またはカラーマーキングに使用されます。
</p><p><span class='headerInParagraph'>ワークシートクエリのダイアログボックスを開くには：</span>
</p>
<ol><li> ワークシートをアクティブにして、メインメニューから<b>ワークシート：ワークシートクエリ</b>を選択します。 </li></ol>
<p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Setting_Dialog_Box_Controls"><span class="tocnumber">1</span> <span class="toctext">設定ダイアログボックスの制御</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Notes_on_Spreadsheet_Cell_Notation.2C_Use_Alias_and_Column_Naming"><span class="tocnumber">1.1</span> <span class="toctext">スプレッドシートのセル表記、使用別名および列の命名に関する注意</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Simple_Tutorial"><span class="tocnumber">1.2</span><span class="toctext">簡単なチュートリアル</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#What_Can_I_Enter_in_Condition_Text_Box.3F"><span class="tocnumber">2</span> <span class="toctext">選択条件テキストボックスに何を入力したら良いですか？</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Numeric_Data"><span class="tocnumber">2.1</span><span class="toctext">数値データ</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#String_Data"><span class="tocnumber">2.2</span><span class="toctext">文字列データ</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Date_Data"><span class="tocnumber">2.3</span><span class="toctext">日付データ</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#Advanced_Scripting_Controls_on_Data_Extraction"><span class="tocnumber">3</span> <span class="toctext">より高度なスクリプトでデータ抽出</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Quick_Examples"><span class="tocnumber">4</span><span class="toctext">クイックサンプル</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#Delete_Rows_with_Missing_Values"><span class="tocnumber">4.1</span> <span class="toctext">欠損値を含む行を削除する</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Extract_Every_Nth_Row"><span class="tocnumber">4.2</span> <span class="toctext">N番目の行ごとに抽出</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Mask_Outliers"><span class="tocnumber">4.3</span> <span class="toctext">外れ値のマスク</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#See_Also"><span class="tocnumber">5</span> <span class="toctext">以下もご覧ください</span></a></li>
</ul>
</div>
<h2><a name="Setting_Dialog_Box_Controls"></a><span class="mw-headline">設定ダイアログボックスの制御</span></h2>
<p>次の図は、<b>ワークシートクエリ</b>ダイアログボックスでコントロールを設定する順序を示しています。次のいずれかが真の場合は、<b>手順1a</b>を実行する必要があります。
</p>
<dl><dd><ul><li> ワークブックで<a href="../../UserGuide/UserGuide/Column_Short_Name_Restriction.html" title="ユーザガイド:列ショートネームの制限">スプレッドシートのセル表記</a>がオフになっています。</li>
<li> ワークブックでスプレッドシートのセル表記がオンになっていますが、ダイアログボックスの右上隅にある<b>別名を使用</b>ボックスをオンにすることを選択しました。</li></ul></dd></dl>
<dl><dd><a class="image"><img alt="Extract Worksheet Data 05.png" src="../images/Worksheet_Query/Extract_Worksheet_Data_05.png" width="648"  /></a></dd></dl>
<table class="note">
<tr>
<td><b>Note:</b>左のパネルに水平にリストされている列の情報について、このパネル内で右クリックし、列の番号やショートネーム、ロングネームなど、表示したい<a href="../../UserGuide/UserGuide/Extract_Worksheet_Data.html#Left_Panel" title="ユーザガイド:ワークシートデータの抽出">アイテム</a>をクリックします。
</td></tr></table>
<h3><a name="Notes_on_Spreadsheet_Cell_Notation.2C_Use_Alias_and_Column_Naming"></a><span class="mw-headline">スプレッドシートのセル表記、使用別名および列の命名に関する注意</span></h3>
<p>このツールは、Origin 2017で<a href="../../UserGuide/UserGuide/Column_Short_Name_Restriction.html" title="ユーザガイド:列ショートネームの制限"><b>スプレッドシートセル表記（SCN）</b></a>が導入される前のバージョンです。以前は、データ列を表すエイリアスの使用は、実際の列名の使用に代わる効率的な方法でした。別名は1文字にすることができますが、ショートネームの列でも参照するにはcol（）関数を使用する必要がありました（例： &quot;M &lt;= 0&quot;と &quot;Col（A）&lt;= 0&quot;）。SCNが導入されたため、<a href="../../UserGuide/UserGuide/Quick_Start_SetColumnValues.html" title="ユーザガイド:クィックスタート 列値の設定"><b><b>値の設定</b></b> ダイアログ</a>または<a href="../../UserGuide/UserGuide/Using_Formulae_to_Set_Cell_Values.html" title="ユーザガイド: 式を使ってセル値を設定">セル式</a>で列のショートネームを囲むためにcol（）関数を使用する必要がなくなりました。 
</p><p>Origin 2019b以降、SCNがオン（デフォルト）で<b>別名の使用</b>がオフの場合、ワークシートクエリの<b>If</b>式でショートネーム列を直接使用できます。この変更は、<b>If</b>式を構築するためのオプションを追加するだけです。式を構築するための「正しい」方法はありませんが、次のことが自分に最適な方法を決定するのに役立ちます。
</p>
<ul><li> ワークブックでSCNがオフになっている場合（たとえば、カスタマイズされた列のショートネームを持つ古いプロジェクトファイルがある場合）、いつもどおり作業を続けることができます。ワークシートクエリツールは、見た目も機能も変わりません。</li>
<li> ワークブックでSCNを有効にしている場合（Originバージョン2017以降のすべての新しいワークブックのデフォルト）、ワークシートクエリの右上隅に<b>別名を使用</b>ボックスが表示されます。ワークシートクエリーに慣れていて別名オプションの使用が好ましい場合は、Origin 2019bより前のバージョンと同じように<b>別名を使用</b>をチェックしてダイアログを使用できます。</li>
<li> ワークブックでSCNがオンになっていて、エイリアスを宣言せずに<b>If</b>式で列のショートネームまたはロングネームを直接使用する場合は、<b>別名を使用</b>を<i>オフのまま</i>にして、次の形式を使用します。</li></ul>
<dl><dd><ul><li> &quot;col（A）&quot;の代わりに &quot;A&quot;を使用してください。col（A）を使用した式は機能しますが、<b>col（）</b>関数を使用する必要はありません。</li>
<li> 式でカラムのロングネームを使用するには、それらを<b>col（）</b>関数で囲む必要があります。ロングネームにスペースが含まれる場合は、ロングネームを二重引用符で囲む必要があります（例：col(&quot;Population Density&quot;)&lt;=100)）。</li>
<li> <b>追加...</b>ボタンを使用してIf式に条件を追加する場合は、<b>追加..</b>.が<b>I<b>f</b>条件の列変数の選択</b>フィールドで強調表示されているものをすべて選択するため、<b>別名を使用</b>をオンにします。</li></ul></dd></dl>
<h3><a name="Simple_Tutorial"></a><span class="mw-headline">簡単なチュートリアル</span></h3>
<ol><li> <span class="db">インポートウィザード</span>を使って、<i>Samples\Data Manipulation\US Metropolitan Area Population.dat</i> ファイルをインポートします。インポート先のワークシートには場所は以下の4列が含まれています。: <b>(Population, Sq.Mi., Density, and Metropolitan Area)</b></li>
<li> メニューの<span class="menu">ワークシート： ワークシートクエリ</span>を選び、<b>ワークシートクエリ</b>ダイアログボックスを開きます。</li>
<li> SCNがオンの場合、または<b>別名を使用</b>を選択していない場合は、この手順を省略してください。SCNがオフの場合、<i>または</i><b>別名を使用</b>ボックスを選択した場合は、Ctrlキーを押しながら<b>列：</b>パネルの<b>Density</b>と<b>Metropolitan Area</b>を選択します。=&gt;ボタンをクリックして、これらの列を<b>If条件の列変数の選択</b>パネルに移動します。別名DとMがそれぞれ列に割り当てられていることに注目してください。 </li>
<li>左パネルの<b>Sq.Mi</b>の前にあるチェックボックスのチェックを外し、この列が抽出結果に含まれないようにします。</li>
<li> <b>別名を使用</b>ボックスがオンになっているかどうかに応じて、<b>条件</b>ボックスに次のいずれかの式を入力します。A-N-Dと入力せずに、<b>AND</b> ボタンをクリックすることもできます。 
<dl><dd>D&gt; 100 AND M == &quot;* CA *&quot;またはD&gt; 100 AND M = &quot;* CA *&quot;（SCN OFF、または、別名を使用にチェックされていて、データ表記には別名を使用）</dd>
<dd>C&gt; 100 AND D == &quot;* CA *&quot;またはC&gt; 100 AND D = &quot;* CA *&quot;（SCN ON、別名を使用にチェックされておらず、データ表記にはショートネームを使用） </dd>
<dd>この2つの条件は、カリフォルニア州(&quot;CA&quot;)のすべての地域で、100人以上の人口密度(Density)域を探します。このツールは、文字列内の<b>*</b>などのワイルドカード記号をサポートしています。</dd></dl></li>
<li><b>テスト - 条件に合えば選択</b>ボタンをクリックします。<b>選択条件</b>ボックスの下に見つかった行の数が更新され、ワークシート内の一部の行が強調表示されていることに注意してください。 </li>
<li><b>再計算</b>ドロップダウンリストから<b>自動</b>を選択し、データが変更された場合に結果が更新されるようにします。</li>
<li><b>出力</b>から <b>&quot;新しいワークシートに抽出&quot;</b> ラジオボタンを選択し、<b>OK</b> ボタンをクリックします。抽出された結果がソースワークブックの新しいワークシートに保存されていることがわかります。</li></ol>
<h2><a name="What_Can_I_Enter_in_Condition_Text_Box.3F"></a><span class="mw-headline">選択条件テキストボックスに何を入力したら良いですか？</span></h2>
<p>あなたの<b>条件</b>を構築するために、列名または別名と関係演算子（&gt;、&lt;=、！=など）、算術演算子（+、 - 、*、/、^）、および論理演算子（&amp;&amp;（AND）、||（OR）を使用できます。 （この<a href="../../UserGuide/UserGuide/Extract_Worksheet_Data.html#Condition" title="ユーザガイド:ワークシートデータの抽出">表</a>を参照）
<b>関数</b>メニューを使って<a class="external text" href="../../LabTalk/Script/LabTalk-Supported_Functions.html">組み込み関数</a>を挿入することもできます。 あるいは、<a href="../../UserGuide/UserGuide/Create_a_User_Defined_Function_for_Set_Column_Values.html" title="ユーザガイド:列値の設定を行うためのユーザ定義式を作成する">ユーザー定義関数を作成</a>することもできます。
</p>
<h5><a name="Numeric_Data"></a><span class="mw-headline">数値データ</span></h5>
<table class="simple">
<tr>
<th width="35%">サンプル
</th>
<th width="65%">説明
</th></tr>
<tr>
<td> <b>T &gt; 0</b>
</td>
<td> 0より大きい列の別名 &quot;T&quot;の値を持つ行を抽出する。
</td></tr>
<tr>
<td> <b>col(&quot;Population Density&quot;) &gt; 1000</b>
</td>
<td> 列ロングネーム &quot;Population Density&quot;の値が1000より大きい行を抽出する
</td></tr>
<tr>
<td> <b>A &gt; 0</b>
</td>
<td> 列のショートネーム &quot;A&quot;の値が0より大きい行を抽出する。
<p>Note：次の構文も機能します。<b>col(A) &gt; 0</b>または<b>col(<i>index</i>) &gt; 0</b>（<i><b>index</b></i>は列番号）
</p>
</td></tr>
<tr>
<td> <b>A.top(10)</b>
</td>
<td> 列ショートネーム「A」の最大値10個で行を抽出します。
</td></tr>
<tr>
<td> <b>N^2&nbsp;!= F</b>
</td>
<td> 列 &quot;N&quot;（別名または短縮名）の値の2乗が列 &quot;F&quot;（別名または短縮名）の値と等しくない行を抽出します。
</td></tr>
<tr>
<td> <b> A&nbsp;!= --</b> (or <b>A&nbsp;!= NANUM</b>)
</td>
<td> 欠損値がなく、列 &quot;A&quot;にテキスト文字列がない行（別名または短縮名）を抽出します。
</td></tr>
<tr>
<td> <b>mod(i, 3) == 0</b>
</td>
<td> <a class="external text" href="../../LabTalk/LabTalk/Mod_(function).html"><b>mod()</b></a>関数を使用して選択された全行の3行ごとに抽出します。ここで<b><i>i</i></b> は行インデックス変数です。
</td></tr></table>
<h5><a name="String_Data"></a><span class="mw-headline">文字列データ</span></h5>
<table class="simple">
<tr>
<th width="35%">サンプル
</th>
<th width="65%">説明
</th></tr>
<tr>
<td> <b>B == &quot;*CA*&quot; </b> (or <b>B = &quot;*ca*&quot;)</b>
</td>
<td> 文字列内に &quot;CA&quot;を含む行を抽出するには、別名または短縮名 &quot;B&quot;の列のセル内に格納します。<b>*</b>（文字列）や<b>？</b>などのワイルドカード記号に注意してください。(文字)などのワイルドカードシンボルはサポートし、大文字小文字の区別はありません。
</td></tr>
<tr>
<td> <b>NOT(A=&quot;Tom&quot; OR A=&quot;James&quot;)</b>
</td>
<td> 列Aに「Tom」または「James」を含む行を除くすべての行を抽出します。
</td></tr>
<tr>
<td>
<p><b>A&nbsp;!= NANUM</b>
<br />
<b>OR A == &quot;--&quot;</b>
<br />
<b>OR A == &quot;&quot;</b>
</p>
</td>
<td> 列名Aの列の数値データ、 &quot;--&quot; 、空の行をハイライトします。複数行の条件式を入力するには、Enterキーを使用します。
</td></tr>
<tr>
<td> <b>isText(B)</b>
</td>
<td> <a class="external text" href="../../LabTalk/LabTalk/IsText_(function).html"><b>isText()</b></a>関数を使用して、列名Bの列にテキスト文字列を含む行を抽出します。
</td></tr></table>
<h5><a name="Date_Data"></a><span class="mw-headline">日付データ</span></h5>
<table class="simple">
<tr>
<th width="35%">サンプル
</th>
<th width="65%">説明
</th></tr>
<tr>
<td> <b>frac(B) &gt; Time(10:00:00) AND frac(B) &lt; Time(11:00:00)</b>
</td>
<td> <a class="external text" href="../../LabTalk/LabTalk/Frac_(function).html"><b>frac()</b></a> および <a class="external text" href="../../LabTalk/LabTalk/Time_(function).html"><b>Time()</b></a> 関数を使用してB列内の10:00 ~ 11:00 の範囲のデータを抽出します。
</td></tr>
<tr>
<td> <b>int(A) &gt; Date(01/24/2004)</b>
</td>
<td> <a class="external text" href="../../LabTalk/LabTalk/Int_(function).html"><b>int()</b></a> および <a class="external text" href="../../LabTalk/LabTalk/Date_(function).html"><b>Date()</b></a>関数を使用して列Aの日付が2004/01/24より後のデータを抽出します。
</td></tr></table>
<h2><a name="Advanced_Scripting_Controls_on_Data_Extraction"></a><span class="mw-headline">より高度なスクリプトでデータ抽出</span></h2>
<dl><dd><dl><dd><a class="image"><img alt="Wks query script menu.png" src="../images/Worksheet_Query/Wks_query_script_menu.png" width="477"  /></a></dd></dl></dd></dl>
<p>使用方法はオプションですが、スクリプトを使用すると<b>ワークシートクエリ</b>ダイアログの機能が向上します。このボックス（<b>スクリプト：編集..</b>.）は1行以上のLabTalkスクリプトを取り、<b>条件</b>ボックスの式が実行される前にそれらを実行します。入力データの前処理や、<b>選択条件</b>に使用する関数・変数・定数の定義などで使用できます。
</p><p>Originは実際には以下のようにデータクエリルーチンを実行します。 
</p>
<ol><li><b>データループを選択する前にスクリプト</b>を実行します。 </li>
<li>ユーザーが指定した開始値と終了値で定義されたすべての行をループします。行番号が<i>i</i>である各列に対して、
<ol><li><b>IF条件前に実行するスクリプト</b>を実行します。</li>
<li>行 <b>i</b>のデータに対して、条件をテストします。</li>
<li>条件が真であればデータを抽出します。 </li>
<li>クエリを終了します。 </li></ol></li>
<li>ループを終了します。 </li></ol>
<p>クエリの実行ルーチンを確認するには、次のサンプルを実行します。このサンプルは、列Bのインデックスを使用して列Aのデータを抽出するものです。
</p>
<ol><li> <b>データループ選択時に実行するスクリプト</b>、<b>IF条件前に実行するスクリプト</b>、<b>選択条件</b>に下図のようなコマンドを入力します。 </li>
<li> <b>テスト--条件に合えば選択</b>ボタンをクリックすると、1、4、7行が選択されます。</li></ol>
<dl><dd><a class="image"><img alt="Extract Worksheet Data 08.png" src="../images/Worksheet_Query/Extract_Worksheet_Data_08.png" width="715"  /></a></dd></dl>
<h2><a name="Quick_Examples"></a><span class="mw-headline">クイックサンプル</span></h2>
<h3><a name="Delete_Rows_with_Missing_Values"></a><span class="mw-headline">欠損値を含む行を削除する</span></h3>
<ol><li> <a class="image"><img alt="Extract Worksheet Data 2.png" src="../images/Worksheet_Query/Extract_Worksheet_Data_2.png" width="20"  /></a>ボタンを使用して列 &quot;Time&quot; を<b>IF条件の列変数を選択</b>ボックスに追加します。</li>
<li> 選択条件ボックスに、<b><i>T == NANUM</i></b><i> (NANUM は欠損値)</i> に入力します。</li>
<li> <b>テスト--条件に合えば選択</b>をクリックして列 &quot;Time&quot;に欠損値が含まれる場合に行を選択します。</li>
<li> 選択された行を右クリックして、ショートカットメニューから<b>削除</b>を選択します。</li></ol>
<dl><dd><a class="image"><img alt="Extract Worksheet Data 09.png" src="../images/Worksheet_Query/Extract_Worksheet_Data_09.png" width="359"  /></a></dd></dl>
<h3><a name="Extract_Every_Nth_Row"></a><span class="mw-headline">N番目の行ごとに抽出</span></h3>
<ol><li> <b>選択条件</b>に<i>mod(i, 3) == 0</i>と入力します。ここで、i は行インデックス変数で、<a class="external text" href="../../LabTalk/LabTalk/Mod_(function).html"><b>mod(m,n)</b></a> mをnで割った整数の係数を返します。</li>
<li> <b>テスト--条件に合えば選択</b>をクリックして選択し、<b>OK</b>ボタンをクリックして新しいワークブックに抽出します。</li></ol>
<dl><dd><a class="image"><img alt="Extract Worksheet Data 12.png" src="../images/Worksheet_Query/Extract_Worksheet_Data_12.png" width="541"  /></a></dd></dl>
<p><br />
</p>
<h3><a name="Mask_Outliers"></a><span class="mw-headline">外れ値をマスク</span></h3>
<p>このサンプルは、25および75パーセンタイルを使用して外れ値をマスクする方法を示します。
<br />
1.<b>データループ選択前に実行するスクリプト</b>に以下のコマンドを入力します。
</p>
<pre class="lt" style="font-family:monospace;">pct <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">25</span>, <span style="color: #0000dd;">75</span><span style="color: #000000;">}</span>;
Q1 <span style="color: #000080;">=</span> percentile<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span>B<span style="color: #000000;">)</span>,pct<span style="color: #000000;">)</span><span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>;
Q3 <span style="color: #000080;">=</span> percentile<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span>B<span style="color: #000000;">)</span>,pct<span style="color: #000000;">)</span><span style="color: #000000;">[</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span>;
IQR <span style="color: #000080;">=</span> Q3 <span style="color: #000080;">-</span> Q1;
UIF <span style="color: #000080;">=</span> Q3 <span style="color: #000080;">+</span> <span style="color: #0000dd;">1.5</span><span style="color: #000080;">*</span>IQR;
LIF <span style="color: #000080;">=</span> Q1 <span style="color: #000080;">-</span> <span style="color: #0000dd;">1.5</span><span style="color: #000080;">*</span>IQR;</pre>
<p>2.<b>選択条件</b>に<i>Y &lt; LIF OR Y &gt; UIF</i> を入力します。
<br />
3.テスト--条件に合えば選択ボタンをクリックして検索された外れ値を選択します。
<br />
4.選択された行を右クリックして、ショートカットメニューから<b>マスク：適用</b>を選択します。
<br />
</p>
<dl><dd><a class="image"><img alt="Extract Worksheet Data 11.png" src="../images/Worksheet_Query/Extract_Worksheet_Data_11.png" width="637"  /></a></dd></dl>
<p><br />
</p>
<h2><a name="See_Also"></a><span class="mw-headline">関連項目</span></h2>
<ul><li> <a href="../../UserGuide/UserGuide/Extract_Worksheet_Data.html" title="ユーザガイド:ワークシートデータの抽出">ワークシートクエリメニューとダイアログのオプション</a></li>
<li> <a class="external text" href="../../Tutorial/Tutorial/Extract_Worksheet_Data.html">ワークシートデータを抽出するには？</a></li>
<li> <a class="external text" href="../../QuickHelp/QuickHelp/How_to_Plot_Multiple_Blocks_of_Data_from_Same_Column_as_Separate_Data_Plots.html">同じにある複数ブロックのデータを異なるデータプロットとして作図するにはどのようにしたらよいでしょうか？</a></li>
<li> <img src="../images/Worksheet_Query/Video_Image_2016.png" style='margin-right: 5px;'/><a class="external text" href="http://www.originlab.com/index.aspx?go=Products/Origin/DataManagement/WorkbooksAndWorksheets&amp;ss=chm&amp;pid=1161" target="_blank">ワークシートクエリ</a></li></ul>

    