<h1 class="firstheading">ランダム配置データのグリッディング法</h1><p class='urlname' style='display: none'>GridMethod-RandomSpaced</p>
<p>ワークシートデータがXおよびY方向に等間隔に並んでいない場合、<b>ランダム</b>または等間隔でないXYデータに対するOriginの5つのグリッディング手法の1つを使います。
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>内容</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Renka_Cline"><span class="tocnumber">1</span> <span class="toctext">Renka Cline法</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Shepard"><span class="tocnumber">2</span> <span class="toctext">Shepard</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Thin_Plate_Spline_.28TPS.29"><span class="tocnumber">3</span> <span class="toctext">TPS (Thin Plate Spline)法</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Kriging_Correlation"><span class="tocnumber">4</span> <span class="toctext">Kriging 相関</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Weighted_Average"><span class="tocnumber">5</span> <span class="toctext">加重平均</span></a></li>
</ul>
</td></tr></table>
<h2><a name="Renka_Cline"></a><span class="mw-headline">Renka- Cline法</span></h2>
<p>このグリッディング法は、1984年にRenka と Clineによって開発されたアルゴリズムに基づいています。このアルゴリズムの主要な計算は次のように行われます。 
</p>
<ol><li><B>三角分割</B>XYデータに対して三角分割法が実行されます。三角形は可能なかぎりほぼ等角になります。
</li><li><B>傾斜推定</B>二次関数の偏微分として、各格子におけるxy方向の傾斜を推定します。 
</li><li><b>補間</b>任意の点 <i>P</i>において、データ値を使って補間された値と点<i>P</i>を含む三角形の3つの頂点のそれぞれの位置での傾斜推定を計算します。 
</li></ol>
<p>200~1000程度のデータポイントが一様に分布している場合には、Renka-Cline法は良い選択肢となります。
</p>
<h2><a name="Shepard"></a><span class="mw-headline">Shepard法</span></h2>
<p>この手法は、Franke と Nielsonによって開発された修正Shepardグリッディング法を組み込んだものです。これは、次の式でデータを補間する、距離で重み付けしたグリッディング法です。
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-046a76c7575020226962aafe30d62999.png" title="F(x,y)=\sum_{i=1}^nF_iW_i(x,y) " alt="F(x,y)=\sum_{i=1}^nF_iW_i(x,y) " class="tex"/>
</p><p>ここで <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-a70f2fe89b3d58e24bfe2e43b20f6b1c.png" title="F_i\,\!" alt="F_i\,\!" class="tex"/> は、ノード (<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-d2583020b138319a535bc3c88278ab33.png" title="x_i\,\!" alt="x_i\,\!" class="tex"/>, <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f3c2749e4798fa8385fdc00a0aa7bea4.png" title="y_i\,\!" alt="y_i\,\!" class="tex"/>) における基本関数で、 <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-4f155925eba0ec05988f496352de5c92.png" title="W_i(x, y)\,\!" alt="W_i(x, y)\,\!" class="tex"/>は重み付けです。計算を制限するため、<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-a70f2fe89b3d58e24bfe2e43b20f6b1c.png" title="F_i\,\!" alt="F_i\,\!" class="tex"/> と <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-73d0207a12f616a8034bdcea6ef1baef.png" title="W_i\,\!" alt="W_i\,\!" class="tex"/> は円の中心(<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-d2583020b138319a535bc3c88278ab33.png" title="x_i\,\!" alt="x_i\,\!" class="tex"/>, <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f3c2749e4798fa8385fdc00a0aa7bea4.png" title="y_i\,\!" alt="y_i\,\!" class="tex"/>)で半径が <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f4a9da512ddea571833f00f353c5f55e.png" title="R_q\,\!" alt="R_q\,\!" class="tex"/> および <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png" title="R_w\,\!" alt="R_w\,\!" class="tex"/> を持つ円の中にあるデータポイントで計算されます。 
</p><p>次の式で定義される重み付けで開始します。
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-38c5b98f93592d46af674dc705356f2d.png" title="w_i(x,y)=\frac{w_i(x,y)}{\sum_{k=1}^nw_k(x,y)}" alt="w_i(x,y)=\frac{w_i(x,y)}{\sum_{k=1}^nw_k(x,y)}" class="tex"/>.
</p><p>半径 <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png" title="R_w\,\!" alt="R_w\,\!" class="tex"/> を与えると、その相対的な重み付け <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-1e1d2f2f6d95a2f415901e6fab3b635f.png" title="w_k\,\!" alt="w_k\,\!" class="tex"/> は、
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-0e141a3a2c838ddf192009baaf5116ad.png" title="w_k=[\frac{(R_w-d_k)_{+}}{R_wd_k}]^2" alt="w_k=[\frac{(R_w-d_k)_{+}}{R_wd_k}]^2" class="tex"/>  ここで、
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-c0d1de70468f4f461eceb23eafebe540.png" title=" \begin{cases}
R_w-d_k \, if \, d_k&lt;R_w,\\
0      \, if \, d_k\geq R_w,
\end{cases} " alt=" \begin{cases}
R_w-d_k \, if \, d_k&lt;R_w,\\
0      \, if \, d_k\geq R_w,
\end{cases} " class="tex"/>
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-5a3ba457aaab0599d360b88b190d197b.png" title="d_k\,\!" alt="d_k\,\!" class="tex"/>は (<i>x, y</i>) と(<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-32c64e570a3b92171cb6bd0c09b98125.png" title="x_k\,\!" alt="x_k\,\!" class="tex"/>, <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e3670e72563d416ec064b9d1465cdcfb.png" title="y_k\,\!" alt="y_k\,\!" class="tex"/>)間の距離です。
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-6cd12b96ce8d8fe8981205d56830b561.png" title="d_k=||(x_k,y_k)-(x,y)||_2\,\!" alt="d_k=||(x_k,y_k)-(x,y)||_2\,\!" class="tex"/>.
</p><p>どの <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png" title="R_w\,\!" alt="R_w\,\!" class="tex"/> &gt;0においても、次のようになります。
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-47517424fc2c0152f170fa76ce90e5d7.png" title="W_i(x_j,y_j)\,\!" alt="W_i(x_j,y_j)\,\!" class="tex"/>=<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-2bdc297be795bd2217387ddca4de2bb8.png" title=" \begin{cases}
1,i=j\\
0,otherwise
\end{cases} " alt=" \begin{cases}
1,i=j\\
0,otherwise
\end{cases} " class="tex"/>
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-6bde42bb59761a6d156975da477e3c7f.png" title="\sum_{k=1}^nW_k(x,y)=1" alt="\sum_{k=1}^nW_k(x,y)=1" class="tex"/>.
</p><p>次に、 節点関数 <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-a70f2fe89b3d58e24bfe2e43b20f6b1c.png" title="F_i\,\!" alt="F_i\,\!" class="tex"/> が局所的な近似関数 <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-0b6a79d78111f43c7b4f10e424b086c6.png" title="Q_k\,\!" alt="Q_k\,\!" class="tex"/> に置き換えられます。
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-9e8d6a36a765b21fff0bfdfad4dc6f9b.png" title="Q_k(x,y)=c_{k1}(x-x_k)^2+c_{k2}(x-x_k)(y-y_k)+c_{k3}(y-y_k)^2+c_{k4}(x-x_k)+c_{k5}(y-y_k)+F_k\,\!" alt="Q_k(x,y)=c_{k1}(x-x_k)^2+c_{k2}(x-x_k)(y-y_k)+c_{k3}(y-y_k)^2+c_{k4}(x-x_k)+c_{k5}(y-y_k)+F_k\,\!" class="tex"/>
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-0b6a79d78111f43c7b4f10e424b086c6.png" title="Q_k\,\!" alt="Q_k\,\!" class="tex"/> は、節点の <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f4a9da512ddea571833f00f353c5f55e.png" title="R_q\,\!" alt="R_q\,\!" class="tex"/> 範囲内にあるデータに重み付けされた最小二乗二次フィット関数です。そして、係数は次の式を最小化するものです。
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-8ab8ecc395dfc1db378345af3deb4929.png" title="\varepsilon _k=\sum_{i=1,j\neq k}^N\omega _i(x_k,y_k)[c_{k1}(x_i-x_k)^2+\ldots +c_{k5}(y_i-y_k)+F_k-F_i]^2" alt="\varepsilon _k=\sum_{i=1,j\neq k}^N\omega _i(x_k,y_k)[c_{k1}(x_i-x_k)^2+\ldots +c_{k5}(y_i-y_k)+F_k-F_i]^2" class="tex"/>
</p><p>ここで
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-82914bba8b91c96a6d5fe1c5865f7fe6.png" title="\omega _i(x,y)=[\frac{(R_q-d_i)_{+}}{R_qd_i}]^2=[\frac{(R_q-||(x_i,y_i)-(x,y)||_2)_{+}}{R_q||(x_i,y_i)-(x,y)||_2}]^2" alt="\omega _i(x,y)=[\frac{(R_q-d_i)_{+}}{R_qd_i}]^2=[\frac{(R_q-||(x_i,y_i)-(x,y)||_2)_{+}}{R_q||(x_i,y_i)-(x,y)||_2}]^2" class="tex"/>.
</p><p>上記で補間関数は、局所近似関数であり、格子ポイント <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f4a9da512ddea571833f00f353c5f55e.png" title="R_q\,\!" alt="R_q\,\!" class="tex"/> および <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png" title="R_w\,\!" alt="R_w\,\!" class="tex"/>での影響半径に依存すると考えることができます。2つの整数 <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-b840101c43afb2134744afa5efd1aac0.png" title=" N_q\,\!" alt=" N_q\,\!" class="tex"/> と <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-585ed64091518f9443b460c06ab9dd5d.png" title="N_w\,\!" alt="N_w\,\!" class="tex"/> が、<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f4a9da512ddea571833f00f353c5f55e.png" title="R_q\,\!" alt="R_q\,\!" class="tex"/> と <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png" title="R_w\,\!" alt="R_w\,\!" class="tex"/>を計算するのに使われます。(これらは、関数のパラメータ <I>q</I> と <I>w</I> であり、それぞれ<a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="ユーザガイド:XYZグリッディングダイアログボックス">二次補間局所因子</a>と<a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="ユーザガイド:XYZグリッディングダイアログボックス">重み関数局所因子</a>です詳細は、このセクションの『XYZグリッディングダイアログボックス』をご覧ください。)
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-4adf5de03f21dc72859d55d561d09e9e.png" title="R_q=\frac D2\sqrt{\frac{N_q}n}" alt="R_q=\frac D2\sqrt{\frac{N_q}n}" class="tex"/> および <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-33cd7fd3e109a8dc3aef57f28cae9bdc.png" title="R_w=\frac D2\sqrt{\frac{N_w}n}" alt="R_w=\frac D2\sqrt{\frac{N_w}n}" class="tex"/> 
</p><p>ここで <i>n</i> はデータポイントの数で、 <i>D</i> は一対のデータポイント間の距離の最大です。そのため、<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-d745ee190affc7e9ec213bbf0491db99.png" title="N_q\,\!" alt="N_q\,\!" class="tex"/> と <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-585ed64091518f9443b460c06ab9dd5d.png" title="N_w\,\!" alt="N_w\,\!" class="tex"/> は、それぞれ各格子において、距離 <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f4a9da512ddea571833f00f353c5f55e.png" title="R_q\,\!" alt="R_q\,\!" class="tex"/>および <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png" title="R_w\,\!" alt="R_w\,\!" class="tex"/> の範囲内にあるデータポイントの平均の数だと考えることができます。
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-d745ee190affc7e9ec213bbf0491db99.png" title="N_q\,\!" alt="N_q\,\!" class="tex"/> と <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-585ed64091518f9443b460c06ab9dd5d.png" title="N_w\,\!" alt="N_w\,\!" class="tex"/> の値を増加させると、計算が全体に及ぶようになり、同様にこれらの値を減少させると、計算が局所的になります。   一般に、<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-b51dc46717c1ae569afeeee234ebfb97.png" title="N_q \approx  2N_w" alt="N_q \approx  2N_w" class="tex"/>とすると良い結果が得られます。デフォルトでは <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-002e750f292f49bb2f7a73ff55014761.png" title="N_q= 18\,\!" alt="N_q= 18\,\!" class="tex"/> および <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-20e3e4c31d474bb53d9791614e49d54f.png" title="N_w= 9\,\!" alt="N_w= 9\,\!" class="tex"/> となっています。しかし、以下の制約を満たしている必要があります。<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-657800af90a95b5de2f6f2e8fef95f20.png" title="0 &lt; N_w \leq  N_q" alt="0 &lt; N_w \leq  N_q" class="tex"/>.  
</p><p>「<a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html" title="ユーザガイド:XYZグリッディングダイアログボックス">XYZグリッディング</a>」ダイアログは、 NAG 関数ライブラリを呼び出して、Shepardグリッディング法を実行しています。また、Originは Shepardグリッディング法を行うXファンクションも提供しており、<a class="external text" href="../../XFunction/X-Function/xyz_shep_nag.html">xyz_shep_nag</a> および <a class="external text" href="../../XFunction/X-Function/xyz_shep.html">xyz_shep</a>は、<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f4a9da512ddea571833f00f353c5f55e.png" title="R_q\,\!" alt="R_q\,\!" class="tex"/> と <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png" title="R_w\,\!" alt="R_w\,\!" class="tex"/> を使って、この手法を組み込んでいます。
</p>
<h2><a name="Thin_Plate_Spline_.28TPS.29"></a><span class="mw-headline">TPS (Thin Plate Spline)法</span></h2>
<p>この関数は、<b>TPS(Thin Plate Spline)</b>アルゴリズムを使って、ランダム配置データの行列変換を行う手法を提供しています。TPS法は、物理的な補間の方法です。グリッディングデータを生成するため、この方法では、すべてのデータポイントが薄い弾性プレートまたはスプライン上に分布しているものと仮定します。プレートはグリッド点に制限され、グリッド点を結ぶことで、2次元の曲面を形成します。曲面は、データポイントに合うように形成するために点と点の間で変形します。最適な結果は、通常、スプラインの「曲げエネルギー関数」を最小化することで見つかります。
</p><p>この手法は、曲げエネルギーの最小値を見つけるので、プレートの変形を最小に抑え、より良い結果が得られます。この計算は、曲率計算を最小化するのにも似ています。TPSグリッディング法を使った曲面プロットは、他の手法よりも滑らかになりますので、この手法は、局所的に平坦な曲面の補間に対して適しています。
</p><p>TPSアルゴリズムの数学的な説明としては、次の曲げエネルギー関数が与えられ
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-07c30f20d63ad99e8f95ba274c88f8d1.png" title="I=\iint_{R^2}(f_{xx}^2+2f_{xy}^2+f_{yy}^2)dxdy" alt="I=\iint_{R^2}(f_{xx}^2+2f_{xy}^2+f_{yy}^2)dxdy" class="tex"/>
</p><p>そして、最小化される関数は
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-dbf9fb6d39144cdd4eca3dab5b8ed2d3.png" title="f(x,y)=a_1+a_xx+a_yy+\sum_{i=1}^pw_iU(||(x_i,y_i)-(x,y)||)" alt="f(x,y)=a_1+a_xx+a_yy+\sum_{i=1}^pw_iU(||(x_i,y_i)-(x,y)||)" class="tex"/>
</p><p>ここで、<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-79150ff3c0545da1261d60ea5774478e.png" title="U(r)=r^2\log (r^2)\,\!" alt="U(r)=r^2\log (r^2)\,\!" class="tex"/>　です。 
</p><p>TPSグリッディングを実行するには、<a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="ユーザガイド:XYZグリッディングダイアログボックス">スムージング</a>のパラメータと補外パラメータを指定する必要があり、スムージングのパラメータは補間した曲面の滑らかさを制御し、 <a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="ユーザガイド:XYZグリッディングダイアログボックス">補外</a>パラメータは、元のデータの範囲を超えて行列のセルにデータを入力するのに使用されます。 
</p><p>TPSアルゴリズムについての詳細は、参考文献『<a href="../../UserGuide/UserGuide/References,_Matrix_Conversion_and_Gridding.html" title="ユーザガイド:行列変換とグリッディング">Donato and Belongie, Approximation Methods for Thin Plate Spline Mappings and Principal Warps</a>』をご覧下さい。
</p>
<h2><a name="Kriging_Correlation"></a><span class="mw-headline">Kriging相関法</span></h2>
<p>Kriging法(鉱山工学者の D. G Krigeの名前から付けられた)は、空間データを補間するのに、よく知られている地理統計学の手法です。この手法は、重み付けした隣接平均により、計算したい位置(グリッド点)での推定した分散を最小化する重み付け移動平均補間(補外)法です。そして、重み付けした値は元データの空間的な相関構造で決定します。 
</p><p>このアルゴリズムは、空間の連続性または従属性のモデルが必要です。通常、処理を2つに分けることができます。
</p>
<ol><li>計算したい領域毎に分けた変数の半分散図を作成します。Originは距離の情報を計算し、半分散値に変換して表に保存し、半分散値に重みを付けます。この半分散図は、入力データセットでの標本間の差の増分や相関の減少を説明するものです。 
</li><li>この従属モデルを使って、z値の空間ポイントの値を計算します。
</li></ol>
<p>Kriging相関法を実行するとき、次のパラメータを使って処理を制御することができます。
</p>
<ul><li><a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="ユーザガイド:XYZグリッディングダイアログボックス">滑らかさ</a>：補間の精度を制御します。
</li></ul>
<ul><li><a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="ユーザガイド:XYZグリッディングダイアログボックス">最小ポイント</a>: Zの計算に必要な最小の制御ポイントの数をセットします。
</li></ul>
<ul><li><a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="ユーザガイド:XYZグリッディングダイアログボックス">検索半径</a>：どれだけ離れたポイントをZの計算対象にするかを指定します。
</li></ul>
<p>Kriging法についての詳細は、参考文献『<a href="../../UserGuide/UserGuide/References,_Matrix_Conversion_and_Gridding.html" title="ユーザガイド:行列変換とグリッディング">Stein, Interpolation of Spatial Data</a>』をご覧ください。
</p>
<h2><a name="Weighted_Average"></a><span class="mw-headline">加重平均</span></h2>
<p>加重平均法は、1/rの重み付けを持つポイントの単純な加重平均で、rは、検索半径の範囲内にあるセルからの各ポイントの距離です。検索半径の範囲内に値が無い場合、少なくとも1ポイント出現するまで半径を拡大します。検索半径を拡大するということは、各ポイントは隣り合うポイントとの内部的な関係を強め、詳細な部分を失って、より滑らかな曲面を作成するということになります。
</p>




    