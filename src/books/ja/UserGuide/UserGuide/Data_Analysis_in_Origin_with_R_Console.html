<h1 class="firstheading">Ｒコンソールを使ったOriginでのデータ分析</h1><p class='urlname' style='display: none'>Analysis-Origin-Rconsole</p>
<div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Data_Analysis_in_Origin_with_R_Console"><span class="tocnumber">1</span> <span class="toctext">Ｒコンソールを使ったOriginでのデータ分析</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Install_packages"><span class="tocnumber">1.1</span> <span class="toctext">パッケージのインストール</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Calculating_the_Correlation_Coefficient_by_Using_Bootstrap"><span class="tocnumber">1.2</span> <span class="toctext">Bootstrapを使って相関係数を計算</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Simulate_Random_Walk_in_2D_Lattice"><span class="tocnumber">1.3</span> <span class="toctext">2D格子のランダムウォークをシミュレート</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Simulated_Annealing_to_find_the_global_minima"><span class="tocnumber">1.4</span> <span class="toctext">グローバル最小値の検索をアニーリングでシミュレート</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Manova_analysis"><span class="tocnumber">1.5</span> <span class="toctext">MANOVA分析</span></a></li>
</ul>
</li>
</ul>
</div>
<h2><a name="Data_Analysis_in_Origin_with_R_Console"></a><span class="mw-headline">Ｒコンソールを使ったOriginでのデータ分析</span></h2>
<p>Origin2016からＲコンソールとRserveコンソールツールが追加されました。これらを使って、RからOriginにデータを簡単に転送でき、Originの優れたグラフ作成機能を利用することが出来ます。また、Rコンソールダイアログとコマンドを使って、様々な範囲の統計機能やパッケージにRからアクセスして、Originで作成したデータを分析することが出来ます。 
統計データの分析シミュレーション向けに、Rコンソールの自由なアプリケーションを表示出来る視覚化サンプルをいくつか提供しています。
</p>
<h3><a name="Install_packages"></a><span class="mw-headline">パッケージのインストール</span></h3>
<p>これらのサンプルを実行するために、コンピュータにＲをインストールして、<a class="external text" href="https://cran.r-project.org/web/packages/boot/boot.pdf" target="_blank"><b>boot</b></a>と<a class="external text" href="https://cran.r-project.org/web/packages/GenSA/GenSA.pdf" target="_blank"><b>GenSA</b></a> というRパッケージをダウンロードします。Ｒのメインウィンドウを開き（OriginのRコンソールではありません）、次のスクリプトを実行してダウンロードしてください。 
</p>
<pre class="oc" style="font-family:monospace;">install.<span style="color: #000000;">packages</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;boot&quot;</span><span style="color: #000000;">)</span>
install.<span style="color: #000000;">packages</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;GenSA&quot;</span><span style="color: #000000;">)</span>
library<span style="color: #000000;">(</span>boot<span style="color: #000000;">)</span>
library<span style="color: #000000;">(</span>GenSA<span style="color: #000000;">)</span></pre>
<h3><a name="Calculating_the_Correlation_Coefficient_by_Using_Bootstrap"></a><span class="mw-headline">Bootstrapを使って相関係数を計算</span></h3>
<p>Rパッケージの<i>boot</i>では、bootstrapの容易な生成と統計分析の実行が行えます。このサンプルでは、このパッケージでのbootstrapを使って、相関係数をRコンソールで計算します。
</p>
<ol><li>新規のワークブックを作成し、<b>単一ASCIIのインポート</b> <a class="image"><img alt="Button Import Single ASCII.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Button_Import_Single_ASCII.png" width="23"  /></a>をクリックして、<i>\OriginLab\Origin2016\Samples\Statistics</i>から<i>LogRegData.dat</i>をインポートします。</li>
<li>メインメニューから<b>接続：Ｒコンソール</b>を選択してＲコンソールダイアログを開きます。</li>
<li><a class="image"><img alt="Select.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Select.png" width="24"  /></a> ボタンをクリックして、ワークシートにある最初の２列を選択します。データを<b>データフレーム</b>に設定し、Ｒオブジェクトボックスのオブジェクト名を<i>data</i>と入力します。<a class="image"><img alt="Send data.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Send_data.png" width="40"  /></a>ボタンをクリックして、データをOriginからRのスペースに移動します。
<dl><dd><a class="image"><img alt="Send data rconsole.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Send_data_rconsole.png" width="610"  /></a></dd></dl></li>
<li> 次に、下のスクリプトをＲコンソールのスクリプトインボックスで実行します。ボックスに貼り付けてEnterをクリックして実行します：</li></ol>
<pre class="oc" style="font-family:monospace;">library<span style="color: #000000;">(</span>boot<span style="color: #000000;">)</span>
f <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> function<span style="color: #000000;">(</span>d, i<span style="color: #000000;">)</span><span style="color: #000000;">{</span>
d2 <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> d<span style="color: #000000;">[</span>i,<span style="color: #000000;">]</span>
<span style="color: #0000ff;">return</span><span style="color: #000000;">(</span>cor<span style="color: #000000;">(</span>d2$Age, d2$Salary<span style="color: #000000;">)</span><span style="color: #000000;">)</span>
<span style="color: #000000;">}</span>
bootcorr <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> boot<span style="color: #000000;">(</span>data, f, R<span style="color: #000080;">=</span><span style="color: #0000dd;">500</span><span style="color: #000000;">)</span>
summary<span style="color: #000000;">(</span>bootcorr<span style="color: #000000;">)</span></pre>
<p>5.  計算結果は、Rオブジェクト<b>bootcorr</b>に保存され、bootstrapそれぞれの相関は<b>bootcorr$t</b>に保存されます。次に新しいワークブックを作成し、<a class="image"><img alt="Get data.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Get_data.png" width="40"  /></a> をクリックして、R オブジェクト<b>bootcorr$t</b>をA列にベクトルで入力します。A列に結果の500行の結果データが入力されます。
</p>
<dl><dd><a class="image"><img alt="Get data rconsole.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Get_data_rconsole.png" width="610"  /></a></dd></dl>
<p>6.  A列をクリックして、<b>作図：統計：ヒストグラム</b>を選択し、ヒストグラムを作成します。次に、<a class="external text" href="../../Tutorial/Tutorial/Histogram_with_Distribution_Curve_overlay.html">分布曲線の作図</a>を行い色を編集すると、下図のグラフが得られます。
</p>
<dl><dd><a class="image"><img alt="Bootstrip.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Bootstrip.png" width="550"  /></a></dd></dl>
<p><br />
</p>
<h3><a name="Simulate_Random_Walk_in_2D_Lattice"></a><span class="mw-headline">2D格子のランダムウォークをシミュレート</span></h3>
<p>Ｒでは、ランダムサンプルと行列操作の効率的な機能があります。ここでは、Rでランダムウォークデータを生成し、Originの色付き折れ線でルートを示したランダムウォークの例を実演します。
</p>
<ol><li>3つの列がある新規のワークブックを作成します。</li>
<li>メインメニューの<b>接続：Ｒコンソール</b>を選択して、ダイアログを開き、次のランダムウォーク生成のスクリプトを実行します：</li></ol>
<pre class="oc" style="font-family:monospace;">step <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> <span style="color: #0000dd;">2000</span>
walk <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> matrix<span style="color: #000000;">(</span><span style="color: #0000dd;">0</span>, ncol <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>, nrow<span style="color: #000080;">=</span>step<span style="color: #000000;">)</span>      
index <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> cbind<span style="color: #000000;">(</span>seq<span style="color: #000000;">(</span>step<span style="color: #000000;">)</span>, sample<span style="color: #000000;">(</span>c<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>, step, <span style="color: #0000ff;">TRUE</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>
walk <span style="color: #000000;">[</span>index<span style="color: #000000;">]</span> <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> sample<span style="color: #000000;">(</span>c<span style="color: #000000;">(</span><span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>, step, <span style="color: #0000ff;">TRUE</span><span style="color: #000000;">)</span>
walk <span style="color: #000000;">[</span>,<span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> cumsum<span style="color: #000000;">(</span>walk<span style="color: #000000;">[</span>, <span style="color: #0000dd;">1</span><span style="color: #000000;">]</span><span style="color: #000000;">)</span>
walk <span style="color: #000000;">[</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">]</span> <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> cumsum<span style="color: #000000;">(</span>walk<span style="color: #000000;">[</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">]</span><span style="color: #000000;">)</span>
walk <span style="color: #000000;">[</span>,<span style="color: #0000dd;">3</span><span style="color: #000000;">]</span> <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span>seq<span style="color: #000000;">(</span>step<span style="color: #000000;">)</span></pre>
<p>Enterを押してスクリプトを実行します。
</p><p>3.  <i>[Book1]Sheet1!A:C</i>にＲオブジェクトを<b>行列</b>として送ります。
</p><p><a class="image"><img alt="Send data rconsole rwk.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Send_data_rconsole_rwk.png" width="610"  /></a>
</p><p>4.  Book1のsheet1にある列Bを選択して折れ線を作成します。<a class="external text" href="../../UserGuide/UserGuide/Using_a_Dataset_to_Control_Plot_Color.html#Color_Mapping">列Ｃのデータは線の色を制御に使い</a>、<a class="external text" href="../../UserGuide/UserGuide/Color_Scales.html">カラースケール</a>と色調を編集します。
</p>
<dl><dd><a class="image"><img alt="Randomwork.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Randomwork.png" width="535"  /></a></dd></dl>
<h3><a name="Simulated_Annealing_to_find_the_global_minima"></a><span class="mw-headline">グローバル最小値の検索をアニーリングでシミュレート</span></h3>
<p>サンプルを実行する前に、<a href="../../UserGuide/UserGuide/Data_Analysis_in_Origin_with_R_Console.html#Install_packages" title="ユーザガイド：Ｒコンソールを使ったOriginでのデータ分析"> GenSAパッケージをインストール</a>します。
</p><p>アニーリングシミュレーションは、非線形曲線で発生する問題のグロ―バルな最小値を見つける方法です。ここでは、Ｒで<b>GenSA</b>パッケージを使って、テスト関数でのアニーリングシミュレーションを実行し、範囲内<img src="../images/Data_Analysis_in_Origin_with_R_Console/math-63752bebb1d7e5b20e33c4d11a17865a.png" title="X,Y\in [-10,10]" alt="X,Y\in [-10,10]" class="tex"/>のＺ最小値を検索します。
</p><p><img src="../images/Data_Analysis_in_Origin_with_R_Console/math-d4ec28dfc40a66a0b689e8f3a71d0bbe.png" title="
z=0.26(x^2+y^2)-0.48xy
" alt="
z=0.26(x^2+y^2)-0.48xy
" class="tex"/>
</p><p>Ｒで計算した後、結果データをOriginに送り、等高線を作成して結果を可視化します。また、それぞれの移動ステップで折れ線を作成し、取得される最小値を検出します。
</p><p>1.  メインメニューから<b>接続：Rコンソール</b>を選択し、スクリプトボックスに次のスクリプトを入力して、Enterを押して実行します。
</p>
<pre class="oc" style="font-family:monospace;">fr <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> function<span style="color: #000000;">(</span>vx<span style="color: #000000;">)</span><span style="color: #000000;">{</span>
x <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> vx<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>
y <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> vx<span style="color: #000000;">[</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span>   
<span style="color: #0000dd;">0.26</span><span style="color: #000040;">*</span><span style="color: #000000;">(</span>x<span style="color: #000040;">^</span><span style="color: #0000dd;">2</span><span style="color: #000040;">+</span>y<span style="color: #000040;">^</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span><span style="color: #000040;">-</span><span style="color: #0000dd;">0.48</span><span style="color: #000040;">*</span>x<span style="color: #000040;">*</span>y<span style="color: #000000;">}</span>
set.<span style="color: #000000;">seed</span><span style="color: #000000;">(</span><span style="color: #0000dd;">25</span><span style="color: #000000;">)</span>
dimension <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span><span style="color: #0000dd;">2</span>
global.<span style="color: #000000;">min</span> <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> <span style="color: #0000dd;">0</span>
tol <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> 1e<span style="color: #000040;">-</span>13
lower <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> c<span style="color: #000000;">(</span><span style="color: #000040;">-</span><span style="color: #0000dd;">10</span>,<span style="color: #000040;">-</span><span style="color: #0000dd;">10</span><span style="color: #000000;">)</span>
upper <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> c<span style="color: #000000;">(</span><span style="color: #0000dd;">10</span>,<span style="color: #0000dd;">10</span><span style="color: #000000;">)</span>
out <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> GenSA<span style="color: #000000;">(</span>lower <span style="color: #000080;">=</span> lower, upper <span style="color: #000080;">=</span> upper, fn <span style="color: #000080;">=</span> fr,
control<span style="color: #000080;">=</span>list<span style="color: #000000;">(</span>temperature<span style="color: #000080;">=</span><span style="color: #0000dd;">200</span>,threshold.<span style="color: #000000;">stop</span><span style="color: #000080;">=</span>global.<span style="color: #000000;">min</span><span style="color: #000040;">+</span>tol,verbose<span style="color: #000080;">=</span><span style="color: #0000ff;">TRUE</span>,max.<span style="color: #000000;">call</span><span style="color: #000080;">=</span>1E3<span style="color: #000000;">)</span><span style="color: #000000;">)</span>
#output the results
<span style="color: #000000;">sprintf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Global minima for the function is:&nbsp;%.3f at (%.3f,&nbsp;%.3f)&quot;</span>, out$value, out$par<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>,out$par<span style="color: #000000;">[</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span><span style="color: #000000;">)</span></pre>
<p>結果の出力は：
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #ff00ff;">「この関数でのグローバル最小値: 0.000 at (0.000, 0.000)&quot;</span></pre>
<p>最小ポイントと一緒に等高線を作成するには：
</p><p>2.  標準ツールバーの<b>3D関数グラフ</b> ボタン<a class="image"><img alt="Button New 3D Plot.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Button_New_3D_Plot.png" width="22"  /></a>をクリックし、次のグラフの様に関数を設定します：
</p>
<dl><dd><a class="image"><img alt="Func plot r.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Func_plot_r.png" width="447"  /></a></dd></dl>
<p>3.  OKをクリックして、3D曲面図を作成します。<a class="external text" href="../../UserGuide/UserGuide/The_(Plot_Details)_Color_Map_Contours_Tab.html">作図の詳細 カラーマップ</a> タブでカラーマップを指定することが出来ます。.<br />
4.  新規のワークブックを作成し、列を3つ作って、それぞれの列属性をXYZにします。最初の行に(0,0,0) を入力して、作成した3Dグラフに列を選択してドラッグでグラフに挿入します。1つの散布図ポイントがグラフに追加されますので、<a class="external text" href="../../UserGuide/UserGuide/The_(Plot_Details)_Label3_Tab.html">作図の詳細 ラベル</a>タブで、散布図にラベルテキストを追加編集します。
</p>
<dl><dd><a class="image"><img alt="Minimum label.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Minimum_label.png" width="732"  /></a></dd></dl>
<p>完成したグラフは次のようになります。
</p>
<dl><dd><a class="image"><img alt="Minimum.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Minimum.png" width="377"  /></a></dd></dl>
<h3><a name="Manova_analysis"></a><span class="mw-headline">MANOVE分析</span></h3>
<p>このサンプルでは、看護グループでの労働費について、多変量解析を実行してみます。
2つの予測値：所有権と認可、3つの従属変数：看護労働費、ハウスキーピング労働費、メンテナンス費用があります。異なる所有権と認可では労働費も異なるのかどうかを知るために、ＲコンソールのデータでMANOVAを実行します。
</p>
<ol><li><a class="external text" href="http://www.originlab.com/ftp/Documentation/R/LaborCost.zip" target="_blank"><b>LaborCost.zip</b></a>からデータをダウンロードし、解凍して<i>LaborCost.dat</i>を入手します。Originで新規のワークブックを開き、ドラッグ＆ドロップでこのデータをOriginにインポートしてください。</li>
<li><a class="image"><img alt="Select.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Select.png" width="24"  /></a> ボタンをクリックして、ワークシートにある全ての5列を選択します。データを<b>データフレーム</b>に設定し、Ｒオブジェクトボックスのオブジェクト名を<i>CostData</i>と入力します。<a class="image"><img alt="Send data.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Send_data.png" width="40"  /></a>ボタンをクリックして、データをOriginからRのスペースに移動します。</li>
<li>入力ボックスでRスクリプトを実行</li></ol>
<pre class="oc" style="font-family:monospace;">Cost<span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span>data.<span style="color: #000000;">matrix</span><span style="color: #000000;">(</span>CostData<span style="color: #000000;">[</span>,<span style="color: #0000dd;">3</span><span style="color: #000000;">:</span><span style="color: #0000dd;">5</span><span style="color: #000000;">]</span><span style="color: #000000;">)</span>
Ownership<span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span>CostData<span style="color: #000000;">[</span>,<span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>
Certification<span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span>CostData<span style="color: #000000;">[</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">]</span>
fit <span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span> manova<span style="color: #000000;">(</span>Cost ~ Ownership<span style="color: #000040;">*</span>Certification<span style="color: #000000;">)</span>
summary<span style="color: #000000;">(</span>fit, test<span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Pillai&quot;</span><span style="color: #000000;">)</span></pre>
<p>データフレームに入れる結果を入れ替えることが出来ます。<i>df</i>をOriginのワークシートにデータフレームとして渡します。
</p>
<pre class="oc" style="font-family:monospace;">sum<span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span>summary<span style="color: #000000;">(</span>fit, test<span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Pillai&quot;</span><span style="color: #000000;">)</span>
df<span style="color: #000080;">&lt;</span><span style="color: #000040;">-</span>as.<span style="color: #000000;">data</span>.<span style="color: #000000;">frame</span><span style="color: #000000;">(</span>sum$stats<span style="color: #000000;">)</span></pre>
<dl><dd><a class="image"><img alt="Manova df.png" src="../images/Data_Analysis_in_Origin_with_R_Console/Manova_df.png" width="726"  /></a></dd></dl>
<p>所有権のＰ値が0.01よりも小さいので労働費の平均に影響する所有権はないと考えられます。
しかし、認定のＰ値が0.089なので結果がほぼ有意であることを示し、3タイプの認定での労働費の平均はそれぞれ異なる可能性があります。
</p>

    