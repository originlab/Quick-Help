<h1 class="firstheading">R二乗に関する追加情報</h1>
<p class="urlname" style="display: none;">Details_of_R_square</p>
<p>フィットの良さは、どのように決まるのでしょうか?1つの明確な基準は、フィット曲線が実際のデータポイントにどの程度近いのかということです。前の<a href="../../UserGuide/Category/Interpreting_Regression_Results.html#Illustration_of_the_Least-Squares_Method" title="カテゴリー:回帰結果の解釈">セクション</a>から、残差二乗和 (<i>RSS</i>) または既約カイ二乗値が、このような距離を評価するのに使用できる定量的な値であることが分かっています。しかし、残差二乗和(<i>RSS</i>) の値は、データセットによって異なり、この値を一定の範囲で再スケールする必要があります。一方、データの特徴を説明するために y 値の平均を使いたいこともあります。このような場合、フィット曲線は水平線<img src="../images/Details_of_R_square/math-70816b25c4d584534e7df04fc17bf02f.png" title="y=\overline{y}" alt="y=\overline{y}" class="tex" border="0" />になり、 予測変数 x は線形的に y 値を予測できません。これを確認するには、最初に、次のような式でデータポイントとその平均との差、平均についての二乗和を計算します。</p>
<p><img src="../images/Details_of_R_square/math-d13055e359b42226d0b8ae6ba915df63.png" title="TSS=\sum_{i=1}^n(y_i-\overline{y})^2 \,\!" alt="TSS=\sum_{i=1}^n(y_i-\overline{y})^2 \,\!" class="tex" border="0" /></p>
<p>最小二乗フィッティングでは、<i>TSS</i> を回帰によって明らかになる変化量と回帰によって明らかにならない変化量の2つの部分に分けることができます。</p>
<table class="simple">
<tr>
<td>
<ul>
<li>回帰の二乗和 <i>SSreg</i> は、回帰モデルで明らかになる変化量の一部です。</li>
</ul>
</td>
<td>
<p><img src="../images/Details_of_R_square/math-f4247da7269e1f6bd96b1cb786a8daa7.png" title="SSreg=\sum_{i=1}^n(\widehat{y_i}-\overline{y})^2 \,\!" alt="SSreg=\sum_{i=1}^n(\widehat{y_i}-\overline{y})^2 \,\!" class="tex" border="0" /></p>
</td>
</tr>
<tr>
<td>
<ul>
<li>残差の二乗和 <i>RSS</i> は、回帰モデルで明らかにならない 変化量の一部です。</li>
</ul>
</td>
<td>
<p><img src="../images/Details_of_R_square/math-634bbb984efc22841c46916fdb141a1e.png" title="RSS=\sum_{i=1}^n(y_i-\widehat{y_i})^2 \,\!" alt="RSS=\sum_{i=1}^n(y_i-\widehat{y_i})^2 \,\!" class="tex" border="0" /></p>
</td>
</tr>
</table>
<p>明らかに、データポイントはフィット曲線に近いほどば、<i>RSS</i> が小さくなり、<i>SSreg</i>で表される合計変化量の比率は大きくなります。つまり、<i>TSS</i>に対する <i>SSreg</i> の比は、 回帰モデルの性質の1つの尺度として使うことができます。この量は、<b>決定係数</b>と呼ばれ、次の式で計算されます。</p>
<p><img src="../images/Details_of_R_square/math-c816efca2c109e12f1095236ff58d882.png" title="R^2=\frac{SSreg}{TSS}=1-\frac{RSS}{TSS} \,\!" alt="R^2=\frac{SSreg}{TSS}=1-\frac{RSS}{TSS} \,\!" class="tex" border="0" /></p>
<p>上記の式から、良いフィットモデルを使うと、<img src="../images/Details_of_R_square/math-e31b458b48dd58470b662e66b9742071.png" title="R^2" alt="R^2" class="tex" border="0" /> は0から1の間で変化するということが分かります。1に近い値は、フィットが良いものだということを示しています。</p>
<p>数学的には、自由度が <img src="../images/Details_of_R_square/math-e31b458b48dd58470b662e66b9742071.png" title="R^2" alt="R^2" class="tex" border="0" /> に影響します。それは、モデルに変数を追加すると、<img src="../images/Details_of_R_square/math-e31b458b48dd58470b662e66b9742071.png" title="R^2" alt="R^2" class="tex" border="0" /> が大きくなりますが、これはフィットが良くなったことを示しているわけではありません。この影響を避けるため、調整 <img src="../images/Details_of_R_square/math-e31b458b48dd58470b662e66b9742071.png" title="R^2" alt="R^2" class="tex" border="0" /> を見ることができます。</p>
<p><img src="../images/Details_of_R_square/math-56ed207e01d9d11e34c2fa201b98e00b.png" title="\overline{R}^2=1-\frac{RSS/df_{Error}}{TSS/df_{Total}} \,\!" alt="\overline{R}^2=1-\frac{RSS/df_{Error}}{TSS/df_{Total}} \,\!" class="tex" border="0" /></p>
<p>数式から、補正 <img src="../images/Details_of_R_square/math-e31b458b48dd58470b662e66b9742071.png" title="R^2" alt="R^2" class="tex" border="0" /> が <img src="../images/Details_of_R_square/math-e31b458b48dd58470b662e66b9742071.png" title="R^2" alt="R^2" class="tex" border="0" /> の増加に勝っていることが分かります。特に複数の予測変数 (k) モデルでサンプルサイズ <i>(n)</i> が小さいフィットの場合にそうなります。通常、決定係数を「R二乗値」と呼びますが、実際には R値の二乗ではありません。ほとんどの場合、その値は0から1の間になりますが、フィット結果が良くないときにはR^2 は負の値になることもあります。これは、<img src="../images/Details_of_R_square/math-e31b458b48dd58470b662e66b9742071.png" title="R^2" alt="R^2" class="tex" border="0" /> を計算する数式が <img src="../images/Details_of_R_square/math-fe4da21819f56a1c315ec606c5fd159f.png" title="R^2 = 1 - RSS / TSS" alt="R^2 = 1 - RSS / TSS" class="tex" border="0" /> であるために起こります。悪いモデルが使われた場合、2番目の項が1より大きくなります。</p>
<p>しかし、<img src="../images/Details_of_R_square/math-e31b458b48dd58470b662e66b9742071.png" title="R^2" alt="R^2" class="tex" border="0" /> あるいは補正 <img src="../images/Details_of_R_square/math-e31b458b48dd58470b662e66b9742071.png" title="R^2" alt="R^2" class="tex" border="0" /> を使うことは十分ではありません。例えば、次のグラフでは、プロットBからDで表されるフィット曲線は、高い <img src="../images/Details_of_R_square/math-e31b458b48dd58470b662e66b9742071.png" title="R^2" alt="R^2" class="tex" border="0" /> 値になりますが、見かけ上のモデルが不適切です。そのため、残差分析によって回帰の結果を診断する必要があります。</p>
<dl>
<dd><a class="image" style="color: #0000ff; text-decoration: underline;"><img alt="Goodness of Fit.jpg" src="../images/Details_of_R_square/Goodness_of_Fit.jpg" width="468" height="341" border="0" /></a></dd>
</dl>
<h2><a name="R-Sqaure_in_Linear_Fit" id="R-Sqaure_in_Linear_Fit"></a><span class="mw-headline">線形フィットでのR二乗</span></h2>
<h3><a name="Linear_Fit_for_Intercept_Included" id="Linear_Fit_for_Intercept_Included"></a><span class="mw-headline">交点を含む線形フィット</span></h3>
<p>線形フィットに交点が含まれている場合、以下の関係に基づきます。</p>
<dl>
<dd><img src="../images/Details_of_R_square/math-f27785e30b46e8d63fc44e61bc5097d7.png" title="\sum_{i=1}^n (y_i-\bar{y})^2 = \sum_{i=1}^n (y_i-f(x_i))^2 + \sum_{i=1}^n (f(x_i)-\bar{y})^2" alt="\sum_{i=1}^n (y_i-\bar{y})^2 = \sum_{i=1}^n (y_i-f(x_i))^2 + \sum_{i=1}^n (f(x_i)-\bar{y})^2" class="tex" border="0" /></dd>
</dl>
<p>ここで、<img src="../images/Details_of_R_square/math-d50c99fc89a5682178a3b7e60966f560.png" title="(x_i, y_i) \; i=1..n \;" alt="(x_i, y_i) \; i=1..n \;" class="tex" border="0" />はフィットデータ、 <img src="../images/Details_of_R_square/math-bacfc7141fdfd692244b6c50891d1f7b.png" title="\bar{y}" alt="\bar{y}" class="tex" border="0" />は従属変数の平均、<img src="../images/Details_of_R_square/math-2545f6aff9e599f7b0731247906b6b00.png" title="f(x_i) \;" alt="f(x_i) \;" class="tex" border="0" />はフィット値を表しています。</p>
<p>上記数式の左辺は総平方和を表します。</p>
<dl>
<dd><img src="../images/Details_of_R_square/math-65662ccc390f7d7235cfde7790068791.png" title="TSS = \sum_{i=1}^n (y_i-\bar{y})^2" alt="TSS = \sum_{i=1}^n (y_i-\bar{y})^2" class="tex" border="0" /></dd>
</dl>
<p>右辺の最初の項は残差平方和を表します。</p>
<dl>
<dd><img src="../images/Details_of_R_square/math-5b6fe5a5e38d5b1e0c1295c200aef14f.png" title="RSS = \sum_{i=1}^n (y_i-f(x_i))^2" alt="RSS = \sum_{i=1}^n (y_i-f(x_i))^2" class="tex" border="0" /></dd>
</dl>
<p>右辺の2番目の項は、回帰による平方和を表します。</p>
<dl>
<dd><img src="../images/Details_of_R_square/math-98c4dfa1b52ea241deb3e3f72a8ede46.png" title="SSR = \sum_{i=1}^n (f(x_i)-\bar{y})^2" alt="SSR = \sum_{i=1}^n (f(x_i)-\bar{y})^2" class="tex" border="0" /></dd>
</dl>
<p>よって、<i><b>TSS = RSS + SSR</b></i>.が成り立ちます。</p>
<p>決定係数（R二乗値）はSSRとTSSの比率で定義されます。</p>
<dl>
<dd><img src="../images/Details_of_R_square/math-87012079a131e26d822f0af602776401.png" title="R^2=\frac{SSR}{TSS}=1-\frac{RSS}{TSS}=1-\frac{\sum_{i=1}^n (y_i-f(x_i))^2}{\sum_{i=1}^n (y_i-\bar{y})^2}" alt="R^2=\frac{SSR}{TSS}=1-\frac{RSS}{TSS}=1-\frac{\sum_{i=1}^n (y_i-f(x_i))^2}{\sum_{i=1}^n (y_i-\bar{y})^2}" class="tex" border="0" /></dd>
</dl>
<p>よって、<b>R二乗値</b>は交点を含んだときのフィット結果で説明できる平均についての偏差の比率を表しています。</p>
<h3><a name="Linear_Fit_for_Fixed_Intercept" id="Linear_Fit_for_Fixed_Intercept"></a><span class="mw-headline">固定切片のための線形フィット</span></h3>
<p>線形フィットで切片が固定されている場合、上記<a href="#Linear_Fit_for_Intercept_Included">切片を含む線形フィット</a>で説明された関係は満たされなくなります。悪いフィットの場合、 <a href="#Linear_Fit_for_Intercept_Included">切片を含む線形フィット</a>で定義した式では負の<b>R二乗値</b>を生む結果になってしまう可能性もあります。それでは、意味をなしません。</p>
<p>線形フィットの切片が固定されている場合、以下の関係に基づきます。</p>
<dl>
<dd><img src="../images/Details_of_R_square/math-4bb63ecc585d86a8829dec4019fe998f.png" title="\sum_{i=1}^n y_i^2 = \sum_{i=1}^n (y_i-f(x_i))^2 + \sum_{i=1}^n (f(x_i))^2" alt="\sum_{i=1}^n y_i^2 = \sum_{i=1}^n (y_i-f(x_i))^2 + \sum_{i=1}^n (f(x_i))^2" class="tex" border="0" /></dd>
</dl>
<p>そして、<b>TSS</b>と<b>SSR</b>は再定義する必要があり、<b>RSS</b>については変更はありません。</p>
<dl>
<dd><img src="../images/Details_of_R_square/math-898716dfe4c0756a5032aff8d5101712.png" title="TSS = \sum_{i=1}^n y_i^2" alt="TSS = \sum_{i=1}^n y_i^2" class="tex" border="0" /></dd>
</dl>
<dl>
<dd><img src="../images/Details_of_R_square/math-120a95f050e837d97b73fecc20722464.png" title="SSR = \sum_{i=1}^n (f(x_i))^2" alt="SSR = \sum_{i=1}^n (f(x_i))^2" class="tex" border="0" /></dd>
</dl>
<p>決定係数（<b>R二乗値</b>）は以下のように再定義されます。</p>
<dl>
<dd><img src="../images/Details_of_R_square/math-5b936b2331157d838945fac4f2fa4bda.png" title="R^2=\frac{SSR}{TSS}=1-\frac{RSS}{TSS}=1-\frac{\sum_{i=1}^n (y_i-f(x_i))^2}{\sum_{i=1}^n y_i^2}" alt="R^2=\frac{SSR}{TSS}=1-\frac{RSS}{TSS}=1-\frac{\sum_{i=1}^n (y_i-f(x_i))^2}{\sum_{i=1}^n y_i^2}" class="tex" border="0" /></dd>
</dl>
<p>この方法で、R二乗値は常に整数(負の数ではない)になります。また、<b>R二乗値</b>は切片を固定したときのフィット結果で説明できる0付近の値についての偏差の比率を表しています。</p>
