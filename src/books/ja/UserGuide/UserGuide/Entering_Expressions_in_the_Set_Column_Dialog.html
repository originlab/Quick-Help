<h1 class="firstheading">「値の設定」ダイアログボックスに数式を入力する</h1><p class='urlname' style='display: none'>Wks-SetColVal-Expression</p>
<p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Expression_Basics"><span class="tocnumber">1</span> <span class="toctext">数式の基本</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Useful_Tips_for_Inputting_Expressions"><span class="tocnumber">1.1</span> <span class="toctext">数式入力のヒント</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3"><a href="#Add_Expressions_only_in_Column_Formula"><span class="tocnumber">2</span> <span class="toctext"><i>列の計算式</i>にのみ数式を追加する</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Add_Expressions_only_in_Before_Formula_Scripts"><span class="tocnumber">3</span> <span class="toctext"><i>実行前の処理スクリプト</i>にのみ数式を追加する</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Add_Expressions_in_both_Column_Formula_and_Before_Formula_Scripts"><span class="tocnumber">4</span> <span class="toctext"><i>列の計算式</i>と<i>実行前の処理スクリプト</i>の両方に数式を追加する</span></a></li>
</ul>
</div>
<h2><a name="Expression_Basics"></a><span class="mw-headline">数式の基本</span></h2>
<p><b>値の設定</b>ダイアログで使われる計算式は、LabTalkのロジックに従います。計算式には、<a class="external text" href="../../LabTalk/LabTalk/Operators.html#Arithmetic_Operators">算術演算</a>、<a class="external text" href="../../LabTalk/LabTalk/Range_Notation.html">範囲(range)変数</a>、<a class="external text" href="../../LabTalk/Script/LabTalk-Supported_Functions.html">組込のLabTalk関数</a>、<a href="../../UserGuide/UserGuide/Create_a_User_Defined_Function_for_Set_Column_Values.html" title="ユーザガイド：列値の設定を行うためのユーザ定義式を作成する">ユーザ定義関数</a> などを含めることができます。数式を定義する場所が2ケ所あります。
</p>
<ul><li><b>列の計算式</b>。1行の計算式を入力します。</li>
<li><b>実行前の処理スクリプト</b>。複数行のLabTalkスクリプトをここに入力でき、これは<b>列の計算式</b>編集ボックスにある計算式を使って列の値がセットされる前に実行されます。</li></ul>
<p>サンプルを利用できます。ダイアログメニューの<b>計算式：サンプルのロード</b>を選択して取得できます。
</p>
<dl><dd><a  class="image"><img alt="SetColumnValue1.png" src="../images/Entering_Expressions_in_the_Set_Column_Dialog/SetColumnValue1.png" width="994"  /></a></dd></dl>
<h3><a name="Useful_Tips_for_Inputting_Expressions"></a><span class="mw-headline">数式入力のヒント</span></h3>
<p>Origin 2017 SR0からは、デフォルトで<a href="../../UserGuide/UserGuide/Folder_and_Window_Properties_Dialog.html#The_User_Tree_tab" title="ユーザガイド：フォルダとウィンドウのプロパティダイアログ">スプレッドシートセル表記 (SCN)</a>が有効になっています。SCNが有効の時、シンプルSCNや2017より前のバージョンをお使いの場合は、<b>列値の設定</b>ボックスか<a href="../../UserGuide/UserGuide/Displaying_Supporting_Data_in_Worksheet_header_Rows.html#F.28x.29.3D" title="ユーザガイド:ワークシートヘッダ行に表示するサポートデータ"><b>F(x)=</b>列ラベル行</a>のいずれかで、新しい表記、または、旧表記の利用が可能です。ただし、これは実行前の処理スクリプトでcol()やwcol()関数を使う場合、<b>実行前の処理スクリプト</b>にスクリプトを入力する場合や、ブラケット「<b>{}</b>」 <i><b><a href="../../UserGuide/UserGuide/Quick_Start_SetColumnValues.html#A_Note:_When_Column_Formulas_do_not_Automatically_Update" title="ユーザガイド:クィックスタート 列値の設定">some limitations apply</a></b></i>を使う場合です。
</p>
<ul><li>ショートネームで直接列を参照する場合、3文字までのショートネームに制限されます。そうでない場合、列参照は認識されません。ショートネームが3文字を超える場合、 <b>col()</b> または <b>wcol()</b>を使用します。2017より前の表記ではこの制限はありません。</li>
<li>Origin 2022bから、ワークシート内に同じロングネームの列が複数ある場合、重複したロングネームの列を指定するためにショートネームとロングネームの両方を使用できます。シンタックスは、以下の通りです。 <pre class="lt" style="font-family:monospace;">col<span style="color: #000000;">(</span>ShortName<span style="color: #ff00ff;">&quot;LongName&quot;</span><span style="color: #000000;">)</span></pre> ショートネームを省略した場合、指定した <i>LongName</i> の列の中で最も左側にある列を参照します。</li>
<li> <a href="../../UserGuide/UserGuide/Menu_Options_and_Dialog_Controls.html#Variables_Menu" title="ユーザガイド:メニューとダイアログのオプション">変数メニュー</a>は、計算式で使用する変数を定義する助けとなります。 </li>
<li> Originは、<b>関数</b>メニューに数多くの<a class="external text" href="../../LabTalk/Script/LabTalk-Supported_Functions.html">組み込み関数</a>を用意しており、これらを計算式で利用することができます。<b>関数の検索と挿入</b>ダイアログを使って、組み込み関数の検索が可能です。</li>
<li> また、自分で<a href="../../UserGuide/UserGuide/Create_a_User_Defined_Function_for_Set_Column_Values.html" title="ユーザガイド：列値の設定を行うためのユーザ定義式を作成する">ユーザ定義関数を作成</a>することもできます。</li>
<li> 関数内の簡易列表記を<a class="external text" href="../../LabTalk/LabTalk/Token_(function).html">Token</a>等の文字列パラメータとともに使用する場合、一重引用符の代わりに二重引用符を使用する必要があります。</li>
<li> 文字 <b><b>i</b></b>と<b><b><b>j</b></b></b>は予約した<a class="external text" href="../../LabTalk/LabTalk/System_Variables.html#X.2C_Y.2C_Z.2C_I.2C_J.2C_E.2C_T.2C_Count">システム変数</a>で、現在の行インデックスと列インデックスをそれぞれ保存しています。列に行番号を入力したい場合は<b>i</b>を、列番号を入力したい場合は<b>j</b>を<b>列の計算式</b>に直接入力します。</li>
<li> <b>i</b>と<b>j</b>を列の式で使う場合、(または、<a href="../../UserGuide/UserGuide/Displaying_Supporting_Data_in_Worksheet_header_Rows.html#F.28x.29.3D" title="ユーザガイド:ワークシートヘッダ行に表示するサポートデータ">F(x)= セル</a>の場合、） ショートネームとの重複しないように小文字を使って参照します。</li>
<li> LabTalkの<a class="external text" href="../../LabTalk/LabTalk/Operators.html#Conditional_Operator_.28.3F:.29">条件演算子</a>を使って列または範囲にデータを入力することができます。たとえば（4番目の列に入力する場合）、<b>列の計算式</b>に<b>col(3)==1?col(1):col(2)</b>と入力して、3列目の値が1だった場合は1列目の値を4列目にコピーし、3列目の値が1以外の場合は2列目の値を4列目にコピーする、という処理が可能です。</li>
<li> <b>列の計算式</b>で<b>{}</b>表記を使うと、選択した列に\一連の等間隔の数字を入力できます。 </li></ul>
<dl><dd><ul><li> <b>{begin:step:end}</b> と入力すると、<b>begin</b>で開始して、増分<b>step</b>で<b>end</b>で終了する一連の数字を入力します。 </li>
<li> <b>{begin:end}</b> と入力すると、<b>begin</b>で開始して、増分<b>1</b>で<b>end</b>で終了する一連の数字を入力します。</li></ul></dd></dl>
<ul><li> 他のブックとシートからのデータはいくつかの方法で関連付けることができます。</li></ul>
<dl><dd><ul><li> <a href="../../UserGuide/UserGuide/Quick_Start_SetColumnValues.html#Column_Formula_Examples" title="ユーザガイド:クィックスタート 列値の設定">直接参照</a>を使って、[Book3]Sheet1!C (列)や[Book3]Sheet1!C1 (セル)に関連付けます。</li>
<li> <a href="../../UserGuide/UserGuide/Menu_Options_and_Dialog_Controls.html#Variables_Menu" title="ユーザガイド:メニューとダイアログのオプション">変数メニュー</a></li>
<li> 式の編集ボックスにあるLabTalkの<a class="external text" href="../../LabTalk/LabTalk/String_Substitution.html#Calculation_Involving_Datasets_from_Another_Sheet">置換表記</a>を直接入力します。 </li></ul></dd></dl>
<ul><li> Col(i)の値を設定する場合、式の中に&quot;Col(i)= ...&quot;のように入力せずに、直接入力できます。</li>
<li> シンタックスを色で表現：<a class="external text" href="../../LabTalk/Script/LabTalk-Supported_Functions.html">LabTalk関数</a> は <b>ワイン色</b>、 <a href="../../UserGuide/UserGuide/Worksheet_Column_and_Cell_Range_Naming_Conventions.html#Origin_worksheet_column_naming_conventions" title="ユーザガイド:ワークシート、列、セル範囲の命名規則">列のショートネーム</a> は <b>赤色</b>、<a class="external text" href="../../LabTalk/LabTalk/Data_Types_and_Variables.html#Variables">LabTalk変数</a> は<b>ネイビー色</b>で表示されます。</li></ul>
<h2><a name="Add_Expressions_only_in_Column_Formula"></a><span class="mw-headline"><i>列の計算式</i>にのみ数式を追加する</span></h2>
<p><b>列の計算式</b>に1行の数式を入力して、<b>実行前の処理スクリプト</b>は空白にしておくことができます。<b>列の計算式</b>編集ボックス内の式は組み込み関数とユーザ定義関数を含めることができます。以下のサンプルで、これらの関数の使用方法をご紹介します。 
</p><p><b>サンプル 1</b>
</p>
<ol><li>新しいワークブックを作成します。 </li>
<li>列Aを選択し、右クリックして<b>列値の一律設定：行番号</b>を選択します。</li>
<li>列Bを選択し、右クリックして、<b>列値の設定</b>を選び、<b>値の設定</b>ダイアログを開きます。<b>関数: 三角関数・双曲線関数: Cos(x)</b> を選択し、<b>cos(x)</b> を<b>列の計算式</b>編集ボックスに追加します。変数xを選択し、値の設定メニューで、<b>Col(A): Col(A)</b>を選択します。これで、表記は<b>cos(A)</b>となります。<b>OK</b>をクリックすると、対応するA列の行から計算したコサインの値が入力されます。</li></ol>
<h2><a name="Add_Expressions_only_in_Before_Formula_Scripts"></a><span class="mw-headline"><i>実行前の処理スクリプト</i>にのみ数式を追加する</span></h2>
<p><b>実行前の処理スクリプト</b>編集ボックスに複数行のLabTalkスクリプトを入力し、<b>列の計算式</b>は空白にしておくことができます。組み込み関数とユーザ定義関数に加え、任意のLabTalkスクリプトを入力できます。ですので、範囲(range)変数、 文字列変数、loop、LabTalkからアクセス可能なXファンクションを使用可能です。 
</p><p>以下のサンプルは、「サンプル1」と同じ結果を取得できます。
</p><p><b>サンプル 2</b>
</p>
<ol><li>新しいワークブックを作成します。 </li>
<li>列Aを選択し、右クリックして、<b>列値の一律設定：行番号</b>を選択します。 </li>
<li>列Bを選択し、右クリックして、<b>列値の設定</b>を選び、<b>値の設定</b>ダイアログを開きます。 </li>
<li><b>実行前の処理スクリプト</b>に、<b>Col(B)=cos(Col(A))</b>と入力し、<b>OK</b>ボタンをクリックして、データを生成します。 </li></ol>
<p>次のサンプルでは、データの正規化を行う複数行のスクリプトを含むサンプルの式をロードします。
</p><p><b>サンプル 3</b>
</p>
<ol><li>新しいワークブックを作成します。 </li>
<li>列Aを選択して右クリックし、ショートカットメニューから<b>列値の一律設定：行番号</b>を選択します。 </li>
<li>再度、列Aを右クリックして、ショートカットメニューから<b>列値の設定</b>を選択し、<b>値の設定</b>ダイアログを開きます。 </li>
<li><b>値の設定</b>ダイアログのメニューから<b>計算式：サンプルのロード：Normalize：column 0 to 1 </b>を選び、<b>実行前の処理スクリプト</b>にスクリプトをロードします。そして、<b>OK</b>ボタンをクリックし、データを正規化します。 </li></ol>
<table class="note">
<tr>
<td>
<p><b>Note:</b> <b>実行前の処理スクリプト</b>パネルの各LabTalkスクリプト行の末尾にセミコロン(;)を付ける必要があります。  
</p>
</td></tr></table>
<p><br />
<b>サンプル 4</b>
</p>
<ol>
<li> 新しいワークブックを作成します。</li>
<li><b>インポートウィザード</b>ボタン<a  class="image"><img alt="Button Import Wizard.png" src="../images/Entering_Expressions_in_the_Set_Column_Dialog/Button_Import_Wizard.png" width="23"  /></a>をクリックしてダイアログを開きます。</li>
<li><b>データソース</b>として、<i>\Samples\Graphing\Waterfall.dat</i>のファイルを選択します。<b>完了</b>ボタンをクリックして、データをインポートします。
<li>ワークシートをアクティブにして、<b>列の追加</b>ボタン<a  class="image"><img alt="Button Add New Columns.png" src="../images/Entering_Expressions_in_the_Set_Column_Dialog/Button_Add_New_Columns.png" width="22"  /></a>をクリックします。ワークシートの最後までスクロールし、列を<b>DW(Y)</b>を確認します。</li> 
<li>DW(Y)列を選択して右クリックし、ショートカットメニューから<b>列値の設定</b>を選択し、値の設定ダイアログを開きます。</li>
<li><b>実行前の処理スクリプト</b>ボックスに以下のスクリプトを入力します。</li>
<pre class="lt" style="font-family:monospace;">range r1 <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span>DW<span style="color: #000000;">)</span>;   <span style="color: #008000;">// 追加列を範囲変数に設定</span> r1 <span style="color: #000080;">=</span> wcol<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>;   <span style="color: #008000;">// 範囲の初期値をセット</span> int nc <span style="color: #000080;">=</span> wks.<span style="color: #000080;">ncols</span>;   <span style="color: #008000;">// 列の総数を取得</span> <span style="color: #008000;">// すべてのy列をループしてそれらを合計</span> for<span style="color: #000000;">(</span>page.<span style="color: #000080;">v1</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>; page.<span style="color: #000080;">v1</span><span style="color: #000080;">&lt;=</span> nc<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span> &nbsp;; page.<span style="color: #000080;">v1</span><span style="color: #000080;">+</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span> range rY <span style="color: #000080;">=</span> wcol<span style="color: #000000;">(</span>page.<span style="color: #000080;">v1</span><span style="color: #000000;">)</span>; r1 <span style="color: #000080;">+</span><span style="color: #000080;">=</span> rY; <span style="color: #000000;">}</span> r1 <span style="color: #000080;">=</span> r1<span style="color: #000080;">/</span><span style="color: #000000;">(</span>nc<span style="color: #000080;">-</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>; <span style="color: #008000;">//y列の平均を計算</span></pre>
<li><b>OK</b>をクリックして、適用します。全Y列の平均値が計算され、<b>DW(Y)</b>列に出力されます。</li>
</ol>
<h2><a name="Add_Expressions_in_both_Column_Formula_and_Before_Formula_Scripts"></a><span class="mw-headline"><i>列の計算式</i>と<i>実行前の処理スクリプト</i>の両方に数式を追加する</span></h2>
<p><b>列の計算式</b>と<b>実行前の処理スクリプト</b>の両方にスクリプトを入力する必要が時々あります。例えば、<b>実行前の処理スクリプト</b>で範囲変数を定義し、それを<b>列の計算式</b>で使用するような場合です。 
</p><p><b>サンプル 5</b>
</p>
<ol><li>新しいプロジェクトを作成します。&quot;Book1&quot;という新規ブックが作成されます。</li>
<li>列Aを選択して右クリックし、ショートカットメニューから<b>列値の一律設定：行番号</b>を選択します。</li>
<li>列Bを選択して右クリックし、ショートカットメニューから<b>列値の一律設定：正規乱数</b>を選択します。</li>
<li>新しいブック&quot;Book2&quot;を作成します。</li>
<li>Book2の列Aを選択します。列を右クリックして、<b>列値の一律設定：行番号</b>を選択します。 </li>
<li>このワークブックのB列を選択します。右クリックして、ショートカットメニューから<b>列値の設定</b>を選択し、<b>値の設定</b>ダイアログを開きます。 </li>
<li>では、<b>Book1</b>の列を指す2つの範囲変数を挿入しましょう。<b>値の設定</b>ダイアログの<b>変数：範囲変数の追加</b>を選択します。<b>レンジブラウザ</b>が開きます。以下のスクリーンショットのように、ダイアログで2つの範囲を選択します。(<b>列のリスト</b>が<b>現在のプロジェクト中</b>であることを確認してください。):
<dl><dd><dl><dd><a  class="image"><img alt="SetColumnValue2.png" src="../images/Entering_Expressions_in_the_Set_Column_Dialog/SetColumnValue2.png" width="713"  /></a></dd></dl></dd>
<dd><b>OK</b>をクリックして、<b>値の設定</b>ダイアログに戻ります。</dd></dl></li>
<li><b>列の計算式</b>に、<b>r1+r2</b> と入力します。<b>値の設定</b>ダイアログは次のようになります。
<dl><dd><dl><dd><a  class="image"><img alt="SetColumnValue3.png" src="../images/Entering_Expressions_in_the_Set_Column_Dialog/SetColumnValue3.png" width="495"  /></a></dd></dl></dd></dl></li>
<li><b><b>OK</b></b>をクリックして列Bに入力するデータを生成します。列B内の各要素は、Book1の対応する要素の合計になっているはずです。
<dl><dd><dl><dd><a  class="image"><img alt="SetColumnValue4.png" src="../images/Entering_Expressions_in_the_Set_Column_Dialog/SetColumnValue4.png" width="405"  /></a></dd></dl></dd></dl></li></ol>
<p><b>サンプル 6</b>
</p><p><a class="external text" href="../../LabTalk/LabTalk/Integral_(function).html">積分関数</a>と<a class="external text" href="../../LabTalk/LabTalk/Functions.html#User-Defined_Functions">ユーザ定義関数</a>を使用して、与えられたT値における積分を計算する方法を示すサンプルです。
</p>
<ol>
<li>新しいワークブックを作成します。
<li>列Aの<b>ロングネーム</b>を<i>T</i> に設定して、列Aの式を以下のように設定します。
<pre class="lt" style="font-family:monospace;">data<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">10</span>,<span style="color: #0000dd;">0.5</span><span style="color: #000000;">)</span></pre>
<li>B列の<b><b>ロングネーム</b></b>を<i>Integral</i> として設定し、列Bを選択して右クリックして<b><b>列値の設定</b></b>を選択してダイアログを開きます。
<li><b><b>実行前の処理スクリプト</b></b>に定数、積分関数を下図のように入力して定義し、 <b>Col(B)=</b> 編集ボックスには積分の式を下図のとおりに入力します。<br />
<dl><dd><dl><dd><a  class="image"><img alt="SetFunValues5.png" src="../images/Entering_Expressions_in_the_Set_Column_Dialog/SetFunValues5.png" width="509"  /></a></dd></dl></dd></dl>
<li><b>OK</b>をクリックして、適用します。計算された積分結果は以下のようになります。
<dl><dd><dl><dd><a  class="image"><img alt="SetFunValues6.png" src="../images/Entering_Expressions_in_the_Set_Column_Dialog/SetFunValues6.png" width="376"  /></a></dd></dl></dd></dl>
</ol>
<p><b>実行前の処理スクリプト</b>は以下の通りです。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// 積分を定義</span>
function double Myintg<span style="color: #000000;">(</span>double x, double T<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
<span style="color: #008000;">//定数を定義</span>
      Double h <span style="color: #000080;">=</span> <span style="color: #0000dd;">1.23</span><span style="color: #000080;">*</span><span style="color: #0000dd;">10</span><span style="color: #000080;">^</span><span style="color: #000000;">(</span><span style="color: #000080;">-</span><span style="color: #0000dd;">4</span><span style="color: #000000;">)</span>; 
      Double k <span style="color: #000080;">=</span> <span style="color: #0000dd;">8.61</span><span style="color: #000080;">*</span><span style="color: #0000dd;">10</span><span style="color: #000080;">^</span><span style="color: #000000;">(</span><span style="color: #000080;">-</span><span style="color: #0000dd;">5</span><span style="color: #000000;">)</span>;
 
      return <span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #000000;">(</span>exp<span style="color: #000000;">(</span>h<span style="color: #000080;">*</span>x<span style="color: #000080;">/</span><span style="color: #000000;">(</span>k<span style="color: #000080;">*</span>T<span style="color: #000000;">)</span><span style="color: #000000;">)</span> <span style="color: #000080;">-</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span></pre>




    