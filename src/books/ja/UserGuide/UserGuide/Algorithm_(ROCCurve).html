<h1 class="firstheading">アルゴリズム（ROC Curve）</h1><p class='urlname' style='display: none'>ROCCurve-Algorithm</p>
<div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#ROC_Values"><span class="tocnumber">1</span> <span class="toctext">ROC値</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#The_area_under_the_ROC_curve"><span class="tocnumber">2</span> <span class="toctext">ROC曲線以下の面積</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#The_SE_of_the_area_under_the_ROC_curve_statistic"><span class="tocnumber">3</span> <span class="toctext">ROC曲線以下の面積のSE</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#The_asymptotic_confidence_interval_of_the_area_under_the_ROC_curve"><span class="tocnumber">4</span> <span class="toctext">ROC曲線以下の面積の漸近の信頼区間</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#The_asymptotic_P-value_under_the_null_hypothesis_that_vs._the_alternative_hypothesis_that"><span class="tocnumber">5</span> <span class="toctext">帰無仮説と対立仮説における漸近のP値</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Optimal_Cut-Point_Value"><span class="tocnumber">6</span> <span class="toctext">最適なカットポイント値</span></a></li>
</ul>
</div>

<p>ここでは、次の表記が使われます。 
</p><p><img src="../images/Algorithm_(ROCCurve)/math-d2583020b138319a535bc3c88278ab33.png" title="x_i\,\!" alt="x_i\,\!" class="tex"/>&nbsp;:   ケース i に対する結果スコアをテスト 
</p><p><img src="../images/Algorithm_(ROCCurve)/math-d750fff2ef5c4d25bcff29719305177a.png" title="n_{TP}\,\!" alt="n_{TP}\,\!" class="tex"/>&nbsp;: 真の正の判定数
</p><p><img src="../images/Algorithm_(ROCCurve)/math-254cedc4e5a3c839360558b23ca648c2.png" title="n_{FN}\,\!" alt="n_{FN}\,\!" class="tex"/>&nbsp;: 偽の負の判定数
</p><p><img src="../images/Algorithm_(ROCCurve)/math-12495e96208687e2494a1d6350363ce4.png" title="n_{TN}\,\!" alt="n_{TN}\,\!" class="tex"/>&nbsp;: 真の負の判定数
</p><p><img src="../images/Algorithm_(ROCCurve)/math-4dd508cc11a3900faec0a3ce7e098751.png" title="n_{FP}\,\!" alt="n_{FP}\,\!" class="tex"/>&nbsp;: 偽の正の判定数
</p><p><img src="../images/Algorithm_(ROCCurve)/math-a3b41b80fce655f49856414c7f15b33e.png" title="n_{-}\,\!" alt="n_{-}\,\!" class="tex"/>: 負の実際の状態を持つケースの数
</p><p><img src="../images/Algorithm_(ROCCurve)/math-79621c4d3dee617c6ee30941cff7dd5a.png" title="n_{+}\,\!" alt="n_{+}\,\!" class="tex"/>:  正の実際の状態を持つケースの数
</p><p><img src="../images/Algorithm_(ROCCurve)/math-482fbd5c0104c0420e4348e592886424.png" title="n_{-=j}\,\!" alt="n_{-=j}\,\!" class="tex"/>:  結果が～に等しい負のケースの数 
</p><p><img src="../images/Algorithm_(ROCCurve)/math-5663bbf004c70b4058e4c35f50e38375.png" title="n_{+&gt;j}\,\!" alt="n_{+&gt;j}\,\!" class="tex"/>:&nbsp;: 結果が～より大きい正のケースの数 
</p><p><img src="../images/Algorithm_(ROCCurve)/math-b821d677c6db926aa8b8a3208114b77b.png" title="n_{+=j}\,\!" alt="n_{+=j}\,\!" class="tex"/>:&nbsp;: 結果が～に等しい正のケースの数 
</p><p><img src="../images/Algorithm_(ROCCurve)/math-962c20beac8eb76e37067599eefebfda.png" title="n_{-&lt;j}\,\!" alt="n_{-&lt;j}\,\!" class="tex"/>:&nbsp;: 結果が～より小さい負のケースの数
</p><p><br />
</p>
<h4><a name="ROC_Values"></a><span class="mw-headline">ROC値</span></h4>
<p>1- 特異性 (X): <img src="../images/Algorithm_(ROCCurve)/math-0c5a60aa9d534a69c504fac187790c07.png" title="1-\frac{n_{TN}}{n_{TN}+n_{FP}}\,\!" alt="1-\frac{n_{TN}}{n_{TN}+n_{FP}}\,\!" class="tex"/>
</p><p>敏感度 (Y):<img src="../images/Algorithm_(ROCCurve)/math-0760bde0cf79e5793835075ee3d2bcdd.png" title="\frac{n_{TP}}{n_{TP}+n_{FN}}\,\!" alt="\frac{n_{TP}}{n_{TP}+n_{FN}}\,\!" class="tex"/>
</p>
<h4><a name="The_area_under_the_ROC_curve"></a><span class="mw-headline">ROC曲線以下の面積</span></h4>
<p><img src="../images/Algorithm_(ROCCurve)/math-6373accf16c083723e8abae2f5401af2.png" title="x\,\!" alt="x\,\!" class="tex"/>を検定結果変数の状態値とします。<img src="../images/Algorithm_(ROCCurve)/math-2d4dd525bc7143c51992574674cba150.png" title="x_{-}\,\!" alt="x_{-}\,\!" class="tex"/>は、 <img src="../images/Algorithm_(ROCCurve)/math-6373accf16c083723e8abae2f5401af2.png" title="x\,\!" alt="x\,\!" class="tex"/>値が負の実際の状態値で、 <img src="../images/Algorithm_(ROCCurve)/math-2c52673b83cb8d0bac1cb71c716fb95b.png" title="x_{+}\,\!" alt="x_{+}\,\!" class="tex"/>は値が正の実際の状態値です。そして、ROC曲線以下の&quot;true&quot;面積のノンパラメトリック近似性、<img src="../images/Algorithm_(ROCCurve)/math-0a5000fe8b6b5570dd5a1ce00b828ef6.png" title="\theta \,\!" alt="\theta \,\!" class="tex"/> は下記のようになります。
</p><p><img src="../images/Algorithm_(ROCCurve)/math-5f79866cf3c0dc05169d11fdd67fd6d7.png" title=" A_Z=\frac 1{n_{+}n_{-}}" alt=" A_Z=\frac 1{n_{+}n_{-}}" class="tex"/><img src="../images/Algorithm_(ROCCurve)/math-569223521931231c409785c91f0084b2.png" title="\sum_{j=1}^{n_{-}}\sum _{i=1}^{n_{+}}\Psi (x_{+},x_{-})" alt="\sum_{j=1}^{n_{-}}\sum _{i=1}^{n_{+}}\Psi (x_{+},x_{-})" class="tex"/>
</p><p>ここで<img src="../images/Algorithm_(ROCCurve)/math-79621c4d3dee617c6ee30941cff7dd5a.png" title="n_{+}\,\!" alt="n_{+}\,\!" class="tex"/>は、 <img src="../images/Algorithm_(ROCCurve)/math-a7c6c783c5d03fc91d0594b217f56580.png" title="D\,\!" alt="D\,\!" class="tex"/>+のサンプルサイズ、 <img src="../images/Algorithm_(ROCCurve)/math-79621c4d3dee617c6ee30941cff7dd5a.png" title="n_{+}\,\!" alt="n_{+}\,\!" class="tex"/>!は、 <img src="../images/Algorithm_(ROCCurve)/math-a7c6c783c5d03fc91d0594b217f56580.png" title="D\,\!" alt="D\,\!" class="tex"/>-のサンプルサイズで、以下のようになります。
</p><p><img src="../images/Algorithm_(ROCCurve)/math-0889c138e945599aafd7573b2404ee0e.png" title="\Psi (x_{+},x_{-})=\,\!" alt="\Psi (x_{+},x_{-})=\,\!" class="tex"/>
<img src="../images/Algorithm_(ROCCurve)/math-3fd91dcf034941370a5ed5d855390a84.png" title="
\begin{cases} 
  1,  &amp; \mbox{if }x_{+}&gt;x_{-} \\
  0.5, &amp; \mbox{if }x_{+}=x_{-} \\
  0, &amp; \mbox{if }x_{+}&lt;x_{-} 
\end{cases}" alt="
\begin{cases} 
  1,  &amp; \mbox{if }x_{+}&gt;x_{-} \\
  0.5, &amp; \mbox{if }x_{+}=x_{-} \\
  0, &amp; \mbox{if }x_{+}&lt;x_{-} 
\end{cases}" class="tex"/>
</p><p><img src="../images/Algorithm_(ROCCurve)/math-695617aa4d2b4e1c93f4ffa59c529d83.png" title="A_z\,\!" alt="A_z\,\!" class="tex"/>は、ROC曲線以下の観測された面積で、このROC曲線は、連続したポイントを台形法などにより直線で接続したものです。 
</p><p><img src="../images/Algorithm_(ROCCurve)/math-695617aa4d2b4e1c93f4ffa59c529d83.png" title="A_z\,\!" alt="A_z\,\!" class="tex"/>を計算する別の方法は、以下のようになります。
</p><p><img src="../images/Algorithm_(ROCCurve)/math-1ea8d817ad6b5f332af7ec49c30dc22d.png" title="A_Z=\frac 1{n_{+}+n_{-}}\sum \left\{ n_{-=j}n_{+&gt;j}+\frac{n_{-=j}n_{+=j}}2\right\} " alt="A_Z=\frac 1{n_{+}+n_{-}}\sum \left\{ n_{-=j}n_{+&gt;j}+\frac{n_{-=j}n_{+=j}}2\right\} " class="tex"/>
</p>
<h4><a name="The_SE_of_the_area_under_the_ROC_curve_statistic"></a><span class="mw-headline">ROC曲線以下の面積のSE</span></h4>
<p><img src="../images/Algorithm_(ROCCurve)/math-695617aa4d2b4e1c93f4ffa59c529d83.png" title="A_z\,\!" alt="A_z\,\!" class="tex"/>の標準偏差は、次の式で計算できます。
</p><p><img src="../images/Algorithm_(ROCCurve)/math-fde8eb47f42d8792fdc2e76131a46863.png" title="SE(A_Z)=\sqrt{\frac{A_Z(1-A_Z)+(n_{+}-1)(Q_1-A_Z^2)+(n_{-}-1)(Q_2-A_Z^2)}{n_{+}n_{-}}} \,\!" alt="SE(A_Z)=\sqrt{\frac{A_Z(1-A_Z)+(n_{+}-1)(Q_1-A_Z^2)+(n_{-}-1)(Q_2-A_Z^2)}{n_{+}n_{-}}} \,\!" class="tex"/>
</p><p>ここで
</p><p><img src="../images/Algorithm_(ROCCurve)/math-99adafc3fccb24a1cf7264ad44e4e60a.png" title="Q_{1=\frac 1{n_{-}n_{+}^2}}\sum n\__{=j}[n_{+&gt;j}^2+n_{+&gt;j}n_{+=j}+\frac{n_{+&gt;j}^2}3] \,\!" alt="Q_{1=\frac 1{n_{-}n_{+}^2}}\sum n\__{=j}[n_{+&gt;j}^2+n_{+&gt;j}n_{+=j}+\frac{n_{+&gt;j}^2}3] \,\!" class="tex"/>
</p><p>および
</p><p><img src="../images/Algorithm_(ROCCurve)/math-aafdd6330c76e9cd18c4af812cd53052.png" title="Q_{2=\frac 1{n_{-}^2n_{+}}}\sum n_{+=j}[n_{-&gt;j}^2+n_{-&gt;j}n_{-=j}+\frac{n_{-=j}^2}3] \,\!" alt="Q_{2=\frac 1{n_{-}^2n_{+}}}\sum n_{+=j}[n_{-&gt;j}^2+n_{-&gt;j}n_{-=j}+\frac{n_{-=j}^2}3] \,\!" class="tex"/>
</p>
<h4><a name="The_asymptotic_confidence_interval_of_the_area_under_the_ROC_curve"></a><span class="mw-headline">ROC曲線以下の面積の漸近の信頼区間</span></h4>
<p>ROC曲線以下の真の面積に対する2方向の漸近の信頼区間<img src="../images/Algorithm_(ROCCurve)/math-76c3dffd80c7fb9b863984e4f4d30b71.png" title="c\%=(100-\alpha )\%\,\!" alt="c\%=(100-\alpha )\%\,\!" class="tex"/>は 
</p><p><img src="../images/Algorithm_(ROCCurve)/math-235de6eb21ed53705c7979a6ce5fb929.png" title="A_Z\pm SE(A_Z)\,\!" alt="A_Z\pm SE(A_Z)\,\!" class="tex"/>
</p>
<h4><a name="The_asymptotic_P-value_under_the_null_hypothesis_that_vs._the_alternative_hypothesis_that"></a><span class="mw-headline">帰無仮説における漸近のP値は、<b><img src="../images/Algorithm_(ROCCurve)/math-da8f6f3f8ae6e03c2be19875f1fb8083.png" title=" \theta=0.5\ \,\!" alt=" \theta=0.5\ \,\!" class="tex"/></b>であるのに対し、 対立仮説は<img src="../images/Algorithm_(ROCCurve)/math-8d97b516153b32dc87de1d6354170e6f.png" title=" \theta \neq 0.5\ \,\!" alt=" \theta \neq 0.5\ \,\!" class="tex"/></span></h4>
<p><img src="../images/Algorithm_(ROCCurve)/math-695617aa4d2b4e1c93f4ffa59c529d83.png" title="A_z\,\!" alt="A_z\,\!" class="tex"/>は、  <img src="../images/Algorithm_(ROCCurve)/math-da8f6f3f8ae6e03c2be19875f1fb8083.png" title=" \theta=0.5\ \,\!" alt=" \theta=0.5\ \,\!" class="tex"/>であるような帰無仮説において漸近的に標準なので、  <img src="../images/Algorithm_(ROCCurve)/math-da8f6f3f8ae6e03c2be19875f1fb8083.png" title=" \theta=0.5\ \,\!" alt=" \theta=0.5\ \,\!" class="tex"/>であるような帰無仮説の漸近のP値を計算できます。それに対し、対立仮説は<img src="../images/Algorithm_(ROCCurve)/math-8d97b516153b32dc87de1d6354170e6f.png" title=" \theta \neq 0.5\ \,\!" alt=" \theta \neq 0.5\ \,\!" class="tex"/>
</p><p><img src="../images/Algorithm_(ROCCurve)/math-d39e6085797aa9607fe719b7472fb2e7.png" title="P\left( \left| Z\right| &gt;\left| \frac{A_Z-0.5}{SD(A_Z)|_{\theta =0.5}}\right| \right) =2P\left( Z&gt;\left| \frac{A_Z-0.5}{SD(A_Z)\mid _{\theta =0.5}}\right| \right)  " alt="P\left( \left| Z\right| &gt;\left| \frac{A_Z-0.5}{SD(A_Z)|_{\theta =0.5}}\right| \right) =2P\left( Z&gt;\left| \frac{A_Z-0.5}{SD(A_Z)\mid _{\theta =0.5}}\right| \right)  " class="tex"/>
</p><p>ノンパラメトリックな場合において、
</p><p><img src="../images/Algorithm_(ROCCurve)/math-72938a409015c7ed5745f164b9c6bd99.png" title="SD(A_Z)|_{\theta =0.5}=\sqrt{\frac{\theta (1-\theta )+(n_{+}-1)(Q_1-\theta ^2)+(n_{-}-1)(Q_2-\theta ^2)}{n_{+}n_{-}}}|_{\theta =0.5}\,\!" alt="SD(A_Z)|_{\theta =0.5}=\sqrt{\frac{\theta (1-\theta )+(n_{+}-1)(Q_1-\theta ^2)+(n_{-}-1)(Q_2-\theta ^2)}{n_{+}n_{-}}}|_{\theta =0.5}\,\!" class="tex"/>
</p><p><img src="../images/Algorithm_(ROCCurve)/math-bc5a5645b9c414917dd8c39d32c961c6.png" title="=\sqrt{\frac{0.5(1-0.5)+(n_{+}-1)(\frac 13-0.5^2)+(n_{-}-1)(\frac 13-0.5^2)}{n_{+}n_{-}}} " alt="=\sqrt{\frac{0.5(1-0.5)+(n_{+}-1)(\frac 13-0.5^2)+(n_{-}-1)(\frac 13-0.5^2)}{n_{+}n_{-}}} " class="tex"/>
</p>
<h4><a name="Optimal_Cut-Point_Value"></a><span class="mw-headline">最適なカットポイント値</span></h4>
<p>カットポイント値は、これら2つの量の等価性の最大化（SpEqualSe）によって定義されます。これは、ROC曲線のmin（abs(1-x-y)）です。
</p>






    