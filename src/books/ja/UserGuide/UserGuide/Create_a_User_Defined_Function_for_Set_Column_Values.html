<h1 class="firstheading">列値の設定を行うためのユーザ定義式を作成する</h1><p class='urlname' style='display: none'>Wks-SetColVal-UserDefFunc</p>
<p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">はじめに</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Supporting_Numeric_.26_String_types_with_data_in_Columns"><span class="tocnumber">2</span> <span class="toctext">列データの数値と文字型のサポート</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#String"><span class="tocnumber">2.1</span> <span class="toctext">文字列</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Numeric"><span class="tocnumber">2.2</span> <span class="toctext">数値</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#Controlling_Access_of_OC_Functions_from_LabTalk"><span class="tocnumber">3</span> <span class="toctext">LabTalkからOrigin C関数のアクセスを制御する</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Setting_Category_for_the_Function_in_Function_Menu"><span class="tocnumber">4</span> <span class="toctext">関数メニューの関数に対するカテゴリーを設定する</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Tutorial"><span class="tocnumber">5</span> <span class="toctext">チュートリアル</span></a></li>
</ul>
</div>

<h2><a name="Introduction"></a><span class="mw-headline">はじめに</span></h2>
<p>このトピックは、<a class="external text" href="../../OriginC/OCGuide/Basic_Features.html"><b>Origin C</b></a>関数を記述して、<a href="../../UserGuide/UserGuide/Menu_Options_and_Dialog_Controls.html#Function_Menu" title="ユーザガイド:メニューとダイアログのオプション"><b>値の設定</b>ダイアログボックスの<b><b>関数</b></b>メニュー</a>に表示する方法について説明しています。
</p><p>自分のOrigin C関数をOriginに追加する方法についての一般的な情報は、<a class="external text" href="../../OriginC/OCGuide/Compiling,_Linking_and_Loading.html">LabTalkからOC関数を呼び出す</a>をご覧下さい。
</p><p><b>値の設定</b>ダイアログからアクセス可能なOrigin C関数は、次の要件を満たしている必要があります。
</p>
<ul><li> 関数の戻り型は、void型にすることはできません。</li>
<li> 関数は変数型に対して、参照型またはポインタを持つことはできません。</li></ul>
<p>関数をコンパイルすると、<b>値の設定</b>ダイアログの<b><b>関数</b></b>メニュードロップダウンリストで利用できるようになります。
</p>
<h2><a name="Supporting_Numeric_.26_String_types_with_data_in_Columns"></a><span class="mw-headline">列データの数値と文字型のサポート</span></h2>
<h3><a name="String"></a><span class="mw-headline">文字列</span></h3>
<p>次は文字列関数のサンプルです。
</p>
<pre class="oc" style="font-family:monospace;">string AddSomethingToStr<span style="color: #000000;">(</span>string str<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
  str <span style="color: #000040;">+</span><span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot; test&quot;</span>;
  <span style="color: #0000ff;">return</span> str;
<span style="color: #000000;">}</span></pre>
<p>コンパイルすれば、次のように、この関数を<b>値の設定</b>ダイアログで利用できます。
</p>
<pre>
Col(B) = AddSomethingToStr(Col(A))$; 
</pre>
<h3><a name="Numeric"></a><span class="mw-headline">数値</span></h3>
<p>次は、整数を返す関数のサンプルです。
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">int</span> CopyNumeric<span style="color: #000000;">(</span><span style="color: #0000ff;">int</span> nn<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	<span style="color: #0000ff;">return</span> nn;
<span style="color: #000000;">}</span></pre>
<p>関数は<b>値の設定</b>ダイアログから利用でき、次のようにある列から別の列に数値データをコピーすることができます。
</p>
<pre>
Col(B) = CopyNumeric(Col(A));
</pre>
<h2><a name="Controlling_Access_of_OC_Functions_from_LabTalk"></a><span class="mw-headline">LabTalkからOrigin C関数のアクセスを制御する</span></h2>
<p>次の #pragma ディレクティブの1つを自分のOrigin Cソースコードに追加して、LabTalkからOrigin C関数にアクセス可能、不可、制限付きアクセス にすることができます。
</p>
<ul><li> #pragma labtalk(0) // LabTalkからOC関数の実行不可</li>
<li> #pragma labtalk(1) // デフォルト、LabTalkからOC関数の実行可</li>
<li> #pragma labtalk(2) // run -ocでOC関数を実行</li></ul>
<p>デフォルトでは、LabTalkからOC関数を呼び出すことができるようにOriginは動作しますので、Origin C関数に <i>#pragma labtalk(1)</i> と記述する必要はありません。<i>#pragma labtalk(...)</i> は、別の <i>#pragma labtalk(...)</i>で変更されるまで、そのファイル内のすべての関数に対して影響します。ですので、いくつかのC関数を<b><b>関数</b></b>メニューには表示したくない場合、 <i>#pragma labtalk(0)</i> を関数の前に配置し、そして、<b><b>F(x)</b></b>メニューに配置する関数の前で再び <i>#pragma labtalk(1)</i> を配置します。この方法を使うことで、<b><b>関数</b></b>メニュー内の関数名を制御したり、管理することができます。
</p>
<h2><a name="Setting_Category_for_the_Function_in_Function_Menu"></a><span class="mw-headline">関数メニューの関数に対するカテゴリーを設定する</span></h2>
<p>自分のOC関数を<b><b>関数</b></b>メニューの適切なカテゴリに表示させるためには、次のようにpragmaステートメントを追加します。
</p>
<ul><li> #pragma labtalk(1, Date and Time) // カテゴリー名をDate and Timeにセット</li></ul>
<p>関数は、次のように<b><b>値の設定</b></b>ダイアログボックスの<b><b>関数</b></b>メニューに現れます。この例では、文字列を受けて、文字列を返す関数を表しています。
</p>
<pre>
Date and Time&nbsp;: FunctionName(str)$
</pre>
<p>自分のOC関数にカテゴリーを指定しない場合、関数は <b>ユーザのOriginC</b>カテゴリーに表示されます。 
</p>
<table class="noborder"><tr>
	<td style="vertical-align:top" width="60"><img src="../images/Create_a_User_Defined_Function_for_Set_Column_Values/Tip_icon.png" width="57"  border="0" /></td><td><p><b>関数</b>メニューから組み込み関数を選択すると、基本的な関数情報（プロトタイプ、返されるものなど）を含む「スマートヒント」が表示されます。示されるように、<i>/*$$$</i>と<i>$$$*/</i>の間にコメントを挿入することで、このようなヒントをOriginC関数（以下の<b>チュートリアル</b>）に追加できます。
</p>
<dl><dd><a  class="image"><img alt="Smart hints UD OC func.png" src="../images/Create_a_User_Defined_Function_for_Set_Column_Values/Smart_hints_UD_OC_func.png" width="752"  /></a></dd></dl>
<p><br />
</p></td></tr></table>
<h2><a name="Tutorial"></a><span class="mw-headline">チュートリアル</span></h2>
<p>次の手順は、ユーザ定義関数を<b>値の設定</b>ダイアログボックスの<b><b>関数</b></b>メニューに追加するチュートリアルです。Originのプログラムフォルダの <b>\OriginC\System\</b> サブフォルダにある<b>internal.c</b>にサンプルコードがあります。
</p><p><b>ステップ：</b>
</p>
<ol><li><b>[コードビルダを開く]:</b>メインメニューから<b>表示：コードビルダメニュー</b>を選択して、<a href="../../UserGuide/UserGuide/The_Code_Builder.html" title="ユーザガイド:コードビルダを開く">コードビルダ</a>を開きます。</li>
<li><b>[ファイル名の入力]:</b>コードビルダのメニューから<b>ファイル：新規</b>を選びます。<b>新規ファイル</b>ダイアログが開きます。新規ファイルダイアログのファイルタイプで<b>C File</b>を選びます。そして、<b>ファイル名</b>フィールドに&quot;<b>test</b>&quot;と入力します。(拡張子&quot;.c&quot;は自動的に付加されます。)デフォルトの場所は &lt;ユーザファイルフォルダ&gt;\OriginC\ です。<b><b>OK</b></b>をクリックします。ダイアログが閉じ、編集ボックスに&quot;test.c&quot; ウィンドウが表示されます。</li>
<li><b>[コードを入力]:</b>このウィンドウにあるコードの一番下に、次のOrigin Cコードを入力します。</li></ol>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">#pragma</span> labtalk<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,Math<span style="color: #000000;">)</span>
<span style="color: #0000ff;">double</span> add2num<span style="color: #000000;">(</span><span style="color: #0000ff;">double</span> a, <span style="color: #0000ff;">double</span> b<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	  <span style="color: #0000ff;">return</span> a <span style="color: #000040;">+</span> b;
<span style="color: #000000;">}</span></pre>
<table class="note">

<tr>
<td>
<p><b>Note:</b> 関数定義の前の&quot;pragma&quot;行は、<b><b>関数</b></b>メニューの数学カテゴリーに関数を配置するものです。
</p>
</td></tr></table>
<ol start="4">
<li><b>[ビルドの実行]:</b>メニューから<b>ビルド：ビルド</b>メニューを選び、コードをコンパイルします。エラーが発生していないことを確認します。コードが問題なくコンパイルされたら、コードビルダを閉じ、Originのウィンドウに戻ります。エラーが発生したら、修正して再度コンパイルしてください。
</ol>
<table class="note">

<tr>
<td><b>Note:</b>コンパイルについての詳細は、<a class="external text" href="../../OriginC/OCGuide/Compiling,_Linking_and_Loading.html">コードビルダワークスペースをビルドする4つの方法</a>および<a class="external text" href="../../LabTalk/LabTalk/Loading_and_Compiling_Origin_C_Function.html"> Origin C関数のロードとコンパイル</a>をご覧下さい。
</td></tr></table>
<ol start="5">
<li> <b>[値の設定ダイアログを開く]:</b>Originワークスペースに戻ります。新しいワークブックを作成します。メニューから<b>列:新規列の追加</b>を選択して、このワークブックのワークシートに3番目の列を追加します。最初の2列にどんな数値でも良いので数値を入力します。3番目の列のヘッダをクリックして選択し、ショートカットメニューから<b>列：列値の設定</b>を選択して、<b>値の設定</b>ダイアログを開きます。 

<li><b>[関数メニューから新しい関数を入力する]</b>:ダイアログの<i>関数</i> メニューをクリックします。<b>Math</b>カテゴリーに、<b>add2num(d1, d2)</b>という項目があるので、その関数をクリックして選択します。文字列&quot;add2num(a,b)&quot;が計算式入力ボックスに挿入されます。これを次のように編集します。 
<pre class="lt" style="font-family:monospace;">add2num<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>,col<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span></pre>
<li><b>[値の設定を実行]:</b> OKをクリックすると、3列目の各行に1列目と2列目の合計が計算されます。
</ol>
<table class="note">
<tr>
<td>
<p><b>Note:</b> この関数&quot;add2num&quot;には2つの(double型)スカラ引数があり、スカラ値を返しますが、2列(vector型)を引数として、<b>値の設定</b>ダイアログボックスでこの関数を使用するとき、 <b>値の設定</b>ダイアログボックスは各要素(<b>i</b>によって暗示的に示される)に自動的に計算式を適用するので、計算結果が目的の列に入力されます。
</p>
</td></tr></table>



    