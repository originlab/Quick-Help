<h1 class="firstheading">残差解析</h1><p class='urlname' style='display: none'>Residual-Plot-Analysis</p>
<p>残差は次のように定義されます。
</p><p><img src="../images/Graphic_Residual_Analysis/math-04f8f09e63a269a044ceeee72a32143d.png" title="r_i=y_i-y=observed\,value\,of\,y-predicted\,value\,of\,y" alt="r_i=y_i-y=observed\,value\,of\,y-predicted\,value\,of\,y" class="tex"/>
</p><p>残差プロットは回帰の質を評価するのに使用できます。現在、5種類の残差プロットが線形フィットダイアログボックスでサポートされています。
</p>
<ul><li> <b>残差</b>と<b>独立変数</b>
</li><li> <b>残差</b>と<b>予測値</b>
</li><li> <b>残差</b>と<b>データの順序</b>
</li><li> <b>残差プロットのヒストグラム</b>
</li><li> <b>残差のラグプロット</b>
</li><li><b>残差の正規確率プロット</b>
</li></ul>
<p>これらの残差プロットは回帰の質を評価するのに使用できます。定数分散、変数の独立性、分布の正規性のような残差についての統計的な仮定を調べることができます。特定の回帰モデルに対してこれらの仮定が真となるためには、残差は0を中心としてランダムに分布している必要があります。 
</p><p>異なるタイプの残差プロットは、これらの仮定の有効性をチェックするのに使用でき、モデルを改良するための情報を提供します。例えば、回帰が良い場合、残差の散布図は乱雑になります。残差は傾向を示しません。傾向は残差が独立していないことを示します。一方、残差のヒストグラムプロットは、対称のベル型分布で表され、正規性の仮定が真であることを示します。
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>内容</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Checking_the_error_variance"><span class="tocnumber">1</span> <span class="toctext">誤差分散のチェック</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Checking_the_process_drift"><span class="tocnumber">2</span> <span class="toctext">ずれのチェック</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Checking_independence_of_the_error_term"><span class="tocnumber">3</span> <span class="toctext">誤差項の独立性のチェック</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Checking_normality_of_variance"><span class="tocnumber">4</span> <span class="toctext">分散の正規性のチェック</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Improving_the_regression_model_using_residuals_plots"><span class="tocnumber">5</span> <span class="toctext">残差プロットを使って回帰を改良する</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Detecting_outliers_by_transforming_residuals"><span class="tocnumber">6</span> <span class="toctext">残差を変換して外れ値を検出する</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Residual_contour_plots_for_surface_fitting"><span class="tocnumber">7</span> <span class="toctext">非線形曲面フィットのための残差の等高線プロット</span></a></li>
</ul>
</td></tr></table>
<h2><a name="Checking_the_error_variance"></a><span class="mw-headline">誤差分散のチェック</span></h2>
<p>増加傾向を示す残差プロット(下図参照)は、誤差分散が独立変数と共に増加し、減少傾向を表す分布は、誤差分散が独立変数と共に減少するというこをを示しています。これらの分布のどちらも定数分散のパターンではありません。そのため、定数分散の仮定が真ではない可能性があり、回帰は良いものではないことを示しています。一方、水平帯のパターンは残差の分散が定数であることを示しています。
</p>
<dl><dd><a class="image"><img alt="Graphic Residual Analysis-1.png" src="../images/Graphic_Residual_Analysis/Graphic_Residual_Analysis-1.png" width="456" height="637" /></a>
</dd></dl>
<h2><a name="Checking_the_process_drift"></a><span class="mw-headline">ずれのチェック</span></h2>
<p><B>残差</B> と <b>データの順序</b>のプロットは、データが時系列の場合の実験プロセスでの分散のずれ(下図参照)をチェックするのに使用されます。残差は0を中心にランダムに分布し、それは処理中にずれは生じていないことを示しています。
</p><p><a class="image"><img alt="Graphic Residual Analysis-2.jpg" src="../images/Graphic_Residual_Analysis/Graphic_Residual_Analysis-2.jpg" width="432" height="431" /></a>
</p>
<h2><a name="Checking_independence_of_the_error_term"></a><span class="mw-headline">誤差項の独立性のチェック</span></h2>
<p>残差のラグプロット(下図参照)は、残差(<i>i</i> ) に対しての残差(<i>i</i>-1)プロットすることで作成され、誤差項の依存性を調べるのに役立ちます。ラグプロットがランダムではないパターンでは、分散はランダムでは無いことを示します。
</p><p><a class="image"><img alt="Graphic Residual Analysis-3.jpg" src="../images/Graphic_Residual_Analysis/Graphic_Residual_Analysis-3.jpg" width="392" height="296" /></a>
</p><p><br /> 分析されるデータが時系列(順次記録されるデータ)の場合、<b>残差</b>と<B>データの順序 </B>のプロットは、誤差項と時間の相関を反映します。0を中心に変動するパターンは、誤差項に依存性があることを示しています。
</p><p><a class="image"><img alt="Graphic Residual Analysis-4.jpg" src="../images/Graphic_Residual_Analysis/Graphic_Residual_Analysis-4.jpg" width="416" height="580" /></a>
</p><p><i>残差ラグプロットは誤差項の独立性を示します。</i>
</p><p><a class="image"><img alt="Graphic Residual Analysis-3.jpg" src="../images/Graphic_Residual_Analysis/Graphic_Residual_Analysis-3.jpg" width="392" height="296" /></a>
</p><p><B>時系列データに対する残差プロット</B>
</p><p><a class="image"><img alt="Graphic Residual Analysis-4.jpg" src="../images/Graphic_Residual_Analysis/Graphic_Residual_Analysis-4.jpg" width="416" height="580" /></a>
</p>
<h2><a name="Checking_normality_of_variance"></a><span class="mw-headline">分散の正規性のチェック</span></h2>
<p>残差のヒストグラムは分散が正規分布しているかどうかを調べるのに使用します。0を中心に分布している対称なベル型のヒストグラムは正規性の仮定が真であることを示しています。ヒストグラムで偶然誤差が正規分布しないことを示している場合、モデルの仮定が違っている可能性があります。
</p><p><i><b>残差のヒストグラムは偏差が正規分布していることを示しています。</b></i>
</p><p><a class="image"><img alt="Graphic Residual Analysis-5.jpg" src="../images/Graphic_Residual_Analysis/Graphic_Residual_Analysis-5.jpg" width="392" height="301" /></a>
</p><p>残差の正規確率プロットは、分散が正規分布しているかどうかを調べるのに使用します。結果のプロットはおおよそ線形で、誤差範囲は正規分布していると仮定することができます。プロットはパーセンタイル対順序化された残差をベースにしており、パーセンタイルは次のように仮定されます。 
</p><p><img src="../images/Graphic_Residual_Analysis/math-ec995bff3922b2290f85bed243de5eb3.png" title="\frac{(i-\frac{3}{8})}{(n+\frac{1}{4})}" alt="\frac{(i-\frac{3}{8})}{(n+\frac{1}{4})}" class="tex"/> 
</p><p>ここで、<I>n</I> はデータセットの合計数で、<I>i</I> は<I>i</I> 番目のデータです。残差の正規確率プロットは次のようになります。
</p><p><i><b>残差の正規確率プロット</b></i>
</p><p><a class="image"><img alt="PP-PLOT.png" src="../images/Graphic_Residual_Analysis/PP-PLOT.png" width="314" height="329" /></a>
</p>
<h2><a name="Improving_the_regression_model_using_residuals_plots"></a><span class="mw-headline">残差プロットを使って回帰を改良する</span></h2>
<p>残差プロットのパターンの構造は、回帰モデルの正当性をチェックするだけでなく、どのように改良するかというヒントも提供されます。例えば、<b>残差と独立変数</b>のプロットの曲線パターンは、より高い次数の項がフィットモデルに追加されるべきだということを示しています。 
</p><p><a class="image"><img alt="Graphic Residual Analysis-6.png" src="../images/Graphic_Residual_Analysis/Graphic_Residual_Analysis-6.png" width="376" height="274" /></a>
</p><p>これは1つのサンプルですが、残差プロットのパターンから調査することによる推定ができる事例はたくさんあります。詳細については、この章にある統計に関する参考文献を参照することをお勧めします。
</p>
<h2><a name="Detecting_outliers_by_transforming_residuals"></a><span class="mw-headline">残差を変換して外れ値を検出する</span></h2>
<p>データの外れ値を探す場合、残差を<b>標準化</b>、<b>スチューデント化</b>、 <b>スチューデント化削除</b>の残差に変換すると役立ちます。これら変換した残差は次のように計算できます。
</p><p><i><b>標準化</b></i>
</p><p><img src="../images/Graphic_Residual_Analysis/math-9ffd8a8883cc3fd6bfe38b2745f3338e.png" title="r_i^{\prime }=\frac{r_i}s" alt="r_i^{\prime }=\frac{r_i}s" class="tex"/>
</p><p><i><b>スチューデント化</b></i>
</p><p>内部基準化残差、とも呼ばれます。
</p><p><img src="../images/Graphic_Residual_Analysis/math-3221975524454d794f9af389fbb5cf78.png" title="r_i^{\prime }=RI_i=\frac{r_i}{s\sqrt{1-h_i}}" alt="r_i^{\prime }=RI_i=\frac{r_i}{s\sqrt{1-h_i}}" class="tex"/>
</p><p><i><b>スチューデント化削除</b></i>
</p><p>外部基準化残差、とも呼ばれます。
</p><p><img src="../images/Graphic_Residual_Analysis/math-747d32a78c8f4a3a011fcf3515de7db5.png" title="r_i^{\prime }=RE_i=\frac{r_i}{s_{-i}\sqrt{1-h_i}}=RI_i\sqrt{\frac{n-p-1}{n-p-RI_i^2}}" alt="r_i^{\prime }=RE_i=\frac{r_i}{s_{-i}\sqrt{1-h_i}}=RI_i\sqrt{\frac{n-p-1}{n-p-RI_i^2}}" class="tex"/>
</p><p><br /> <b>スチューデント化</b>と<b>スチューデント化削除</b>の残差の数式で、 <img src="../images/Graphic_Residual_Analysis/math-57339b77b3af15427b7154f4daf8a223.png" title="h_i" alt="h_i" class="tex"/> は、行列<i>P </i>の<I>i</I> 番目の対角要素です。
</p><p><img src="../images/Graphic_Residual_Analysis/math-ec67346fb4efce792368cdc19156d0c2.png" title="P=F(F'F)^{-1}F^{\prime }" alt="P=F(F'F)^{-1}F^{\prime }" class="tex"/>
</p><p>ここで、 <i>F</i> は、非線形回帰モデルに対する部分派生行列です。 
</p><p>線形回帰モデルで、独立行列 X は <i>F</i>に等しくなります。
</p><p><img src="../images/Graphic_Residual_Analysis/math-609f90ce395d2346200e55f1a632bab0.png" title="P=X(X'X)^{-1}X^{\prime }" alt="P=X(X'X)^{-1}X^{\prime }" class="tex"/>
</p><p>変換した残差の使用例として、標準化残差は回帰の標準誤差によって残差の値を再スケールし、データは正規分布しているという回帰の仮定の場合、約95%のデータがフィット曲線を中心として2σ の範囲内に入ります。逆に、標準化残差の95%は、残差プロットの-2から+2の範囲に入ります。
</p><p>残差プロットの分散は、外れ値を検出するのに大変役立ちます。例えば、標準化残差と独立変数プロットで、残差は回帰の標準誤差で再スケールされます。データが正規分布しており、データポイントの約95%がフィット曲線の2σ 以内にあるという回帰の前提の場合、標準化した残差の95%が、以下のグラフの-2から+2の間に入ります。 
</p><p><a class="image"><img alt="Graphic Residual Analysis 7.png" src="../images/Graphic_Residual_Analysis/Graphic_Residual_Analysis_7.png" width="309" height="220" /></a>
</p><p>これらのポイントは外れ値の可能性があるので、この範囲の外側の残差を調べます。
</p>
<h2><a name="Residual_contour_plots_for_surface_fitting"></a><span class="mw-headline">非線形曲面フィットのための残差の等高線プロット</span></h2>
<p>OriginProの組込み関数を使って曲面フィットを行うとき、XY平面に残差の等高線を生成します。等高線の区間は、シグマの値によって決まります(モデル誤差)。2Dフィットの場合と同様に、回帰曲面のフィットの良さは残差の等高線プロットで認識できるパターンを生成しません。
</p>




    