<h1 class="firstheading">線形、多項式、線形多重回帰</h1>
<p class="urlname" style="display: none;">Linear-Fitting</p>
<p><span class="OIndex" style="display: none;">Fit Line</span><span class="OIndex" style="display: none;">Fit Polynomial</span><span class="OIndex" style="display: none;">Regression</span><span class="OIndex" style="display: none;">Multiple Regression</span></p>
<p>LabTalkスクリプトでは、3つのXファンクション<b><a class="external text" href="../../XFunction/X-Function/FitLR.html">fitLR</a></b>、<b><a class="external text" href="../../XFunction/X-Function/Fitpoly.html">fitPoly</a></b>、<b><a class="external text" href="../../XFunction/X-Function/FitMR.html">fitMR</a></b>を使用して線形フィット、多項式フィット、線形多重回帰を実行できます。<b>-h</b>スイッチを使用すれば、引数のリストを確認できます。</p>
<div id="toc" class="toc">
<div id="toctitle">
<h2>内容</h2>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Linear_Regression"><span class="tocnumber">1</span> <span class="toctext">線形フィット</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Polynomial_Regression"><span class="tocnumber">2</span> <span class="toctext">多項式フィット</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Multiple_Linear_Regression"><span class="tocnumber">3</span> <span class="toctext">線形多重回帰</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Run_Operation_Classes_to_Perform_Regression"><span class="tocnumber">4</span> <span class="toctext">オペレーションクラスを実行して回帰を行う</span></a></li>
</ul>
</div>
<h2><a name="Linear_Regression" id="Linear_Regression"></a><span class="mw-headline">線形フィット</span></h2>
<p><b><a class="external text" href="../../XFunction/X-Function/FitLR.html">fitLR</a></b>は、目的のデータセットに対し、もっとも当てはまりがよい直線を作成します。</p>
<pre class="lt" style="font-family: monospace;">
newbook;  <span style="color: #008000;">// 新しいブックを作製</span><span style="color: #008000;">
// ファイル名</span>
string strFile<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">"Samples\Curve Fitting\Linear Fit.dat"</span>;  
impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strFile<span style="color: #000080;">$</span>;  <span style="color: #008000;">// データインポート</span>
int nn <span style="color: #000080;">=</span> wks.<span style="color: #000080;">ncols</span>; 
wks.<span style="color: #000080;">addcol</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 新しい列追加</span>
wks.<span style="color: #000080;">col</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>nn<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>.<span style="color: #000080;">lname</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> FitData;  <span style="color: #008000;">// 新しい列にロングネームを割り当て</span><span style="color: #008000;">
// 列1(X)と列2(Y)の最初の10点に線形フィット実行</span><span style="color: #008000;">
// フィットデータをFitData列に出力</span>
fitLR iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">)</span> oy<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span><span style="color: #ff00ff;">"FitData"</span><span style="color: #000000;">)</span>;<span style="color: #008000;">
// 出力値をふくむツリーオブジェクトfitLR作成</span>
fitLR.<span style="color: #000080;">a</span> <span style="color: #000080;">=</span> ;  <span style="color: #008000;">// フィット切片を出力</span>
fitLR.<span style="color: #000080;">b</span> <span style="color: #000080;">=</span> ;  <span style="color: #008000;">// フィット傾きを出力</span>
fitLR.<span style="color: #000080;">=</span> ;  <span style="color: #008000;">// 切片と傾きを含む全結果を出力</span>
</pre>
<p>線形フィットの他のサンプルは<a href="../../LabTalk/LabTalk/Curve_Fitting.html#Linear_Fit" title="LabTalk:カーブフィッティング">曲線フィットサンプルページ</a>にあります。また、<b>XFスクリプトダイアログ</b>の<b>Fitting</b>カテゴリー内でも確認できます（F11で開く）。</p>
<h2><a name="Polynomial_Regression" id="Polynomial_Regression"></a><span class="mw-headline">多項式フィット</span></h2>
<p><span class="OIndex" style="display: none;">多項式フィット</span>では、フィット関数が数学的には非線形ですが、反復無しの分析解を得る特殊なケースです。LabTalkで多項式フィットを行うには、<b><a class="external text" href="../../XFunction/X-Function/Fitpoly.html">fitPoly</a></b>を利用できます。</p>
<pre class="lt" style="font-family: monospace;">
newbook;  <span style="color: #008000;">// 新規ブックを作成</span>
 <span style="color: #008000;">
// ファイル名</span>
string strFile<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">"Samples\Curve Fitting\Polynomial Fit.dat"</span>;
impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strFile<span style="color: #000080;">$</span>;  <span style="color: #008000;">// データをインポート</span>
page.<span style="color: #000080;">xlcolname</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; <span style="color: #008000;">// 最初にスプレッドシートセル表記をオフ</span>
wks.<span style="color: #000080;">addcol</span><span style="color: #000000;">(</span>PolyCoef<span style="color: #000000;">)</span>;  <span style="color: #008000;">// 多項式係数用の新規列を追加</span>
wks.<span style="color: #000080;">addcol</span><span style="color: #000000;">(</span>FittedX<span style="color: #000000;">)</span>;  <span style="color: #008000;">//フィット曲線のXデータ用に新規列を追加</span>
wks.<span style="color: #000080;">addcol</span><span style="color: #000000;">(</span>FittedY<span style="color: #000000;">)</span>;  <span style="color: #008000;">// フィット曲線のYデータ用に新規列を追加</span>
 <span style="color: #008000;">
// 列1 (X) と列3 (Y) に多項式フィットを実行</span><span style="color: #008000;">
// 多項式次数は 3</span>
fitPoly iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">3</span><span style="color: #000000;">)</span> polyorder<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span> coef<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span>PolyCoef<span style="color: #000000;">)</span> oy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">(</span>col<span style="color: #000000;">(</span>FittedX<span style="color: #000000;">)</span>,col<span style="color: #000000;">(</span>FittedY<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
 <span style="color: #008000;">
// fitPolyというツリーに格納された結果を出力</span>
fitPoly.<span style="color: #000080;">=</span> ;
</pre>
<p>さらに、<b><a class="external text" href="../../XFunction/X-Function/Fitpoly.html">fitPoly</a></b> では、補正済み残差平方和、決定係数、多項式係数の誤差を出力できます。より詳しいサンプルは、<a href="../../LabTalk/LabTalk/Curve_Fitting.html#Polynomial_Fit" title="LabTalk:カーブフィッティング">曲線フィットサンプルページ</a>にあります。または、<b>XFスクリプトダイアログ</b>の<b>Fitting</b>カテゴリー内で確認できます（F11で開く）。</p>
<table class="noborder">
<tr>
<td style="vertical-align: top;" width="60"><img src="../images/Linear_Fitting/Tip_icon.png" alt="" width="57" height="57" border="0" /></td>
<td>
<p>ワークブックの<a class="external text" href="../../UserGuide/UserGuide/Column_Short_Name_Restriction.html">スプレッドシートセル表記</a>については、<a class="external text" href="../../QuickHelp/QuickHelp/Turn_off_spreadsheet_cell_notation.html"><b>FAQ-849</b></a> を参照してください。</p>
</td>
</tr>
</table>
<h2><a name="Multiple_Linear_Regression" id="Multiple_Linear_Regression"></a><span class="mw-headline">線形多重回帰</span></h2>
<p>多重線形回帰はシンプルな線形回帰を拡張したもので、複数の説明変数と目的変数間の関係性を評価します。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// 新しいブックを作成し、データをインポート</span>
newbook;
fn<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">"Samples\Curve Fitting\Multiple Linear Regression.dat"</span>;
impasc fn<span style="color: #000080;">$</span>;
page.<span style="color: #000080;">xlcolname</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; <span style="color: #008000;">//最初にスプレッドシートセル表記をオフ</span>
wks.<span style="color: #000080;">addcol</span><span style="color: #000000;">(</span>FitValue<span style="color: #000000;">)</span>;  <span style="color: #008000;">// フィットした従属変数（Y値）用の列を追加</span>
 <span style="color: #008000;">
// 多重線形回帰を実行</span><span style="color: #008000;">
// 列Dは従属、列A、B、Cは独立変数</span><span style="color: #008000;">
// 出力結果はtrツリーに格納される</span>
fitMR dep<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span>D<span style="color: #000000;">)</span> indep<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span><span style="color: #000000;">:</span>col<span style="color: #000000;">(</span>C<span style="color: #000000;">)</span> mrtree<span style="color: #000000;">:</span><span style="color: #000080;">=</span>tr odep<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span>FitValue<span style="color: #000000;">)</span>;
tr.<span style="color: #000080;">=</span> ;  <span style="color: #008000;">// 結果ツリーを出力</span>
</pre>
<p>他のサンプルは、<a href="../../LabTalk/LabTalk/Curve_Fitting.html" title="LabTalk:カーブフィッティング">曲線フィットサンプルページ</a>にあります。または、<b>XFスクリプトダイアログ</b>の<b>Fitting</b>カテゴリー内で確認できます（F11で開く）。</p>
<table class="noborder">
<tr>
<td style="vertical-align: top;" width="60"><img src="../images/Linear_Fitting/Tip_icon.png" alt="" width="57" height="57" border="0" /></td>
<td>
<p>ワークブックの<a class="external text" href="../../UserGuide/UserGuide/Column_Short_Name_Restriction.html">スプレッドシートセル表記</a>については、<a class="external text" href="../../QuickHelp/QuickHelp/Turn_off_spreadsheet_cell_notation.html"><b>FAQ-849</b></a> を参照してください。</p>
</td>
</tr>
</table>
<h2><a name="Run_Operation_Classes_to_Perform_Regression" id="Run_Operation_Classes_to_Perform_Regression"></a><span class="mw-headline">オペレーションクラスを実行して回帰を行う</span></h2>
<p>上記で説明したXファンクションは、シンプルで素早く線形、多項式、多重回帰を行うためのものです。つまり、これら3つのXファンクションを使用する際は、いくつかの値の指定ができません。全ての値にアクセスをするには、 <b><a class="external text" href="../../XFunction/X-Function/Xop.html">xop</a></b> Xファンクションを使用します。これは、内部メニューコマンド（オペレーションコマンド）を呼び出し、回帰を行うためのオペレーションクラスを実行します。次のサンプルは、<b><a class="external text" href="../../XFunction/X-Function/Xop.html">xop</a></b> Xファンクションを使って線形フィットを実行し、レポートを作成する方法です。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// 新しいブックを作成し、データをインポート</span>
newbook;
fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">"Samples\Curve Fitting\Linear Fit.dat"</span>;
impasc fname<span style="color: #000080;">$</span>;
 
tree lrGUI;  <span style="color: #008000;">// 線形フィットのためのGUIツリー</span><span style="color: #008000;">
// FitLinear クラスでGUIツリーを初期化</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>init classname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitLinear iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lrGUI;
 <span style="color: #008000;">
// GUIツリーに入力するデータを指定</span>
lrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">X</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span>;
lrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">Y</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span>C<span style="color: #000000;">)</span>;
 <span style="color: #008000;">
// 線形フィットを実行し、準備したGUIツリーにレポートを生成</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>report iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lrGUI;
 
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cleanup;  <span style="color: #008000;">//フィット完了後に線形フィットオブジェクトをリセットする</span>
</pre>
