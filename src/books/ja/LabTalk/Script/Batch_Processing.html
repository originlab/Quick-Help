<h1 class="firstheading">バッチ処理</h1><p class='urlname' style='display: none'>Batch-Processing</p>
<p>Originであるデータに対して行った分析処理と同じ処理を複数のデータファイルやデータセットに対して<span class="OIndex">バッチ処理</span>として実行する必要があるかもしれません。これは3つの方法で行うことができ、次のセクションで情報とサンプルを提供しています。
</p>
<h2><a name="Processing_Each_Dataset_in_a_Loop"></a><span class="mw-headline">各データセットをループで処理する</span></h2>
<p>バッチ処理を行う1つの方法は、<span class="OIndex">複数ファイルやデータセットをループ</span>し、ループ処理の中で、適切なXファンクションや他のスクリプトを呼び出し、必要なデータ処理を実行することです。
</p><p>次のサンプルは10個のファイルをインポートし、カーブフィット操作を実行して、フィット結果を出力します。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// ワイルドカードを使ってすべてのファイルを検索</span>
string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Batch Processing&quot;</span>;  <span style="color: #008000;">// ファイルを検索するパス</span>
<span style="color: #008000;">// path$変数で指定したフォルダ内を検索</span>
<span style="color: #008000;">// 結果のファイル名を文字列fname$に保存する</span>
<span style="color: #008000;">// CRLF で分ける(デフォルト).ここで使用しているワイルドカード * は、</span>
<span style="color: #008000;">// &quot;T&quot;からはじまり、拡張子が&quot;csv&quot;のファイルすべてを意味する</span>
findFiles ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;T*.csv&quot;</span>;
&nbsp;
<span style="color: #008000;">// シートなしの新しいブックを開始</span>
newbook sheet<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
<span style="color: #008000;">// すべてのファイルをループ</span>
for<span style="color: #000000;">(</span>int iFile <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; iFile <span style="color: #000080;">&lt;=</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">(</span>CRLF<span style="color: #000000;">)</span>; iFile<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	<span style="color: #008000;">// ファイル名を取得</span>
	string file<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetToken</span><span style="color: #000000;">(</span>iFile, CRLF<span style="color: #000000;">)</span><span style="color: #000080;">$</span>;
	<span style="color: #008000;">// ファイルを新しいシートにインポート</span>
	newsheet;
	impasc file<span style="color: #000080;">$</span>;
	<span style="color: #008000;">// 現在のデータの列2にガウスフィットを実行</span>
	nlbegin iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> func<span style="color: #000000;">:</span><span style="color: #000080;">=</span>gaussamp nltree<span style="color: #000000;">:</span><span style="color: #000080;">=</span>myfitresult;
	<span style="color: #008000;">// フィットし、レポートなしで終了</span>
	nlfit;
	nlend;
	<span style="color: #008000;">// ファイル名と結果を出力</span>
	type <span style="color: #ff00ff;">&quot;File Name:&nbsp;%(file$)&quot;</span>;
	type <span style="color: #ff00ff;">&quot;   Peak Center= $(myfitresult.xc)&quot;</span>;	
	type <span style="color: #ff00ff;">&quot;   Peak Height= $(myfitresult.A)&quot;</span>;	
	type <span style="color: #ff00ff;">&quot;   Peak Width=  $(myfitresult.w)&quot;</span>;	
<span style="color: #000000;">}</span></pre>
<h2><a name="Using_Analysis_Template_in_a_Loop"></a><span class="mw-headline">ループ内で分析テンプレートを使用</span></h2>
<p>代表的なデータセットに対してメニュー操作で必要なデータ処理を実行し、ワークブックまたはプロジェクト全体を<span class="OIndex"><b>分析テンプレート</b></span>として保存し、Originで分析用のカスタムテンプレートを作成できます。次のサンプルは、10個のファイルのカーブフィットを実行する既存の分析テンプレートを使う方法です。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// ワイルドカードを使ってすべてのファイルを検索</span>
string fpath<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Samples\Batch Processing\&quot;</span>;
string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> fpath<span style="color: #000080;">$</span>;  <span style="color: #008000;">// ファイルを検索するパス</span>
<span style="color: #008000;">// path$変数で指定したフォルダ内を検索</span>
<span style="color: #008000;">// 結果のファイル名を文字列fname$に保存する</span>
<span style="color: #008000;">// CRLF で分ける(デフォルト)</span>ここで使用しているワイルドカード * は、
// &quot;T&quot;からはじまり、拡張子が&quot;csv&quot;のファイルすべてを意味します
findFiles ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;T*.csv&quot;</span>;
&nbsp;
<span style="color: #008000;">// 分析テンプレートのパスをセット</span>
string templ<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> path<span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Peak Analysis.OGW&quot;</span>;
<span style="color: #008000;">// すべてのファイルでループ</span>
for<span style="color: #000000;">(</span>int iFile <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; iFile <span style="color: #000080;">&lt;=</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">(</span>CRLF<span style="color: #000000;">)</span>; iFile<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>	
   <span style="color: #008000;">// 分析テンプレートのインスタンスを開く</span>
   doc <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">(</span>templ<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;
   <span style="color: #008000;">// 現在のファイルを第1シートにインポート</span>
   page.<span style="color: #000080;">active</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
   impasc fname.<span style="color: #000080;">GetToken</span><span style="color: #000000;">(</span>iFile, CRLF<span style="color: #000000;">)</span><span style="color: #000080;">$</span>
<span style="color: #000000;">}</span>
&nbsp;
<span style="color: #008000;">// テンプレートで手動再計算に設定した場合</span>
<span style="color: #008000;">//保留中のすべての操作を更新する</span>
run <span style="color: #000080;">-</span>p au;</pre>
<h2><a name="Using_Batch_Processing_X-Functions"></a><span class="mw-headline">Xファンクションのバッチ処理を使用する</span></h2>
<p>Originは、ファイルやデータセットをループする必要がないところでスクリプトアクセス可能なXファンクションでバッチ処理を行うことができます。単に処理を行うデータのリストを作成し、適切なXファンクションを呼び出します。Xファンクションは、テンプレートまたはテーマを使って、指定したデータのすべてを処理します。これらのXファンクションのいくつかは、任意の<span class="OIndex">サマリーレポート</span>を作成します。サマリーレポートには、ユーザが分析テンプレートでレポートすると指定した各ファイル/データセットからの結果が含まれています。
</p><p>以下の表は、バッチ分析で利用可能なXファンクションの一覧です。
</p>
<table class="simple">
<tr>
<th> 名前</th>
<th> 説明
</th></tr>
<tr>
<td> <a class="external text" href="../../XFunction/X-Function/BatchProcess.html">batchProcess</a>
</td>
<td>
<p>任意のサマリーレポート付きで、分析テンプレート使って複数ファイルまたはデータセットのバッチ処理を実行します。
</p>
</td></tr>
<tr>
<td> <a class="external text" href="../../XFunction/X-Function/PaMultiY.html">paMultiY</a>
</td>
<td> ピークアナライザテーマを使って複数Yデータセットのピーク分析を実行します。
</td></tr>
</table>
<p>次のスクリプトは、分析テンプレートを使って、10個のファイルからデータのカーブフィットを実行し、処理の終わりにサマリーレポートを作成する <a class="external text" href="../../XFunction/X-Function/BatchProcess.html">batchProcess Xファンクション</a> を使用する方法を示しています。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// ワイルドカードを使ってすべてのファイルを検索</span>
string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Batch Processing\&quot;</span>;  <span style="color: #008000;">// ファイルを検索するパス</span>
<span style="color: #008000;">// path$変数で指定したフォルダ内を検索</span>
<span style="color: #008000;">// 結果のファイル名を文字列fname$に保存する</span>
<span style="color: #008000;">// CRLF で分ける(デフォルト).ここで使用しているワイルドカード * は、</span>
<span style="color: #008000;">// &quot;T&quot;からはじまり、拡張子が&quot;csv&quot;のファイルすべてを意味する</span>
findFiles ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;T*.csv&quot;</span>;
&nbsp;
<span style="color: #008000;">// 分析テンプレートのパスをセット</span>
string templ<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> path<span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Peak Analysis.OGW&quot;</span>;
&nbsp;
<span style="color: #008000;">// バッチ処理X-Functionを呼び出す</span>
<span style="color: #008000;">// 最終的なサマリーシートを保持し、中間ブックを削除</span>
batchProcess batch<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> name<span style="color: #000000;">:</span><span style="color: #000080;">=</span>templ<span style="color: #000080;">$</span> data<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> fill<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Raw Data&quot;</span> 
             append<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Summary&quot;</span> remove<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> method<span style="color: #000000;">:</span><span style="color: #000080;">=</span>impASC;</pre>
<hr />
<p>Xファンクションを使ったバッチ処理は、外部コンソールからOriginを呼び出すことで実行できます。詳細は、<a href="../../LabTalk/Script/From_Console.html" title="Script:コンソールから">コンソールからスクリプトを実行する</a>をご覧ください。
</p>






    