<h1 class="firstheading">ワークシート列データの操作</h1><div id="toc" class="toc"><div id="toctitle"><h2>内容</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Basic_Operation"><span class="tocnumber">1</span> <span class="toctext">基本的な操作</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Basic_ArithmeticArithmetic"><span class="tocnumber">1.1</span> <span class="OIndex" style="display:none">基本的な算術計算</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#FunctionsFunction"><span class="tocnumber">1.2</span> <span class="toctext">関数</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Set_Formula_for_ColumnSet_Column_Values"><span class="tocnumber">2</span> <span class="toctext">列に式をセットする</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Copy_ColumnCopy_Column"><span class="tocnumber">3</span> <span class="toctext">列のコピー</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Sort_Column"><span class="tocnumber">4</span> <span class="toctext">列をソートする</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Reverse_Column"><span class="tocnumber">5</span> <span class="toctext">列を逆順にする</span></a></li>
</ul>
</div>

<h2><a name="Basic_Operation"></a><span class="mw-headline">基本的な操作</span></h2>
<p>いくつかの数値データをロードしたり、作成したら、ここに示すような操作を行うことができます。
</p>
<h3><a name="Basic_ArithmeticArithmetic"></a><span class="mw-headline">基本的な算術計算</span></h3>
<p>ほとんどのデータは列に保存されており、そのデータに対して行毎にさまざまな操作を実行することができます。  LabTalkスクリプトで2つの方法でこれを行うことができます。(1) 演算子を使って直接ステートメントまたは (2) 範囲を使う、という選択肢があります。  例えば、列Aの各行に値を追加し、列Bにはそれに対応する値を追加し、列Cに結果の値を配置します。
</p>
<pre class="lt" style="font-family:monospace;">Col<span style="color: #000000;">(</span>C<span style="color: #000000;">)</span> <span style="color: #000080;">=</span> Col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span> <span style="color: #000080;">+</span> Col<span style="color: #000000;">(</span>B<span style="color: #000000;">)</span>;  <span style="color: #008000;">// 加算 </span>
Col<span style="color: #000000;">(</span>D<span style="color: #000000;">)</span> <span style="color: #000080;">=</span> Col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span> <span style="color: #000080;">*</span> Col<span style="color: #000000;">(</span>B<span style="color: #000000;">)</span>;  <span style="color: #008000;">// 乗算</span>
Col<span style="color: #000000;">(</span>E<span style="color: #000000;">)</span> <span style="color: #000080;">=</span> Col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span> <span style="color: #000080;">/</span> Col<span style="color: #000000;">(</span>B<span style="color: #000000;">)</span>;  <span style="color: #008000;">// 除算</span></pre>
<p>「 <b>-</b> 」と「 <b>^</b> 」の演算子は、それぞれ減算と指数として上記のように動作します。
</p><p>範囲変数を使えば、異なるシートにある列に対して同じ操作を行うことができます。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// sheet1, 2, 3の列1をポイント</span>
range aa <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
range bb <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span><span style="color: #000080;">!</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
range cc <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span><span style="color: #000080;">!</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
cc <span style="color: #000080;">=</span> aa<span style="color: #000080;">+</span>bb;
cc <span style="color: #000080;">=</span> aa<span style="color: #000080;">^</span>bb;
cc <span style="color: #000080;">=</span> aa<span style="color: #000080;">/</span>bb;</pre>
<table class="noborder">
	<tr>
	<td style="vertical-align:top" width="60"><img src="../images/Worksheet_Column_Data_Manipulation/Alert_icon.png" width="57"  border="0" /></td><td><p>異なるシートにあるデータを算術演算するときには、範囲変数を使う必要があります。  範囲文字列への直接参照はサポートされていません。  例えば、スクリプト <b>Sheet3!col(1) = Sheet1!col(1) + Sheet2!col(1);</b> は動作しません。
</p>
	</td>
	</tr>
	</table>
<h3><a name="FunctionsFunction"></a><span class="mw-headline">関数</span></h3>
<p>標準的な演算子に加え、LabTalkは、<a href="../../LabTalk/LabTalk/Sin_(function).html" title="LabTalk:Sin (関数)"><b>sin</b></a> や <a href="../../LabTalk/LabTalk/Cos_(function).html" title="LabTalk:Cos (関数)"><b>cos</b></a> のような三角関数、 Bessel関数、<a href="../../LabTalk/LabTalk/Uniform_(function).html" title="LabTalk:Uniform (関数)"><b>uniform</b></a> や <a href="../../LabTalk/LabTalk/Poisson_(function).html" title="LabTalk:Poisson (関数)"><b>Poisson</b></a>のような統計分布データを生成する関数など、データを操作する多くの一般的な関数をサポートしています。  すべてのLabTalk関数は、1つの引数で動作しますが、多くはその中でベクター化され、ワークシート列、ルーズデータセット、行列で動作します。  例えば、三角関数 <b>sin</b> は次のようになります。 
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// 数値のsinを見つける:</span>
double xx <span style="color: #000080;">=</span> sin<span style="color: #000000;">(</span><span style="color: #0000dd;">0.3572</span><span style="color: #000000;">)</span></pre>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// 列データのsinを見つける (行毎)</span>
Col<span style="color: #000000;">(</span>B<span style="color: #000000;">)</span> <span style="color: #000080;">=</span> sin<span style="color: #000000;">(</span>Col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span><span style="color: #000000;">)</span></pre>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// 行列データのsinを見つける (要素毎)</span>
<span style="color: #000000;">[</span>MBook2<span style="color: #000000;">]</span> <span style="color: #000080;">=</span> sin<span style="color: #000000;">(</span><span style="color: #000000;">[</span>MBook1<span style="color: #000000;">]</span><span style="color: #000000;">)</span></pre>
<p>関数の例として、主要な機能がデータ生成である<b>uniform</b> 関数を考えます。この形式では、作成する値の数として入力<i>N</i>を取り、そして、0から1までの範囲で均一に分布した乱数を <i>N</i> 個生成します。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000; font-style: regular;">/* 列Bの最初の20行に一様に分布した乱数を入力: */</span>
Col<span style="color: #000000;">(</span>B<span style="color: #000000;">)</span> <span style="color: #000080;">=</span> uniform<span style="color: #000000;">(</span><span style="color: #0000dd;">20</span><span style="color: #000000;">)</span>;</pre>
<p>LabTalkでサポートする関数の完全なリストについては、<a href="../../LabTalk/Category/Alphabetical_Listing_of_Functions_(LabTalk).html" title="Category:アルファベット順関数の一覧 (LabTalk)">アルファベット順の関数リスト</a>をご覧下さい。
</p>
<h2><a name="Set_Formula_for_ColumnSet_Column_Values"></a><span class="mw-headline">列に式をセットする</span></h2>
<p><span class="OIndex" style="display:none">Set Column Value</span><span class="OIndex" style="display:none">Formula</span><span class="OIndex" style="display:none">Set Formula</span>
</p><p>Originのメニュー操作で、列値の設定ダイアログを使って、指定した数式でワークシート列にデータを生成または変換することができます。このような変換は、 <a class="external text" href="../../XFunction/X-Function/Csetvalue.html">csetvalue</a> Xファンクションを使ってLabTalkで実行することもできます。ここにLabTalkを使って列値をセットする方法を示すサンプルがいくつかあります。
</p>
<pre class="lt" style="font-family:monospace;">newbook;
wks.<span style="color: #000080;">ncols</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;
<span style="color: #008000;">// 列1に乱数を入力</span>
csetvalue formula<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;rnd()&quot;</span> col<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
<span style="color: #008000;">// 列1のデータを 0 ~ 100の整数値に変換</span>
csetvalue formula<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;int(col(1)*100)&quot;</span> col<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>;
<span style="color: #008000;">// 列値を設定するときに実行前の処理スクリプトを指定</span>
<span style="color: #008000;">// 再計算モードを手動にセット</span>
csetvalue formula<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;mm - col(2)&quot;</span> col<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span> script<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;int mm = max(col(2))&quot;</span> recalculate<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>;
string str<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000000;">[</span><span style="color: #000080;">%</span>h<span style="color: #000000;">]</span><span style="color: #000080;">%</span><span style="color: #000000;">(</span>page.<span style="color: #000080;">active</span><span style="color: #000080;">$</span><span style="color: #000000;">)</span><span style="color: #000080;">!</span>;
newsheet cols<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
<span style="color: #008000;">// range変数を使って別のシートの列を参照</span>
csetvalue f<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;r1/r2&quot;</span> c<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> s<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;range r1=%(str$)2; range r2=%(str$)3;&quot;</span> r<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;</pre>
<table class="noborder">
	<tr>
	<td style="vertical-align:top" width="60"><img src="../images/Worksheet_Column_Data_Manipulation/Alert_icon.png" width="57"  border="0" /></td><td><p>列の式をセットするのに論理宣言が使用されているとき、0.0, NANUM(欠損値)や-1.0E-290 から 1.0E-290の値などは、<i>False</i>として評価されます。つまり、LabTalkはコマンドは、1(真)の代わりに0(偽)を返します。 
</p>
<pre class="lt" style="font-family:monospace;">type <span style="color: #000080;">$</span><span style="color: #000000;">(</span><span style="color: #000080;">-</span>1e<span style="color: #000080;">-</span>290?<span style="color: #0000dd;">1</span><span style="color: #000000;">:</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>; <span style="color: #008000;">// 0 (偽)を返す</span>
type <span style="color: #000080;">$</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">0</span>?<span style="color: #0000dd;">1</span><span style="color: #000000;">:</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>; <span style="color: #008000;">// 0 (偽)を返す, ここで 1/0 == NANUM</span></pre>
	</td>
	</tr>
	</table>
<h2><a name="Copy_ColumnCopy_Column"></a><span class="mw-headline">列のコピー</span></h2>
<p><a class="external text" href="../../XFunction/X-Function/Colcopy.html">colcopy</a> Xファンクションは、列ラベル行と日付や文字と数値のような列フォーマットを含むデータ列をコピーします。
</p><p>次の例は、アクティブワークシートの2列目から4列目をbook2のsheet1の1列目から3列目にコピーします。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// 列のロングネーム、単位とコメントだけでなく </span>
<span style="color: #008000;">// データと書式の両方をコピー</span>
colcopy irng<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">:</span><span style="color: #0000dd;">4</span><span style="color: #000000;">)</span> orng<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span>book2<span style="color: #000000;">]</span>sheet1<span style="color: #000080;">!</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">:</span><span style="color: #0000dd;">3</span><span style="color: #000000;">)</span> data<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> 
        format<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> lname<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> units<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> comments<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;</pre>
<h2><a name="Sort_Column"></a><span class="mw-headline">列をソートする</span></h2>
<p>特定の列をソートするには、Xファンクション <a class="external text" href="../../XFunction/X-Function/Wsort.html">wsort</a> が使用できます。このXファンクションを使って1列のみをソートするには、引数C1とC2は、ワークシートの同じ列でなければならず、bycolもC1と同じである必要があります。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// 新しいワークブックを作成</span>
newbook;
&nbsp;
<span style="color: #008000;">// 第1列は行番号、2列目は一様乱数で埋める</span>
col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">1</span><span style="color: #000000;">:</span><span style="color: #0000dd;">32</span><span style="color: #000000;">}</span>;
col<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> uniform<span style="color: #000000;">(</span><span style="color: #0000dd;">32</span><span style="color: #000000;">)</span>;
&nbsp;
<span style="color: #008000;">// 2列目を降順にソートする</span>
wsort c1<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> c2<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> bycol<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> descending<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;</pre>
<h2><a name="Reverse_Column"></a><span class="mw-headline">列を逆順にする</span></h2>
<p>Xファンクション<a class="external text" href="../../XFunction/X-Function/Colreverse.html">colreverse</a>を使用して列を逆順にします。 
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// 新しいワークブックを作成</span>
newbook;
&nbsp;
<span style="color: #008000;">// 第1列は行番号、2列目は一様乱数で埋める</span>
col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">1</span><span style="color: #000000;">:</span><span style="color: #0000dd;">32</span><span style="color: #000000;">}</span>;
col<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> uniform<span style="color: #000000;">(</span><span style="color: #0000dd;">32</span><span style="color: #000000;">)</span>;
&nbsp;
<span style="color: #008000;">// 1列目をインデックスを使用して逆順にする</span>
colreverse rng<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// colreverse rng:=col(A);  // このスクリプトも使用可能</span>
&nbsp;
<span style="color: #008000;">// 2列目をrange変数を使用して逆順にする</span>
range rr <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;
colreverse rng<span style="color: #000000;">:</span><span style="color: #000080;">=</span>rr;</pre>



    