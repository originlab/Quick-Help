<h1 class="firstheading">ワークシートデータの操作</h1>
<p class="urlname" style="display: none;">ワークシートデータの操作</p>
<p><br />
このセクションでは、基本的なデータ処理のXファンクションのサンプルを説明します。ワークシートデータに直接アクセスするには、<a href="../../LabTalk/LabTalk/Range_Notation.html#Worksheet_Data" title="LabTalk:範囲変数">範囲表記</a>をご覧下さい。 <span class="OIndex" style="display: none;">ワークシート</span></p>
<div id="toc" class="toc">
<div id="toctitle">
<h2>内容</h2>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Copy_Worksheet_Data"><span class="tocnumber">1</span> <span class="toctext">ワークシートデータをコピーする</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Copy_a_Worksheet"><span class="tocnumber">1.1</span> <span class="toctext">ワークシートをコピーする</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Copy_a_Range_of_CellsCopy_Range"><span class="tocnumber">1.2</span> <span class="toctext">セルの範囲をコピーする</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Reduce_Worksheet_Data"><span class="tocnumber">2</span> <span class="toctext">ワークシートデータを削減する</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Examples"><span class="tocnumber">2.1</span> <span class="toctext">サンプル</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Extract_Worksheet_Data"><span class="tocnumber">3</span> <span class="toctext">ワークシートデータを抽出する</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Output_To_New_Workbook"><span class="tocnumber">3.1</span> <span class="toctext">新しいブックに出力</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Use_Wildcard_Search"><span class="tocnumber">3.2</span> <span class="toctext">ワイルドカードを使って検索する</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#Delete_Worksheet_Data"><span class="tocnumber">4</span> <span class="toctext">ワークシートデータを削除する</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#Sort_Worksheet"><span class="tocnumber">5</span> <span class="toctext">ワークシートをソートする</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="#Split_Worksheet"><span class="tocnumber">6</span> <span class="toctext">ワークシートを分割する</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="#Unstack.2FStack_Categorical_Data"><span class="tocnumber">7</span> <span class="toctext">カテゴリーデータをアンスタック/スタックする</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#Unstack_Worksheet_Columns"><span class="tocnumber">7.1</span> <span class="toctext">ワークシート列をアンスタックする</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Stack_Worksheet_Columns"><span class="tocnumber">7.2</span> <span class="toctext">ワークシート列をスタックする</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15"><a href="#Pivot_Table"><span class="tocnumber">8</span> <span class="toctext">ピボットテーブル</span></a></li>
<li class="toclevel-1 tocsection-16"><a href="#Worksheet_Filter"><span class="tocnumber">9</span> <span class="toctext">ワークシートフィルタ</span></a></li>
</ul>
</div>
<h2><a name="Copy_Worksheet_Data" id="Copy_Worksheet_Data"></a><span class="mw-headline">ワークシートデータをコピーする</span></h2>
<h3><a name="Copy_a_Worksheet" id="Copy_a_Worksheet"></a><span class="mw-headline">ワークシートをコピーする</span></h3>
<p><a class="external text" href="../../XFunction/X-Function/Wcopy.html">wcopy</a> Xファンクションは、指定した<span class="OIndex">ワークシートの コピー</span> を作成するのに使用します。</p>
<p>次のサンプルは、現在のワークシートを複製し、コピーしたワークシートをもつ新しいブックを作成します。</p>
<pre class="lt" style="font-family: monospace;">
wcopy <span style="color: #0000dd;">1</span><span style="color: #000080;">!</span> <span style="color: #000000;">[</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span><span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;
</pre>
<h3><a name="Copy_a_Range_of_CellsCopy_Range" id="Copy_a_Range_of_CellsCopy_Range"></a><span class="mw-headline">セルの範囲をコピーする</span></h3>
<p><a class="external text" href="../../XFunction/X-Function/Wrcopy.html">wrcopy</a> Xファンクションは、あるワークシートから別のワークシートにセル範囲をコピーするのに使用します。 目的のワークシートのロングネームとして使用する元の行を指定できます。</p>
<p>次のスクリプトは、[book1]sheet1! の5から9行目をBook1のCopiedValuesというワークシートにコピーし(ワークシートが存在しなければ作成されます)、[book1]sheet1! の4行目の値を目的のワークシート[book1]CopiedValues!のロングネームに割り当てます。</p>
<pre class="lt" style="font-family: monospace;">
wrcopy iw<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span>book1<span style="color: #000000;">]</span>sheet1<span style="color: #000080;">!</span> r1<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">5</span> r2<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">10</span> name<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">4</span> ow<span style="color: #000000;">:</span><span style="color: #000080;">=</span>CopiedValues<span style="color: #000080;">!</span>;
</pre>
<p>列や行列オブジェクトのコピーは、<a href="../../LabTalk/Script/Worksheet_Column_Data_Manipulation.html#Copy_Column" title="Script:ワークシート列データの操作">列をコピーする</a> と <a href="../../LabTalk/Script/Matrix_Object_Data_Manipulation.html#Copy_Matrix_Data" title="Script:行列オブジェクトのデータ操作">行列をコピーする</a> をご覧ください。</p>
<h2><a name="Reduce_Worksheet_Data" id="Reduce_Worksheet_Data"></a><span class="mw-headline">ワークシートデータを削減する</span></h2>
<p><span class="OIndex" style="display: none;">ワークシートデータの削減</span><span class="OIndex" style="display: none;">ワークシート、削減</span></p>
<p>Originは、 <a class="external text" href="../../XFunction/X-Function/Reduce_ex.html">reduce_ex</a>, <a class="external text" href="../../XFunction/X-Function/Reducedup.html">reducedup</a>, <a class="external text" href="../../XFunction/X-Function/Reducerows.html">reducerows</a>, <a class="external text" href="../../XFunction/X-Function/Reducexy.html">reducexy</a>のようなデータ削減のXファンクションがあります。これらのXファンクションは、大きなデータセットから小さなデータセットを作成する異なる方法を提供します。 どれを選択するかは、持っている入力データの種類や出力したいデータの種類に依存します。</p>
<h3><a name="Examples" id="Examples"></a><span class="mw-headline">サンプル</span></h3>
<p>次のスクリプトは、Y値が複数X値のそれぞれに対して平均値となるよう新しくXY列を作成します。</p>
<pre class="lt" style="font-family: monospace;">
reducedup col<span style="color: #000000;">(</span>B<span style="color: #000000;">)</span>;
</pre>
<p>次のスクリプトは、3を係数として、アクティブな選択(XYのプロット属性とは関係なく、複数列やワークシート全体にできます。)を削減します。 これは、行2,3、行5,6を削除し、行1,4を残します。デフォルトで、削減された値は、新しいワークシートに入れられます。</p>
<pre class="lt" style="font-family: monospace;">
reducerows npts<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>;
</pre>
<p>次のスクリプトは列Aの <i>n</i> 個毎の数字(下記例では5個)の平均を取り、各グループの平均を列Bに出力します。これは <a href="../../LabTalk/LabTalk/Ave_(function).html" title="LabTalk:Ave (関数)">ave</a> LabTalk関数と同じで、col(b)=ave(col(a),5)のように書くことができます。</p>
<pre class="lt" style="font-family: monospace;">
reducerows irng<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span> npts<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">5</span> method<span style="color: #000000;">:</span><span style="color: #000080;">=</span>ave rd<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span>b<span style="color: #000000;">)</span>;
</pre>
<h2><a name="Extract_Worksheet_Data" id="Extract_Worksheet_Data"></a><span class="mw-headline">ワークシートデータの抽出</span></h2>
<p><span class="OIndex" style="display: none;">ワークシート、データの抽出</span><span class="OIndex" style="display: none;">抽出、ワークシートデータ</span></p>
<p><a class="external text" href="../../XFunction/X-Function/Wxt.html"><b>wxt</b></a> Xファンクションを使って、データ列を含む条件でワークシートから部分データを抽出することができます。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// サンプルデータファイルのインポート</span>
newbook;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">"samples\statistics\automobile.dat"</span>;
impasc;<span style="color: #008000;">
// 列のいくつかを使って範囲を定義</span>
range rYear<span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>, rMake<span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>, rHP<span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>;
type <span style="color: #ff00ff;">"Number of rows in raw data sheet= $(rYear.GetSize())"</span>;<span style="color: #008000;">
// 条件文字列を定義し、同じブック内の </span><span style="color: #008000;">
// 新しく名前を付けたシートにデータを抽出</span>
string strCond<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">"rYear &gt;= 1996 and rHP&lt;70 and rHP&gt;60 and rMake[i]$=Honda"</span>;
wxt test<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strCond<span style="color: #000080;">$</span> ow<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">"Extracted Rows"</span><span style="color: #000080;">!</span> num<span style="color: #000000;">:</span><span style="color: #000080;">=</span>nExtRows;
type <span style="color: #ff00ff;">"Number of rows extracted = $(nExtRows)"</span>;
</pre>
<h3><a name="Output_To_New_Workbook" id="Output_To_New_Workbook"></a><span class="mw-headline">新しいブックに出力する</span></h3>
<p>次の行を変更して、既存のワークブックの新しいシートではなく、新しいワークブックに直接出力できます。</p>
<pre class="lt" style="font-family: monospace;">
wxt test<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strCond<span style="color: #000080;">$</span> ow<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span><span style="color: #000080;">&lt;</span>new name<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">"Result"</span><span style="color: #000080;">&gt;</span><span style="color: #000000;">]</span><span style="color: #ff00ff;">"Extracted"</span><span style="color: #000080;">!</span> num<span style="color: #000000;">:</span><span style="color: #000080;">=</span>nExtRows;
</pre>
<p>見て分かるように、前のコードとの違いは、<b>&lt;new&gt;</b> キーワードを持つ変数<b>ow</b>の範囲表記のワークブックの部分を追加しています。(&lt;new&gt;修飾語、オプション、テンプレート、名前などにリンクとインデックスを表します。)</p>
<h3><a name="Use_Wildcard_Search" id="Use_Wildcard_Search"></a><span class="mw-headline">ワイルドカードを使って検索する</span></h3>
<p>LabTalkは、文字列の比較に、<span class="OIndex">ワイルドカード</span>として* と&#160;? 文字を使います。以下のように、<b>strCond</b> を変更することができます。</p>
<pre class="lt" style="font-family: monospace;">
string strCond<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">"rYear &gt;= 1996 and rHP&lt;70 and rHP&gt;60 and rMake[i]$=*o*"</span>;
</pre>
<p>文字 <b>o</b>を使って、自動車のメーカすべてを表示できます。</p>
<h2><a name="Delete_Worksheet_Data" id="Delete_Worksheet_Data"></a><span class="mw-headline">ワークシートデータを削除する</span></h2>
<p><span class="OIndex" style="display: none;">ワークシートデータを削除する</span></p>
<p><i>N</i>番目の行を削除するには、上記で述べたように、 <a class="external text" href="../../XFunction/X-Function/Reducerows.html"><b>reducerows</b></a> Xファンクションを使って行います。</p>
<p>このサンプルでは、<a href="../../LabTalk/LabTalk/Flow_of_Control.html" title="LabTalk:フロー制御">forループ</a>を使ってワークシート内の<i>N</i>番目の列毎に削除する方法を示しています。</p>
<pre class="lt" style="font-family: monospace;">
int ndel <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>; <span style="color: #008000;">// 必要に応じてこの数字を変更</span>
int ncols <span style="color: #000080;">=</span> wks.<span style="color: #000080;">ncols</span>;
int nlast <span style="color: #000080;">=</span> ncols <span style="color: #000080;">-</span> mod<span style="color: #000000;">(</span>ncols, ndel<span style="color: #000000;">)</span>;<span style="color: #008000;">
// 右から左に削除する必要がある</span>
for<span style="color: #000000;">(</span>int ii <span style="color: #000080;">=</span> nlast; ii <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">0</span>; ii <span style="color: #000080;">-</span><span style="color: #000080;">=</span> ndel<span style="color: #000000;">)</span><span style="color: #000000;">
{</span>
   delete wcol<span style="color: #000000;">(</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;<span style="color: #000000;">
}</span>
</pre>
<h2><a name="Sort_Worksheet" id="Sort_Worksheet"></a><span class="mw-headline">ワークシートをソートする</span></h2>
<p><span class="OIndex" style="display: none;">ワークシートをソートする</span><span class="OIndex" style="display: none;">ワークシート、ソート</span></p>
<p>次のサンプルでは、 <a class="external text" href="../../XFunction/X-Function/Wsort.html"><b>wsort</b></a> Xファンクションを使って、ワークシート内のデータをネストソートする方法を示しています。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// 新しくブックを作成し、サンプルファイルをインポート</span>
newbook;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">"Samples\Statistics\automobile.dat"</span>;
impasc;<span style="color: #008000;">
// ベクターデータをセットアップして、列のネストとソート順を指定</span><span style="color: #008000;">
// ソートネスト: 主キー 列2, 次にcol 1, その次にcol 3</span>
dataset dsCols <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">2</span>, <span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">3</span><span style="color: #000000;">}</span>;
 <span style="color: #008000;">
// col2 を昇順、col 1を昇順、col 3を降順にソート   </span>
dataset dsOrder <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>;  
 
wsort nestcols<span style="color: #000000;">:</span><span style="color: #000080;">=</span>dsCols order<span style="color: #000000;">:</span><span style="color: #000080;">=</span>dsOrder;
</pre>
<h2><a name="Split_Worksheet" id="Split_Worksheet"></a><span class="mw-headline">ワークシートを分割する</span></h2>
<p>Xファンクション<a class="external text" href="../../XFunction/X-Function/Wsplit.html">wsplit</a>は、1つのワークシートの列を複数シートに分割するのに使用されます。</p>
<p>以下のサンプルは、複数のCSVファイルをインポートし、全てのデータファイル内にあるAmplitudeデータをワークシートに出力します。さらに、等高線図の作図のためにこれらを統合し、行列として出力します。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// 新しいワークブックを作成</span>
newbook;
 <span style="color: #008000;">
// 特定フォルダ内の全てのCSVファイルを探す</span>
string strPath<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">"Samples\Batch Processing\"</span>;
findfiles path<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strPath<span style="color: #000080;">$</span> fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>csvFiles<span style="color: #000080;">$</span> ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span>csv;
 <span style="color: #008000;">
// 見つかったCSVファイルを、1つのワークシートにインポートする</span>
impCSV  fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>csvFiles<span style="color: #000080;">$</span>  <span style="color: #008000;">// 見つかったすべてのCSVファイル</span>
        options.<span style="color: #000080;">Mode</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>  <span style="color: #008000;">// 第2ファイルから、新たな列を開始</span>
        options.<span style="color: #000080;">names</span>.<span style="color: #000080;">FNameToSht</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>  <span style="color: #008000;">// ワークシート名の変更なし</span>
        options.<span style="color: #000080;">names</span>.<span style="color: #000080;">FNameToBk</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>  <span style="color: #008000;">// ワークブック名の変更なし</span>
        options.<span style="color: #000080;">headerLines</span>.<span style="color: #000080;">SubheaderLines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>  <span style="color: #008000;">// 2行のサブヘッダオプション</span>
        options.<span style="color: #000080;">headerLines</span>.<span style="color: #000080;">LongNames</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>  <span style="color: #008000;">// 第1サブヘッダ行はロングネーム</span>
        options.<span style="color: #000080;">headerLines</span>.<span style="color: #000080;">Units</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// 第2サブヘッダ行は単位</span>
 <span style="color: #008000;">
// ロングネームによりワークシートを分割</span><span style="color: #008000;">
// 同じロングネームの列を同一ワークシートに出力する</span><span style="color: #008000;">
// すべての結果ワークシートを新たなワークブックひとつに出力</span>
wsplit mode<span style="color: #000000;">:</span><span style="color: #000080;">=</span>label label<span style="color: #000000;">:</span><span style="color: #000080;">=</span>L;
 <span style="color: #008000;">
// ワークシートAmplitudeをアクティブにする</span>
page.<span style="color: #000080;">active</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> Amplitude;
 <span style="color: #008000;">
// ワークシートデータを行列に直接変換する</span>
w2m;
 <span style="color: #008000;">
// Amplitudeデータの等高線図を作成する</span>
worksheet <span style="color: #000080;">-</span>p <span style="color: #0000dd;">226</span> contour;
</pre>
<h2><a name="Unstack.2FStack_Categorical_Data" id="Unstack.2FStack_Categorical_Data"></a><span class="mw-headline">カテゴリーデータをアンスタック/スタックする</span></h2>
<p><span class="OIndex" style="display: none;">アンスタックデータ</span><span class="OIndex" style="display: none;">スタック、データ</span></p>
<h3><a name="Unstack_Worksheet_Columns" id="Unstack_Worksheet_Columns"></a><span class="mw-headline">ワークシート列をアンスタックする</span></h3>
<p>分析およびプロットを行う際に、カテゴリーデータをアンスタックすることが望ましい場合があります。 スクリプトからこれを実行するには、 <a class="external text" href="../../XFunction/X-Function/Wunstackcol.html">wunstackcol</a> Xファンクションが最も便利な方法です。</p>
<p>この例では、カテゴリーデータがインポートされ、入力範囲を <b>irng2</b>で指定した特定のカテゴリーでデータをアンスタックします。 (カテゴリーで)表示されるデータは、入力範囲 <b>irng1</b>で参照されます。 この例では、列の範囲が直接入力となりますが、範囲変数が使われます。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// 自動車データをインポート </span>
newbook; 
string fpath<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">"\Samples\Statistics\Automobile.dat"</span>; 
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> fpath<span style="color: #000080;">$</span>; 
impasc;
 <span style="color: #008000;">
// 列2に保存されている自動車のMakeを使って他のすべての列をアンスタック</span><span style="color: #008000;">
// 出力シートのコメント行に "Make" を配置</span>
wunstackcol irng1<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">3</span><span style="color: #000000;">:</span><span style="color: #0000dd;">7</span><span style="color: #000000;">)</span> irng2<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> label<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">"Comments"</span>;
</pre>
<p>結果はアンスタックデータを持つ新しいワークシートです。</p>
<h3><a name="Stack_Worksheet_Columns" id="Stack_Worksheet_Columns"></a><span class="mw-headline">ワークシート列をスタックする</span></h3>
<p>カテゴリーデータをスタックする操作は、アンスタック操作の逆を行うようなものです。元のデータセットにおいて、異なるグループに属したサンプルが、別々の列に格納されています。スタッキング後、サンプルはグループ情報を提供する追加の列とともに、同じ列の異なる行に格納されます。<a class="external text" href="../../XFunction/X-Function/Wstackcol.html">wstackcol</a> を使用してワークシート列をスタックします。</p>
<p>以下のサンプルではまず、カテゴリーデータの入力されたワークブックを開きます。第1ワークシートがアクティブな状態でB,C,D列を行でスタックし、A列はその他の列として含めます。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// ワークブックを開く</span>
string strBook<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span>;
strBook<span style="color: #000080;">$</span> <span style="color: #000080;">+</span><span style="color: #000080;">=</span> <span style="color: #ff00ff;">"Samples\Statistics\Body.ogw"</span>;
doc <span style="color: #000080;">-</span>o <span style="color: #000080;">%</span><span style="color: #000000;">(</span>strBook<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;
 <span style="color: #008000;">
// ワークシートMaleのB,C,D列をスタック</span><span style="color: #008000;">
// A列を他の列として含める</span><span style="color: #008000;">
// メソッドは行ごと</span>
wstackcol irng<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">:</span><span style="color: #0000dd;">4</span><span style="color: #000000;">)</span> tr.<span style="color: #000080;">identifiers</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">{</span>L<span style="color: #000000;">}</span> include<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> method<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
</pre>
<p>結果は、ソースと同じブック内にスタックデータを持った新しいワークシートとして出力されます。</p>
<h2><a name="Pivot_Table" id="Pivot_Table"></a><span class="mw-headline">ピボットテーブル</span></h2>
<p>Xファンクション<a class="external text" href="../../XFunction/X-Function/Wpivot.html">wpivot</a> は、データ概要の把握、分析、比較、データ間の関係確認を素早く行うことがきます。これによりデータ情報を簡単に把握できます。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// 新しいブックを作成</span><span style="color: #008000;">
// データファイルをインポート</span>
newbook;
fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">"Samples\Statistics\HouseholdCareSamples.xls"</span>;
impExcel lname<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
 <span style="color: #008000;">
// ワークシート"HQ Family Mart"がアクティブなことを確認 </span><span style="color: #008000;">
// このワークシートのコピーを作成</span>
page.<span style="color: #000080;">active</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">"HQ Family Mart"</span>;
wcopy ow<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span><span style="color: #000000;">]</span><span style="color: #ff00ff;">"HQ Family Mart"</span><span style="color: #000080;">!</span>;
 <span style="color: #008000;">
// ピボットテーブルの行のソースはMake、</span><span style="color: #008000;">
// 列ソースはBrand、データはNumber in shelf</span><span style="color: #008000;">
// 結果として、異なるブランドと型式ごとに</span><span style="color: #008000;">
// 棚の製品数が出力される</span>
wpivot  row<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span>D<span style="color: #000000;">)</span> col<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span>F<span style="color: #000000;">)</span> data<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span>K<span style="color: #000000;">)</span> 
        method<span style="color: #000000;">:</span><span style="color: #000080;">=</span>sum total<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> sort_total<span style="color: #000000;">:</span><span style="color: #000080;">=</span>no sum<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
 <span style="color: #008000;">
// ソースデータシートをアクティブにする</span>
page.<span style="color: #000080;">active</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">"HQ Family Mart"</span>;
 <span style="color: #008000;">
// 行のソース、列のソース、データ列が同じピポッドテーブル</span><span style="color: #008000;">
// 合計の10％より小さい値の場合、</span><span style="color: #008000;">
// それらを結合</span><span style="color: #008000;">
// 結果シートでは、列の情報をユーザ定義パラメータとして格納</span><span style="color: #008000;">
// 行の名前は、ソースシートの列ロングネームを使用</span>
wpivot  row<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span>D<span style="color: #000000;">)</span> 
        col<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span>F<span style="color: #000000;">)</span>
        data<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span>K<span style="color: #000000;">)</span>
        method<span style="color: #000000;">:</span><span style="color: #000080;">=</span>sum total<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> sort_total<span style="color: #000000;">:</span><span style="color: #000080;">=</span>no sum<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> 
        dir<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col threshold<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">10</span>  <span style="color: #008000;">// 列を越えて10％より小さい値の場合、
// それらを結合</span>
        <span style="color: #008000;">// 列の情報（列ロングネーム）をユーザ定義パラメータ行に出力</span>
        pos<span style="color: #000000;">:</span><span style="color: #000080;">=</span>udl udlabel<span style="color: #000000;">:</span><span style="color: #000080;">=</span>L;
</pre>
<h2><a name="Worksheet_Filter" id="Worksheet_Filter"></a><span class="mw-headline">ワークシートフィルタ</span></h2>
<p>Originの<span class="OIndex">ワークシートフィルタ</span> (<span class="OIndex">データフィルタ</span>) は、列ベースのフィルタで、特定条件により行の削減が可能です。そして、削減されたデータは分析やグラフからは除かれます。3つのデータフォーマット（数値、テキスト、日付/時間）をサポートしています。LabTalkでは、<a href="../../LabTalk/LabTalk/Wks.Col_(object).html" title="LabTalk:Wks.Col (オブジェクト)">wks.col</a> (wks.col.filter, wks.col.filter$, wks.col.filterenabled, wks.col.filterprescript$, とwks.col.filterx$) オブジェクトにより、データフィルタの制御が可能です。フィルタの実行/再適用には、<a href="../../LabTalk/LabTalk/Wks_(object).html#Methods" title="LabTalk:Wks (オブジェクト)">wks.runfilter()</a> メソッドを使用します。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// ワークブックを作成し、データをインポート</span>
newbook;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">"Samples\Statistics\Automobile.dat"</span>;
impasc;
 <span style="color: #008000;">
// 1列目にデータフィルタをセット（数値）</span>
wks.<span style="color: #000080;">col1</span>.<span style="color: #000080;">filter</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// フィルタ追加</span>
wks.<span style="color: #000080;">col1</span>.<span style="color: #000080;">filterx</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> year;  <span style="color: #008000;">// 既存の第1列を変数 "year"にセット</span><span style="color: #008000;">
// フィルタ条件を、1995から2000の間に設定</span>
wks.<span style="color: #000080;">col1</span>.<span style="color: #000080;">filter</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">"year.between(1995,2000)"</span>;  
 <span style="color: #008000;">
// 2列目にデータフィルタをセット（テキスト）</span>
wks.<span style="color: #000080;">col2</span>.<span style="color: #000080;">filter</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// Add filter</span>
wks.<span style="color: #000080;">col2</span>.<span style="color: #000080;">filterx</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> make;  <span style="color: #008000;">// 既存の第2列を変数 "make" としてセット</span><span style="color: #008000;">
// 事前スクリプトをセット</span>
wks.<span style="color: #000080;">col2</span>.<span style="color: #000080;">filterprescript</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">"string strFavorite$ = GMC"</span>;
wks.<span style="color: #000080;">col2</span>.<span style="color: #000080;">filter</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">"make = strFavorite$"</span>;  <span style="color: #008000;">// フィルタクエリ文字列をセット</span>
 <span style="color: #008000;">
// ワークシートフィルタを実行</span>
wks.<span style="color: #000080;">runfilter</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
 <span style="color: #008000;">
// 1列目のフィルタを無効化</span>
wks.<span style="color: #000080;">col1</span>.<span style="color: #000080;">filterenabled</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
 <span style="color: #008000;">
// フィルタを再適用</span>
wks.<span style="color: #000080;">runfilter</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
</pre>
<p>ワークシート内にフィルタがあるかどうかを検出するには、<a href="../../LabTalk/LabTalk/Wks_(object).html#Methods" title="LabTalk:Wks (オブジェクト)">wks.hasfilter()</a>メソッドを使用することができます。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// ワークシートフィルタがある場合1を返し、そうでない場合は0を返す</span>
wks.<span style="color: #000080;">hasfilter</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> ;
</pre>
