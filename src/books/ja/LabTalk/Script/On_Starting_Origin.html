<h1 class="firstheading">Origin起動時と終了時の処理</h1>
<p class="urlname" style="display: none;">On-Starting-Origin</p>
<div id="toc" class="toc">
<div id="toctitle">
<h2>目次</h2>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Defining_Global_Constants.2C_Variables_and_Functions"><span class="tocnumber">1</span> <span class="toctext">グローバル定数、変数、関数を定義</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Defining_global_constants_and_variables"><span class="tocnumber">1.1</span> <span class="toctext">グローバル定数と変数を定義</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Defining_a_global_function"><span class="tocnumber">1.2</span> <span class="toctext">グローバル関数を定義</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Using_OEvents.ogs_to_Trigger_Events"><span class="tocnumber">2</span> <span class="toctext">OEvents.ogsを使ってイベントをトリガする</span></a></li>
</ul>
</div>
<h3><a name="Defining_Global_Constants.2C_Variables_and_Functions" id="Defining_Global_Constants.2C_Variables_and_Functions"></a><span class="mw-headline">グローバル定数、変数、関数を定義</span></h3>
<p>Origin.ini ファイルの<b>[Startup]</b>セクションを使って、Origin起動時にいつでも使用できるグローバル定数、変数、関数を定義できます。</p>
<p>スコープについての詳細は、以下を参照してください。</p>
<ul>
<li><a href="../../LabTalk/LabTalk/Data_Types_and_Variables.html#Scope_of_Variables" title="LabTalk:データ型と変数">変数のスコープ</a></li>
<li><a href="../../LabTalk/LabTalk/Functions.html#Scope_of_Functionsscope_of_a_function" title="LabTalk:関数">関数のスコープ</a></li>
</ul>
<h4><a name="Defining_global_constants_and_variables" id="Defining_global_constants_and_variables"></a><span class="mw-headline">グローバル定数と変数を定義</span></h4>
<p><a class="external text" href="../../QuickHelp/QuickHelp/How_do_I_define_global_constants.html#Constants_and_Variables_for_use_across_Origin_sessions">FAQ-286 グローバルな変数や定数を定義する</a>を参照してください。</p>
<h4><a name="Defining_a_global_function" id="Defining_a_global_function"></a><span class="mw-headline">グローバル関数を定義</span></h4>
<ol>
<li>Originが起動していたら、終了します。</li>
<li>メモ帳などのテキストエディタを新規に起動し、以下の情報を入力します。
<pre class="lt" style="font-family: monospace;">
<span style="color: #000000;">[</span>Main<span style="color: #000000;">]</span>
@global <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;<span style="color: #008000;">
// この関数は数値の3乗根を計算する</span>
function double dCubeRoot<span style="color: #000000;">(</span>double dVal<span style="color: #000000;">)</span><span style="color: #000000;">
{</span>
    double xVal;
    if<span style="color: #000000;">(</span>dVal<span style="color: #000080;">&lt;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> xVal <span style="color: #000080;">=</span> <span style="color: #000080;">-</span>exp<span style="color: #000000;">(</span>ln<span style="color: #000000;">(</span><span style="color: #000080;">-</span>dVal<span style="color: #000000;">)</span><span style="color: #000080;">/</span><span style="color: #0000dd;">3</span><span style="color: #000000;">)</span>;
    else xVal <span style="color: #000080;">=</span> exp<span style="color: #000000;">(</span>ln<span style="color: #000000;">(</span>dVal<span style="color: #000000;">)</span><span style="color: #000080;">/</span><span style="color: #0000dd;">3</span><span style="color: #000000;">)</span>;
    return xVal;<span style="color: #000000;">
}</span>
@global <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
        
</pre></li>
<li><a class="external text" href="../../QuickHelp/QuickHelp/What_is_the_User_Files_Folder.html"><b>User Filesフォルダ</b>(<b>UFF</b>)</a>に、拡張子.OGS付きの名前を付けて保存します（例： myLTFuncs.ogs）。</li>
<li>UFFフォルダにあるOrigin.iniファイルを参照して、テキストエディタで開きます。</li>
<li>このファイルの<b>[Startup]</b>セクションに、以下の形式で保存した.OGS ファイルの名前を追加します。
<pre class="lt" style="font-family: monospace;">
FileN<span style="color: #000080;">=</span>myLTFuncs.<span style="color: #000080;">ogs</span>
        
</pre>
<p>ここで <i>N</i> は 1,2,3,などです。</p>
</li>
<li>変更をOrigin.iniに保存します。</li>
<li>関数が利用できるか確認するには、Originを起動し、スクリプトウィンドウを開いて、関数名を入力して、その後に括弧内の値と「=」を入力して、Enterキーを押します。
<pre class="lt" style="font-family: monospace;">
dCubeRoot<span style="color: #000000;">(</span><span style="color: #0000dd;">8</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>
        
</pre>
<p>Originは次のように返します。</p>
<pre class="lt" style="font-family: monospace;">
dCubeRoot<span style="color: #000000;">(</span><span style="color: #0000dd;">8</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>
        
</pre></li>
</ol>
<p>詳細は、<a href="../../LabTalk/LabTalk/Functions.html#Scope_of_Functionsscope_of_a_function" title="LabTalk:関数">関数のスコープ</a>を参照してください。</p>
<h3><a name="Using_OEvents.ogs_to_Trigger_Events" id="Using_OEvents.ogs_to_Trigger_Events"></a><span class="mw-headline">OEvents.ogsを使ってイベントをトリガする</span></h3>
<p>Originが起動するとき、トリガーとなる複数のイベントがあります。<i>OEvents.OGS</i> ファイルを使って各イベントで実行するようにLabTalkスクリプトをセットすることができます。この<i>OEvents.OGS</i>ファイルは、スクリプト実行時に示す <b><i>[AfterCompileSystem]</i></b>, <b><i>[BeforeOpenDoc]</i></b>, <b><i>[OnExitOrigin]</i></b>複数のセクションを含みます。</p>
<p>次のサンプルは、既存のOriginのコマンドウィンドウの履歴パネルをクリーニングします。<br />
(Origin C関数は<b><i>[OnExitOrigin]</i></b> セクションで実行できないので注意してください。Originの終了時にイベントをトリガしたい場合は、常にLabTalkコマンドを使用してください。)</p>
<ol>
<li>Originフォルダから <i>OEvents.OGS</i> をUser Filesフォルダにコピーします。 別の方法として、Originフォルダからファイルを開くときに、User Filesフォルダに保存します。</li>
<li><b><i>[OnExitOrigin]</i></b> というセクションで、次のスクリプトを追加します。
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// コマンドウィンドウの履歴を保持するファイルをユーザファイルフォルダから削除</span>
del <span style="color: #000080;">-</span>f <span style="color: #ff00ff;">"%YUpDown_Buffer.txt"</span>;
del <span style="color: #000080;">-</span>f <span style="color: #ff00ff;">"%YLTHistory.txt"</span>;
        
</pre></li>
<li><i>OEvents.OGS</i> でセクションを実行するには、User Filesフォルダで <i>Origin.ini</i> を編集します。Originを起動していたら終了し、<i>Origin.ini</i>　ファイルを編集し、 <i><b>[Config]</b></i> セクションの下にある行を下記のようにコメント解除 (;を消去)します。
<pre class="ini" style="font-family: monospace;">
<span style="color: #000099;">Ogs1</span> <span style="color: #000066; font-weight: bold;">=</span><span style="color: #660066;"> OEvents</span><span style="color: #666666; font-style: italic;">
; Ogs2 = OEvents</span><span style="color: #666666; font-style: italic;">
; Origin can trigger multiple system events</span><span style="color: #666666; font-style: italic;">
; Uncomment this line and implement event handlers in OEvents.ogs</span>
</pre>
<table class="note">
<tr>
<td><b>Note:</b> 1つ以上のイベントハンドラーファイルが <i>Origin.ini</i> に存在していて、名前がOEvents.OGSでないかもしれません。</td>
</tr>
</table>
</li>
<li>Originを閉じ、新しいOriginのセッションを起動して、<b>コマンドウィンドウ</b>の履歴パネルの内容が消去されているか確認してください。</li>
</ol>
<table class="noborder">
<tr>
<td style="vertical-align: top;" width="60"><img src="../images/On_Starting_Origin/Tip_icon.png" alt="" width="57" height="57" border="0" /></td>
<td>
<p>Origin C関数は、<b><i>[BeforeOpenDoc]</i></b>のような、<i>OEvents.OGS</i> の他のセクションから実行できます。サンプルは、<a class="external text" href="../../OriginC/OCGuide/Compiling,_Linking_and_Loading.html#Build_Individual_Source_File_on_Origin_Startup"><b>OriginCプログラミングガイド</b>の<b>Origin C関数のコンパイル、リンク、ロード</b>ページ</a>を参照してください。</p>
<p>イベントに結びついたカスタムスクリプトからOrigin C関数を呼び出す必要がある場合、Origin Cファイルがコンパイルされ、関数がスクリプトアクセスできる状態にあることを確実にする必要があります。詳細は <a class="external text" href="../../LabTalk/LabTalk/Loading_and_Compiling_Origin_C_Function.html">Origin C関数のロードとコンパイル</a> をご覧ください。</p>
</td>
</tr>
</table>
