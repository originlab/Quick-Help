<h1 class="firstheading">グラフ/データ/ビデオ のエクスポート</h1>

  <p class='urlname' style='display: none'>一般的なエクスポート</p>

  <div id="toc" class="toc">
    <div id="toctitle">
      <h2>目次</h2>
    </div>

    <ul>
      <li class="toclevel-1 tocsection-1">
        <a href="#Export_Graphs"><span class="tocnumber">1</span> <span class="toctext">グラフエクスポート</span></a>

        <ul>
          <li class="toclevel-2 tocsection-2"><a href="#Export_graphs_using_Project_Explorer_folder_hierarchy_as_export_path"><span class="tocnumber">1.1</span>　<span class="toctext">プロジェクトエクスプローラーのフォルダ階層をエクスポートパスとして使用してグラフをエクスポート</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-3">
        <a href="#Export_Data"><span class="tocnumber">2</span> <span class="toctext">データのエクスポート</span></a>

        <ul>
          <li class="toclevel-2 tocsection-4"><a href="#Export_all_worksheets_in_all_workbooks_in_all_folders_as_text_files"><span class="tocnumber">2.1</span>　<span class="toctext">すべてのフォルダ内のすべてのブックにあるすべてのワークシートをテキストファイルとしてエクスポート</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-5"><a href="#Export_Videos"><span class="tocnumber">3</span> <span class="toctext">ビデオのエクスポート</span></a></li>
    </ul>
  </div>

  <h2><a name="Export_Graphs"></a><span class="mw-headline">グラフエクスポート</span></h2>

  <h3><a name="Export_graphs_using_Project_Explorer_folder_hierarchy_as_export_path"></a><span class="mw-headline">プロジェクトエクスプローラーのフォルダ階層をエクスポートパスとして使用してグラフをエクスポート</span></h3>

  <p>この例では、プロジェクトのフォルダ構造に従って同じサブフォルダ階層を作成し、グラフウィンドウのロングネームを使用した名前のグラフをフォルダにエクスポートします。</p>

  <p><b>Origin2016以降での方法</b></p>
  <pre class="lt" style="font-family:monospace;">
doc <span style="color: #000080;">-</span>e P
<span style="color: #000000;">{</span>
        if<span style="color: #000000;">(</span>page.<span style="color: #000080;">IsEmbedded</span><span style="color: #000080;">==</span><span style="color: #0000dd;">0</span><span style="color: #000080;">&amp;&amp;</span>exist<span style="color: #000000;">(</span><span style="color: #000080;">%</span>H<span style="color: #000000;">)</span><span style="color: #000080;">!</span><span style="color: #000080;">=</span><span style="color: #0000dd;">11</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span><span style="color: #008000;">//埋め込みグラフやレイアウトウィンドウはスキップ</span>
                expGraph type<span style="color: #000000;">:</span><span style="color: #000080;">=</span>jpg filename<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;&lt;long name&gt;&quot;</span> path<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;&lt;Project Folder&gt;&lt;PE Path&gt;&quot;</span> theme<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>Original<span style="color: #000080;">&gt;</span> tr.<span style="color: #000080;">Margin</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>;
        <span style="color: #000000;">}</span>
<span style="color: #000000;">}</span>
</pre>

  <p><b>Origin2015以前での方法</b></p>
  <pre class="lt" style="font-family:monospace;">
doc <span style="color: #000080;">-</span>e P <span style="color: #008000;">//すべてのグラフでループします</span>
<span style="color: #000000;">{</span>
	if<span style="color: #000000;">(</span>page.<span style="color: #000080;">IsEmbedded</span><span style="color: #000080;">==</span><span style="color: #0000dd;">0</span><span style="color: #000080;">&amp;&amp;</span>exist<span style="color: #000000;">(</span><span style="color: #000080;">%</span>H<span style="color: #000000;">)</span><span style="color: #000080;">!</span><span style="color: #000080;">=</span><span style="color: #0000dd;">11</span><span style="color: #000000;">)</span>  <span style="color: #008000;">//埋め込まれたグラフまたはレイアウトウィンドウをスキップします</span>
	<span style="color: #000000;">{</span>
		string proj_path<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span>X; <span style="color: #008000;">//保存されたプロジェクトの</span>
		<span style="color: #008000;">//&quot;the project path is:&quot;+proj_path$;を入力</span>
		window <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span>H;	
		string graph_fullPath<span style="color: #000080;">$</span>;
		pe_path path<span style="color: #000000;">:</span><span style="color: #000080;">=</span>graph_fullPath<span style="color: #000080;">$</span>; <span style="color: #008000;">//グラフのプロジェクトエクスプローラーパスを取得;</span>
		<span style="color: #000080;">%</span>A<span style="color: #000080;">=</span>graph_fullPath<span style="color: #000080;">$</span>;
		string graph_path<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span><span style="color: #000000;">[</span><span style="color: #000080;">%</span>A,<span style="color: #000080;">&gt;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span>; <span style="color: #008000;">//パスからルートフォルダ名を削除</span>
		<span style="color: #008000;">//&quot;the graph path is:&quot;+graph_path$;を入力</span>
		<span style="color: #008000;">// &quot;graph title is:&quot;+%H;を入力</span>
		string path<span style="color: #000080;">$</span><span style="color: #000080;">=</span>proj_path<span style="color: #000080;">$</span><span style="color: #000080;">+</span>graph_Path<span style="color: #000080;">$</span>; <span style="color: #008000;">//上記の文字列を連結してエクスポートフォルダを作成;</span>
		path.<span style="color: #000080;">Replace</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;/&quot;</span>,<span style="color: #ff00ff;">&quot;\&quot;</span><span style="color: #000000;">)</span>;
		expGraph type<span style="color: #000000;">:</span><span style="color: #000080;">=</span>jpg filename<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;&lt;long name&gt;&quot;</span> path<span style="color: #000000;">:</span><span style="color: #000080;">=</span>path<span style="color: #000080;">$</span> theme<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>Original<span style="color: #000080;">&gt;</span> tr.<span style="color: #000080;">Margin</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>;
	<span style="color: #000000;">}</span>;
<span style="color: #000000;">}</span>
</pre>

  <h2><a name="Export_Data"></a><span class="mw-headline">データのエクスポート</span></h2>

  <h3><a name="Export_all_worksheets_in_all_workbooks_in_all_folders_as_text_files"></a><span class="mw-headline">すべてのフォルダ内のすべてのブックにあるすべてのワークシートをテキストファイルとしてエクスポート</span></h3>

  <p>このサンプルは、プロジェクト内の全ブックの全シートを&quot;WorkbookName_WorksheetName&quot;という名前のファイルとして指定パスにエクスポートします。</p>
  <pre class="lt" style="font-family:monospace;">
fdlog.<span style="color: #000080;">openpath</span><span style="color: #000000;">(</span>B<span style="color: #000000;">)</span>; <span style="color: #008000;">// ファイルを保存するディレクトリを指定</span>

doc <span style="color: #000080;">-</span>e W<span style="color: #000000;">{</span> <span style="color: #008000;">//プロジェクト内の全ブックでループ</span>

doc <span style="color: #000080;">-</span>e LW <span style="color: #008000;">// ブック内の全シートでループ</span>
<span style="color: #000000;">{</span> string temp<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> wks.<span style="color: #000080;">name</span><span style="color: #000080;">$</span>; <span style="color: #008000;">// ワークシートショートネームを取得</span> <span style="color: #008000;">// string temp$ = wks.longname$; // ワークシートロングネームを取得するためにこの行を実行</span>
expASC type<span style="color: #000000;">:</span><span style="color: #000080;">=</span>text path<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span>B<span style="color: #000080;">%</span>H_<span style="color: #000080;">%</span><span style="color: #000000;">(</span>temp<span style="color: #000080;">$</span><span style="color: #000000;">)</span> shortname<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">// 列名がエクスポートされた.txtファイルとしてファイルをエクスポート</span>
<span style="color: #000000;">}</span>;
<span style="color: #000000;">}</span>
</pre>

  <p>現在アクティブなフォルダでループするには、<a href="../../LabTalk/LabTalk/Document_(command).html#-e_object_.7Bscript.7D.3B_Execute_the_given_script_for_all_objects" title="LabTalk:Document (コマンド)"><i>doc -e W</i></a>を<a href="../../LabTalk/LabTalk/Document_(command).html#-ef.3B_Execute_the_given_script_for_all_objects_in_the_current_folder" title="LabTalk:Document (コマンド)"><i>doc -ef W</i></a>に置き換えます。Originのさまざまなオブジェクトでループする他の例については<a href="../../LabTalk/Script/Looping_Over_Objects.html" title="Script:Looping Over Objects">こちら</a>をご覧ください。</p>

  <p>この例のバリエーションでは、すべてのワークシート列を.datファイルにエクスポートし、プロジェクトの<a class="external text" href="../../UserGuide/UserGuide/Project_Explorer.html"><b>プロジェクトエクスプローラ</b></a>のフォルダ構造を使用してそれらを整理します:</p>
  <pre class="lt" style="font-family:monospace;">
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;%YMap Data.opju&quot;</span>;
doc <span style="color: #000080;">-</span>o <span style="color: #000080;">%</span><span style="color: #000000;">(</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">)</span>; <span style="color: #008000;">//User Files\Map Data.opju を開きます</span>

doc <span style="color: #000080;">-</span>e W<span style="color: #000000;">{</span>   <span style="color: #008000;">// プロジェクト内の全ブックでループ</span>
    
       doc <span style="color: #000080;">-</span>e LW <span style="color: #008000;">// ブック内の全シートでループ</span>
            <span style="color: #000000;">{</span>
              string temp<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> wks.<span style="color: #000080;">name</span><span style="color: #000080;">$</span>; <span style="color: #008000;">// ワークシートのショートネームを取得</span>
           <span style="color: #008000;">// string temp$ = wks.longname$; //  ワークシートロングネームを取得するためにこの行を実行</span>
              expASC path<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;&lt;Project Folder&gt;&lt;PE Path&gt;%(temp$)&quot;</span> shortname<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">// プロジェクトエクスプローラのフォルダ構造を使ってファイルを整理しエクスポートします</span>
            <span style="color: #000000;">}</span>;
<span style="color: #000000;">}</span>
</pre>

  <h2><a name="Export_Videos"></a><span class="mw-headline">ビデオのエクスポート</span></h2>

  <p class="version">必要なOriginのバージョン: 9.0 SR0以降</p>

  <p>この例では新しい行列を作成し、値をセットして、等高線グラフとしてプロットします。これを50回繰り返し、その都度、行列値を調整してグラフを更新します。作成されたグラフは毎回動画の1フレームとして追加されます。完了したら、50フレーム分の動画が作成されます。</p>

  <p>このサンプルでは、リアルタイムにグラフを変更する方法と、LabTalkスクリプトに<a href="../../LabTalk/LabTalk/Vw_(object).html" title="LabTalk:Vw (object)">vw_オブジェクト</a>を使用して動画を作成する方法を紹介します。（Cドライブ直下のtempというフォルダに保存するようにしています。ない場合は作成してから実行してください）</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// 行列ウィンドウの作成</span>
string matbk<span style="color: #000080;">$</span>;
newbook mat<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>matbk<span style="color: #000080;">$</span>;
 
<span style="color: #008000;">// シート内で行列オブジェクトを指す</span>
range rmat <span style="color: #000080;">=</span> <span style="color: #000000;">[</span>matbk<span style="color: #000080;">$</span><span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span>;
 
<span style="color: #008000;">// 次数の値をセットし、等高線を作成 </span>
mdim c<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">100</span> r<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">100</span>;
double a<span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; 
string formula<span style="color: #000080;">$</span>; formula<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;i*sin(a*x)-j*cos(y/a)&quot;</span>; 
msetvalue im<span style="color: #000000;">:</span><span style="color: #000080;">=</span>rmat formula<span style="color: #000000;">:</span><span style="color: #000080;">=</span>formula<span style="color: #000080;">$</span>; 
wo <span style="color: #000080;">-</span>p <span style="color: #0000dd;">226</span> contour; 
 
<span style="color: #008000;">// 等高線をカスタマイズ </span>
layer.<span style="color: #000080;">cmap</span>.<span style="color: #000080;">zmin</span><span style="color: #000080;">=</span><span style="color: #000080;">-250</span>;
layer.<span style="color: #000080;">cmap</span>.<span style="color: #000080;">zmax</span><span style="color: #000080;">=</span><span style="color: #0000dd;">250</span>;
layer.<span style="color: #000080;">cmap</span>.<span style="color: #000080;">nummajorlevels</span><span style="color: #000080;">=</span><span style="color: #0000dd;">10</span>; 
layer.<span style="color: #000080;">cmap</span>.<span style="color: #000080;">numminorlevels</span><span style="color: #000080;">=</span><span style="color: #0000dd;">9</span>;
layer.<span style="color: #000080;">cmap</span>.<span style="color: #000080;">setlevels</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>; 
layer.<span style="color: #000080;">cmap</span>.<span style="color: #000080;">updatescale</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>; 
layer.<span style="color: #000080;">cmap</span>.<span style="color: #000080;">load</span><span style="color: #000000;">(</span>Rainbow.<span style="color: #000080;">PAL</span><span style="color: #000000;">)</span>;
 
<span style="color: #008000;">// codecを選択4文字コードで指定</span>
<span style="color: #008000;">// （マシンにより利用可能なコーデックが異なるので注意）</span>
<span style="color: #008000;">// 以下はサンプル</span>
int codec <span style="color: #000080;">=</span> vw.<span style="color: #000080;">FourCC</span><span style="color: #000000;">(</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>; <span style="color: #008000;">// 無圧縮</span>
<span style="color: #008000;">//int codec = vw.FourCC(1, 0, 0, 0); // Microsoft連長圧縮</span>
<span style="color: #008000;">//int codec = vw.FourCC(&apos;c&apos;, &apos;v&apos;, &apos;i&apos;, &apos;d&apos;); // Cinepak</span>
<span style="color: #008000;">//int codec = vw.FourCC(&apos;F&apos;, &apos;M&apos;, &apos;P&apos;, &apos;4&apos;); // MPEG4</span>
 
<span style="color: #008000;">// ビデオを作成(ファイル名, コーデック, フレーム毎秒, 幅, 高さ)</span>
int err <span style="color: #000080;">=</span> vw.<span style="color: #000080;">Create</span><span style="color: #000000;">(</span>d<span style="color: #000000;">:</span>\test.<span style="color: #000080;">avi</span>, codec, <span style="color: #0000dd;">15</span>, <span style="color: #0000dd;">1024</span>, <span style="color: #0000dd;">768</span><span style="color: #000000;">)</span>;
if<span style="color: #000000;">(</span> <span style="color: #0000dd;">0</span> <span style="color: #000080;">==</span> err <span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	for<span style="color: #000000;">(</span> a<span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; a<span style="color: #000080;">&lt;=</span><span style="color: #0000dd;">1.5</span>; a<span style="color: #000080;">+</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0.01</span> <span style="color: #000000;">)</span>
	<span style="color: #000000;">{</span>
		<span style="color: #000080;">%</span>C <span style="color: #000080;">-</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
		formula<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;i*sin(a*x)-j*cos(y/a)+grnd()&quot;</span>;
		msetvalue im<span style="color: #000000;">:</span><span style="color: #000080;">=</span>rmat formula<span style="color: #000000;">:</span><span style="color: #000080;">=</span>formula<span style="color: #000080;">$</span>;
 
		<span style="color: #008000;">// グラフウィンドウの再描画を待つ</span>
                <span style="color: #008000;">// これにより動画ファイル作成中に動画を確認できる</span>
                sec <span style="color: #000080;">-</span>pw <span style="color: #000080;">%</span>h;
 
                <span style="color: #008000;">// グラフを1つのフレームとして動画に書き込む</span>
                err <span style="color: #000080;">=</span> vw.<span style="color: #000080;">WriteGraph</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
                if<span style="color: #000000;">(</span> err <span style="color: #000000;">)</span>
                        break;
        <span style="color: #000000;">}</span>
 
        <span style="color: #008000;">// リリース</span>
        vw.<span style="color: #000080;">Release</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
 
        if<span style="color: #000000;">(</span> err <span style="color: #000000;">)</span>
                type <span style="color: #ff00ff;">&quot;WriteGraph error $(err)&quot;</span>;
<span style="color: #000000;">}</span>
else
        type <span style="color: #ff00ff;">&quot;VideoWriter Create error $(err).&quot;</span>;
</pre>

  <p><b>Note:</b>codecについて詳しく知りたい場合には<a href="../../LabTalk/LabTalk/FourCC_Table.html" title="LabTalk:FourCC Table">FourCC 表</a>をご覧ください。</p>
