<h1 class="firstheading">一般的なインポートのサンプル</h1>

  <p class='urlname' style='display: none'>general-Import</p>

  <div id="toc" class="toc">
    <div id="toctitle">
      <h2>目次</h2>
    </div>

    <ul>
      <li class="toclevel-1 tocsection-1">
        <a href="#Using_X-Functions_to_Import_Data"><span class="tocnumber">1</span> <span class="toctext">Xファンクションを使ってデータをインポート</span></a>

        <ul>
          <li class="toclevel-2 tocsection-2"><a href="#X-Function_Themes"><span class="tocnumber">1.1</span> <span class="toctext">Xファンクションテーマ</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-3">
        <a href="#ASCII_Import"><span class="tocnumber">2</span> <span class="toctext">ASCIIインポート</span></a>

        <ul>
          <li class="toclevel-2 tocsection-4"><a href="#Controlling_header_and_Long_Name"><span class="tocnumber">2.1</span> <span class="toctext">ヘッダとロングネームのコントロール</span></a></li>

          <li class="toclevel-2 tocsection-5"><a href="#Partial_Import"><span class="tocnumber">2.2</span> <span class="toctext">部分インポート</span></a></li>

          <li class="toclevel-2 tocsection-6"><a href="#Delimiters_and_Numeric_Separators"><span class="tocnumber">2.3</span> <span class="toctext">区切り文字および数値の区切り</span></a></li>

          <li class="toclevel-2 tocsection-7"><a href="#Import_Mode"><span class="tocnumber">2.4</span><span class="toctext">インポートモード</span></a></li>

          <li class="toclevel-2 tocsection-8"><a href="#Importing_Multiple_Files"><span class="tocnumber">2.5</span> <span class="toctext">複数ファイルのインポート</span></a></li>

          <li class="toclevel-2 tocsection-9"><a href="#After_Import_Convert_Worksheet_to_Matrix"><span class="tocnumber">2.6</span> <span class="toctext">インポート後にワークシートを行列に変換</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-10">
        <a href="#Import_Filters"><span class="tocnumber">3</span> <span class="toctext">インポートフィルタ</span></a>

        <ul>
          <li class="toclevel-2 tocsection-11"><a href="#impFile_X-Function_with_Sample_Filter"><span class="tocnumber">3.1</span> <span class="toctext">サンプルフィルタを使用してXファンクションimpFileを実行</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-12">
        <a href="#Internet_Data_Access"><span class="tocnumber">4</span> <span class="toctext">インターネットデータへのアクセス</span></a>

        <ul>
          <li class="toclevel-2 tocsection-13"><a href="#Import_A_Web_ASCII_File_Into_A_Worksheet"><span class="tocnumber">4.1</span> <span class="toctext">Web上のASCIIファイルをワークシートにインポート</span></a></li>

          <li class="toclevel-2 tocsection-14"><a href="#Import_A_Web_Image_Into_A_New_Matrix"><span class="tocnumber">4.2</span> <span class="toctext">Web上の画像を新しい行列にインポート</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-15">
        <a href="#Database_Access"><span class="tocnumber">5</span> <span class="toctext">データベースへのアクセス</span></a>

        <ul>
          <li class="toclevel-2 tocsection-16"><a href="#Import_from_Included_Sample_Access_Database"><span class="tocnumber">5.1</span> <span class="toctext">Accessデータベースからインポート</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-17">
        <a href="#Instrument_Data_Import"><span class="tocnumber">6</span> <span class="toctext">機器データのインポート</span></a>

        <ul>
          <li class="toclevel-2 tocsection-18"><a href="#Importing_and_Plotting_Multiple_SPC_Files"><span class="tocnumber">6.1</span> <span class="toctext">複数SPCファイルのインポートと作図</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-19"><a href="#Specify_Channel_Names_for_Import"><span class="tocnumber">7</span> <span class="toctext">インポートするチャネル名を指定</span></a></li>

      <li class="toclevel-1 tocsection-20">
        <a href="#Image_Files"><span class="tocnumber">8</span> <span class="toctext">画像ファイル</span></a>

        <ul>
          <li class="toclevel-2 tocsection-21"><a href="#Import_Images"><span class="tocnumber">8.1</span> <span class="toctext">画像をインポート</span></a></li>

          <li class="toclevel-2 tocsection-22"><a href="#Convert_Imported_Image_into_Data"><span class="tocnumber">8.2</span> <span class="toctext">インポートした画像をデータに変換</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-23">
        <a href="#Text_Files"><span class="tocnumber">9</span> <span class="toctext">テキストファイル</span></a>

        <ul>
          <li class="toclevel-2 tocsection-24"><a href="#Open_a_Text_File_Into_a_Notes_Window"><span class="tocnumber">9.1</span> <span class="toctext">テキストファイルをノートウィンドウに開く</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-25"><a href="#Import_Video"><span class="tocnumber">10</span> <span class="toctext">動画のインポート</span></a></li>

      <li class="toclevel-1 tocsection-26">
        <a href="#Reimport"><span class="tocnumber">11</span> <span class="toctext">再インポート</span></a>

        <ul>
          <li class="toclevel-2 tocsection-27"><a href="#Using_Reimport_to_Bring_back_all_Data"><span class="tocnumber">11.1</span> <span class="toctext">再インポートですべてのデータを元に戻す</span></a></li>

          <li class="toclevel-2 tocsection-28"><a href="#Watching_for_a_File_change_for_reimport"><span class="tocnumber">11.2</span> <span class="toctext">ファイルが変更されたら再インポート</span></a></li>
        </ul>
      </li>
    </ul>
  </div>

  <h2><a name="Using_X-Functions_to_Import_Data"></a><span class="mw-headline">Xファンクションを使ってデータをインポート</span></h2>

  <p>Originには、ASCII、CSV、Excel、National Instruments DIAdem、pCLAMPなど様々なデータファイルをインポートするためのXファンクションがあります。各ファイルフォーマットごとのオプション設定のほか、インポートファイルの名前をブックやシート名にするといった共通の設定が可能です。</p>

  <p>インポートに関するXファンクション名は、すべて<b>imp</b>から始まります。これらのXファンクションに関する詳細は、<a class="external text" href="../../XFunction/Category/Import_and_Export.html">こちら</a>を参照してください。</p>

  <p>ユーザ独自のインポートルーチンをXファンクションとして作成することもできます。作成したXファンクションの名前を<b>imp</b>から始まるものにし、Originインストールフォルダやユーザファイルフォルダ、グループパスの<b>\X-Functions\Import and Export</b>サブフォルダに置けば、<b>データ：ファイルからインポート</b>メニューに表示できます。</p>

  <p>インポートの機能と、システムブラウザの機能（<b>dlgfile</b>や<b>findfiles</b>）には、共通のパラメータ<b>fname</b>があります。<b>fname</b>は、ファイル名のみまたは、ファイルのパスやリストを保持できる文字列変数です。インポートのXファンクションは、複数ファイルを扱えます。複数ファイルをどう扱うか、つまり、追加ファイルのために新しいブックを作成するのかあるいは、シートや列を作成するのかについてのデフォルト設定はXファンクションごとに異なります。これはインポート機能のオプションによって変更可能です。</p>

  <h3><a name="X-Function_Themes"></a><span class="mw-headline">Xファンクションテーマ</span></h3>

  <p>GUIからインポートのXファンクションを使用するとき、カスタマイズした設定をテーマとして保存できます。テーマファイルは、拡張子.OISのファイルとしてユーザファイルフォルダ（UFF）の<b>\Themes\AnalysisAndReportTable</b>に保存されます。関連するXファンクションの<b>-t</b><a href="../../LabTalk/LabTalk/X-Function_Execution_Options.html" title="LabTalk:Xファンクションの実行オプション">オプションスイッチ</a>を使用して、保存したテーマファイルにアクセスでき、テーマに保存された設定を使用したインポートが可能です。</p>

  <p><b>サンプル:</b></p>
  <pre class="lt" style="font-family:monospace;">
string fn<span style="color: #000080;">$</span><span style="color: #000080;">=</span>system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Spectroscopy\HiddenPeaks.dat&quot;</span>; 
<span style="color: #008000;">// &quot;My Theme.OIS&quot; というテーマファイルがあることが前提 </span>
impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fn<span style="color: #000080;">$</span> <span style="color: #000080;">-</span>t <span style="color: #ff00ff;">&quot;My Theme&quot;</span>;
</pre>

  <h2><a name="ASCII_Import"></a><span class="mw-headline">ASCII インポート</span></h2>

  <h3><a name="Controlling_header_and_Long_Name"></a><span class="mw-headline">ヘッダとロングネームのコントロール</span></h3>

  <p>アメリカのGDPデータをWebサイトから取得し、ヘッダ部分を除いたデータをインポートします。ヘッダの内容は、最初の列のコメント行に入力します。</p>
  <pre class="lt" style="font-family:monospace;">
string fname<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;%YUSGDP.txt&quot;</span>;
url<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;https://research.stlouisfed.org/fred2/data/GDP.txt&quot;</span>;
web2file;
if<span style="color: #000000;">(</span> exist<span style="color: #000000;">(</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">)</span> <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
        type <span style="color: #ff00ff;">&quot;failed to get &quot;</span> <span style="color: #000080;">+</span> url<span style="color: #000080;">$</span>;
        return <span style="color: #0000dd;">0</span>;
<span style="color: #000000;">}</span>
<span style="color: #008000;">//プロジェクトをクリアしてからの空の状態から開始</span>
doc <span style="color: #000080;">-</span>s;doc <span style="color: #000080;">-</span>n;<span style="color: #000000;">{</span>win <span style="color: #000080;">-</span>cd<span style="color: #000000;">}</span>;
newbook s<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
<span style="color: #008000;">// インポートのためにヘッダ構造を指定</span>
impASC options.<span style="color: #000080;">sparklines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> 
options.<span style="color: #000080;">FileStruct</span>.<span style="color: #000080;">DateFormat</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;yyyy&apos;-&apos;MM&apos;-&apos;dd&quot;</span>
options.<span style="color: #000080;">Hdr</span>.<span style="color: #000080;">MainHdrLns</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">19</span>
options.<span style="color: #000080;">Hdr</span>.<span style="color: #000080;">AutoSubHdr</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>
options.<span style="color: #000080;">Hdr</span>.<span style="color: #000080;">SubHdrLns</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>
options.<span style="color: #000080;">Hdr</span>.<span style="color: #000080;">Units</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
<span style="color: #008000;">// ヘッダにある文字列はシステム変数__headERに保存されるので</span>
<span style="color: #008000;">// これを1列目のコメント行に置く</span>
range aa<span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
aa<span style="color: #000000;">[</span>C<span style="color: #000000;">]</span><span style="color: #000080;">$</span><span style="color: #000080;">=</span>__headER<span style="color: #000080;">$</span>;

wks.<span style="color: #000080;">labels</span><span style="color: #000000;">(</span>LC<span style="color: #000000;">)</span>;<span style="color: #008000;">//ロングネームとコメントを表示</span>
</pre>

  <h3><a name="Partial_Import"></a><span class="mw-headline">部分インポート</span></h3>

  <p>Xファンクション<b>impASC</b>のオプションツリーは、名前のオプションや部分インポートのオプションを設定できます。例えば、ダイアログを使用して複数のファイルを指定し、各ファイルの一部（10行）をインポートして列3データの検定を実行します。データが基準を満たせばすべてのファイルをインポートし、そうでない場合スキップします。</p>

  <p>インポートされたファイルのファイル名はワークブックのコメントに格納されます。Samples\Curve Fittingフォルダにある12個のSTEP##.DATファイルでこのコードを実行すると、7個のファイルがスキップされ、5個のファイルがインポートされます。</p>
  <pre class="lt" style="font-family:monospace;">
newbook;
dlgfile gr<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">*</span>.<span style="color: #000080;">dat</span> mu<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
string file<span style="color: #000080;">$</span>;
loop<span style="color: #000000;">(</span>ii,<span style="color: #0000dd;">1</span>,fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">(</span>CRLF<span style="color: #000000;">)</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    file<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetToken</span><span style="color: #000000;">(</span>ii,CRLF<span style="color: #000000;">)</span><span style="color: #000080;">$</span>;
    impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>file<span style="color: #000080;">$</span>
           options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">AutoNames</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>
           options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToSht</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>
           options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToBk</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>
           options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToBkComm</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>
           options.<span style="color: #000080;">PartImp</span>.<span style="color: #000080;">Partial</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>
           options.<span style="color: #000080;">PartImp</span>.<span style="color: #000080;">LastRow</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">10</span>;
    stats <span style="color: #0000dd;">3</span>;
    wclear msg<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
    if<span style="color: #000000;">(</span> stats.<span style="color: #000080;">mean</span> <span style="color: #000080;">&gt;</span> .01 <span style="color: #000080;">&amp;&amp;</span> stats.<span style="color: #000080;">mean</span> <span style="color: #000080;">&lt;</span> .4 <span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>file<span style="color: #000080;">$</span>
               options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">AutoNames</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>
               options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToSht</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>
               options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToBk</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>
               options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToBkComm</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>
               options.<span style="color: #000080;">PartImp</span>.<span style="color: #000080;">Partial</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
        if<span style="color: #000000;">(</span> ii <span style="color: #000080;">!</span><span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">(</span>CRLF<span style="color: #000000;">)</span> <span style="color: #000000;">)</span> newsheet;
    <span style="color: #000000;">}</span>
    else
    <span style="color: #000000;">{</span>
        type Skipping <span style="color: #000080;">%</span><span style="color: #000000;">(</span>file<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;
        if<span style="color: #000000;">(</span> ii <span style="color: #000080;">==</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">(</span>CRLF<span style="color: #000000;">)</span> <span style="color: #000000;">)</span> layer <span style="color: #000080;">-</span>d;
    <span style="color: #000000;">}</span>
<span style="color: #000000;">}</span>
</pre>

  <p> </p>

  <h3><a name="Delimiters_and_Numeric_Separators"></a><span class="mw-headline">区切り文字および数値の区切り</span></h3>

  <p>Xファンクション<b>impASC</b>のオプションツリーは、区切り文字と数値の区切りオプションを設定できます。これら2つのオプションは、オプションツリーのFileStructノードにあります。</p>

  <p>以下が区切り文字のオプション（<b>options.FileStruct.Delimiter</b>）です。</p>

  <ul>
    <li>0 = 不明</li>

    <li>1 = コンマ</li>

    <li>2 = タブ</li>

    <li>3 = タブ/スペース</li>

    <li>4 = セミコロン</li>

    <li>5 = その他 (options.FileStruct.OtherDelimiterで文字を指定)</li>

    <li>7 = スペース</li>
  </ul>

  <p>以下が区切り文字のオプション（<b>options.FileStruct.NumericSeparator</b>）です。</p>

  <ul>
    <li>0 = 1,000.00</li>

    <li>1 = 1.000,00</li>

    <li>2 = 1 000,00</li>

    <li>3 = 1&apos;000.00</li>
  </ul>

  <p>次のデータは単純なTab区切りデータファイルです。</p>
  <pre>
1       1,010.00        1,240.00
2       3,020.01        2,562.01
3       4,030.00        3,680.00
4       6,040.01        4,002.01
5       7,050.00        5,440.00
6       7,060.01        6,002.01
7       8,982.99        3,456.23
</pre>

  <p>以下は、このデータを使用したサンプルです。実行する前に、上のデータをC:\tempData.txt に保存するか、同じファイル形式のデータファイル名に変更してください。</p>
  <pre class="lt" style="font-family:monospace;">
impASC fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>c<span style="color: #000000;">:</span>\tempData.<span style="color: #000080;">txt</span>
        options.<span style="color: #000080;">FileStruct</span>.<span style="color: #000080;">Delimiter</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>
        options.<span style="color: #000080;">FileStruct</span>.<span style="color: #000080;">NumericSeparator</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
</pre>

  <p>次のサンプルでは、他の区切り文字オプションを使用します。上のサンプルデータの区切り文字がバーティカルバーであった場合、<b>options.FileStruct.Delimiter</b>を5にし、<b>options.FileStruct.OtherDelimiter</b>を&quot;|&quot;にします。</p>
  <pre class="lt" style="font-family:monospace;">
impASC fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>d<span style="color: #000000;">:</span>\tempData.<span style="color: #000080;">txt</span>
        options.<span style="color: #000080;">FileStruct</span>.<span style="color: #000080;">Delimiter</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">5</span>
        options.<span style="color: #000080;">FileStruct</span>.<span style="color: #000080;">OtherDelimiter</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;|&quot;</span>
        options.<span style="color: #000080;">FileStruct</span>.<span style="color: #000080;">NumericSeparator</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
</pre>

  <h3><a name="Import_Mode"></a><span class="mw-headline">インポートモード</span></h3>

  <p>このサンプルは、 impAsc Xファンクションの多くの詳細オプションの使用方法を説明します。このサンプルでは、XファンクションimpAscのオプションを使って名前を変更された新しいブックにファイルをインポートします。</p>
  <pre class="lt" style="font-family:monospace;">
string fn<span style="color: #000080;">$</span><span style="color: #000080;">=</span>system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Spectroscopy\HiddenPeaks.dat&quot;</span>; 
impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fn<span style="color: #000080;">$</span> 
options.<span style="color: #000080;">ImpMode</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>                        <span style="color: #008000; font-style: regular;">/* 新しいブックで開始 */</span>
options.<span style="color: #000080;">Sparklines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>                     <span style="color: #008000; font-style: regular;">/* スパークラインオフ */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">AutoNames</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>                <span style="color: #008000; font-style: regular;">/* 自動名前変更オフ */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToSht</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>               <span style="color: #008000; font-style: regular;">/* シート名をファイル名にする */</span>
options.<span style="color: #000080;">Miscellaneous</span>.<span style="color: #000080;">LeadingZeros</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;    <span style="color: #008000; font-style: regular;">/* 先行ゼロを削除 */</span>
</pre>

  <h3><a name="Importing_Multiple_Files"></a><span class="mw-headline">複数ファイルのインポート</span></h3>

  <p><b>サンプル 1</b></p>

  <p>次のサンプルでは、複数データファイルを新しいワークブックにインポートしてファイルごとに新しいシートを作成します。</p>
  <pre class="lt" style="font-family:monospace;">
string fns, path<span style="color: #000080;">$</span><span style="color: #000080;">=</span>system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\&quot;</span>; 
<span style="color: #008000;">// findFilesはデフォルトでpath$から取得</span>
findfiles fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fns<span style="color: #000080;">$</span> ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;step1*.dat&quot;</span>;
int n <span style="color: #000080;">=</span> fns.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">(</span>CRLF<span style="color: #000000;">)</span>;
string bkName<span style="color: #000080;">$</span>;
newbook s<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>bkName<span style="color: #000080;">$</span>;
impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fns<span style="color: #000080;">$</span>  
options.<span style="color: #000080;">ImpMode</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">4</span>                      <span style="color: #008000; font-style: regular;">/* 新規シートを開始 */</span>
options.<span style="color: #000080;">Sparklines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>                   <span style="color: #008000; font-style: regular;">/* &lt; 50のときスパークラインを追加 */</span>
options.<span style="color: #000080;">Cols</span>.<span style="color: #000080;">NumCols</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>            <span style="color: #008000; font-style: regular;">/* 最初の3列のみインポート */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">AutoNames</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>         <span style="color: #008000; font-style: regular;">/* 自動名前変更はオフ */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToBk</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>          <span style="color: #008000; font-style: regular;">/* ブック名をファイル名にしない */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToSht</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>         <span style="color: #008000; font-style: regular;">/* シート名をファイル名にする */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToShtFrom</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">4</span>     <span style="color: #008000; font-style: regular;">/* ファイル名の文字を短縮してを4文字目から表示 */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToBkComm</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>      <span style="color: #008000; font-style: regular;">/* ファイル名をブックコメントに追加 */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToColComm</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>     <span style="color: #008000; font-style: regular;">/* ファイル名を列コメントに追加 */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FPathToComm</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>        <span style="color: #008000; font-style: regular;">/* コメントにファイルパスを含める */</span>
orng<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span>bkName<span style="color: #000080;">$</span><span style="color: #000000;">]</span>A1<span style="color: #000080;">!</span>A<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span><span style="color: #000000;">:</span>C<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span> ;
</pre>

  <p><b>サンプル 2</b></p>

  <p>このサンプルでは、全サブフォルダおよび先フォルダのsample*.csvという複数のファイルを検索し、各ファイルを新しい行としてOriginのワークシートに追加してインポートします。</p>
  <pre class="lt" style="font-family:monospace;">
newbook test;
dlgPath;<span style="color: #008000;">// ダイアログを開いてメインフォルダを開く</span>
type <span style="color: #000080;">-</span>a <span style="color: #ff00ff;">&quot;You have choosen &quot;</span> <span style="color: #000080;">+</span> path<span style="color: #000080;">$</span>;

findfolders addpath<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;

if<span style="color: #000000;">(</span>folder.<span style="color: #000080;">GetLength</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span> <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>
        <span style="color: #000000;">{</span>
                type <span style="color: #ff00ff;">&quot;No subfolders found&quot;</span>;
                break <span style="color: #0000dd;">1</span>;
        <span style="color: #000000;">}</span>
else
        <span style="color: #000000;">{</span>
                int nn <span style="color: #000080;">=</span> folder.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">(</span>CRLF<span style="color: #000000;">)</span>;
                type <span style="color: #ff00ff;">&quot;$(nn) subfolders found&quot;</span>;
                
                string strTemp<span style="color: #000080;">$</span>;
                for<span style="color: #000000;">(</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ii <span style="color: #000080;">&lt;=</span>nn; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span> <span style="color: #008000;">// 検索されたフォルダごとに実行</span>
                <span style="color: #000000;">{</span>
                        strTemp<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> folder.<span style="color: #000080;">GetToken</span><span style="color: #000000;">(</span>ii, CRLF<span style="color: #000000;">)</span><span style="color: #000080;">$</span>;
                        findFiles path<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strTemp<span style="color: #000080;">$</span> ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;sample*.csv&quot;</span> fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>results;
                        int mm <span style="color: #000080;">=</span> results.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">(</span>CRLF<span style="color: #000000;">)</span>;
                        type <span style="color: #ff00ff;">&quot;A Total of $(mm) files found&quot;</span>;
                        impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>results<span style="color: #000080;">$</span> menu<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> options.<span style="color: #000080;">Impmode</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> Options.<span style="color: #000080;">Hdr</span>.<span style="color: #000080;">SNames</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;
                <span style="color: #000000;">}</span>
        <span style="color: #000000;">}</span>
</pre>

  <h3><a name="After_Import_Convert_Worksheet_to_Matrix"></a><span class="mw-headline">インポート後にワークシートを行列に変換</span></h3>

  <p>次のサンプルでは、最初にダイアログを開き、ワークシートにインポートするASCIIファイルを選択します。次に、ワークシートを行列に直接変換し、行列のXY座標を設定します。この変換オプションでは、線形に増加するYが1列目に、線形に増加するXが1行目にあるとしています。</p>

  <p>（Samples\Import and Export\にある&apos;matrix_data_with_xy.txt&apos;で試すことができます。）</p>

  <p><b>サンプル:</b></p>
  <pre class="lt" style="font-family:monospace;">
dlgfile g<span style="color: #000000;">:</span><span style="color: #000080;">=</span>ascii;
impAsc;
w2m xy<span style="color: #000000;">:</span><span style="color: #000080;">=</span>xcol xlabel<span style="color: #000000;">:</span><span style="color: #000080;">=</span>row1 ycol<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
</pre>

  <h2><a name="Import_Filters"></a><span class="mw-headline">インポートフィルタ</span></h2>

  <p>ASCIIファイルおよび単純形式のバイナリファイルのカスタムインポートは<b>インポートウィザード</b>を使って実行することができます。この機能は、ファイル名やヘッダから変数を抽出したり、インポート後に実行するスクリプトを記述してデータの前処理を行うことなどが可能です。このGUIで設定した内容は、拡張子.OIFの<b>インポートフィルタファイル</b>として様々な場所に保存できます。このようなファイルは拡張子<b>.OIF</b> を持ち、複数の場所に保存できます。</p>

  <p>インポートフィルタを作成すれば、Xファンクションimpfileでフィルタを指定し、保存された設定を使用してインポートを実行できます。</p>

  <p><b>サンプル:</b></p>
  <pre class="lt" style="font-family:monospace;">
string fname<span style="color: #000080;">$</span>, path<span style="color: #000080;">$</span>, filtername<span style="color: #000080;">$</span>;
<span style="color: #008000;">// ファイルパスを指定</span>
path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Import and Export\&quot;</span>;
findfiles ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;S*.dat&quot;</span>;   <span style="color: #008000;">// 条件に一致するファイルを探す</span>
<span style="color: #008000;">// インポートフィルタファイルを指定</span>
filtername<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Import and Export\
VarsFromFileNameAndheader.oif&quot;</span>;
impfile location<span style="color: #000000;">:</span><span style="color: #000080;">=</span>data;    <span style="color: #008000;">// フィルタを使用してすべてのファイルをインポート</span>
</pre>

  <h3><a name="impFile_X-Function_with_Sample_Filter"></a><span class="mw-headline">サンプルフィルタを使用してXファンクションimpFileを実行</span></h3>

  <p>このサンプルでは、フィルタを使用して一連のデータファイルをインポートします。それぞれのデータファイルのために、プロジェクト内に新しいサブフォルダが作成されます。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// データファイルの場所を指定</span>
string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Signal Processing\&quot;</span>;
<span style="color: #008000;">// ワイルドカードですべてのファイルを検索</span>
findfiles ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;TR*.dat&quot;</span>;
int numFiles <span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">(</span>LF<span style="color: #000000;">)</span>;

<span style="color: #008000;">// 全てのファイルでループ</span>
int nFirst <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
for<span style="color: #000000;">(</span>int ifile <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ifile <span style="color: #000080;">&lt;=</span> numFiles; ifile<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
        string filepath<span style="color: #000080;">$</span>, filename<span style="color: #000080;">$</span>;
        
        <span style="color: #008000;">// 次のファイル名を取得</span>
        filepath<span style="color: #000080;">$</span><span style="color: #000080;">=</span>fname.<span style="color: #000080;">gettoken</span><span style="color: #000000;">(</span>ifile,LF<span style="color: #000000;">)</span><span style="color: #000080;">$</span>;
        <span style="color: #008000;">// パスと拡張子を除いてファイル名を変数に保持</span>
        filename<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> filepath.<span style="color: #000080;">GetFileName</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000080;">$</span>;
        
        <span style="color: #008000;">// ファイル名で新しいサブフォルダを作成し、アクティブにする</span>
        pe_mkdir filename<span style="color: #000080;">$</span> cd<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
        
        <span style="color: #008000;">// 新しいブックを作成してデータファイルをインポート</span>
        <span style="color: #008000;">// データフォルダ内にあるフィルタを使用</span>
        <span style="color: #008000;">// このフィルタは、データの前処理として</span>
        <span style="color: #008000;">// frequency列を作成し、値を設定</span>
        newbook;
        <span style="color: #008000;">// Xファンクションの引数名は固有であれば短縮可能</span>
        impfile fn<span style="color: #000000;">:</span><span style="color: #000080;">=</span>filepath<span style="color: #000080;">$</span> fi<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;TR Data Files.oif&quot;</span> l<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
        <span style="color: #008000;">// PEのフォルダを前のレベルに戻して、次のファイルへ</span>
        pe_cd ..;
<span style="color: #000000;">}</span>
</pre>

  <p><br>
  次のサンプルでは、フィルタを使用して単一または複数ファイルをインポートします。このフィルタは、</p>

  <p>各ファイルを新しいシートまたは新しいブックにインポートするか決定する設定があります。このコードを実行する前に、</p>

  <p>フィルタを作成してインポートするデータと同じ場所に保存する必要があります。その後、わずか2行のコードでデータを</p>

  <p>取り込みます。このコードでは、dlgFile と impFileの2つのXファンクションを使用します。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// ダイアログを開いて単一または複数ファイルを選択</span>
dlgfile group<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">*</span>.<span style="color: #000080;">csv</span> multi<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
<span style="color: #008000;">// フィルタファイルmyFilter.oifはデータと同じ場所にある</span>
impFile filtername<span style="color: #000000;">:</span><span style="color: #000080;">=</span>myFilter.<span style="color: #000080;">oif</span> location<span style="color: #000000;">:</span><span style="color: #000080;">=</span>data;
</pre>

  <h2><a name="Internet_Data_Access"></a><span class="mw-headline">インターネットデータへのアクセス</span></h2>

  <p>Xファンクションweb2fileは、インターネット上のテキストファイルを取得できます。</p>

  <h3><a name="Import_A_Web_ASCII_File_Into_A_Worksheet"></a><span class="mw-headline">Web上のASCIIファイルをワークシートにインポート</span></h3>

  <p>このサンプルでは、httpを使用したインターネット上のファイルをユーザファイルフォルダにダウンロードして、アクティブシートにインポートします。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// ローカルにファイルをコピー</span>
string fname<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;%Y_tmp_webdata.txt&quot;</span>;
string url<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;http://hadobs.metoffice.com/hadcrut3/diagnostics/global/nh+sh/annual&quot;</span>;
web2file;
if<span style="color: #000000;">(</span> exist<span style="color: #000000;">(</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">)</span> <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">0</span> <span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
  impASC;
  del <span style="color: #000080;">-</span>f <span style="color: #ff00ff;">&quot;%(fname$)&quot;</span>; <span style="color: #008000;">// 完了したらファイルを削除</span>
<span style="color: #000000;">}</span>
else
  ty <span style="color: #ff00ff;">&quot;Failed to copy web file to local file.&quot;</span>;
</pre>

  <h3><a name="Import_A_Web_Image_Into_A_New_Matrix"></a><span class="mw-headline">Web上の画像を新しい行列にインポート</span></h3>

  <p>次のサンプルでは、OriginLabのWebサイト上にあるのロゴ画像をユーザファイルフォルダにダウンロードし、</p>

  <p>行列シートにインポートします。</p>
  <pre class="lt" style="font-family:monospace;">
string fname<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;%Y_tmp_logo.png&quot;</span>;
string url<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;https://www.originlab.com/images/header_logo.png&quot;</span>;
web2file;
if<span style="color: #000000;">(</span> exist<span style="color: #000000;">(</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">)</span> <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">0</span> <span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
  win <span style="color: #000080;">-</span>t matrix;
  impImage;
  del <span style="color: #000080;">-</span>f <span style="color: #ff00ff;">&quot;%(fname$)&quot;</span>; <span style="color: #008000;">// 完了したらファイルを削除</span>
<span style="color: #000000;">}</span>
else
  ty <span style="color: #ff00ff;">&quot;Failed to copy web file to local file.&quot;</span>;
</pre>

  <h2><a name="Database_Access"></a><span class="mw-headline">データベースアクセスツールバー</span></h2>

  <h3><a name="Import_from_Included_Sample_Access_Database"></a><span class="mw-headline">Accessデータベースからインポート</span></h3>

  <p>Samplesフォルダには、Accessデータベースのサンプルstars.mdbが含まれています。以下のコードはこれを使用して、データベースアクセスのXファンクションでアクティブワークシートにインポートを実行します。詳細は、Xファンクション<a class="external text" href="../../XFunction/X-Function/DbEdit.html">dbEdit</a>を参照してください。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// 接続文字列を構築します。</span>
<span style="color: #008000;">// クエリビルダダイアログを使用して接続文字列を構築してください。</span>
string strdb<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span>
                <span style="color: #ff00ff;">&quot;Samples\Import and Export\stars.mdb&quot;</span>;

string strConn<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Provider=Microsoft.ACE.OLEDB.12.0;
                Data Source=%(strdb$); User ID=; Password=;&quot;</span>;

<span style="color: #008000;">// SQL</span>
string strSQL<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;SELECT Stars.Index, Stars.Name, Stars.LightYears, Stars.Magnitude
                FROM Stars
                WHERE Stars.LightYears&lt;=100
                ORDER BY Stars.Magnitude, Stars.LightYears&quot;</span>;

<span style="color: #008000;">// データベースに接続し、SQLを投入</span>
dbEdit change conn<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strConn<span style="color: #000080;">$</span> sql<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strSQL<span style="color: #000080;">$</span>;
<span style="color: #008000;">// データインポート</span>
dbImport;
<span style="color: #008000;">// データベース接続を切断</span>
dbEdit remove;
</pre>

  <h2><a name="Instrument_Data_Import"></a><span class="mw-headline">機器データのインポート</span></h2>

  <h3><a name="Importing_and_Plotting_Multiple_SPC_Files"></a><span class="mw-headline">複数SPCファイルのインポートと作図</span></h3>

  <p>次のサンプルでは、複数のSPCファイルを個別のワークシートにインポートして、すべてのデータセットから</p>

  <p>グラフを作図する方法を紹介します。また、このコードでは、グラフの凡例の編集も行います。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// 開くダイアログを使用</span>
dlgfile m<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> g<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">*</span>.<span style="color: #000080;">spc</span>;                              <span style="color: #008000;">// *.SPCのグループから複数ファイルを指定</span>
int count <span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">(</span>CRLF<span style="color: #000000;">)</span>;               <span style="color: #008000;">// ファイル数を取得</span>
newbook;                                            <span style="color: #008000;">// 新しいブック作成</span>
loop<span style="color: #000000;">(</span>ii,<span style="color: #0000dd;">1</span>,count<span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        string strFile<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetToken</span><span style="color: #000000;">(</span>ii,CRLF<span style="color: #000000;">)</span><span style="color: #000080;">$</span>; <span style="color: #008000;">// 次のファイル名</span>
        impSPC f<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strFile<span style="color: #000080;">$</span>;                         <span style="color: #008000;">// インポート</span>
        <span style="color: #000080;">%</span>N <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>H;                                    <span style="color: #008000;">// 名前を記憶して後で使用</span>
        range ss <span style="color: #000080;">=</span> <span style="color: #000000;">[</span><span style="color: #000080;">%</span>H<span style="color: #000000;">]</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span><span style="color: #000080;">!</span>;                      <span style="color: #008000;">// シートプロパティにアクセスできる</span>
                                                    <span style="color: #008000;">// 1列以上の場合最初の列をXとする</span>
        if<span style="color: #000000;">(</span>ss.<span style="color: #000080;">col2</span>.<span style="color: #000080;">nrows</span> <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>
                                                    <span style="color: #008000;">// 作図</span>
                plotxy <span style="color: #000000;">[</span><span style="color: #000080;">%</span>H<span style="color: #000000;">]</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span><span style="color: #000080;">!</span><span style="color: #0000dd;">2</span><span style="color: #000000;">:</span>end p<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span> o<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span><span style="color: #000000;">]</span>;
                                                    <span style="color: #008000;">// 1列の場合Yとする</span>
        else
                                                    <span style="color: #008000;">// 作図</span>
                plotxy <span style="color: #000000;">[</span><span style="color: #000080;">%</span>H<span style="color: #000000;">]</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span> p<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span> o<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span><span style="color: #000000;">]</span>;
        legendupdate u<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> m<span style="color: #000000;">:</span><span style="color: #000080;">=</span>custom c<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;@WS&quot;</span>;       <span style="color: #008000;">// オプションを使って凡例を更新</span>
        win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span>N; <span style="color: #008000;">// ワークブックをアクティブにする</span>
        if <span style="color: #000000;">(</span>ii<span style="color: #000080;">&lt;</span>count<span style="color: #000000;">)</span> newsheet;                     <span style="color: #008000;">// まだファイルがある場合シートを追加</span>
<span style="color: #000000;">}</span>
</pre>

  <h2><a name="Specify_Channel_Names_for_Import"></a><span class="mw-headline">インポートするチャネル名を指定</span></h2>

  <p class="version">必要なOriginのバージョン: 9.0 SR0以降</p>

  <p>Xファンクション<a class="external text" href="../../XFunction/X-Function/ImpFileSel.html">impFileSel</a>を使ってインポート前にチャネル構造をツリー変数として取得し、このツリー変数を使ってインポートするチャネル名を指定することができます。これは、インポートのXファンクションimppClamp、impMDF、impMatlab、impNITDM、impNIDIAdem、impPrismで動作します。</p>

  <p>以下は、pClampデータをインポートする際にチャネルを指定する方法を紹介しています。</p>
  <pre class="lt" style="font-family:monospace;">
newbook;
<span style="color: #008000;">// 文字列変数fnameをセットし、調べるファイルを指定</span>
fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Import and Export\pClamp\93310C08.DAT&quot;</span>
<span style="color: #008000;">// ファイル構造をLabTalkツリー変数&quot;tt&quot;に入れる</span>
impFileSel xfname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>imppClamp trFiles<span style="color: #000000;">:</span><span style="color: #000080;">=</span>tt;
<span style="color: #008000;">// 各チャネルのチャネル名を表示</span>
<span style="color: #008000;">//tt.=;</span>
<span style="color: #008000;">// 最初のチャネルを除いてファイル構造を変更</span>
<span style="color: #008000;">// 最初のチャネル名は&quot;ChannelName1&quot;</span>
<span style="color: #008000;">// 値を0に変更してこのチャネルのインポートをブロック</span>
<span style="color: #008000;">// デフォルトの値1はインポートを許可する</span>
for<span style="color: #000000;">(</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ii<span style="color: #000080;">&lt;=</span><span style="color: #0000dd;">2</span>; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
        if <span style="color: #000000;">(</span>ii <span style="color: #000080;">==</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>
        continue;
        tt.<span style="color: #000080;">Channels</span>.<span style="color: #000080;">ChannelName</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
<span style="color: #000000;">}</span>
<span style="color: #008000;">// 93310C08.DAT と 93311C01.DATを含む2つのファイルを選択</span>
folderpath<span style="color: #000080;">$</span><span style="color: #000080;">=</span>system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Import and Export\pClamp&quot;</span>;
dlgfile group<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;9331*C0*.dat&quot;</span> multi<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> init<span style="color: #000000;">:</span><span style="color: #000080;">=</span>folderpath<span style="color: #000080;">$</span>;
int numFiles <span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">(</span>LF<span style="color: #000000;">)</span>;
<span style="color: #008000;">// 全ファイルでループ</span>
int nFirst <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
for<span style="color: #000000;">(</span>int ifile <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ifile <span style="color: #000080;">&lt;=</span> numFiles; ifile<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
        string filepath<span style="color: #000080;">$</span>, filename<span style="color: #000080;">$</span>;
        <span style="color: #008000;">// 次のファイル名を取得</span>
        filepath<span style="color: #000080;">$</span><span style="color: #000080;">=</span>fname.<span style="color: #000080;">gettoken</span><span style="color: #000000;">(</span>ifile,LF<span style="color: #000000;">)</span><span style="color: #000080;">$</span>;
        newbook;
        <span style="color: #008000;">// 変更したファイル構造でインポート</span>
        imppClamp fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>filepath<span style="color: #000080;">$</span> trFiles<span style="color: #000000;">:</span><span style="color: #000080;">=</span>tt;
<span style="color: #000000;">}</span>;
</pre>

  <h2><a name="Image_Files"></a><span class="mw-headline">画像ファイル</span></h2>

  <h3><a name="Import_Images"></a><span class="mw-headline">画像のインポート</span></h3>

  <p><a class="external text" href="../../XFunction/X-Function/ImpImage.html">ImpImage</a> は、画像形式のファイルをOrigin にインポートします。</p>

  <p>これは複数ファイルのインポートが可能です。デフォルトでは、複数の画像ファイルは行列ページの新しいレイヤに追加されます。それぞれの行列レイヤ名はファイル名になります。</p>

  <p><b>サンプル1：</b></p>

  <p>このサンプルは新しい行列ブックに一連の *.TIF画像をインポートします。</p>
  <pre class="lt" style="font-family:monospace;">
newbook mat<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
string fns, path<span style="color: #000080;">$</span><span style="color: #000080;">=</span>system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span><span style="color: #ff00ff;">&quot;Samples\Image Processing and Analysis\&quot;</span>;
findfiles fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fns<span style="color: #000080;">$</span> ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;myocyte*.tif&quot;</span>; <span style="color: #008000;">// findFilesはデフォルトでpath$から取得</span>
int n <span style="color: #000080;">=</span> fns.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">(</span>CRLF<span style="color: #000000;">)</span>;
impimage options.<span style="color: #000080;">Mode</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">4</span> fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fns<span style="color: #000080;">$</span>
</pre>

  <p><b>サンプル2：</b></p>

  <p>このサンプルは、JPG画像のフォルダを異なる行列ブックにインポートします。</p>
  <pre class="lt" style="font-family:monospace;">
string fns, path<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;C:\Documents and Settings\All Users\Documents\My Pictures\Sample Pictures\&quot;</span>;
findfiles fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fns<span style="color: #000080;">$</span> ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;*.jpg&quot;</span>; <span style="color: #008000;">// findFilesはデフォルトでpath$から取得</span>
int n <span style="color: #000080;">=</span> fns.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">(</span>CRLF<span style="color: #000000;">)</span>;
string bkName<span style="color: #000080;">$</span>;
string fname<span style="color: #000080;">$</span>;
for<span style="color: #000000;">(</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ii<span style="color: #000080;">&lt;=</span>n; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> fns.<span style="color: #000080;">GetToken</span><span style="color: #000000;">(</span>ii, CRLF<span style="color: #000000;">)</span><span style="color: #000080;">$</span>;
    <span style="color: #008000;">// 新しい行列ページを作成</span>
    newbook s<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> mat<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>bkName<span style="color: #000080;">$</span>;
    <span style="color: #008000;">// 行列ページの最初のレイヤに画像をインポート</span>
    <span style="color: #008000;">// impimageはデフォルトでfname$をインポート </span>
    impimage orng<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span>bkName<span style="color: #000080;">$</span><span style="color: #000000;">]</span>msheet1;
<span style="color: #000000;">}</span>
</pre>

  <h3><a name="Convert_Imported_Image_into_Data"></a><span class="mw-headline">インポートした画像をデータに変換</span></h3>

  <p>ここでは、ビットマップ画像をインポートしてバイト行列に変換する方法を紹介します。</p>
  <pre class="lt" style="font-family:monospace;">
dlgfile g<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">*</span>.<span style="color: #000080;">bmp</span>;      <span style="color: #008000;">// 開くダイアログを開いてファイルを選択し、fname$にいれる</span>
newbook m<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;          <span style="color: #008000;">// 新しい行列ブックを作成</span>
impImage;              <span style="color: #008000;">// アクティブな行列ブックにインポート</span>
img2m o<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>input<span style="color: #000080;">&gt;</span> t<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">// 画像をバイトデータに変換</span>
</pre>

  <h2><a name="Text_Files"></a><span class="mw-headline">テキストファイル</span></h2>

  <h3><a name="Open_a_Text_File_Into_a_Notes_Window"></a><span class="mw-headline">テキストファイルをノートウィンドウに開く</span></h3>

  <dl>
    <dd><font color="navy"><i>open -n fileName [winName]</i></font></dd>
  </dl>

  <p>このスクリプトはASCIIファイルをノートウィンドウに開きます。winNameを指定しない場合、新しいノートウィンドウが作成されます。</p>

  <p><b>サンプル:</b></p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #000080;">%</span>b <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Import and Export\ASCII simple.dat&quot;</span>;
open <span style="color: #000080;">-</span>n <span style="color: #ff00ff;">&quot;%b&quot;</span>;
</pre>

  <h2><a name="Import_Video"></a><span class="mw-headline">動画のインポート</span></h2>

  <p class="version">必要なOriginのバージョン: 9.1 SR2以降</p>

  <p>このサンプルでは、新しい行列ブックを作成して、アクティブシートの複数行列オブジェクトに、指定した動画ファイルのフレームをロードします。</p>

  <p>自身のファイルのコードを簡単に修正したり、特定のフレーム数や時間の増分でロードするように指定したりすることができます。</p>
  <pre class="lt" style="font-family:monospace;">
string vfilename<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;d:\test.avi&quot;</span>;
<span style="color: #008000;">//ByCountを0にするとStepSize秒毎に読み込み</span>
<span style="color: #008000;">//1にすると、TotalFrames数分読み込む</span>
int ByCount <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; 
int TotalFrames <span style="color: #000080;">=</span> <span style="color: #0000dd;">100</span>;
double StepSize <span style="color: #000080;">=</span> <span style="color: #0000dd;">15</span>; <span style="color: #008000;">// 秒</span>
 
<span style="color: #008000;">// 新しい行列ブックを作成</span>
string matbk<span style="color: #000080;">$</span>;
newbook mat<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>matbk<span style="color: #000080;">$</span>;
int skip;

<span style="color: #008000;">// 動画ファイルを開く</span>
int err <span style="color: #000080;">=</span> vr.<span style="color: #000080;">Open</span><span style="color: #000000;">(</span><span style="color: #000080;">%</span><span style="color: #000000;">(</span>vfilename<span style="color: #000080;">$</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
if<span style="color: #000000;">(</span> <span style="color: #0000dd;">0</span> <span style="color: #000080;">==</span> err <span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
        if<span style="color: #000000;">(</span> ByCount <span style="color: #000000;">)</span> <span style="color: #008000;">// スキップして終了までのTotalFrames数分読み込む</span>
        <span style="color: #000000;">{</span>
                skip <span style="color: #000080;">=</span> vr.<span style="color: #000080;">FrameCount</span><span style="color: #000080;">/</span>TotalFrames;
                type <span style="color: #ff00ff;">&quot;Read total of $(TotalFrames) frames, 
Skip every $(skip) frames or $(skip/vr.FPS) sec. 
File has $(vr.FrameCount) frames&quot;</span>;
        <span style="color: #000000;">}</span>
        else <span style="color: #008000;">// 1フレーム読み込んでStepSize秒スキップ</span>
        <span style="color: #000000;">{</span>
                skip <span style="color: #000080;">=</span> StepSize <span style="color: #000080;">*</span> vr.<span style="color: #000080;">FPS</span>;
                type <span style="color: #ff00ff;">&quot;Read total of $(TotalFrames) frames, 
Skip every $(skip) frames or $(StepSize) sec. 
File has $(vr.FrameCount) frames&quot;</span>;
        <span style="color: #000000;">}</span>
 
        <span style="color: #008000;">// 現在の位置（最初）からファイルの</span>
        <span style="color: #008000;">// 最後(frameCount=0)まで行列に読み込み</span>
        vr.<span style="color: #000080;">ReadFrames</span><span style="color: #000000;">(</span><span style="color: #000080;">%</span>h, TotalFrames, skip<span style="color: #000000;">)</span>;
        vr.<span style="color: #000080;">Close</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;<span style="color: #008000;">// 動画ファイルを閉じる</span>
<span style="color: #000000;">}</span>
 
page.<span style="color: #000080;">cntrl</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">// イメージモード</span>
matrix <span style="color: #000080;">-</span>it <span style="color: #0000dd;">1</span>; <span style="color: #008000;">// サムネイル表示</span>
</pre>

  <p> </p>

  <h2><a name="Reimport"></a><span class="mw-headline">再インポート</span></h2>

  <h3><a name="Using_Reimport_to_Bring_back_all_Data"></a><span class="mw-headline">再インポートですべてのデータを元に戻す</span></h3>

  <p>このサンプルは、アクティブなワークブックにインポートされたデータを元に戻します。コードを実行する前に、データ：ファイルからインポート：ASCIIメニューを使ってワークブックにデータをインポートします。この時、インポートオプションで、インポートモードを「シートを新たに作って読み込む」に設定してください。その後、ワークシート：ワークシートのクリアメニューで各シートのデータを削除します。以下のスクリプトを実行してください。</p>
  <pre class="lt" style="font-family:monospace;">
loop <span style="color: #000000;">(</span>i, <span style="color: #0000dd;">1</span>, page.<span style="color: #000080;">nlayers</span><span style="color: #000000;">)</span> 
<span style="color: #000000;">{</span>     <span style="color: #008000;">// ブック内のすべてのシートでループ</span>
        page.<span style="color: #000080;">active</span> <span style="color: #000080;">=</span> i; <span style="color: #008000;">// アクティブシート</span>
        reimport;        <span style="color: #008000;">// アクティブシートのデータを元に戻すために再インポート</span>
<span style="color: #000000;">}</span>
</pre>

  <h3><a name="Watching_for_a_File_change_for_reimport"></a><span class="mw-headline">ファイルが変更されたら再インポート</span></h3>

  <p>ここでは、ファイルをインポートしたあと、再インポートのためにファイルの変更を確認します。このスクリプトは特定イベントマクロ<i><b>timerproc</b></i>を使い、指定した間隔で実行します。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// データをインポートして作図</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> D<span style="color: #000000;">:</span>\Sample.<span style="color: #000080;">dat</span>;
impasc;
range raIn <span style="color: #000080;">=</span> <span style="color: #000080;">!</span>; <span style="color: #008000;">// 再インポート用</span>
plotxy <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">)</span> <span style="color: #0000dd;">202</span>;
double olddate <span style="color: #000080;">=</span> exist<span style="color: #000000;">(</span><span style="color: #000080;">%</span><span style="color: #000000;">(</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">)</span>,<span style="color: #0000dd;">5</span><span style="color: #000000;">)</span>; <span style="color: #008000;">// ファイルの日付-時間をメモ</span>

<span style="color: #008000;">// ここから、ファイル変更があったら再インポートするマクロをプログラム</span>
def timerproc
<span style="color: #000000;">{</span>
    double newdate <span style="color: #000080;">=</span> exist<span style="color: #000000;">(</span><span style="color: #000080;">%</span><span style="color: #000000;">(</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">)</span>,<span style="color: #0000dd;">5</span><span style="color: #000000;">)</span>; <span style="color: #008000;">// 現在のファイルの日付-時間</span>
    if<span style="color: #000000;">(</span>newdate <span style="color: #000080;">!</span><span style="color: #000080;">=</span> olddate<span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        reimport or<span style="color: #000000;">:</span><span style="color: #000080;">=</span>raIn; <span style="color: #008000;">// ファイルに変更があったら再インポート</span>
        olddate <span style="color: #000080;">=</span> newdate;
        layer <span style="color: #000080;">-</span>a; <span style="color: #008000;">// グラフを更新（グラフウィンドウがアクティブなことが前提）</span>
    <span style="color: #000000;">}</span>
    else ty Nothing new ...; <span style="color: #008000;">// 必要なければこの行は削除</span>
<span style="color: #000000;">}</span>

<span style="color: #008000;">// ファイルを確認するタイマーを開始</span>
timer <span style="color: #0000dd;">1800</span>; <span style="color: #008000;">// timerprocを1800秒（30分）ごとに実行</span>
</pre>

  <p>プロセスを停止するために以下のコマンドを実行する必要があります。</p>
  <pre class="lt" style="font-family:monospace;">
timer <span style="color: #000080;">-</span>k;
</pre>
