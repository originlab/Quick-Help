<h1 class="firstheading">LabTalkスクリプトのデバッグ</h1>

  <p class='urlname' style='display: none'>Tutorial-Debug</p>

  <div id="toc" class="toc">
    <div id="toctitle">
      <h2>目次</h2>
    </div>

    <ul>
      <li class="toclevel-1 tocsection-1"><a href="#Summary"><span class="tocnumber">1</span> <span class="toctext">概要</span></a></li>

      <li class="toclevel-1 tocsection-2"><a href="#What_You_Will_Learn"><span class="tocnumber">2</span> <span class="toctext">学習する項目</span></a></li>

      <li class="toclevel-1 tocsection-3"><a href="#Using_Code_Builder"><span class="tocnumber">3</span> <span class="toctext">コードビルダを使用</span></a></li>

      <li class="toclevel-1 tocsection-4">
        <a href="#Using_Skills"><span class="tocnumber">4</span> <span class="toctext">スキルを使用</span></a>

        <ul>
          <li class="toclevel-2 tocsection-5"><a href="#win_-o.3B_layer_-o"><span class="tocnumber">4.1</span> <span class="toctext">win -o; layer -o</span></a></li>

          <li class="toclevel-2 tocsection-6"><a href="#type"><span class="tocnumber">4.2</span> <span class="toctext">type</span></a></li>

          <li class="toclevel-2 tocsection-7"><a href="#echo"><span class="tocnumber">4.3</span> <span class="toctext">echo</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-8"><a href="#Error_Handling"><span class="tocnumber">5</span> <span class="toctext">エラー処理</span></a></li>

      <li class="toclevel-1 tocsection-9"><a href="#LabTalk_Script_Precedence"><span class="tocnumber">6</span> <span class="toctext">LabTalkスクリプト実行の優先順位</span></a></li>
    </ul>
  </div>

  <h2><a name="Summary"></a><span class="mw-headline">概要</span></h2>

  <p>Originには、LabTalkスクリプトの開発とデバッグに役立つさまざまなツールが用意されています。</p>

  <h2><a name="What_You_Will_Learn"></a><span class="mw-headline">学習する項目</span></h2>

  <p>このチュートリアルでは、以下の項目について解説します。</p>

  <ul>
    <li>コードビルダを使ってLabTalkスクリプトをデバッグ</li>

    <li>便利なスキルを使ってLabTalkスクリプトをデバッグ</li>

    <li>エラー処理をして中断することなくLabTalkスクリプトを実行</li>

    <li>LabTalkスクリプトの優先順位の概念を理解</li>
  </ul>

  <h2><a name="Using_Code_Builder"></a><span class="mw-headline">コードビルダを使用</span></h2>

  <p>*.OGSのテキストファイルのセクションにLabTalkスクリプトを保存すると、コードビルダを使用してLabTalkスクリプトをデバッグできます。</p>

  <p>以下のサンプルでコードビルダを使ってデバッグする方法を紹介します。</p>

  <ol>
    <li>*.ogsファイルをコードビルダで開きます。</li>

    <li>ブレークポイントを設定する行にカーソルを置き、F9を押す（またはメニューから<b>デバッグ: ブレークポイントの挿入/削除</b>を選択するか、 <b>ブレークポイントの挿入/削除</b>ボタン<a class="image"><img alt="Button Toggle Breakpoint new.png" src="../images/Tutorial_Debug/Button_Toggle_Breakpoint_new.png" width="25"></a>をクリック）か行番号の左側の余白をクリックして、その行にブレークポイントを設定します。

      <dl>
        <dd><a class="image"><img alt="Debug LabTalk example 01.png" src="../images/Tutorial_Debug/Debug_LabTalk_example_01.png" width="407"></a></dd>
      </dl>
    </li>

    <li>セクションを実行します。現在のセクション名を選択するか、セクション名の行にカーソルを置き、<b>現セクションの実行</b>ボタン<a class="image"><img alt="Button Execute Current Section new.png" src="../images/Tutorial_Debug/Button_Execute_Current_Section_new.png" width="25"></a>をクリックするか、メニューから<b>デバッグ: 現セクションの実行</b>を選択して、指定した行までコードを実行します。また、<a href="../../LabTalk/LabTalk/Run_(object).html#Methods:" title="LabTalk:Run (オブジェクト)">run.section</a>オブジェクトメソッドを使ってセクションを実行することもできます。</li>

    <li><b>ステップイン</b>ボタン<a class="image"><img alt="Button Step Into new.png" src="../images/Tutorial_Debug/Button_Step_Into_new.png" width="24"></a>をクリック (またはF8キーを押すか、メニューから<b>デバッグ: ステップイン</b>を選択) して、スクリプトをステップごとに実行し、論理エラーをチェックします。

      <dl>
        <dd><a class="image"><img alt="Debug LabTalk example 02.png" src="../images/Tutorial_Debug/Debug_LabTalk_example_02.png" width="444"></a></dd>
      </dl>
    </li>

    <li>別のブレークポイントがある場合は、<b>デバッグの開始</b>ボタン<a class="image"><img alt="Button Go new.png" src="../images/Tutorial_Debug/Button_Go_new.png" width="27"></a>をクリックして次のブレークポイントまでスクリプトを実行できます。デバッグが終了したら、<b>デバッグの中止</b>ボタン<a class="image"><img alt="Button Stop Debugging new.png" src="../images/Tutorial_Debug/Button_Stop_Debugging_new.png" width="28"></a>をクリックしてデバッグを終了します。</li>
  </ol>

  <p>LabTalk関数、LabTalkで呼び出し可能なOC関数、同じogsまたは別のogs内の別のセクションを呼び出すコマンドラインがある場合、呼び出された関数 (または呼び出されたセクションやogs) を含むコードを一度に1行ずつ実行するかどうかを選択できます。 </p>

  <p><b>ステップイン</b></p>

  <p>ステップイン機能を使用すると、呼び出された関数をステップスルーして、関数の論理エラーをチェックできます。</p>

  <ol>
    <li><b>getminmax()</b>関数を呼び出す行にブレークポイントを設定します。</li>

    <li>関数呼び出しに到達するまで、コードを1行ずつ実行します。プログラムが関数呼び出し行で一時停止している間に、デバッグツールバーの<b>ステップイン</b>ボタン<a class="image"><img alt="Button Step Into new.png" src="../images/Tutorial_Debug/Button_Step_Into_new.png" width="24"></a>をクリックするか、<b>デバッグ:ステップイン</b>を選択します。</li>

    <li>デバッガは関数呼び出しステートメントを実行し、呼び出されたセクションの最初の行で実行を一時停止します。

      <dl>
        <dd><a class="image"><img alt="Debug LabTalk example 03.png" src="../images/Tutorial_Debug/Debug_LabTalk_example_03.png" width="578"></a></dd>
      </dl>
    </li>
  </ol>

  <p><b>ステップオーバー</b></p>

  <p>ただし、呼び出された関数をステップオーバーすることもできます。これを行うには、ステップオーバーする関数呼び出し行でコードの実行を一時停止します (ブレークポイントを設定するか、関数呼び出しまで一行ごとに実行)。プログラムが関数呼び出し行で一時停止している間に、デバッグツールバーの<b>ステップオーバー</b>ボタン<a class="image"><img alt="Button Step Over new.png" src="../images/Tutorial_Debug/Button_Step_Over_new.png" width="25"></a>をクリックするか、<b>デバッグ:ステップオーバー</b>を選択します。</p>

  <p>デバッガは関数呼び出しを実行し、関数が戻った後に一時停止します。</p>

  <dl>
    <dd><a class="image"><img alt="Debug LabTalk example 04.png" src="../images/Tutorial_Debug/Debug_LabTalk_example_04.png" width="567"></a></dd>
  </dl>

  <p><b>ステップアウト</b></p>

  <p>関数内で実行が一時停止されている場合は、デバッグツールバーの<b>ステップアウト</b>ボタン<a class="image"><img alt="Button Step Out new.png" src="../images/Tutorial_Debug/Button_Step_Out_new.png" width="27"></a>をクリックするか、<b>デバッグ: ステップアウト</b>を選択して関数からステップアウトできます。</p>

  <p><b>カーソルまで実行</b></p>

  <p>ルーチンを中断するブレークポイントがない場合は、<b>カーソルまで実行</b>ボタン<a class="image"><img alt="Button Run to Cursor new.png" src="../images/Tutorial_Debug/Button_Run_to_Cursor_new.png" width="25"></a>をクリックするか、 <b>デバッグ：カーソルまで実行</b>を選択します。カーソルが設定されている場所に到達するまでスクリプトが実行されます。</p>

  <p>また、ed.open()メソッドを使用して、コードビルダでLabTalkスクリプトを開くことができます。たとえば、コード ビルダウィンドウの指定したセクションで指定したスクリプトファイルを開くには、次のようにスクリプトを記述します。</p>
  <pre class="lt" style="font-family:monospace;">
cd <span style="color: #0000dd;">2</span>; <span style="color: #008000;">//OriginのLabTalkスクリプトサンプルフォルダに切り替え</span>
ed.<span style="color: #000080;">open</span><span style="color: #000000;">(</span>summarize_data.<span style="color: #000080;">ogs</span>,main<span style="color: #000000;">)</span>;
</pre>

  <h2><a name="Using_Skills"></a><span class="mw-headline">スキルを使用</span></h2>

  <h3><a name="win_-o.3B_layer_-o"></a><span class="mw-headline">win -o; layer -o</span></h3>

  <p><a href="../../LabTalk/LabTalk/Window_(command).html#-o.3B_Execute_the_specified_script_for_the_named_window" title="LabTalk:ウィンドウ(コマンド)">win -o</a>および<a href="../../LabTalk/LabTalk/Layer_(command).html#-o.3B_execute_.28operate.29_the_specified_script_for_the_specified_layer" title="LabTalk:レイヤ(コマンド)">layer -o</a>コマンドはデバッグとは関係ありませんが、エラーの発生を回避するのに非常に役立ちます。</p>

  <p>ワークブックやグラフページ/レイヤなどのOriginオブジェクトを操作するとき、スクリプトは常にデフォルトでアクティブウィンドウに対して行われます。ただし、アクティブなウィンドウまたはレイヤの切り替えに遅延が発生したり、予期せぬ結果を招く可能性があるため、ターゲットウィンドウをアクティブにしたくない場合があります。このような場合、win -oやlayer -oを使用してスクリプトを囲むとよいでしょう。</p>
  <pre class="lt" style="font-family:monospace;">
newbook; <span style="color: #008000;">//新規ワークブック</span>
<span style="color: #008000;">//ワークブックにファイルをインポート</span>
string fn1<span style="color: #000080;">$</span><span style="color: #000080;">=</span>system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Spectroscopy\XPS\BTABA.DAT&quot;</span>; 
impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fn1<span style="color: #000080;">$</span>;
string mybk<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span>H; <span style="color: #008000;">//ワークブック名を保存</span>
plotxy <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">)</span> o<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>new<span style="color: #000080;">&gt;</span>; <span style="color: #008000;">//グラフを作成しグラフウィンドウがアクティブに</span>
<span style="color: #008000;">//ワークブックウィンドウに対して中括弧で囲まれたスクリプトを実行</span>
win <span style="color: #000080;">-</span>o mybk<span style="color: #000080;">$</span> 
<span style="color: #000000;">{</span>
  newsheet;
  string fn2<span style="color: #000080;">$</span><span style="color: #000080;">=</span>system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Spectroscopy\XPS\BTATI.DAT&quot;</span>; 
  impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fn2<span style="color: #000080;">$</span>;
  plotxy <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">)</span> o<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>new<span style="color: #000080;">&gt;</span>;
<span style="color: #000000;">}</span>
</pre>

  <h3><a name="type"></a><span class="mw-headline">type</span></h3>

  <p><b>Type</b> を使用して、現在のディレクトリにある指定したスクリプトファイル (.OGS ファイル) の内容をコマンド (またはスクリプト) ウィンドウに出力できます。</p>

  <p>例えば、</p>
  <pre class="lt" style="font-family:monospace;">
cd <span style="color: #0000dd;">2</span>;
type autofit; <span style="color: #008000;">//labtalkサンプルファイルautofot.ogsを印字</span>
</pre>

  <h3><a name="echo"></a><span class="mw-headline">echo</span></h3>

  <p>デバッグとトレースを行うために、システム変数<a href="../../LabTalk/LabTalk/System_Variables.html#ECHO" title="LabTalk:システム変数">Echo</a>はスクリプトまたはエラーメッセージをコマンドウィンドウ (またはスクリプトウィンドウ) に出力します。</p>

  <p>たとえば、スクリプトウィンドウで次のスクリプトを実行します。</p>
  <pre class="lt" style="font-family:monospace;">
echo<span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
string aa<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;abc&quot;</span>;
double aa<span style="color: #000080;">=</span><span style="color: #0000dd;">100</span>;
</pre>

  <p>以下のように一般的なエラーメッセージだけでなく、エラーのあるスクリプト行も表示されます。</p>
  <pre class="lt" style="font-family:monospace;">
AA<span style="color: #000000;">:</span>already declared as string, cannot redeclare in the same scope<span style="color: #000080;">!</span>
Error<span style="color: #000000;">:</span>double aa<span style="color: #000080;">=</span><span style="color: #0000dd;">100</span>  <span style="color: #008000;">//The script line with error will show after runing echo=1.</span>
</pre>

  <h2><a name="Error_Handling"></a><span class="mw-headline">エラー処理</span></h2>

  <p>LabTalkコードにエラーがある場合、コードはエラーの時点で中断され、エラー後の行は実行されません。スクリプトを中断せずに実行し続けたい場合は、エラーのある行を中括弧で囲むこともできます。</p>

  <p>たとえば、次のスクリプトを実行します。</p>
  <pre class="lt" style="font-family:monospace;">
newbook name<span style="color: #000000;">:</span><span style="color: #000080;">=</span>abc option<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lsname;
wks.<span style="color: #000080;">ncols</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>;
col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>data<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">10</span><span style="color: #000000;">)</span>;
col<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>normal<span style="color: #000000;">(</span><span style="color: #0000dd;">10</span><span style="color: #000000;">)</span>;
plotxy;
win <span style="color: #000080;">-</span>a abc;
col<span style="color: #000000;">(</span><span style="color: #0000dd;">3</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000080;">+</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>;
</pre>

  <p>Col(1)とCol(2)にはデータが入力されますが、入力が指定されていないため &quot;plotxy;&quot; 行で実行を停止します。そのためCol(3) はデータが入力されません。</p>

  <p>以下のように中括弧を使用して&quot;plotxy;&quot;の行を囲みます。</p>
  <pre class="lt" style="font-family:monospace;">
newbook name<span style="color: #000000;">:</span><span style="color: #000080;">=</span>abc option<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lsname;
wks.<span style="color: #000080;">ncols</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>;
col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>data<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">10</span><span style="color: #000000;">)</span>;
col<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>normal<span style="color: #000000;">(</span><span style="color: #0000dd;">10</span><span style="color: #000000;">)</span>;
<span style="color: #000000;">{</span>plotxy;<span style="color: #000000;">}</span>
win <span style="color: #000080;">-</span>a abc;
col<span style="color: #000000;">(</span><span style="color: #0000dd;">3</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000080;">+</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>;
</pre>

  <p>すると次の行が実行され、Col(3)にデータが入力されます。</p>

  <p>エラー処理の詳細については、<a href="../../LabTalk/Script/Error_Handling.html" title="Script:Error Handling">このページ</a>を参照してください。</p>

  <h2><a name="LabTalk_Script_Precedence"></a><span class="mw-headline">LabTalkスクリプト実行の優先順位</span></h2>

  <p>ユーザ定義のOrigin C関数が labtalkogsファイルと同じ名前を持つ場合、labtalk ogs ファイルが優先されます。</p>

  <p>たとえば、Origin C 関数&quot;precedence&quot;を作成します。</p>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">void</span> precedence<span style="color: #000000;">(</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
MessageBox<span style="color: #000000;">(</span>GetWindow<span style="color: #000000;">(</span><span style="color: #000000;">)</span>, <span style="color: #ff00ff;">&quot;This message is from OC code!&quot;</span>, <span style="color: #ff00ff;">&quot;OC&quot;</span><span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span>
</pre>

  <p>このOrigin C関数をコンパイルして</p>
  <pre class="oc" style="font-family:monospace;">
precedence;
</pre>

  <p>スクリプトウィンドウで実行します。&quot;This message is from OC code!&quot;というメッセージが表示されます。</p>

  <p>次に、ogsファイルを作成し、precedence.ogsという名前を付けて、次のスクリプトでユーザファイル フォルダに保存します。</p>
  <pre class="lt" style="font-family:monospace;">
type <span style="color: #000080;">-</span>b <span style="color: #ff00ff;">&quot;This message is from OGS file!&quot;</span>;
</pre>

  <p>その後スクリプトウィンドウで次のスクリプトを実行します。</p>
  <pre class="lt" style="font-family:monospace;">
cd <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// 現在の作業ディレクトリ</span>
precedence;
</pre>

  <p>&quot;This message is from OGS file!&quot;というメッセージボックスが表示されます。これで、labtalkスクリプトの優先度が高いことが確認できます。</p>
