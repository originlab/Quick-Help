<h1 class="firstheading">LabTalkによるグラフ作成とエクスポート</h1>

  <p class='urlname' style='display: none'>Tutorial-Graphing-and-Exporting-with-LT</p>

  <p>&#160;</p>

  <div id="toc" class="toc">
    <div id="toctitle">
      <h2>目次</h2>
    </div>

    <ul>
      <li class="toclevel-1 tocsection-1"><a href="#Summary"><span class="tocnumber">1</span> <span class="toctext">概要</span></a></li>

      <li class="toclevel-1 tocsection-2"><a href="#What_You_Will_Learn"><span class="tocnumber">2</span> <span class="toctext">学習する項目</span></a></li>

      <li class="toclevel-1 tocsection-3">
        <a href="#Steps"><span class="tocnumber">3</span> <span class="toctext">ステップ</span></a>

        <ul>
          <li class="toclevel-2 tocsection-4"><a href="#Create_Graphs"><span class="tocnumber">3.1</span> <span class="toctext">グラフを作成する</span></a></li>

          <li class="toclevel-2 tocsection-5"><a href="#Customize_Graphs"><span class="tocnumber">3.2</span> <span class="toctext">グラフを編集する</span></a></li>

          <li class="toclevel-2 tocsection-6"><a href="#Export_Graphs"><span class="tocnumber">3.3</span> <span class="toctext">グラフエクスポート</span></a></li>
        </ul>
      </li>
    </ul>
  </div>

  <h2><a name="Summary"></a><span class="mw-headline">概要</span></h2>

  <p>LabTalkには、2Dまたは3Dグラフを作成および編集し、それらを画像または動画ファイルとしてエクスポートするために使用できる、多くのコマンド、オブジェクト、およびXファンクションがあります。</p>

  <h2><a name="What_You_Will_Learn"></a><span class="mw-headline">学習する項目</span></h2>

  <p>このチュートリアルでは、LabTalk スクリプトを使用して次のことを行う方法を説明します。</p>

  <ul>
    <li>2Dグラフの作成</li>

    <li>3Dグラフの作成</li>

    <li>グラフの軸とデータ プロットの編集</li>

    <li>グラフを画像ファイルとしてエクスポート</li>

    <li>複数のグラフの組み合わせを動画としてエクスポート</li>
  </ul>

  <p>スクリプトは各サンプル内で順番に実行されるように設計されています。</p>

  <h2><a name="Steps"></a><span class="mw-headline">ステップ</span></h2>

  <h3><a name="Create_Graphs"></a><span class="mw-headline">グラフを作成する</span></h3>

  <p><b>2Dグラフ</b></p>

  <ol>
    <li>以下のスクリプトを実行して、<b>Graph2D</b>という新しいワークブックを作成し、インポートフィルター<b>waterfall.oif</b>を使って<i>&lt;Origin EXE Folder&gt;\Samples\Graphing\</i>のW<b>aterfall.dat</b>ファイルをインポートします。この場合、Xファンクション<a class="external text" href="../../XFunction/X-Function/ImpFile.html">ImpFile</a>が使用されます。</li>

    <li style="list-style: none">
      <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// 新規ブックを作成し、Graph2Dと名前付け（ロングネームとショートネーム両方）</span>
newbook name<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Graph2D&quot;</span> option<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lsname;
<span style="color: #008000;">// ファイル名とフィルタ名を定義</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Graphing\Waterfall.dat&quot;</span>;
string filtername<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;waterfall.oif&quot;</span>;  
<span style="color: #008000;">// Xファンクションimpfileを使用して、インポートフィルタで指定ファイルをインポート</span>
impfile fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fname<span style="color: #000080;">$</span> filtername<span style="color: #000000;">:</span><span style="color: #000080;">=</span>filtername<span style="color: #000080;">$</span> location<span style="color: #000000;">:</span><span style="color: #000080;">=</span>data orng<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span>Graph2D<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;
</pre>
    </li>

    <li>Xファンクション<a class="external text" href="../../XFunction/X-Function/Plotxy.html">plotxy</a>を使用して、ワークブック<b>Graph2D</b>にインポートされたデータの1 列目をXとし、2列目をYとして、線とシンボルのグラフを作成します。</li>

    <li style="list-style: none">
      <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// ユーザ定義のRGBカラーで線とシンボルのXYプロットを作成</span>
plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span>Graph2D<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">)</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">202</span> color<span style="color: #000000;">:</span><span style="color: #000080;">=</span>color<span style="color: #000000;">(</span><span style="color: #0000dd;">255</span>,<span style="color: #0000dd;">0</span>,<span style="color: #0000dd;">255</span><span style="color: #000000;">)</span>;
<span style="color: #008000;">// 文字列レジスタを使用して、作成したグラフのショートネームを取得</span>
<span style="color: #000080;">%</span>A <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>H;
</pre>
    </li>

    <li>作成したグラフに別のデータプロットを追加します。ここではプロット先のレイヤを指定します。</li>

    <li style="list-style: none">
      <pre class="lt" style="font-family:monospace;">
plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span>Graph2D<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">126</span><span style="color: #000000;">)</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">202</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span><span style="color: #000080;">%</span>A<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;
</pre>
    </li>

    <li>組み込みテンプレート<b>doubleY</b>を使用して別のグラフを作成します。</li>

    <li style="list-style: none">
      <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// ソースデータワークシートの範囲を定義</span>
range rr <span style="color: #000080;">=</span> <span style="color: #000000;">[</span>Graph2D<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;
<span style="color: #008000;">// 組み込みテンプレート &apos;&apos;&apos;doubleY&apos;&apos;&apos;を使用し、1列目をX、2列目をYとしてグラフの最初の (アクティブな) レイヤに線 + シンボルグラフをプロット</span>
plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span><span style="color: #000000;">(</span>rr<span style="color: #000000;">)</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">)</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">202</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span><span style="color: #000080;">&lt;</span>new template<span style="color: #000000;">:</span><span style="color: #000080;">=</span>doubleY<span style="color: #000080;">&gt;</span><span style="color: #000000;">]</span>;
<span style="color: #008000;">// グラフの2番目のレイヤに折れ線グラフを追加。1列目をX、126列目をYに設定</span>
plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span><span style="color: #000000;">(</span>rr<span style="color: #000000;">)</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">126</span><span style="color: #000000;">)</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span><span style="color: #000080;">!</span>;
<span style="color: #008000;">//新しいグラフの名前を取得し、文字列変数 str1に保存</span>
string str1<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> page.<span style="color: #000080;">name</span><span style="color: #000080;">$</span>;
</pre>
    </li>
  </ol>

  <p><b>3Dグラフ</b></p>

  <ol>
    <li>次のスクリプトを使用して、<i>&lt;Origin EXE&gt;\Samples\Matrix Conversion and Gridding\</i>にあるファイル<b>XYZ Random Gaussian.dat</b>をインポートします。</li>

    <li style="list-style: none">
      <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// 新しいワークブックを作成</span>
newbook;
<span style="color: #008000;">// ファイル名を指定</span>
string str2<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Samples\Matrix Conversion and Gridding\XYZ Random Gaussian.dat&quot;</span>;
<span style="color: #008000;">// ファイルパを含める</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> str2<span style="color: #000080;">$</span>;
<span style="color: #008000;">// XファンクションimpASCでインポート</span>
impASC fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fname<span style="color: #000080;">$</span>;
<span style="color: #008000;">//文字列レジスタを使用してワークブック名​​を取得</span>
<span style="color: #000080;">%</span>B <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>H;
</pre>
    </li>

    <li><a href="../../LabTalk/LabTalk/Wks.Col_(object).html" title="LabTalk:Wks.Col (オブジェクト)">wks.colオブジェクト</a>を使用して、3番目の列をZ列に設定します。</li>

    <li style="list-style: none">
      <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// 保存された文字列レジスタ変数を使って3番目の列をZに設定</span>
<span style="color: #000080;">%</span>B<span style="color: #000080;">!</span>wks.<span style="color: #000080;">col3</span>.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">6</span>;
</pre>
    </li>

    <li>Xファンクション<a class="external text" href="../../XFunction/X-Function/Plotxyz.html">plotxyz</a>で3Dカラーマップ曲面グラフを作成します。</li>

    <li style="list-style: none">
      <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// データワークシートをアクティブにする</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span>B;
<span style="color: #008000;">// 選択したワークシートデータから3Dカラーマップ曲面グラフを作成</span>
plotxyz iz<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">103</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>new template<span style="color: #000000;">:</span><span style="color: #000080;">=</span>glcmap<span style="color: #000080;">&gt;</span>;
<span style="color: #008000;">//グラフウィンドウ名を文字列変数str3に保存</span>
string str3<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> page.<span style="color: #000080;">name</span><span style="color: #000080;">$</span>;
</pre>
    </li>
  </ol>

  <p><b>Note:</b> <a href="../../LabTalk/LabTalk/Worksheet_(command).html#-p.3B_Plot_the_current_worksheet_selection_in_the_nth_graph_type_into_the_template" title="LabTalk:Worksheet (コマンド)">worksheet -pコマンド</a>を使用して2Dグラフと3Dグラフの両方を作成できますが、先に<a href="../../LabTalk/LabTalk/Worksheet_(command).html#-s.3B_Set_the_specified_range_to_be_the_current_worksheet_selection" title="LabTalk:Worksheet (コマンド)">worksheet -s</a>コマンドを使用して目的の入力データ範囲を選択する必要があります。</p>

  <h3><a name="Customize_Graphs"></a><span class="mw-headline">グラフを編集する</span></h3>

  <p>グラフウィンドウは、<a href="../../LabTalk/LabTalk/Page_(object).html" title="LabTalk:Page(オブジェクト)">Page</a>オブジェクトに結びついたビジュアルページで構成されます。各グラフページには、少なくとも1つのビジュアルレイヤと、関連付けられた<a href="../../LabTalk/LabTalk/Layer_(object).html" title="LabTalk:Layer (オブジェクト)">layerオブジェクト</a>が含まれます。グラフレイヤには、layerオブジェクトのサブオブジェクトである<a href="../../LabTalk/LabTalk/Layer.Axis_(object).html" title="LabTalk:Layer.Axis (オブジェクト)">layer.x</a>および<a href="../../LabTalk/LabTalk/Layer.Axis_(object).html" title="LabTalk:Layer.Axis (オブジェクト)">layer.y</a>オブジェクトが関連付けられた一連のXY軸が含まれています。これらのオブジェクトへのLabTalkアクセスにより、ページ、レイヤ、軸のプロパティを制御できます。</p>

  <p>データプロットを編集する場合、<a href="../../LabTalk/Category/Set_(command).html" title="Category:Set (コマンド)">set</a>コマンドを使用できます。グラフ上のテキストオブジェクトを編集場合には、 <a href="../../LabTalk/LabTalk/Label_(command).html" title="LabTalk:Label （コマンド）">label</a>コマンドが役立ちます。</p>

  <p>さらに、<a href="../../LabTalk/Script/LabTalk-Supported_X-Functions.html#Graph_Manipulation" title="Script:LabTalk-Supported X-Functions">グラフを操作</a>するためXファンクションも用意されています。</p>

  <p>前セクションのプロジェクトファイルを引き続き使用していきます。</p>

  <ol>
    <li>次のスクリプトを実行して、作成した最初のグラフの軸タイプを設定します。
      <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">//グラフ ウィンドウをアクティブにする</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span>A;
<span style="color: #008000;">//Y軸のタイプをlog10に変更し、開始値0.003に変更</span>
layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;
layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">from</span> <span style="color: #000080;">=</span> .003;
<span style="color: #008000;">//Y軸のタイトルを&quot;Amplitude&quot;に変更</span>
label <span style="color: #000080;">-</span>yl Amplitude;
<span style="color: #008000;">// X軸とY軸の右側のレイヤを表示</span>
layer.<span style="color: #000080;">x</span>.<span style="color: #000080;">showAxes</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;
layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">showAxes</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;
<span style="color: #008000;">//X軸の主グリッドを破線で表示</span>
layer.<span style="color: #000080;">x</span>.<span style="color: #000080;">showGrids</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
layer.<span style="color: #000080;">x</span>.<span style="color: #000080;">grid</span>.<span style="color: #000080;">majorType</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;
</pre>
    </li>

    <li>次に、setコマンドを使用して2番目のデータプロットを編集します。</li>

    <li style="list-style: none">
      <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">//最初に作成したグラフウィンドウがアクティブであることを確認</span>
<span style="color: #008000;">//既にアクティブになっている場合は、次の行の実行は不要</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span>A;
<span style="color: #008000;">//2番目のデータプロットをアクティブにする</span>
layer.<span style="color: #000080;">plot</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;
<span style="color: #008000;">//シンボルの形状をCross(X)に設定</span>
set <span style="color: #000080;">%</span>C <span style="color: #000080;">-</span>k <span style="color: #0000dd;">7</span>;
<span style="color: #008000;">//プロット線の色を青に設定</span>
set <span style="color: #000080;">%</span>C <span style="color: #000080;">-</span>cl <span style="color: #0000dd;">4</span>;
<span style="color: #008000;">//シンボルの境界色をオリーブに設定</span>
set <span style="color: #000080;">%</span>C <span style="color: #000080;">-</span>cse <span style="color: #0000dd;">12</span>;
</pre>
    </li>

    <li>以下スクリプトを実行して、二重Y軸グラフを編集します。</li>

    <li style="list-style: none">
      <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">//二重Y軸グラフのレイヤ2にある第一データプロットの範囲を宣言</span>
range r2 <span style="color: #000080;">=</span> <span style="color: #000000;">[</span><span style="color: #000080;">%</span><span style="color: #000000;">(</span>str1<span style="color: #000080;">$</span><span style="color: #000000;">)</span><span style="color: #000000;">]</span><span style="color: #0000dd;">2</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span>;
<span style="color: #008000;">//線を破線に設定</span>
set r2 <span style="color: #000080;">-</span>d <span style="color: #0000dd;">1</span>;
<span style="color: #008000;">//二重Y軸グラフのウィンドウをアクティブにして、変化を表示</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">(</span>str1<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;
</pre>
    </li>

    <li>Xファンクション<a class="external text" href="../../XFunction/X-Function/Legendupdate.html">legendupdate</a> を使用して、二重Y軸グラフの凡例を更新します。</li>

    <li style="list-style: none">
      <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">//元データのワークシート範囲を事前定義</span>
range rw<span style="color: #000080;">=</span><span style="color: #000000;">[</span>Graph2D<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;
<span style="color: #008000;">//最初に作成したグラフウィンドウがアクティブであることを確認</span>
<span style="color: #008000;">//既にアクティブになっている場合は、次の行の実行は不要</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">(</span>str1<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;
<span style="color: #008000;">//Xファンクションlegendupdateで凡例を更新</span>
<span style="color: #008000;">//凡例は最初のユーザ定義パラメータの名前 + 値</span>
<span style="color: #008000;">//@LD1 は最初のユーザ定義パラメーター</span>
legendupdate mode<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">7</span> custom<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;%(rw.UserParam1$)-@LD1&quot;</span>;
</pre>
    </li>

    <li><a href="../../LabTalk/LabTalk/Layer_(command).html#-3d_r.3B_set_the_3D_graph_rotation" title="LabTalk:レイヤ(コマンド)">layer -3d r</a> コマンドで3Dグラフを回転します。</li>

    <li style="list-style: none">
      <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">//先ほど作成した3Dプロットのグラフウィンドウをアクティブに</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">(</span>str3<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;
<span style="color: #008000;">//垂直方向に90度回転</span>
layer <span style="color: #000080;">-</span>3d r V <span style="color: #0000dd;">90</span>;
<span style="color: #008000;">//リフレッシュしてグラフ表示を確認</span>
doc <span style="color: #000080;">-</span>uw;
</pre>
    </li>
  </ol>

  <h3><a name="Export_Graphs"></a><span class="mw-headline">グラフエクスポート</span></h3>

  <p><b>画像としてエクスポート</b></p>

  <p>Xファンクション<a class="external text" href="../../XFunction/X-Function/ExpGraph.html">expGraph</a>を呼び出して、1つまたは複数のグラフを画像ファイルにエクスポートできます。画像ののエクスポート設定を制御するには、<a class="external text" href="../../UserGuide/UserGuide/The_Export_Graph_Dialog_Box.html#tr1">tr1</a>または<a class="external text" href="../../UserGuide/UserGuide/The_Export_Graph_Dialog_Box.html#tr2">tr2</a>ツリーを使用できます。</p>

  <ul>
    <li>次のスクリプトを使用して、現在のプロジェクトのすべてのグラフをイメージとしてユーザファイルフォルダ (%Y 文字列レジスタに保存されているパス) にエクスポートし、幅を600ピクセル、DPI解像度を100、圧縮方式をLZWに設定します。エクスポートされたファイル名は、グラフウィンドウのロングネームとシステム日時の組み合わせで設定されます。</li>

    <li style="list-style: none">
      <pre class="lt" style="font-family:monospace;">
doc <span style="color: #000080;">-</span>e P
<span style="color: #000000;">{</span>
expGraph type<span style="color: #000000;">:</span><span style="color: #000080;">=</span>pdf filename<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;&lt;long name&gt;-$(System.Date(),D11)&quot;</span> path<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span>Y
     tr.<span style="color: #000080;">Margin</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> 
     tr1.<span style="color: #000080;">Unit</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> 
     tr1.<span style="color: #000080;">Width</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">600</span> 
     tr2.<span style="color: #000080;">TIF</span>.<span style="color: #000080;">DotsPerInch</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">100</span>
     tr2.<span style="color: #000080;">TIF</span>.<span style="color: #000080;">Compression</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span>LZW;
<span style="color: #000000;">}</span>
</pre>
    </li>
  </ul>

  <table class="noborder">
    <tr>
      <td style="vertical-align:top" width="60"><img src="../images/Tutorial_Graphing_and_Exporting_with_Labtalk/Tip_icon.png" width="57" border="0" alt=""></td>

      <td>
        <p>スクリプトの記述を簡素化するには、 <b>expGraph</b>ダイアログ (<b>ファイル:グラフエクスポート</b>)を開き、ダイアログの設定を変更して、<b>ダイアログテーマ</b>の横にある三角形のボタンをクリックし、<b>スクリプトの生成</b>を選択して、同じ設定でLabTalkスクリプトを生成します。</p>
      </td>
    </tr>
  </table>

  <p><b>動画のエクスポート</b></p>

  <p><a href="../../LabTalk/LabTalk/Vw_(object).html" title="LabTalk:Vw (object)">vw</a>オブジェクトを使用して、グラフを動画としてエクスポートできます。</p>

  <ul>
    <li>以下のスクリプトを実行して励起波長の増加に伴うスペクトル形状の変化を示す動画をエクスポートします。<b>Graph2D</b> ワークブックのデータを使用します。</li>

    <li style="list-style: none">
      <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// MPEG4の圧縮方式を定義</span>
int codec <span style="color: #000080;">=</span> vw.<span style="color: #000080;">FourCC</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&apos;F&apos;</span>,<span style="color: #ff00ff;">&apos;M&apos;</span>,<span style="color: #ff00ff;">&apos;P&apos;</span>,<span style="color: #ff00ff;">&apos;4&apos;</span><span style="color: #000000;">)</span>; 
<span style="color: #008000;">//この圧縮方法がサポートされているかどうかを確認</span>
<span style="color: #008000;">//サポートされていない場合、圧縮は使用されない</span>
if<span style="color: #000000;">(</span>vw.<span style="color: #000080;">IsCodecInstalled</span><span style="color: #000000;">(</span>codec<span style="color: #000000;">)</span> <span style="color: #000080;">==</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> 
codec <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; 
 
<span style="color: #008000;">//動画ファイル名を&apos;&apos;&lt;User Files Folder&gt;\test.avi&apos;&apos;で定義</span>
<span style="color: #008000;">//文字列レジスタ %Z を使用して、ファイル パスと名前を保存</span>
<span style="color: #000080;">%</span>Z <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>Ytest.<span style="color: #000080;">avi</span>;
<span style="color: #008000;">// ビデオ ライターを作成(fileName, codec, framesPerSec, width, height)</span>
int err <span style="color: #000080;">=</span> vw.<span style="color: #000080;">Create</span><span style="color: #000000;">(</span><span style="color: #000080;">%</span>Z, codec, <span style="color: #0000dd;">8</span>, <span style="color: #0000dd;">1024</span>, <span style="color: #0000dd;">768</span><span style="color: #000000;">)</span>;
if<span style="color: #000000;">(</span> <span style="color: #0000dd;">0</span> <span style="color: #000080;">==</span> err <span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
       <span style="color: #008000;">//ソースデータワークシートの範囲を定義</span>
        win <span style="color: #000080;">-</span>a Graph2D;
        range rw1 <span style="color: #000080;">=</span> <span style="color: #000000;">[</span>Graph2D<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;
       <span style="color: #008000;">//最初のグラフを作成</span>
        plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span><span style="color: #000000;">(</span>rw1<span style="color: #000000;">)</span><span style="color: #0000dd;">2</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span>;
       <span style="color: #008000;">//Y軸のスケールと増分を編集</span>
        layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">to</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3250</span>;
        layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">inc</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">500</span>;
        <span style="color: #008000;">//凡例を更新</span>
        legendupdate mode<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">7</span> custom<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;%(rw1.UserParam1$)-@LD1&quot;</span>;
        <span style="color: #008000;">// 凡例を配置</span>
        legend.<span style="color: #000080;">y</span> <span style="color: #000080;">=</span> layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">to</span>;
        legend.<span style="color: #000080;">x</span> <span style="color: #000080;">=</span> layer.<span style="color: #000080;">x</span>.<span style="color: #000080;">to</span> <span style="color: #000080;">-</span> legend.<span style="color: #000080;">dx</span> <span style="color: #000080;">/</span> <span style="color: #0000dd;">2</span>;
        <span style="color: #008000;">//ループを使用して、グラフ内のプロットデータを置き換え</span>
        <span style="color: #008000;">//各グラフをビデオのフレームとして追加 </span>
        for<span style="color: #000000;">(</span>int a<span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>; a<span style="color: #000080;">&lt;=</span>rw1.<span style="color: #000080;">nCols</span>; a<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
        <span style="color: #000000;">{</span>
               <span style="color: #008000;">//現在表示されているデータセットの範囲を定義</span>
               range ra <span style="color: #000080;">=</span> <span style="color: #000080;">%</span><span style="color: #000000;">(</span>rw1<span style="color: #000000;">)</span>col<span style="color: #000000;">(</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>a<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
               <span style="color: #008000;">//新しいデータセットの範囲を定義</span>
                range rb <span style="color: #000080;">=</span> <span style="color: #000080;">%</span><span style="color: #000000;">(</span>rw1<span style="color: #000000;">)</span>col<span style="color: #000000;">(</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>a<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
                <span style="color: #008000;">//現在のデータプロットをクリア</span>
                layer <span style="color: #000080;">-</span>e ra;
               <span style="color: #008000;">//新しいデータセットをグラフに追加</span>
                layer <span style="color: #000080;">-</span>i rb;
               <span style="color: #008000;">//Y軸のタイトルを変更</span>
                label <span style="color: #000080;">-</span>yl Amplitude;
               <span style="color: #008000;">//グラフをリフレッシュ</span>
              doc <span style="color: #000080;">-</span>uw;
         <span style="color: #008000;">//グラフ ウィンドウ再描画を待つ</span>
        <span style="color: #008000;">// これにより動画ファイル作成中に動画を確認できる</span>
        sec <span style="color: #000080;">-</span>pw <span style="color: #000080;">%</span>h;
        <span style="color: #008000;">// 各グラフを2フレームとして動画に書き込み</span>
        err <span style="color: #000080;">=</span> vw.<span style="color: #000080;">WriteGraph</span><span style="color: #000000;">(</span><span style="color: #000080;">%</span>h,<span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>;
        if<span style="color: #000000;">(</span> err <span style="color: #000000;">)</span>
                    break;
        <span style="color: #000000;">}</span>
 
        <span style="color: #008000;">//ビデオライターをリリース</span>
        vw.<span style="color: #000080;">Release</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
 
        if<span style="color: #000000;">(</span> err <span style="color: #000000;">)</span>
                type <span style="color: #ff00ff;">&quot;WriteGraph error $(err)&quot;</span>;
<span style="color: #000000;">}</span>
else
        type <span style="color: #ff00ff;">&quot;VideoWriter Create error $(err).&quot;</span>;
</pre>
    </li>
  </ul>
