<h1 class="firstheading">カーブフィット</h1>

  <p class='urlname' style='display: none'>Curve-Fitting</p>

  <div id="toc" class="toc">
    <div id="toctitle">
      <h2>目次</h2>
    </div>

    <ul>
      <li class="toclevel-1 tocsection-1">
        <a href="#Linear_Fit"><span class="tocnumber">1</span> <span class="toctext">線形フィット</span></a>

        <ul>
          <li class="toclevel-2 tocsection-2"><a href="#Fit_XYYYY_Data_and_Plot_Each_Fit_in_Separate_Window"><span class="tocnumber">1.1</span> <span class="toctext">XYYYYデータをフィットして各フィット線を別ウィンドウに作図</span></a></li>

          <li class="toclevel-2 tocsection-3"><a href="#US_Total_Population"><span class="tocnumber">1.2</span> <span class="toctext">US人口の合計</span></a></li>

          <li class="toclevel-2 tocsection-4"><a href="#Get_and_Change_Existing_Linear_Fit_Operation"><span class="tocnumber">1.3</span> <span class="toctext">既存の線形フィット操作の取得と変更</span></a></li>

          <li class="toclevel-2 tocsection-5"><a href="#Apparent_Linear_Fit_with_xop_X-Function_and_Get_Result_Tree"><span class="tocnumber">1.4</span> <span class="toctext">Xファンクションxopで図上値でフィットし結果ツリーを取得</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-6"><a href="#Perform_Linear_Regression_from_a_graph"><span class="tocnumber">2</span> <span class="toctext">グラフで線形フィットを実行</span></a></li>

      <li class="toclevel-1 tocsection-7">
        <a href="#Polynomial_Fit"><span class="tocnumber">3</span> <span class="toctext">多項式フィット</span></a>

        <ul>
          <li class="toclevel-2 tocsection-8"><a href="#Time_Series_Data.2C_Fitting_the_RMB_Exchange_Rate"><span class="tocnumber">3.1</span> <span class="toctext">時系列データ、人民元為替レートのフィット</span></a></li>

          <li class="toclevel-2 tocsection-9"><a href="#Polynomial_Fit_with_xop_X-Function_and_Get_Result_Tree"><span class="tocnumber">3.2</span> <span class="toctext">Xファンクションxopで多項式フィットし結果ツリーを取得</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-10">
        <a href="#Multiple_Linear_Regression"><span class="tocnumber">4</span> <span class="toctext">重回帰</span></a>

        <ul>
          <li class="toclevel-2 tocsection-11"><a href="#Composite_Spectrum_Fitting_with_Multiple_Components"><span class="tocnumber">4.1</span> <span class="toctext">複数成分の複合スペクトルのフィット</span></a></li>

          <li class="toclevel-2 tocsection-12"><a href="#Multiple_Linear_Regression_with_xop_X-Function_and_Get_Result_Tree"><span class="tocnumber">4.2</span> <span class="toctext">Xファンクションxopで重回帰して結果ツリーを取得</span></a></li>
        </ul>
      </li>

      <li class="toclevel-1 tocsection-13">
        <a href="#Nonlinear_Fit"><span class="tocnumber">5</span> <span class="toctext">非線形曲線フィット</span></a>

        <ul>
          <li class="toclevel-2 tocsection-14"><a href="#Predicting_Further_Strengthening_of_the_Chinese_Currency"><span class="tocnumber">5.1</span> <span class="toctext">人民元の高騰を予測</span></a></li>

          <li class="toclevel-2 tocsection-15"><a href="#Fit_Multiple_Peaks_with_Replica"><span class="tocnumber">5.2</span> <span class="toctext">複製による複数ピークフィット</span></a></li>

          <li class="toclevel-2 tocsection-16"><a href="#Global_Fit_with_Parameter_Sharing_on_Plot_Segments"><span class="tocnumber">5.3</span> <span class="toctext">グラフの部分範囲でパラメータを共有したグローバルフィット</span></a></li>

          <li class="toclevel-2 tocsection-17"><a href="#Creating_Multiple_Simulated_Curves_With_a_User-Defined_Fitting_Function"><span class="tocnumber">5.4</span> <span class="toctext">ユーザ定義のフィット関数で複数のシミュレーション曲線を作成</span></a></li>

          <li class="toclevel-2 tocsection-18">
            <a href="#Fit_Parameter_Rearrangement_in_Post_Fit_Worsksheet_Script"><span class="tocnumber">5.5</span> <span class="toctext">ワークシートスクリプトでフィットパラメータの再構成</span></a>

            <ul>
              <li class="toclevel-3 tocsection-19"><a href="#Worksheet_Script"><span class="tocnumber">5.5.1</span> <span class="toctext">ワークシートスクリプト</span></a></li>

              <li class="toclevel-3 tocsection-20"><a href="#Setting_up_the_Analysis_Template"><span class="tocnumber">5.5.2</span> <span class="toctext">分析テンプレートのセットアップ</span></a></li>
            </ul>
          </li>

          <li class="toclevel-2 tocsection-21"><a href="#Fit_Multiple_Columns_in_a_Worksheet"><span class="tocnumber">5.6</span> <span class="toctext">ワークシートの複数列をフィット</span></a></li>

          <li class="toclevel-2 tocsection-22"><a href="#Change_Parameters_of_an_Existing_Operation"><span class="tocnumber">5.7</span> <span class="toctext">既存オペレーションのパラメータを変更</span></a></li>
        </ul>
      </li>
    </ul>
  </div>

  <h2><a name="Linear_Fit"></a><span class="mw-headline">線形フィット</span></h2>

  <h3><a name="Fit_XYYYY_Data_and_Plot_Each_Fit_in_Separate_Window"></a><span class="mw-headline">XYYYYデータをフィットして各フィット線を別ウィンドウに作図</span></h3>

  <p>次のコードは、第1シートにXYYYY形式のデータを持つアクティブブックに対して動作します。結果のフィット線は新しく作成されたシートに追加されます。このフィットデータを使用してグラフを作成します。</p>
  <pre class="lt" style="font-family:monospace;">
string mybk<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>H;  <span style="color: #008000;">// アクティブワークブック名を保存</span>
newsheet name<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitLines outname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitLines<span style="color: #000080;">$</span> cols<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// フィットデータを保持するシートを追加</span>
range aa <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;  <span style="color: #008000;">// 最初のシート。1つのデータシートのみと仮定</span>
range bb <span style="color: #000080;">=</span> <span style="color: #000080;">%</span><span style="color: #000000;">(</span>FitLines<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 新しく追加されたシートの名前を変数FitLines$に保存</span>
bb.<span style="color: #000080;">nCols</span> <span style="color: #000080;">=</span> aa.<span style="color: #000080;">nCols</span>;  <span style="color: #008000;">// 追加したシートに新しい列を追加</span>
<span style="color: #008000;">// 全ての列にループして線形フィットを実行し、結果を新しいシートに出力</span>
<span style="color: #008000;">//  Xファンクションfitlrを使用</span>
dataset slopes, intercepts;  <span style="color: #008000;">// フィット結果のパラメータを保存</span>
slopes.<span style="color: #000080;">SetSize</span><span style="color: #000000;">(</span>aa.<span style="color: #000080;">nCols</span><span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// データワークシートのYの数</span>
intercepts.<span style="color: #000080;">SetSize</span><span style="color: #000000;">(</span>slopes.<span style="color: #000080;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 後で使用</span>
loop<span style="color: #000000;">(</span>ii, <span style="color: #0000dd;">2</span>, aa.<span style="color: #000080;">nCols</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        range dd <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
        fitlr iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span>dd oy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span><span style="color: #000000;">(</span>FitLines<span style="color: #000080;">$</span><span style="color: #000000;">)</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, wcol<span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
        slopes<span style="color: #000000;">[</span>ii<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> fitlr.<span style="color: #000080;">b</span>;  <span style="color: #008000;">// 2からループするのでii-1</span>
        intercepts<span style="color: #000000;">[</span>ii<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> fitlr.<span style="color: #000080;">a</span>;
<span style="color: #000000;">}</span>
<span style="color: #008000;">// 全ソースデータとフィットデータをプロット</span>
<span style="color: #008000;">// 名前と傾きを表示するラベルを追加</span>
loop<span style="color: #000000;">(</span>ii, <span style="color: #0000dd;">2</span>, aa.<span style="color: #000080;">nCols</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        range data <span style="color: #000080;">=</span> <span style="color: #000000;">[</span>mybk<span style="color: #000080;">$</span><span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, wcol<span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
        range fit <span style="color: #000080;">=</span> <span style="color: #000080;">%</span><span style="color: #000000;">(</span>FitLines<span style="color: #000080;">$</span><span style="color: #000000;">)</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, wcol<span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
        win <span style="color: #000080;">-</span>t plot;  <span style="color: #008000;">// 新しいグラフウィンドウを作成</span>
        plotxy data plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">201</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>active<span style="color: #000080;">&gt;</span>;  <span style="color: #008000;">// ソースデータを散布図として作図</span>
        plotxy fit plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> color<span style="color: #000000;">:</span><span style="color: #000080;">=</span>color<span style="color: #000000;">(</span>red<span style="color: #000000;">)</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>active<span style="color: #000080;">&gt;</span>;  <span style="color: #008000;">// フィットデータを赤い線で作図</span>
        label <span style="color: #000080;">-</span>r legend;  <span style="color: #008000;">// 凡例は不要なので削除</span>
        label <span style="color: #000080;">-</span>s <span style="color: #000080;">-</span>q <span style="color: #0000dd;">2</span> <span style="color: #000080;">-</span>n myLabel1 <span style="color: #ff00ff;">&quot;Linear Fit to %(1, @LM)%(CRLF)slope=$(slopes[ii-1])&quot;</span>;
<span style="color: #000000;">}</span>
</pre>

  <h3><a name="US_Total_Population"></a><span class="mw-headline">US人口の合計</span></h3>

  <p>以下のスクリプトは、1950年からのアメリカの人口データをフィットして人口が4億を超える年はいつかを調べます。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// アメリカの人口データをSPウェブサイトから取得</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;%YUSpop.txt&quot;</span>;
string url<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;https://research.stlouisfed.org/fred2/data/POP.txt&quot;</span>;
web2file;
if<span style="color: #000000;">(</span>exist<span style="color: #000000;">(</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">)</span> <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        type <span style="color: #ff00ff;">&quot;failed to get &quot;</span> <span style="color: #000080;">+</span> url<span style="color: #000080;">$</span>;
        return <span style="color: #0000dd;">0</span>;
<span style="color: #000000;">}</span>
<span style="color: #008000;">// プロジェクトをクリアして空のスペースから開始</span>
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">{</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">}</span>
newbook s<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> name<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;US Population&quot;</span>;
<span style="color: #008000;">// データをインポート</span>
impAsc options.<span style="color: #000080;">sparklines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> options.<span style="color: #000080;">Miscellaneous</span>.<span style="color: #000080;">AllowAllText</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
wks.<span style="color: #000080;">nCols</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">7</span>;
wks.<span style="color: #000080;">Labels</span><span style="color: #000000;">(</span>LU<span style="color: #000000;">)</span>;
range aa <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>, bb <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>, yr <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>, pop <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>, param <span style="color: #000080;">=</span> <span style="color: #0000dd;">5</span>, fitx <span style="color: #000080;">=</span> <span style="color: #0000dd;">6</span>, fity <span style="color: #000080;">=</span> <span style="color: #0000dd;">7</span>;
int nMonths <span style="color: #000080;">=</span> aa.<span style="color: #000080;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
yr.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// X</span>
yr<span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Year&quot;</span>;
pop<span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;US Population&quot;</span>;
pop<span style="color: #000000;">[</span>U<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Thousands&quot;</span>;
fitx.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;
fitx<span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;LR Fit X&quot;</span>;
fity<span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;LR Fit Y&quot;</span>;

int nYears <span style="color: #000080;">=</span> nMonths<span style="color: #000080;">/</span><span style="color: #0000dd;">12</span>;  <span style="color: #008000;">// インポートされた月毎のデータから年数を取得</span>
<span style="color: #008000;">// 四月のデータをその年の人口として取得</span>
for<span style="color: #000000;">(</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">16</span>, jj <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ii <span style="color: #000080;">&lt;=</span> nMonths; ii<span style="color: #000080;">+</span><span style="color: #000080;">=</span><span style="color: #0000dd;">12</span>, jj<span style="color: #000080;">++</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        string str<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> aa<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span><span style="color: #000080;">$</span>;
        string strYear<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> str.<span style="color: #000080;">left</span><span style="color: #000000;">(</span><span style="color: #0000dd;">4</span><span style="color: #000000;">)</span><span style="color: #000080;">$</span>;
        yr<span style="color: #000000;">[</span>jj<span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span><span style="color: #000000;">(</span>strYear<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;
        pop<span style="color: #000000;">[</span>jj<span style="color: #000000;">]</span> <span style="color: #000080;">=</span> bb<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span>;
<span style="color: #000000;">}</span>
plotxy pop plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">201</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span><span style="color: #000000;">]</span>;
y2 <span style="color: #000080;">=</span> <span style="color: #0000dd;">405000</span>;  <span style="color: #008000;">// 4億を少し超える数字</span>
x2 <span style="color: #000080;">=</span> <span style="color: #0000dd;">2060</span>;
fitlr;  <span style="color: #008000;">// アクティブグラフのアクティブプロットをフィット</span>
fitx <span style="color: #000080;">=</span> data<span style="color: #000000;">(</span>x1, x2<span style="color: #000000;">)</span>;  <span style="color: #008000;">// 増分1 = 1年</span>
fity <span style="color: #000080;">=</span> fitlr.<span style="color: #000080;">a</span><span style="color: #000080;">+</span>fitlr.<span style="color: #000080;">b</span><span style="color: #000080;">*</span>fitx;
param<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> fitlr.<span style="color: #000080;">a</span>;
param<span style="color: #000000;">[</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> fitlr.<span style="color: #000080;">b</span>;
plotxy fity <span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;  <span style="color: #008000;">// デフォルトXを使ってフィットYデータを再スケールせずにレイヤ１に追加</span>
<span style="color: #008000;">// 4億の位置に垂線を引く</span>
double yy <span style="color: #000080;">=</span> <span style="color: #0000dd;">400000</span>;
double xx <span style="color: #000080;">=</span> <span style="color: #000000;">(</span>yy<span style="color: #000080;">-</span>fitlr.<span style="color: #000080;">a</span><span style="color: #000000;">)</span><span style="color: #000080;">/</span>fitlr.<span style="color: #000080;">b</span>;
type <span style="color: #ff00ff;">&quot;US Population will reach 400M at year $(xx, %d)&quot;</span>;
draw <span style="color: #000080;">-</span>l <span style="color: #000080;">-</span>v xx;
<span style="color: #008000;">// 凡例は不要なので削除</span>
label <span style="color: #000080;">-</span>r legend;
</pre>

  <h3><a name="Get_and_Change_Existing_Linear_Fit_Operation"></a><span class="mw-headline">既存の線形フィット操作の取得と変更</span></h3>

  <p>ここでは、既存の線形フィット操作を取得し、いくつかの設定を変更して更新します。この操作はGUIでの、鍵アイコンをクリックしてパラメータの変更を選択し、設定を変更する操作に相当します。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// 線形フィットの分析テンプレートを開く</span>
string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Linear Regression.ogw&quot;</span>;
doc <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">(</span>path<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;

<span style="color: #008000;">// テンプレートの&quot;Data&quot;シートをアクティブにし、サンプルデータファイルをインポート</span>
page.<span style="color: #000080;">active</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Data&quot;</span>;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Sensor01.dat&quot;</span>;
impasc;

<span style="color: #008000;">// 線形フィットのレポートシートからオペレーションツリーを取得</span>
op_change ir<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitLinear1<span style="color: #000080;">!</span> tr<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mytree;

<span style="color: #008000;">// 切片を0に固定</span>
mytree.<span style="color: #000080;">gui</span>.<span style="color: #000080;">fit</span>.<span style="color: #000080;">FixIntercept</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
mytree.<span style="color: #000080;">gui</span>.<span style="color: #000080;">fit</span>.<span style="color: #000080;">FixInterceptAt</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;

<span style="color: #008000;">// 変更した設定で再計算</span>
op_change ir<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitLinear1<span style="color: #000080;">!</span> tr<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mytree op<span style="color: #000000;">:</span><span style="color: #000080;">=</span>run;
</pre>

  <h3><a name="Apparent_Linear_Fit_with_xop_X-Function_and_Get_Result_Tree"></a><span class="mw-headline">Xファンクションxopで図上値でフィットし結果ツリーを取得</span></h3>

  <p>Xファンクション<b>xop</b>を使って、GUIツリーの作成、パラメータの設定、フィットの実行、結果ツリーの生成、出力結果ツリーから結果の出力などの操作を含めた図上値でフィットを実行します。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// サンプルデータを開いてグラフを作成</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Apparent Fit.dat&quot;</span>;
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">{</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">}</span>;  <span style="color: #008000;">// プロジェクトをクリアして空のスペースで開始</span>
newbook result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>apparentfit<span style="color: #000080;">$</span>;  <span style="color: #008000;">// データ用のワークブックを作成</span>
impasc;  <span style="color: #008000;">// データをインポート</span>
plotxy <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 散布図を作成</span>
layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// Y軸のタイプをLog10にする</span>
layer <span style="color: #000080;">-</span>a;  <span style="color: #008000;">// レイヤを再スケール</span>

<span style="color: #008000;">// FitLinearクラスを使ってGUIツリー&quot;lrGUI&quot;を作成</span>
tree lrGUI;
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>init classname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitLinear iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lrGUI;
<span style="color: #008000;">// アクティブプロットのデータを使用</span>
<span style="color: #008000;">// 図上値のフィットをセット</span>
lrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">Fit</span>.<span style="color: #000080;">ApparentFit</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
<span style="color: #008000;">// フィットを実行して結果をツリー&quot;lrOut&quot;に取得</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>run iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lrGUI otrresult<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lrOut;
<span style="color: #008000;">// フィット後にオペレーションオブジェクトをクリーンナップ</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cleanup;

<span style="color: #008000;">// 出力ツリーから結果を取得して印字</span>
type <span style="color: #ff00ff;">&quot;The fitted result is:&quot;</span>;
type <span style="color: #ff00ff;">&quot;A = $(lrOut.Summary.R1.Intercept_Value), Error = $(lrOut.Summary.R1.Intercept_Error)&quot;</span>;
type <span style="color: #ff00ff;">&quot;B = $(lrOut.Summary.R1.Slope_Value), Error = $(lrOut.Summary.R1.Slope_Error)&quot;</span>;
type <span style="color: #ff00ff;">&quot;Forumla is:&quot;</span>;
type <span style="color: #ff00ff;">&quot;y = $(lrOut.Summary.R1.Slope_Value, %3.2f)x + $(lrOut.Summary.R1.Intercept_Value, %3.2f)&quot;</span>;
</pre>

  <h2><a name="Perform_Linear_Regression_from_a_graph"></a><span class="mw-headline">グラフで線形フィットを実行</span></h2>

  <p>1つのレイヤに複数データプロットのあるグラフで線形フィットを実行します。そして、グラフにすべてのフィット線を作成し、レポート表を作成します。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// 最初にデータをインポート</span>
filename<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Linear Fit.dat&quot;</span>; 
newbook;
impASC filename<span style="color: #000080;">$</span>;
 
 
<span style="color: #008000;">//グラフを作成</span>
range data <span style="color: #000080;">=</span> <span style="color: #000000;">[</span><span style="color: #000080;">&lt;</span>active<span style="color: #000080;">&gt;</span><span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">:</span> wcol<span style="color: #000000;">(</span>wks.<span style="color: #000080;">ncols</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
plotxy data plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">201</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>active<span style="color: #000080;">&gt;</span>;  <span style="color: #008000;">// ソースデータを散布図としてプロット</span>
 
 
<span style="color: #008000;">//FitLinearクラスを使用してGUIツリー&quot;lrGUI&quot;を作成する</span>
tree lrGUI;  
<span style="color: #008000;">// GUIツリーをFitLinearクラスと初期化</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>init classname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitLinear iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lrGUI;
 
<span style="color: #008000;">//グラフ上のすべてのデータプロットをGUIツリーの入力データとして指定</span>
ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
doc <span style="color: #000080;">-</span>e d <span style="color: #008000;">//アクティブレイヤの全プロットにループ</span>
<span style="color: #000000;">{</span>
        <span style="color: #000080;">%</span>A <span style="color: #000080;">=</span>  xof<span style="color: #000000;">(</span><span style="color: #000080;">%</span>C<span style="color: #000000;">)</span>;   <span style="color: #008000;">//XYデータセットを指定</span>
        lrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span>.<span style="color: #000080;">X</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>A;
        lrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span>.<span style="color: #000080;">Y</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>C;       
        range rPlot <span style="color: #000080;">=</span> <span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span>; <span style="color: #008000;">//各データプロットをRange変数で定義</span>
        int uid <span style="color: #000080;">=</span> range2uid<span style="color: #000000;">(</span>rPlot<span style="color: #000000;">)</span>; <span style="color: #008000;">//get the uid of the range</span>
        lrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span>.<span style="color: #000080;">SetAttribute</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;PlotObjUID&quot;</span>, <span style="color: #000080;">$</span><span style="color: #000000;">(</span>uid<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// uidをプロットにセット</span>
        ii <span style="color: #000080;">=</span> ii <span style="color: #000080;">+</span> <span style="color: #0000dd;">1</span>;
<span style="color: #000000;">}</span>
<span style="color: #008000;">// 線形フィットを実行してGUIツリーのレポートを生成</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>report iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lrGUI;
<span style="color: #008000;">// フィット後に線形フィットのオペレーションオブジェクトをクリーンナップ</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cleanup;
</pre>

  <h2><a name="Polynomial_Fit"></a><span class="mw-headline">多項式フィット</span></h2>

  <h3><a name="Time_Series_Data.2C_Fitting_the_RMB_Exchange_Rate"></a><span class="mw-headline">時系列データ、人民元為替レートのフィット</span></h3>

  <p>X列に日付が含まれている場合、内部的にユリウス日であるため、非常に大きな数値になります。内部的に、特殊なコードを使用してデータをシフトし、数値計算の丸めを最小限に抑えて適切なフィットが可能です。この例では、2010年以前の人民元対米ドルの為替レートへのフィットを行います。</p>

  <p><font color="red"><b>次のスクリプトでは、OSの日付形式が MM/dd/yyyy (例：7/22/2005) である必要があります</b></font></p>

  <p><a class="image"><img alt="RMB Exchange.png" src="../images/Curve_Fitting/RMB_Exchange.png" width="317"></a></p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// SP Web サイトからファイルを取得</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;%YDEXCHUS.txt&quot;</span>;
string url<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;https://research.stlouisfed.org/fred2/data/DEXCHUS.txt&quot;</span>;
web2file;
if<span style="color: #000000;">(</span>exist<span style="color: #000000;">(</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">)</span> <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        type <span style="color: #ff00ff;">&quot;Failed to get &quot;</span> <span style="color: #000080;">+</span> url<span style="color: #000080;">$</span>;
        return <span style="color: #0000dd;">0</span>;
<span style="color: #000000;">}</span>
<span style="color: #008000;">// プロジェクトをクリーンアップして空のスペースから開始</span>
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">{</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">}</span>
newbook sheet<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
impAsc options.<span style="color: #000080;">sparklines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
wks.<span style="color: #000080;">col1</span>.<span style="color: #000080;">setFormat</span><span style="color: #000000;">(</span><span style="color: #0000dd;">4</span>, <span style="color: #0000dd;">22</span>, yyyy<span style="color: #ff00ff;">&apos;-&apos;</span>MM<span style="color: #ff00ff;">&apos;-&apos;</span>dd<span style="color: #000000;">)</span>;
range dd <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>, val <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;
dd<span style="color: #000000;">[</span>C<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Date&quot;</span>; val<span style="color: #000000;">[</span>C<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;RMB vs USD&quot;</span>;
<span style="color: #008000;">// 誤った場所にインポートされた単位とロングネームのクリア</span>
dd<span style="color: #000000;">[</span>U<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;&quot;</span>; val<span style="color: #000000;">[</span>U<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;&quot;</span>;
dd<span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Date&quot;</span>; val<span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Rate&quot;</span>;
dd.<span style="color: #000080;">width</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">9</span>; val.<span style="color: #000080;">width</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">7</span>;
wks.<span style="color: #000080;">labels</span><span style="color: #000000;">(</span>LC<span style="color: #000000;">)</span>;

<span style="color: #008000;">// 多項式フィットを格納するワークシートをセットアップ</span>
<span style="color: #008000;">// 範囲変数をセットアップし全てを1つのワークシートに格納</span>
range coef <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>, fitx <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>, fity <span style="color: #000080;">=</span> <span style="color: #0000dd;">5</span>, fitplot <span style="color: #000080;">=</span> <span style="color: #000000;">(</span><span style="color: #0000dd;">4</span>, <span style="color: #0000dd;">5</span><span style="color: #000000;">)</span>;
fitx <span style="color: #000080;">=</span> data<span style="color: #000000;">(</span>date<span style="color: #000000;">(</span><span style="color: #0000dd;">9</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2005</span><span style="color: #000000;">)</span>, date<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2010</span><span style="color: #000000;">)</span>, <span style="color: #0000dd;">90</span><span style="color: #000000;">)</span>;
fity <span style="color: #000080;">=</span> fitx;  <span style="color: #008000;">// 列作成のためにデータを入力</span>
fitx.<span style="color: #000080;">format</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// 日付</span>
d0 <span style="color: #000080;">=</span> date<span style="color: #000000;">(</span><span style="color: #0000dd;">7</span><span style="color: #000080;">/</span><span style="color: #0000dd;">22</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2005</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// X (日付) 範囲の開始位置</span>
d1 <span style="color: #000080;">=</span> date<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">4</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2010</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// X (日付) 範囲の終了位置</span>
ii <span style="color: #000080;">=</span> list<span style="color: #000000;">(</span>d0, col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 対応する行</span>
jj <span style="color: #000080;">=</span> list<span style="color: #000000;">(</span>d1, col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 対応する行を検索</span>
<span style="color: #008000;">// 3次多項式でフィットし、係数のみを取得</span>
fitpoly <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">)</span><span style="color: #000000;">[</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span><span style="color: #000000;">:</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>jj<span style="color: #000000;">)</span><span style="color: #000000;">]</span> <span style="color: #0000dd;">3</span> coef<span style="color: #000000;">:</span><span style="color: #000080;">=</span>coef;
fity <span style="color: #000080;">=</span> poly<span style="color: #000000;">(</span>fitx, coef<span style="color: #000000;">)</span>;

<span style="color: #008000;">// 適切なラベルを付けて、プロット</span>
fitx.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// X列。実際にはプロットには必要ありませんが、ワークシートに表示されると便利</span>
fity<span style="color: #000000;">[</span>C<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;3rd order polynomial fit&quot;</span>;
plotxy <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">)</span> <span style="color: #0000dd;">200</span>;
x1 <span style="color: #000080;">=</span> d0<span style="color: #000080;">-</span><span style="color: #0000dd;">10</span>; x2 <span style="color: #000080;">=</span> date<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2010</span><span style="color: #000000;">)</span>; x3 <span style="color: #000080;">=</span> <span style="color: #0000dd;">365</span>;  <span style="color: #008000;">// 1年ずつ</span>
y1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">5</span>; y2 <span style="color: #000080;">=</span> <span style="color: #0000dd;">8.5</span>;
plotxy fitplot <span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;  <span style="color: #008000;">// 保存されたプロット範囲を使用し、再スケールなしでレイヤ1に追加</span>
range pp <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// 2番目のプロットは、新しいフィット曲線</span>
set pp <span style="color: #000080;">-</span>c color<span style="color: #000000;">(</span>red<span style="color: #000000;">)</span>;
</pre>

  <h3><a name="Polynomial_Fit_with_xop_X-Function_and_Get_Result_Tree"></a><span class="mw-headline">Xファンクションxopで多項式フィットし結果ツリーを取得</span></h3>

  <p>Xファンクション<b>xop</b>で2次、3次の多項式フィットを実行します。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// サンプルデータを開く</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Polynomial Fit.dat&quot;</span>;
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">{</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">}</span>;  <span style="color: #008000;">// プロジェクトをクリアして空のスペースから開始</span>
newbook result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyfit<span style="color: #000080;">$</span>;  <span style="color: #008000;">// 新しいワークブックを作成</span>
impasc;  <span style="color: #008000;">// データをインポート</span>
polyfit<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>H;  <span style="color: #008000;">// 現在のワークブック名を取得</span>

<span style="color: #008000;">// フィット結果用のワークシート列をセットアップ</span>
wks.<span style="color: #000080;">ncols</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">6</span>;  <span style="color: #008000;">// 3列追加</span>
range coef <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>, fitx <span style="color: #000080;">=</span> <span style="color: #0000dd;">5</span>, fity <span style="color: #000080;">=</span> <span style="color: #0000dd;">6</span>, fitxy <span style="color: #000080;">=</span> <span style="color: #000000;">(</span><span style="color: #0000dd;">5</span>, <span style="color: #0000dd;">6</span><span style="color: #000000;">)</span>;
coef<span style="color: #000000;">[</span>C<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;coefficients of 2nd polynomial fit&quot;</span>;
fitx.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// X列</span>
fitx <span style="color: #000080;">=</span> data<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">100</span><span style="color: #000000;">)</span>;

<span style="color: #008000;">// FitPolynomialクラスを使ってGUIツリー&quot;polyGUI&quot;を作成</span>
tree polyGUI;
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>init classname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitPolynomial iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyGUI;
<span style="color: #008000;">// 入力データをセット</span>
polyGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">X</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
polyGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">Y</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>;
<span style="color: #008000;">// フィットを実行して結果ツリー&quot;polyOut&quot;を取得</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>run iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyGUI otrresult<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyOut;
<span style="color: #008000;">// フィットの後にオペレーションオブジェクトをクリーンアップ</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cleanup;

<span style="color: #008000;">// 出力ツリーから係数を取得</span>
coef<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Intercept</span>.<span style="color: #000080;">Value</span>;
coef<span style="color: #000000;">[</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">B1</span>.<span style="color: #000080;">Value</span>;
coef<span style="color: #000000;">[</span><span style="color: #0000dd;">3</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">B2</span>.<span style="color: #000080;">Value</span>;
<span style="color: #008000;">// XからフィットYを生成</span>
fity <span style="color: #000080;">=</span> poly<span style="color: #000000;">(</span>fitx, coef<span style="color: #000000;">)</span>;
fity<span style="color: #000000;">[</span>C<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;2nd order polynomial fit&quot;</span>;
<span style="color: #008000;">// グラフを作成</span>
plotxy <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 散布図</span>
plotxy fitxy <span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;  <span style="color: #008000;">// 同じレイヤに折れ線グラフ</span>
range pp <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// 2番目のプロットはフィット線</span>
set pp <span style="color: #000080;">-</span>c color<span style="color: #000000;">(</span>red<span style="color: #000000;">)</span>;  <span style="color: #008000;">// 色を赤にする</span>

<span style="color: #008000;">// 列3に同様の操作をする</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">(</span>polyfit<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// データワークブックをアクティブにする</span>
wks.<span style="color: #000080;">ncols</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">9</span>;  <span style="color: #008000;">// 3列追加</span>
range coef1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">7</span>, fitx1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">8</span>, fity1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">9</span>, fitxy1 <span style="color: #000080;">=</span> <span style="color: #000000;">(</span><span style="color: #0000dd;">8</span>, <span style="color: #0000dd;">9</span><span style="color: #000000;">)</span>;
coef1<span style="color: #000000;">[</span>C<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;coefficients of 3rd polynomial fit&quot;</span>;
fitx1.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// X列</span>
fitx1 <span style="color: #000080;">=</span> data<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">100</span><span style="color: #000000;">)</span>;

<span style="color: #008000;">// FitPolynomialクラスを使用してGUIツリー&quot;polyGUI&quot;を作成</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>init classname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitPolynomial iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyGUI;
<span style="color: #008000;">// 入力データのセット</span>
polyGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">X</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
polyGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">Y</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span><span style="color: #0000dd;">3</span><span style="color: #000000;">)</span>;
<span style="color: #008000;">// 次数を3にセット</span>
polyGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">Order</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;
<span style="color: #008000;">// フィットを実行し結果をツリー&quot;polyOut&quot;に取得</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>run iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyGUI otrresult<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyOut;
<span style="color: #008000;">// フィット後にオペレーションオブジェクトをクリーンナップ</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cleanup;

<span style="color: #008000;">// 出力ツリーから係数を取得</span>
coef1<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Intercept</span>.<span style="color: #000080;">Value</span>;
coef1<span style="color: #000000;">[</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">B1</span>.<span style="color: #000080;">Value</span>;
coef1<span style="color: #000000;">[</span><span style="color: #0000dd;">3</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">B2</span>.<span style="color: #000080;">Value</span>;
coef1<span style="color: #000000;">[</span><span style="color: #0000dd;">4</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">B3</span>.<span style="color: #000080;">Value</span>;
<span style="color: #008000;">// XからフィットYを作成</span>
fity1 <span style="color: #000080;">=</span> poly<span style="color: #000000;">(</span>fitx1, coef1<span style="color: #000000;">)</span>;
fity1<span style="color: #000000;">[</span>C<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;3rd order polynomial fit&quot;</span>;
<span style="color: #008000;">// グラフを作成</span>
plotxy <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">3</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 散布図</span>
plotxy fitxy1 <span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;  <span style="color: #008000;">// 同じレイヤに折れ線グラフ</span>
range pp1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// 2番目のプロットはフィット線</span>
set pp1 <span style="color: #000080;">-</span>c color<span style="color: #000000;">(</span>red<span style="color: #000000;">)</span>;  <span style="color: #008000;">// 色を赤にする</span>
</pre>

  <h2><a name="Multiple_Linear_Regression"></a><span class="mw-headline">重回帰</span></h2>

  <h3><a name="Composite_Spectrum_Fitting_with_Multiple_Components"></a><span class="mw-headline">複数成分の複合スペクトルのフィット</span></h3>

  <p>2つの成分（x1およびx2）からなる複合スペクトル（y）のデータがあります。これは<img src="../images/Curve_Fitting/math-f7a96cf4fc957b2bf6d90416a6f47f82.png" title="y = \alpha + \beta_1x_1 + \beta_2x_2" alt="y = \alpha + \beta_1x_1 + \beta_2x_2" class="tex"> という関係にあると仮定し、Xファンクション<b>fitMr</b>を使用した重回帰を実行して、このモデルのパラメータを取得します。これを以下のサンプルで示します。</p>

  <dl>
    <dd><a class="image"><img alt="Composite Spectrum.png" src="../images/Curve_Fitting/Composite_Spectrum.png" width="338"></a></dd>
  </dl>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// サンプルデータを開く</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Composite Spectrum.dat&quot;</span>;
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">{</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">}</span>;  <span style="color: #008000;">// プロジェクトをクリアして空のスペースから開始</span>
newbook;  <span style="color: #008000;">// データ用の新しいワークブックを作成</span>
impasc;  <span style="color: #008000;">// データをインポート</span>
wks.<span style="color: #000080;">addCol</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 従属変数のフィット値のための列を追加</span>
col<span style="color: #000000;">(</span><span style="color: #0000dd;">5</span><span style="color: #000000;">)</span><span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Fitted Composite&quot;</span>;  <span style="color: #008000;">// ロングネーム</span>

<span style="color: #008000;">// 重回帰を実行</span>
<span style="color: #008000;">// col(4) = y, col(2) = x1, col(3) = x2, col(5) = フィットy</span>
<span style="color: #008000;">// 結果はツリーtrMrに取得</span>
fitmr dep<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">4</span><span style="color: #000000;">)</span> indep<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span><span style="color: #000000;">:</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">3</span><span style="color: #000000;">)</span> mrtree<span style="color: #000000;">:</span><span style="color: #000080;">=</span>trMr odep<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">5</span><span style="color: #000000;">)</span>;

<span style="color: #008000;">// 列1をXとして同じグラフに元データとフィット線をプロット</span>
range rxy <span style="color: #000080;">=</span> <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">4</span><span style="color: #000000;">)</span>, rfitxy <span style="color: #000080;">=</span> <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">5</span><span style="color: #000000;">)</span>;
plotxy rxy <span style="color: #0000dd;">201</span>;  <span style="color: #008000;">// 散布図</span>
plotxy rfitxy plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> color<span style="color: #000000;">:</span><span style="color: #000080;">=</span>color<span style="color: #000000;">(</span>red<span style="color: #000000;">)</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>active<span style="color: #000080;">&gt;</span>;  <span style="color: #008000;">// 赤い折れ線グラフ</span>

<span style="color: #008000;">// フィットパラメータを表示するラベルを追加</span>
label <span style="color: #000080;">-</span>s <span style="color: #000080;">-</span>q <span style="color: #0000dd;">2</span> <span style="color: #000080;">-</span>n myLabel1 <span style="color: #ff00ff;">&quot;Fitted Function: y = Alpha + Beta1*x1 + Beta2*x2
Alpha = $(trMr.v1, %3.2f)
Beta1 = $(trMR.v2, %.2f)
Beta2 = $(trMr.v3, %.2f)&quot;</span>;
</pre>

  <h3><a name="Multiple_Linear_Regression_with_xop_X-Function_and_Get_Result_Tree"></a><span class="mw-headline">Xファンクションxopで重回帰して結果ツリーを取得</span></h3>

  <p>3次の多項式フィットの式は<img src="../images/Curve_Fitting/math-3134961dcb0baf5e7f055a8632c8669d.png" title="y = \alpha + \beta_1x + \beta_2x^2 + \beta_3x^3" alt="y = \alpha + \beta_1x + \beta_2x^2 + \beta_3x^3" class="tex">について考えます。ここでは、<img src="../images/Curve_Fitting/math-9dd4e461268c8034f5c8564e155c67a6.png" title="x" alt="x" class="tex">を<img src="../images/Curve_Fitting/math-aa687da0086c1ea060a8838e24611319.png" title="x_1" alt="x_1" class="tex">、<img src="../images/Curve_Fitting/math-32f5240d0dbf2ccbe75ef7f8ef2015e0.png" title="x^2" alt="x^2" class="tex">を<img src="../images/Curve_Fitting/math-8732099f74d777a67257cb2f04ead3d8.png" title="x_2" alt="x_2" class="tex">、<img src="../images/Curve_Fitting/math-8c0fb3b076d9aea142467b34f0f794eb.png" title="x^3" alt="x^3" class="tex">を<img src="../images/Curve_Fitting/math-28c5eac946471f68eefb01f7a53b1844.png" title="x_3" alt="x_3" class="tex">として考えると、式は、<img src="../images/Curve_Fitting/math-c7d8ab9f725785c7dbd7d3f9d2ee3940.png" title="y=\alpha+\beta_1x_1+\beta_2x_2+\beta_3x_3" alt="y=\alpha+\beta_1x_1+\beta_2x_2+\beta_3x_3" class="tex">となるので、Xファンクション<b>xop</b>で重回帰を実行して、結果をツリーに取得します。そして、得られたパラメータが3次の多項式フィットの結果と同じであることを確かめます。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// サンプルデータを開く</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Polynomial Fit.dat&quot;</span>;
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">{</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">}</span>;  <span style="color: #008000;">// プロジェクトをクリアしてからのスペースから開始</span>
newbook;  <span style="color: #008000;">// 新しいワークブックを作成</span>
impasc;  <span style="color: #008000;">// データをインポート</span>
wks.<span style="color: #000080;">nCols</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">7</span>;  <span style="color: #008000;">// 必要なデータのために4列追加</span>
col<span style="color: #000000;">(</span><span style="color: #0000dd;">4</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// X1</span>
col<span style="color: #000000;">(</span><span style="color: #0000dd;">5</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000080;">^</span><span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// X2</span>
col<span style="color: #000000;">(</span><span style="color: #0000dd;">6</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000080;">^</span><span style="color: #0000dd;">3</span>;  <span style="color: #008000;">// X3</span>
col<span style="color: #000000;">(</span><span style="color: #0000dd;">7</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span><span style="color: #0000dd;">3</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// Y</span>

<span style="color: #008000;">// MRクラスを使ってGUIツリーmrGUIを作成</span>
tree mrGUI;
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>init classname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>MR iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mrGUI;
<span style="color: #008000;">// 入力データをセット</span>
mrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">X</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span><span style="color: #0000dd;">4</span><span style="color: #000000;">)</span><span style="color: #000000;">:</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">6</span><span style="color: #000000;">)</span>;
mrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">Y</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span><span style="color: #0000dd;">7</span><span style="color: #000000;">)</span>;
<span style="color: #008000;">// フィットを実行して結果をmrOutツリーに出力</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>run iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mrGUI otrresult<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mrOut;
<span style="color: #008000;">// フィット後にオペレーションオブジェクトをクリーンナップ</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cleanup;

<span style="color: #008000;">// 結果を表示</span>
double alpha <span style="color: #000080;">=</span> mrOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Intercept</span>.<span style="color: #000080;">Value</span>;
double beta1 <span style="color: #000080;">=</span> mrOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">D</span>.<span style="color: #000080;">Value</span>;
double beta2 <span style="color: #000080;">=</span> mrOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">E</span>.<span style="color: #000080;">Value</span>;
double beta3 <span style="color: #000080;">=</span> mrOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">F</span>.<span style="color: #000080;">Value</span>;
type <span style="color: #ff00ff;">&quot;Alpha = $(alpha)&quot;</span>;
type <span style="color: #ff00ff;">&quot;Beta1 = $(beta1)&quot;</span>;
type <span style="color: #ff00ff;">&quot;Beta2 = $(beta2)&quot;</span>;
type <span style="color: #ff00ff;">&quot;Beta3 = $(beta3)&quot;</span>;
type <span style="color: #ff00ff;">&quot;Expression is:&quot;</span>;
type <span style="color: #ff00ff;">&quot;y = $(alpha, %4.2f) + $(beta1, %4.2f)x1 + $(beta2, %3.2f)x2 + $(beta3, %.2f)x3&quot;</span>;
</pre>

  <h2><a name="Nonlinear_Fit"></a><span class="mw-headline">非線形曲線フィット</span></h2>

  <p>Origin 8 NLFit エンジンを制御する新しい X ファンクションのセットがSR2以降で使用できます。</p>

  <h3><a name="Predicting_Further_Strengthening_of_the_Chinese_Currency"></a><span class="mw-headline">人民元の高騰を予測</span></h3>

  <p>次のスクリプトは、2005年7月以降の人民元と米ドルの為替レートをフィットさせ、2013年まで推定する方法を示しています。<font color="red"><b>次のスクリプトでは、OSの日付形式が MM/dd/yyyy (例：7/22/2005) である必要があります</b></font></p>

  <dl>
    <dd><a class="image"><img alt="Chinese Currency.png" src="../images/Curve_Fitting/Chinese_Currency.png" width="324"></a></dd>
  </dl>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// SP Webサイトからファイルを取得</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;%YDEXCHUS.txt&quot;</span>;
if<span style="color: #000000;">(</span>exist<span style="color: #000000;">(</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">)</span> <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>  <span style="color: #008000;">// File not yet download, lets try to get it</span>
        string url<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;https://research.stlouisfed.org/fred2/data/DEXCHUS.txt&quot;</span>;
        web2file;
        if<span style="color: #000000;">(</span>exist<span style="color: #000000;">(</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">)</span> <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
                type <span style="color: #ff00ff;">&quot;Failed to get &quot;</span> <span style="color: #000080;">+</span> url<span style="color: #000080;">$</span>;
                return <span style="color: #0000dd;">0</span>;
        <span style="color: #000000;">}</span>
<span style="color: #000000;">}</span>
<span style="color: #008000;">// プロジェクトをクリーンアップして空のスペースから開始</span>
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">{</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">}</span>
newbook sheet<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
impAsc options.<span style="color: #000080;">sparklines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
wks.<span style="color: #000080;">col1</span>.<span style="color: #000080;">setFormat</span><span style="color: #000000;">(</span><span style="color: #0000dd;">4</span>, <span style="color: #0000dd;">22</span>, yyyy<span style="color: #ff00ff;">&apos;-&apos;</span>MM<span style="color: #ff00ff;">&apos;-&apos;</span>dd<span style="color: #000000;">)</span>;
range dd <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>, val <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;
dd<span style="color: #000000;">[</span>C<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Date&quot;</span>; val<span style="color: #000000;">[</span>C<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;RMB vs USD&quot;</span>;
<span style="color: #008000;">// 誤った場所にインポートされた単位とロングネームのクリア</span>
dd<span style="color: #000000;">[</span>U<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;&quot;</span>; val<span style="color: #000000;">[</span>U<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;&quot;</span>;
dd<span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Date&quot;</span>; val<span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Rate&quot;</span>;
dd.<span style="color: #000080;">width</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">9</span>; val.<span style="color: #000080;">width</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">7</span>;
wks.<span style="color: #000080;">labels</span><span style="color: #000000;">(</span>LC<span style="color: #000000;">)</span>;

<span style="color: #008000;">// フィッティングからの見積もりを推定する新しいワークシートを作成</span>
newsheet name<span style="color: #000000;">:</span><span style="color: #000080;">=</span>Predict label<span style="color: #000000;">:</span><span style="color: #000080;">=</span>Date<span style="color: #000080;">|</span>Estimate;
range fitx <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>, fity <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>, fitplot <span style="color: #000080;">=</span> <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 後でfitxをプロットするために、fitplotを含む範囲を保存</span>
fitx.<span style="color: #000080;">format</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// 日付</span>
fitx <span style="color: #000080;">=</span> data<span style="color: #000000;">(</span>date<span style="color: #000000;">(</span><span style="color: #0000dd;">9</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2005</span><span style="color: #000000;">)</span>, date<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2013</span><span style="color: #000000;">)</span>, <span style="color: #0000dd;">90</span><span style="color: #000000;">)</span>;
fity<span style="color: #000000;">[</span>C<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Result from ExpDecay2 fit&quot;</span>;
page.<span style="color: #000080;">active</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// インポートされたデータに戻る</span>

<span style="color: #008000;">// USDの切り下げとRMBの比較は2005年7月22日から2013年1月1日</span>
d0 <span style="color: #000080;">=</span> date<span style="color: #000000;">(</span><span style="color: #0000dd;">7</span><span style="color: #000080;">/</span><span style="color: #0000dd;">22</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2005</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// Save this date</span>
d1 <span style="color: #000080;">=</span> date<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2013</span><span style="color: #000000;">)</span>;
ii <span style="color: #000080;">=</span> list<span style="color: #000000;">(</span>d0, col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 対応する行を検索</span>
jj <span style="color: #000080;">=</span> list<span style="color: #000000;">(</span>d1, col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
rate0 <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span><span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span>;  <span style="color: #008000;">// この値を保存</span>
rate1 <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span><span style="color: #000000;">[</span>jj<span style="color: #000000;">]</span>;
plotxy <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">)</span><span style="color: #000000;">[</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span><span style="color: #000000;">:</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>jj<span style="color: #000000;">)</span><span style="color: #000000;">]</span> <span style="color: #0000dd;">200</span>;  <span style="color: #008000;">// 切り下げ以降のデータをプロット</span>
x1 <span style="color: #000080;">=</span> date<span style="color: #000000;">(</span><span style="color: #0000dd;">7</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2005</span><span style="color: #000000;">)</span>; x2 <span style="color: #000080;">=</span> date<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2013</span><span style="color: #000000;">)</span>; y1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">5</span>;  <span style="color: #008000;">// X、Y 軸のスケールを設定</span>

<span style="color: #008000;">// グラフのフィッティングを開始</span>
nlbegin <span style="color: #0000dd;">1</span> ExpDecay2 tt;
tt.<span style="color: #000080;">x0</span> <span style="color: #000080;">=</span> d0; tt.<span style="color: #000080;">f_x0</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// 最初に初期の日付でx0を固定</span>
tt.<span style="color: #000080;">y0</span> <span style="color: #000080;">=</span> rate0; tt.<span style="color: #000080;">f_y0</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// y0も固定</span>
tt.<span style="color: #000080;">A1</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
nlfit <span style="color: #0000dd;">3</span>;  <span style="color: #008000;">// 3 回反復</span>
tt.<span style="color: #000080;">f_x0</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; tt.<span style="color: #000080;">f_y0</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;  <span style="color: #008000;">// x0とy0の固定を解除してデフォルトの最大反復回数でフィット</span>
nlfit;
<span style="color: #008000;">// これでフィット曲線を生成可能</span>
fity <span style="color: #000080;">=</span> fit<span style="color: #000000;">(</span>fitx<span style="color: #000000;">)</span>;
nlend;  <span style="color: #008000;">// すべてのフィッティングが完了したので、終了できます</span>

<span style="color: #008000;">// このプロットにもフィット曲線を追加</span>
<span style="color: #008000;">// 保存されたプロット範囲を使用し、再スケールせずにレイヤ1に追加</span>
plotxy fitplot <span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span> color<span style="color: #000000;">:</span><span style="color: #000080;">=</span>color<span style="color: #000000;">(</span>red<span style="color: #000000;">)</span>;
</pre>

  <h3><a name="Fit_Multiple_Peaks_with_Replica"></a><span class="mw-headline">複製による複数ピークフィット</span></h3>

  <p>次のスクリプトは、ベースラインを減算済みの複数ピークのデータセットをフィットします。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// プロジェクトをクリア</span>
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">{</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">}</span>

<span style="color: #008000;">// 新しいワークブックにサンプルデータをインポート</span>
newbook;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Multiple Peaks.dat&quot;</span>;
impAsc;

<span style="color: #008000;">// 列Cをフィット、このデータでは列B以降のどの列でも可</span>
range aa <span style="color: #000080;">=</span> <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">3</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// A(x), C(y)</span>
int nCumFitCol <span style="color: #000080;">=</span> wks.<span style="color: #000080;">nCols</span><span style="color: #000080;">+</span><span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// フィットY用の新しい列</span>

<span style="color: #008000;">// このデータでは、4つのガウスピークがあるので、複製を3にセット(ピークの数 = 複製の数+1)</span>
nlbegin aa gauss tt replica<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>;
nlfit;
range yy <span style="color: #000080;">=</span> nCumFitCol;
yy <span style="color: #000080;">=</span> fit<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// ピークインデックスなしでfit(x)を呼び出して累積ピークを作成</span>
yy<span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Fit Y&quot;</span>;
loop<span style="color: #000000;">(</span>ii, <span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">4</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        range pk <span style="color: #000080;">=</span> wcol<span style="color: #000000;">(</span>nCumFitCol<span style="color: #000080;">+</span>ii<span style="color: #000000;">)</span>;
        pk <span style="color: #000080;">=</span> fit<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>, ii<span style="color: #000000;">)</span>;
        pk<span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Peak$(ii)&quot;</span>;
<span style="color: #000000;">}</span>
nlend;

<span style="color: #008000;">// src および fitを新しいグラフにプロット</span>
plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">(</span>A,C<span style="color: #000000;">)</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">201</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span><span style="color: #000000;">]</span>;
plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span>MultiplePeaks<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">(</span>A,<span style="color: #ff00ff;">&quot;Fit Y&quot;</span><span style="color: #000000;">)</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span>  ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span>Layer1 color<span style="color: #000000;">:</span><span style="color: #000080;">=</span>color<span style="color: #000000;">(</span>red<span style="color: #000000;">)</span>;
</pre>

  <h3><a name="Global_Fit_with_Parameter_Sharing_on_Plot_Segments"></a><span class="mw-headline">グラフの部分範囲でパラメータを共有したグローバルフィット</span></h3>

  <p>次のスクリプトは、3つの指数減少のデータセットの部分範囲（後半部分）に対して非線形曲線フィットを実行します。</p>
  <pre class="lt" style="font-family:monospace;">
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">{</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">}</span>  <span style="color: #008000;">// ワークスペースをクリア</span>
newbook sheet<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// データとフィット線のシート</span>
range ss2 <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span><span style="color: #000080;">!</span>;
ss2.<span style="color: #000080;">name</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Fit Curves&quot;</span>;
ss2.<span style="color: #000080;">nCols</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// x, fity1, 2, 3</span>

<span style="color: #008000;">// 1つ目のシートに戻ってデータをインポート</span>
page.<span style="color: #000080;">active</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Exponential Decay.dat&quot;</span>;
impAsc;
<span style="color: #008000;">// ワークブック名を保存</span>
string strData<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>H;
plotxy <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">:</span>end<span style="color: #000000;">)</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span><span style="color: #000000;">]</span>;
x1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; x2 <span style="color: #000080;">=</span> <span style="color: #0000dd;">1.1</span>;
sec <span style="color: #000080;">-</span>p <span style="color: #0000dd;">0.1</span>;  <span style="color: #008000;">// 増分(x3)設定の前のプロット描画に必要な時間</span>
x3 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0.2</span>;
sec <span style="color: #000080;">-</span>p <span style="color: #0000dd;">0.1</span>;  <span style="color: #008000;">// 続く範囲宣言が正しく動作するためのリフレッシュに必要な時間</span>
<span style="color: #008000;">// 0.2秒から最後までフィットするために、0.2秒の行インデックスを探す</span>
range p1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// 最初のデータプロットを使う</span>
int i1 <span style="color: #000080;">=</span> xindex<span style="color: #000000;">(</span><span style="color: #0000dd;">0.2</span>, p1<span style="color: #000000;">)</span>;
range aa <span style="color: #000080;">=</span> <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span>, <span style="color: #0000dd;">3</span><span style="color: #000000;">)</span><span style="color: #000000;">[</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>i1<span style="color: #000000;">)</span><span style="color: #000000;">:</span>end<span style="color: #000000;">]</span>;  <span style="color: #008000;">// プロット1, 2, 3を選択</span>

nlbegin aa ExpDec1 tt;
<span style="color: #008000;">// t1を共有</span>
tt.<span style="color: #000080;">s_t1</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
nlfit;
<span style="color: #008000;">// フィット曲線を生成してプロット</span>
range fx <span style="color: #000080;">=</span> <span style="color: #000000;">[</span>strData<span style="color: #000080;">$</span><span style="color: #000000;">]</span><span style="color: #0000dd;">2</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span>;
fx <span style="color: #000080;">=</span> data<span style="color: #000000;">(</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">0.02</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 全てのフィットのX列を生成</span>
for<span style="color: #000000;">(</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ii <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">3</span>; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        range yy <span style="color: #000080;">=</span> <span style="color: #000000;">[</span>strData<span style="color: #000080;">$</span><span style="color: #000000;">]</span><span style="color: #0000dd;">2</span><span style="color: #000080;">!</span>wcol<span style="color: #000000;">(</span>ii<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
        yy<span style="color: #000000;">[</span>C<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Fit Curve $(ii)&quot;</span>;
        yy <span style="color: #000080;">=</span> fit<span style="color: #000000;">(</span>fx, ii<span style="color: #000000;">)</span>;
        plotxy yy <span style="color: #0000dd;">200</span>, ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> color<span style="color: #000000;">:</span><span style="color: #000080;">=</span>color<span style="color: #000000;">(</span>red<span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span>
nlend;
</pre>

  <h3><a name="Creating_Multiple_Simulated_Curves_With_a_User-Defined_Fitting_Function"></a><span class="mw-headline">ユーザ定義のフィット関数で複数のシミュレーション曲線を作成</span></h3>

  <p>このサンプルでは、Xファンクションnlfitを使用してユーザ定義関数のシミュレーションを実行する方法を紹介します。ここで使用するフィット関数<i>MyFitFunc</i>は、aとbという2つのパラメータを持つものとします。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// デフォルトのワークブック作成</span>
newbook;

<span style="color: #008000;">// シミュレーションのために最初の列にXを入力</span>
col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">0</span><span style="color: #000000;">:</span><span style="color: #0000dd;">0.1</span><span style="color: #000000;">:</span><span style="color: #0000dd;">4</span><span style="color: #000000;">}</span>;

<span style="color: #008000;">// 列2は空欄のままユーザ定義関数でフィット開始</span>
nlbegin iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> func<span style="color: #000000;">:</span><span style="color: #000080;">=</span>MyFitFunc nltree<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mytree;

<span style="color: #008000;">// 適切なパラメータ値を設定してループ</span>
<span style="color: #008000;">// ここではフィット関数は、aとbというパラメータをもつとする</span>
for<span style="color: #000000;">(</span>double a <span style="color: #000080;">=</span> <span style="color: #0000dd;">1.0</span>; a <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">3.0</span>; a<span style="color: #000080;">+</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0.5</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        for<span style="color: #000000;">(</span>double b <span style="color: #000080;">=</span> <span style="color: #0000dd;">3.0</span>; b <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">12.0</span>; b<span style="color: #000080;">+</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2.0</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
                type <span style="color: #ff00ff;">&quot;a = $(a), b = $(b)&quot;</span>;
                <span style="color: #008000;">// シミュレーション曲線を受け取る新しい列を追加</span>
                wks.<span style="color: #000080;">addCol</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
                int nCol <span style="color: #000080;">=</span> wks.<span style="color: #000080;">nCols</span>;
                <span style="color: #008000;">// パラメータ値をツリーにセット</span>
                mytree.<span style="color: #000080;">a</span> <span style="color: #000080;">=</span> a;
                mytree.<span style="color: #000080;">b</span> <span style="color: #000080;">=</span> b;
                <span style="color: #008000;">// 0回反復してフィットを更新</span>
                nlfit<span style="color: #000000;">(</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>;
                <span style="color: #008000;">// fit()関数を使って最後の列にフィット曲線を作成（第1列をXとする）</span>
                wcol<span style="color: #000000;">(</span>nCol<span style="color: #000000;">)</span> <span style="color: #000080;">=</span> fit<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
                <span style="color: #008000;">// 使用されたパラメータ値をコメントに追加</span>
                string str<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;a = $(a), b = $(b)&quot;</span>;
                wcol<span style="color: #000000;">(</span>nCol<span style="color: #000000;">)</span><span style="color: #000000;">[</span>C<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> str<span style="color: #000080;">$</span>;
        <span style="color: #000000;">}</span>
<span style="color: #000000;">}</span>
<span style="color: #008000;">// フィットプロセスを終了</span>
nlend<span style="color: #000000;">(</span><span style="color: #000000;">)</span>;

<span style="color: #008000;">// 空の2番目の列を削除し、すべての列をプロット</span>
delete wcol<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>;
plotxy <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">:</span>end<span style="color: #000000;">)</span> <span style="color: #0000dd;">200</span>;
</pre>

  <p>ユーザ定義フィット関数の作成方法については、<a class="external text" href="../../Tutorial/Tutorial/User_Defined_Fitting_Function_using_OC.html">カーブフィットのチュートリアル</a>を参照してください。</p>

  <h3><a name="Fit_Parameter_Rearrangement_in_Post_Fit_Worsksheet_Script"></a><span class="mw-headline">ワークシートスクリプトでフィットパラメータの再構成</span></h3>

  <p>フィットを実行すると、フィットパラメータ表などの多くの出力表を含むレポートシートが作成されます。これらのレイアウトは、希望する形式ではない可能性があります。そのため、フィットパラメータを再構成し、フィットの再計算後に再構成と自動実行する必要があります。</p>

  <p>次のサンプルでは、スクリプトでパラメータを再構成して、各行に一つのデータのセットを表示し、次のように列を構成します。</p>

  <ol>
    <li>Name （入力データセットのロングネーム）</li>

    <li>P1（第1パラメータ値）</li>

    <li>E1（第1パラメータの誤差)</li>

    <li>P2（第2パラメータ値）</li>

    <li>E2（第2パラメータの誤差)</li>
  </ol>

  <p>とパラメータの数だけ続きます。また、自由度あたりのカイ二乗を最後の列に出力します。</p>

  <h4><a name="Worksheet_Script"></a><span class="mw-headline">ワークシートスクリプト</span></h4>

  <p>このスクリプトは、ワークシートスクリプトダイアログに入力し、分析レポートシートが変更された後に実行します。</p>
  <pre class="lt" style="font-family:monospace;">
Tree tt;
getnlr tr<span style="color: #000000;">:</span><span style="color: #000080;">=</span>tt iw<span style="color: #000000;">:</span><span style="color: #000080;">=</span>__Report<span style="color: #000080;">$</span> p<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;

int nTotalParamsPerSet <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
for<span style="color: #000000;">(</span>int idx <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; idx <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">0</span>; idx<span style="color: #000080;">++</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        if<span style="color: #000000;">(</span>tt.<span style="color: #000080;">p</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>idx<span style="color: #000000;">)</span> <span style="color: #000080;">!</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #000080;">/</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>
                nTotalParamsPerSet<span style="color: #000080;">++</span>;
        else
                break;
<span style="color: #000000;">}</span>
nTotalParamsPerSet <span style="color: #000080;">/</span><span style="color: #000080;">=</span> tt.<span style="color: #000080;">nsets</span>;

wks.<span style="color: #000080;">nCols</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;  <span style="color: #008000;">// ワークシートをクリア</span>
col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Data&quot;</span>;
wks.<span style="color: #000080;">col1</span>.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// X列</span>

for<span style="color: #000000;">(</span>int nn <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; nn <span style="color: #000080;">&lt;=</span> nTotalParamsPerSet; nn<span style="color: #000080;">++</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        int nCol <span style="color: #000080;">=</span> <span style="color: #000000;">(</span>nn<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000080;">*</span><span style="color: #0000dd;">2</span><span style="color: #000080;">+</span><span style="color: #0000dd;">2</span>;
        wcol<span style="color: #000000;">(</span>nCol<span style="color: #000000;">)</span><span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">n</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>nn<span style="color: #000000;">)</span><span style="color: #000080;">$</span>;
        wcol<span style="color: #000000;">(</span>nCol<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">n</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>nn<span style="color: #000000;">)</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;_Error&quot;</span>;
        wks.<span style="color: #000080;">col</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>nCol<span style="color: #000000;">)</span>.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// Y列</span>
        wks.<span style="color: #000080;">col</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>nCol<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;  <span style="color: #008000;">// Yエラー</span>
<span style="color: #000000;">}</span>

int nChiSqrCol <span style="color: #000080;">=</span> nTotalParamsPerSet<span style="color: #000080;">*</span><span style="color: #0000dd;">2</span><span style="color: #000080;">+</span><span style="color: #0000dd;">2</span>;
wcol<span style="color: #000000;">(</span>nChiSqrCol<span style="color: #000000;">)</span><span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Reduced Chi-Sqr&quot;</span>;

for<span style="color: #000000;">(</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ii <span style="color: #000080;">&lt;=</span> tt.<span style="color: #000080;">nsets</span>; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">Data</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span>.<span style="color: #000080;">Name</span><span style="color: #000080;">$</span>;
        for<span style="color: #000000;">(</span>int jj <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; jj <span style="color: #000080;">&lt;=</span> nTotalParamsPerSet; jj<span style="color: #000080;">++</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
                int nCol <span style="color: #000080;">=</span> <span style="color: #000000;">(</span>jj<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000080;">*</span><span style="color: #0000dd;">2</span><span style="color: #000080;">+</span><span style="color: #0000dd;">2</span>;
                wcol<span style="color: #000000;">(</span>nCol<span style="color: #000000;">)</span><span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">p</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span><span style="color: #000000;">(</span>ii<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000080;">*</span>nTotalParamsPerSet<span style="color: #000080;">+</span>jj<span style="color: #000000;">)</span>;
                wcol<span style="color: #000000;">(</span>nCol<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">e</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span><span style="color: #000000;">(</span>ii<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000080;">*</span>nTotalParamsPerSet<span style="color: #000080;">+</span>jj<span style="color: #000000;">)</span>;
        <span style="color: #000000;">}</span>
        if<span style="color: #000000;">(</span>tt.<span style="color: #000080;">nsets</span> <span style="color: #000080;">==</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>
                wcol<span style="color: #000000;">(</span>nChiSqrCol<span style="color: #000000;">)</span><span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">chisqr</span>;
        else
                wcol<span style="color: #000000;">(</span>nChiSqrCol<span style="color: #000000;">)</span><span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">chisqr</span><span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span>
</pre>

  <h4><a name="Setting_up_the_Analysis_Template"></a><span class="mw-headline">分析テンプレートのセットアップ</span></h4>

  <p>以下のようにして、このスクリプトを使って分析テンプレートをセットアップします。</p>

  <ol>
    <li>レポートシートを入力データシートと同じブックに出力する、デフォルトのフィット操作を実行します。すると、他にフィットを実行してなければ、FitNL1、他に実行していれば、FitNL2などのレポートシートが作成されます。</li>

    <li>新しいシートを追加して、FitParamsなどの名前を付けます。</li>

    <li>FitParamsシートをアクティブにして、メインメニューのワークシート：ワークシート・スクリプトを選択してダイアログを開きます。</li>

    <li>ダイアログ内の大きなパネルに上のスクリプトをコピー&amp;ペーストします。</li>

    <li>「<b>セミコロンで終わらない1行の式を許す</b>」のチェックが外れていることを確認します。</li>

    <li>「<b>範囲の変更で</b>」にチェックをつけます</li>

    <li>その下にFitNL1!と入力します。ここで!をつけることで、シート範囲に何か変更があったときにスクリプトが実行されるようになります。</li>

    <li><b>更新</b>ボタンをクリックしてスクリプトをFitParamsシートに保存します。</li>
  </ol>

  <p>元の入力シートに新しいデータを入力すると、FitParams シートが更新され、再配置されたパラメーターが表示されます。下記のようにすると、このブックを分析テンプレートとして保存できます。</p>

  <ol>
    <li>FitParams シートでワークシートのクリアを実行して、現在の結果が削除されたことを確認します。</li>

    <li>入力データシートをクリックし、<b>ワークシートのクリア</b>を実行して、入力シートとレポートシートの両方がすべてクリーンアップされていることを確認します。</li>

    <li>入力データシートがアクティブな状態で、メインメニューから<b>ファイル -&gt; ウィンドウの新規保存</b>を選択して、ogwファイルに保存します。</li>
  </ol>

  <p>これで分析テンプレートが保存され、 <b>ファイル -&gt; 最近使ったブック</b>から簡単に開くことができます。</p>

  <h3><a name="Fit_Multiple_Columns_in_a_Worksheet"></a><span class="mw-headline">ワークシートの複数列をフィット</span></h3>

  <p>以下のsクリプトでは、1枚のシートにある複数の列をフィットして2枚目のシートに結果表を作成します。  <b>Function</b>機能を使用するのでOrigin <font color="red">8.1</font>以上で動作します。</p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// あとで使用する関数を定義</span>
function int FitOneData<span style="color: #000000;">(</span>range xyin, string strFunc<span style="color: #000080;">$</span>, ref tree trResults<span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        nlbegin iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span>xyin func<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strFunc<span style="color: #000080;">$</span> nltree<span style="color: #000000;">:</span><span style="color: #000080;">=</span>trResults;
        nlfit;
        nlend;
        return trResults.<span style="color: #000080;">niter</span>;
<span style="color: #000000;">}</span>

<span style="color: #008000;">// 新しいシートにサンプルデータをインポートしてアクティブにする</span>
newbook;  <span style="color: #008000;">// N最初のシートをソースデータ用にする</span>
range rngSrcWks <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;  <span style="color: #008000;">// Use 1st worksheet as source data</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Multiple Gaussians.dat&quot;</span>;
impAsc;

<span style="color: #008000;">// Multiple Gaussians.datは列名がないので、つける</span>
int ii;
loop<span style="color: #000000;">(</span>ii, <span style="color: #0000dd;">2</span>, rngSrcWks.<span style="color: #000080;">nCols</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        range cc <span style="color: #000080;">=</span> wcol<span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span>;
        cc<span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Sample $(ii-1)&quot;</span>;
<span style="color: #000000;">}</span>
<span style="color: #008000;">// フィット結果を入力するシートを作成</span>
<span style="color: #008000;">// 中心と AdjRなどを取得</span>
newsheet name<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Results&quot;</span> labels<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Name|Center|AdjR|Iterations&quot;</span> active<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
range rName <span style="color: #000080;">=</span> Results<span style="color: #000080;">!</span>col<span style="color: #000000;">(</span>Name<span style="color: #000000;">)</span>;
range rCenter <span style="color: #000080;">=</span> Results<span style="color: #000080;">!</span>col<span style="color: #000000;">(</span>Center<span style="color: #000000;">)</span>;
range rAdjR <span style="color: #000080;">=</span> Results<span style="color: #000080;">!</span>col<span style="color: #000000;">(</span>AdjR<span style="color: #000000;">)</span>;
range rIter <span style="color: #000080;">=</span> Results<span style="color: #000080;">!</span>col<span style="color: #000000;">(</span>Iterations<span style="color: #000000;">)</span>;
loop<span style="color: #000000;">(</span>ii, <span style="color: #0000dd;">2</span>, rngSrcWks.<span style="color: #000080;">nCols</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
        int rr <span style="color: #000080;">=</span> ii<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span>;
        range rngInput <span style="color: #000080;">=</span> <span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
        tree tr;
        int nn <span style="color: #000080;">=</span> FitOneData<span style="color: #000000;">(</span>rngInput, <span style="color: #ff00ff;">&quot;gauss&quot;</span>, tr<span style="color: #000000;">)</span>;
        <span style="color: #008000;">// ワークシートに結果を出力</span>
        rName<span style="color: #000000;">[</span>rr<span style="color: #000000;">]</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> rngInput<span style="color: #000000;">[</span>L<span style="color: #000000;">]</span><span style="color: #000080;">$</span>;
        rCenter<span style="color: #000000;">[</span>rr<span style="color: #000000;">]</span> <span style="color: #000080;">=</span> tr.<span style="color: #000080;">xc</span>;
        rAdjR<span style="color: #000000;">[</span>rr<span style="color: #000000;">]</span> <span style="color: #000080;">=</span> tr.<span style="color: #000080;">adjr</span>;
        rIter<span style="color: #000000;">[</span>rr<span style="color: #000000;">]</span> <span style="color: #000080;">=</span> nn;
<span style="color: #000000;">}</span>
</pre>

  <h3><a name="Change_Parameters_of_an_Existing_Operation"></a><span class="mw-headline">既存オペレーションのパラメータを変更</span></h3>

  <p>分析テンプレートに格納されたオペレーションオブジェクトのパラメータを変更したい場合、Xファンクション<i>op_change</i>を使ってツリーを取得し設定できます。</p>

  <p> </p>
  <pre class="lt" style="font-family:monospace;">
<span style="color: #008000;">// 分析テンプレートをロード</span>
string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Single Peak Fit.ogw&quot;</span>;
doc <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">(</span>path<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;

<span style="color: #008000;">// データの部分インポート</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Gaussian.dat&quot;</span>;
impAsc  options.<span style="color: #000080;">partImp</span>.<span style="color: #000080;">partial</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>
                options.<span style="color: #000080;">partImp</span>.<span style="color: #000080;">firstCol</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>
                options.<span style="color: #000080;">partImp</span>.<span style="color: #000080;">lastCol</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>
                orng<span style="color: #000000;">:</span><span style="color: #000080;">=</span>Data<span style="color: #000080;">!</span>;

<span style="color: #008000;">// オペレーションツリーを取得</span>
op_change ir<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitNL1<span style="color: #000080;">!</span> tr<span style="color: #000000;">:</span><span style="color: #000080;">=</span>tr;

<span style="color: #008000;">// y0を0に固定</span>
tr.<span style="color: #000080;">FitWorkArea</span>.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Fixed</span><span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
tr.<span style="color: #000080;">FitWorkArea</span>.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Values</span><span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;

<span style="color: #008000;">// xcを固定し、最も近い整数に丸める</span>
tr.<span style="color: #000080;">FitWorkArea</span>.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Fixed</span><span style="color: #000000;">[</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
tr.<span style="color: #000080;">FitWorkArea</span>.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Values</span><span style="color: #000000;">[</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> nint<span style="color: #000000;">(</span>tr.<span style="color: #000080;">FitWorkArea</span>.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Values</span><span style="color: #000000;">[</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span><span style="color: #000000;">)</span>;

<span style="color: #008000;">// パラメータ表に固定列を追加</span>
tr.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">Quantities</span>.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Fix</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;

<span style="color: #008000;">// 統計表にR値を含める</span>
tr.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">Quantities</span>.<span style="color: #000080;">Statistics</span>.<span style="color: #000080;">Rvalue</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;

<span style="color: #008000;">// ANOVA表を削除</span>
tr.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">Quantities</span>.<span style="color: #000080;">ANOVAtable</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;

<span style="color: #008000;">// ツリーを戻して更新を実行</span>
op_change ir<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitNL1<span style="color: #000080;">!</span> tr<span style="color: #000000;">:</span><span style="color: #000080;">=</span>tr op<span style="color: #000000;">:</span><span style="color: #000080;">=</span>run;
</pre>
