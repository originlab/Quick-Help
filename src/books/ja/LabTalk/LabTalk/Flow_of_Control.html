<h1 class="firstheading">条件およびループ構造</h1><p class='urlname' style='display: none'>Flow-of-Control</p>
<p>LabTalk言語の構造はC言語のそれと似ています。LabTalkは以下の構造をサポートしています。
</p>
<ul><li> 処理を繰り返し実行するループ構造</li>
<li> 条件の真、偽に応じて処理の実行を制御する分岐構造</li></ul>
<div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Loop_Structures"><span class="tocnumber">1</span> <span class="toctext">ループ構造</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Repeat"><span class="tocnumber">1.1</span> <span class="toctext">Repeat</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Loop"><span class="tocnumber">1.2</span> <span class="toctext">Loop</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Doc_-e"><span class="tocnumber">1.3</span> <span class="toctext">Doc -e</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#For"><span class="tocnumber">1.4</span> <span class="toctext">For</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Decision_Structures"><span class="tocnumber">2</span> <span class="toctext">分岐構造</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#If.2C_If-Else"><span class="tocnumber">2.1</span> <span class="toctext">If, If-Else</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Switch"><span class="tocnumber">2.2</span> <span class="toctext">Switch</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Break_and_Progress_Bars"><span class="tocnumber">2.3</span> <span class="toctext">Breakおよびプログレスバー</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Exit"><span class="tocnumber">2.4</span> <span class="toctext">Exit</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Continue"><span class="tocnumber">2.5</span> <span class="toctext">Continue</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#Sections_in_a_Script_File"><span class="tocnumber">3</span> <span class="toctext">スクリプトファイル内のセクション</span></a></li>
</ul>
</div>

<h2><a name="Loop_Structures"></a><span class="mw-headline">ループ構造</span></h2>
<p>すべてのLabTalkのループは、引数としてスクリプトを取ります。  これらのスクリプトは、指定した条件下で繰り返し実行されます。LabTalkには次の4つのループコマンドがあります。 
</p>
<table class="simple">
<tr>
<th> コマンド
</th>
<th> 構文
</th></tr>
<tr>
<td> repeat
</td>
<td> repeat value {<i>script</i>};
</td></tr>
<tr>
<td> loop
</td>
<td> loop (variable, startVal, endVal) {<i>script</i>};
</td></tr>
<tr>
<td> doc -e
</td>
<td> doc -e object {<i>script</i>};
</td></tr>
<tr>
<td> for
</td>
<td> for (expression1; expression2; expression3) {<i>script</i>};
</td></tr></table>
<p>LabTalkのforループは、他のプログラミング言語のforループと同じです。  repeat, loop, doc -eループは、他の言語では馴染みがないものですが、簡単に使うことができます。
</p>
<h3><a name="Repeat"></a><span class="mw-headline">Repeat</span></h3>
<p><b><span class="OIndex">repeat</span></b>ループは一連の操作が変更無く繰り返されるときに使われます。 
</p><p>シンタックス :  <b>repeat <i>value</i> {<i>script</i>};</b>
</p><p>スクリプトscriptを、valueで指定した回数分、またはエラーが起こるまで、または<i><a href="../../LabTalk/LabTalk/Break_(command).html" title="LabTalk:Break (コマンド)">break</a></i>コマンドが実行されるまで実行します。 
</p><p>例えば、次のスクリプトは、文字列を3回出力します。
</p>
<pre class="lt" style="font-family:monospace;">repeat <span style="color: #0000dd;">3</span> <span style="color: #000000;">{</span> type <span style="color: #ff00ff;">&quot;line of output&quot;</span>; <span style="color: #000000;">}</span>;</pre>
<h3><a name="Loop"></a><span class="mw-headline">Loop</span></h3>
<p><b><span class="OIndex">loop</span></b> ループは、各ループの処理が問題なく実行されると1つの変数が増加するようなときに使われます。 
</p><p>シンタックス : <b>loop (<i>variable</i>, <i>startVal</i>, <i>endVal</i>) {<i>script</i>};</b>
</p><p>簡単なカウンタ変数を持つループ構造です。<i>starVal</i>の値で変数<i>variable</i>を初期化し、スクリプトを実行します。<i>script</i>を実行します。<i>variable</i> を増加し、それが<i>endVal</i>より大きいかどうかをチェックします。大きくない場合、<i>script</i> を実行し、ループを継続します。
</p><p>例えば、次のスクリプトは1から4までの数を出力します。
</p>
<pre class="lt" style="font-family:monospace;">loop <span style="color: #000000;">(</span>ii, <span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">4</span><span style="color: #000000;">)</span>  <span style="color: #000000;">{</span>type <span style="color: #ff00ff;">&quot;$(ii)&quot;</span>;<span style="color: #000000;">}</span>;</pre>
<p><b>Note</b>:<b>loop</b> コマンドは、<b>for</b> コマンドよりもスクリプトブロックの実行が高速となります。ループを停止ための条件を判定するためLabTalk式の解析を行う必要がないため、高速となります。
</p>
<h3><a name="Doc_-e"></a><span class="mw-headline">Doc -e</span></h3>
<p><a href="../../LabTalk/LabTalk/Document_(command).html#-e_object_.7Bscript.7D.3B_Execute_the_given_script_for_all_objects" title="LabTalk:Document (コマンド)"><span class="OIndex">doc -e</span></a>ループは、スクリプトを実行してグラフウィンドウのような特定のオブジェクトに対して処理を行うときに使われます。  <b>doc -e</b> ループは、指定したオブジェクトの各インスタンスに対してスクリプトを実行するようにOriginに通知します。
</p><p>シンタックス : <b>doc -e <i>object</i> {<i>script</i>};</b>
</p><p>さまざまなオブジェクトタイプは<a href="../../LabTalk/LabTalk/Document_(command).html#-e_object_.7Bscript.7D.3B_Execute_the_given_script_for_all_objects" title="LabTalk:Document (コマンド)">ドキュメントコマンド</a>に一覧が載っています。
</p><p>例えば、次のスクリプトはプロジェクト内のすべてのグラフウィンドウのウィンドウタイトルを出力します。
</p>
<pre class="lt" style="font-family:monospace;">doc <span style="color: #000080;">-</span>e P <span style="color: #000000;">{</span><span style="color: #000080;">%</span>H<span style="color: #000080;">=</span><span style="color: #000000;">}</span></pre>
<h3><a name="For"></a><span class="mw-headline">For</span></h3>
<p><b><span class="OIndex">for</span></b>ループは、上記以外のすべての状況で使われます。 
</p><p>シンタックス : <b>for (<i>expression1</i>; <i>expression2</i>; <i>expression3</i>) {<i>script</i>};</b>
</p><p><b>for</b> ステートメントの中で、<i>expression1</i> が評価されます。これによって、ループの初期値が指定されます。  次に<i>expression2</i> が評価され、その結果が真(0でない)である場合、<i>script</i>が実行されます。そして、カウンターの増加を受けて <b>expression3</b>が実行されます。処理が2番目のステップを繰り返し行われます。<i>expression2</i>の結果が偽(0)になった時点でこのループは終了します。  他のexpressionは、カンマで区切られている複数の文から構成することができます。
</p><p>例えば、次のスクリプトは1から4を出力します。
</p>
<pre class="lt" style="font-family:monospace;">for<span style="color: #000000;">(</span>ii<span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; ii<span style="color: #000080;">&lt;=</span><span style="color: #0000dd;">4</span>; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span>  
<span style="color: #000000;">{</span>
   type <span style="color: #ff00ff;">&quot;$(ii)&quot;</span>;
<span style="color: #000000;">}</span></pre>
<p><b>Note</b>:<b>loop</b> コマンドはスクリプトブロックの実行が高速となります。
</p>
<h2><a name="Decision_Structures"></a><span class="mw-headline">分岐構造</span></h2>
<p><span class="OIndex">分岐構造</span>により、プログラムは状況に応じて異なるアクションセットを実行できます。  LabTalkは、3つの判断分岐構造を提供します。   if、if-else、switchです。
</p>
<ul><li> <b>if</b>コマンドは、指定した条件が成り立った場合、つまり、真(非ゼロ値)の場合に、指定したスクリプトを実行する場合に使用します。</li>
<li> <span class="OIndex">if-else</span>コマンドは、指定した条件が真(非ゼロ値)の場合、あるスクリプトを実行し、偽(ゼロ)の場合、別のスクリプトを実行する場合に使用します。</li>
<li> <b>switch</b>コマンドは、2つ又はそれ以上の条件があって、条件を満たした指定スクリプトを実行をする場合に使用します。</li></ul>
<h3><a name="If.2C_If-Else"></a><span class="mw-headline">If, If-Else</span></h3>
<p>シンタックス : 
</p>
<ol><li> <b>if (<i>testCondition</i>) <i>sentence1</i>; [else <i>sentence2</i>;]</b></li>
<li> <b>if (<i>testCondition</i>) {<i>script1</i>} [else {<i>script2</i>}]</b></li></ol>
<p><i>TestCondition</i>が真である場合、<i>script1</i>が実行されます。表現が条件演算子を含まない場合、その結果がゼロより大きければ真と評価されます。 
</p><p>オプション<b>else</b>が付加されていて、<i>testCondition</i>が偽(ゼロ)である場合、<i>script2</i>が実行されます。このとき、elseの後にスペースを付けなくてはいけません。文字列は引用符で囲まれていなくてはいけません。文字列の比較には大文字と小文字の<b>区別はされません</b>。
</p><p>一つの文からなるスクリプトの引数の終わりには、セミコロンを付けます。複数の文からなるスクリプトの引数は、大括弧{}で囲みます。この場合、各々のスクリプトはセミコロンで区切ります。スクリプトを囲む大括弧の後にセミコロンを付ける必要はありません。
</p><p>例えば、下記のスクリプトは、｢Yes!｣を表示するメッセージボックスを開きます。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #000080;">%</span>M <span style="color: #000080;">=</span> test;
if <span style="color: #000000;">(</span><span style="color: #000080;">%</span>M <span style="color: #000080;">==</span> <span style="color: #ff00ff;">&quot;TEST&quot;</span><span style="color: #000000;">)</span>  type <span style="color: #000080;">-</span>b <span style="color: #ff00ff;">&quot;Yes!&quot;</span>;
else type <span style="color: #000080;">-</span>b <span style="color: #ff00ff;">&quot;No!&quot;</span>;</pre>
<p>下記のスクリプトは、列A内の-1.95以上である最初のポイントを見つけます。
</p>
<pre class="lt" style="font-family:monospace;">newbook;
col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>data<span style="color: #000000;">(</span><span style="color: #000080;">-</span><span style="color: #0000dd;">2</span>,<span style="color: #0000dd;">2</span>,<span style="color: #0000dd;">0.01</span><span style="color: #000000;">)</span>;
val <span style="color: #000080;">=</span> <span style="color: #000080;">-</span><span style="color: #0000dd;">1.95</span>;
get col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span> <span style="color: #000080;">-</span>e numpoints;
for<span style="color: #000000;">(</span>ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>&nbsp;; ii <span style="color: #000080;">&lt;=</span> numpoints&nbsp;; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
   <span style="color: #008000;">// これは&quot;真&quot;の時にループを終了する</span>
   if <span style="color: #000000;">(</span>Col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span><span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span> <span style="color: #000080;">&gt;</span> val<span style="color: #000000;">)</span>  break;
<span style="color: #000000;">}</span>
if<span style="color: #000000;">(</span>ii <span style="color: #000080;">&gt;</span> numpoints <span style="color: #000080;">-</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>
   ty <span style="color: #000080;">-</span>b No number exceeds <span style="color: #000080;">$</span><span style="color: #000000;">(</span>val<span style="color: #000000;">)</span>;
else
   type <span style="color: #000080;">-</span>b The index number of first value <span style="color: #000080;">&gt;</span> <span style="color: #000080;">$</span><span style="color: #000000;">(</span>val<span style="color: #000000;">)</span> is <span style="color: #000080;">$</span><span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span>
The value is <span style="color: #000080;">$</span><span style="color: #000000;">(</span>col<span style="color: #000000;">(</span>a<span style="color: #000000;">)</span><span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span><span style="color: #000000;">)</span>;</pre>
<p>例えば、1つの<b>if</b>ステートメントで複数の条件を確かめることができます。
</p>
<pre class="lt" style="font-family:monospace;">if<span style="color: #000000;">(</span>a<span style="color: #000080;">&gt;</span><span style="color: #0000dd;">1</span> <span style="color: #000080;">&amp;&amp;</span> a<span style="color: #000080;">&lt;</span><span style="color: #0000dd;">3</span><span style="color: #000000;">)</span> b<span style="color: #000080;">+</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// 真の場合、bの値を1つ増加させる</span></pre>
<p>&amp;&amp; (論理和) 演算子は、LabTalkでサポートされているいくつかの<a href="../../LabTalk/LabTalk/Operators.html#Logical_and_Relational_Operators" title="LabTalk:演算子">論理演算子</a>の1つです。
</p>
<h3><a name="Switch"></a><span class="mw-headline">Switch</span></h3>
<p><span class="OIndex">switch</span>コマンドは、2つ又はそれ以上の条件があって、条件を満たした指定スクリプトを実行をする場合に使用します。例えば、次のスクリプトはbを返します。
</p>
<pre class="lt" style="font-family:monospace;">ii<span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>;
switch <span style="color: #000000;">(</span>ii<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
     case <span style="color: #0000dd;">1</span><span style="color: #000000;">:</span>
         type <span style="color: #ff00ff;">&quot;a&quot;</span>; 
         break;
     case <span style="color: #0000dd;">2</span><span style="color: #000000;">:</span>
         type <span style="color: #ff00ff;">&quot;b&quot;</span>; 
         break;
     case <span style="color: #0000dd;">3</span><span style="color: #000000;">:</span>
         type <span style="color: #ff00ff;">&quot;c&quot;</span>; 
         break;
     default<span style="color: #000000;">:</span>
         type <span style="color: #ff00ff;">&quot;none&quot;</span>; 
         break;
<span style="color: #000000;">}</span></pre>
<h3><a name="Break_and_Progress_Bars"></a><span class="mw-headline">Breakとプログレスバー</span></h3>
<p>LabTalkには<a href="../../LabTalk/LabTalk/Break_(command).html" title="LabTalk:Break (コマンド)"><span class="OIndex">break</span></a> コマンドがあります。  これを実行すると、ループから抜け、任意でスクリプトを終了します。これは、ループ内の分岐構造でよく利用されます。ループのテスト条件を無効にする条件から保護するために使われます。breakコマンドは、ループの処理を表示する現在の処理状況ダイアログボックス(プログレスバー)を表示するのに使うことができます。
</p>
<h3><a name="Exit"></a><span class="mw-headline">Exit</span></h3>
<p><span class="OIndex">exit</span> コマンドは、予めフラグを強制的に終了するようセットしていれば、Originを終了する際のメッセージボックスが表示されます。
</p>
<h3><a name="Continue"></a><span class="mw-headline">Continue</span></h3>
<p><span class="OIndex">continue</span> コマンドは、ループ内で使うことができます。これを実行すると、ループスクリプト内の残りの部分は無視され、インタプリタは次のループを実行します。これは、ループ内の分岐構造と一緒に使われ、ループスクリプトでの処理から不正な値を除外できます。
</p><p>例えば、下記のforループにおいて、iiがゼロより小さい場合に、continue文はtype文を飛ばします。
</p>
<pre class="lt" style="font-family:monospace;">for <span style="color: #000000;">(</span>ii <span style="color: #000080;">=</span> <span style="color: #000080;">-</span><span style="color: #0000dd;">10</span>; ii <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">10</span>; ii <span style="color: #000080;">+</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span><span style="color: #000000;">)</span> 
<span style="color: #000000;">{</span>
   if <span style="color: #000000;">(</span>ii <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>
     continue;

   type <span style="color: #ff00ff;">&quot;$(sqrt(ii))&quot;</span>;
<span style="color: #000000;">}</span></pre>
<h2><a name="Sections_in_a_Script_File"></a><span class="mw-headline">スクリプトファイル内のセクション</span></h2>
<p>ラベルコントロールダイアログにスクリプトを入力するだけでなく、<a href="../../LabTalk/Script/From_Files.html#The_OGS_File_Extension" title="Script:ファイルから">Originスクリプトファイル(OGS)</a>として保存することもできます。Originスクリプトファイルは、ASCIIテキストファイルで、1行以上のLabTalkステートメントで構成されています。  複数ステートメントを複数セクションに分けることができます。<a href="../../LabTalk/Script/From_Files.html#Sections_in_an_OGS_File" title="Script:ファイルから"><span class="OIndex">セクション</span></a> は、次のようにセクション名を角括弧で囲んで、この内容だけを宣言します。
</p><p>[<i>SectionName</i>]
</p><p>別のセクションの宣言が現れるまで、宣言したセクション内にあるスクリプトがそのセクションに属します。  セクションを持つスクリプトのフレームワークは、次のようなものです。
</p>
<pre class="lt" style="font-family:monospace;">...
<span style="color: #000080;">Scripts</span>;
...
<span style="color: #000000;">[</span>Section <span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>
...
<span style="color: #000080;">Scripts</span>;
...
<span style="color: #000000;">[</span>Section <span style="color: #0000dd;">2</span><span style="color: #000000;">]</span>
...
<span style="color: #000080;">Scripts</span>;
...</pre>
<p>各スクリプトは、新しいセクションが現れるか、returnステートメントが実行されるか、エラーが発生するまで順番に実行されます。セクション内のスクリプトを実行するには、次のようなコマンドを使います。 
</p><p><a href="../../LabTalk/LabTalk/Run_(object).html#Methods:" title="LabTalk:Run (オブジェクト)">run.section(<i>FileName</i>, <i>SectionName</i>)</a>
</p><p>command.FileName が含まれていないとき、現在実行されているスクリプトファイル内のセクションであると見なされます。
</p><p>run.section( ,Init);
</p><p>次のスクリプトは、OGSファイル内のセクションを呼び出す方法を示しています。
</p>
<pre class="lt" style="font-family:monospace;">type <span style="color: #ff00ff;">&quot;Hello, we will run section 2&quot;</span>;
run.<span style="color: #000080;">section</span><span style="color: #000000;">(</span>, section2<span style="color: #000000;">)</span>;

<span style="color: #000000;">[</span>section1<span style="color: #000000;">]</span>
type <span style="color: #ff00ff;">&quot;This is section 1, End the script.&quot;</span>;

<span style="color: #000000;">[</span>section2<span style="color: #000000;">]</span>
type <span style="color: #ff00ff;">&quot;This is section 2, run section 1.&quot;</span>;
run.<span style="color: #000080;">section</span><span style="color: #000000;">(</span>, section1<span style="color: #000000;">)</span>;</pre>
<p>スクリプトを実行するには、Originのユーザフォルダにtest.ogsと保存し、コマンドウィンドウに次のように入力します。
</p>
<pre class="lt" style="font-family:monospace;">run.<span style="color: #000080;">section</span><span style="color: #000000;">(</span>test<span style="color: #000000;">)</span>;</pre>
<p>セクション内のコードが意図せずセクションを終了させるようなエラーを引き起こす場合、テスト用の変数を使うことができます。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #000000;">[</span>Test<span style="color: #000000;">]</span>
SectionPassed <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
<span style="color: #008000;">// 実行時にエラーとなるコード
</span>
...
<span style="color: #000080;">SectionPassed</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;</pre>
<p>コードがエラーの場合、SectionPassedには0の値がセットされます。コードが問題ない場合、SectionPassedには1の値がセットされます。
</p>






    