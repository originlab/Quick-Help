<h1 class="firstheading">画像処理</h1>
<p class="urlname" style="display: none;">Image-Processing</p>
<p>Origin 8は、以前のバージョンに比べ、画像処理の機能が拡張されています。 基本的な画像処理に必要な操作を実行するサンプルとLabTalkスクリプトとして以下に示します。</p>
<p>画像処理を行うのに利用可能なすべてのXファンクションを表示するには、次のコマンドを使います。</p>
<pre class="lt" style="font-family: monospace;">
lx cat<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">"image*"</span>;
</pre>
<p>いくつかのXファンクションはOriginProでのみ利用できます。</p>
<div id="toc" class="toc">
<div id="toctitle">
<h2>Contents</h2>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Rotate_and_Make_Image_Compact"><span class="tocnumber">1</span> <span class="toctext">回転および画像を小さくする</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Edge_Detection"><span class="tocnumber">2</span> <span class="toctext">エッジ検出</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Apply_Rainbow_Palette_to_Gray_Image"><span class="tocnumber">3</span> <span class="toctext">Rainbowパレットをグレー画像に適用する</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Converting_Image_to_DataConverting_Image_to_Data"><span class="tocnumber">4</span> <span class="toctext">画像をデータに変換する</span></a></li>
</ul>
</div>
<h2><a name="Rotate_and_Make_Image_Compact" id="Rotate_and_Make_Image_Compact"></a><span class="mw-headline">回転および画像を小さくする</span></h2>
<p>この例では、画像を回転し、余白を切り取り、自動レベルを適用して、より小さく、明確にします。<br />
<a class="image"><img alt="ImageRotate Trim AutoLevel.jpg" src="../images/Image_Processing/ImageRotate_Trim_AutoLevel.jpg" width="600" border="0" /></a></p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">//プロジェクトエクスプローラに新しいフォルダを作成</span>
pe_mkdir RotateTrim path<span style="color: #000000;">:</span><span style="color: #000080;">=</span>aa<span style="color: #000080;">$</span>;
pe_cd aa<span style="color: #000080;">$</span>;
 <span style="color: #008000;">
//行列を作成し、そこに画像をインポート</span>
window <span style="color: #000080;">-</span>t m;
string fpath<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">"samples\Image Processing and Analysis\rice.bmp"</span>;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> System.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> fpath<span style="color: #000080;">$</span>;
impimage;
window <span style="color: #000080;">-</span>r <span style="color: #000080;">%</span>h Original;
 <span style="color: #008000;">
//元の画像の寸法を取得</span>
matrix <span style="color: #000080;">-</span>pg DIM nCol1 nRow1;         
 
window <span style="color: #000080;">-</span>d; <span style="color: #008000;">//画像の複製</span>
window <span style="color: #000080;">-</span>r <span style="color: #000080;">%</span>h Modified;
 
imgRotate angle<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">42</span>;
imgTrim t<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">17</span>;
 
matrix <span style="color: #000080;">-</span>pg DIM nCol2 nRow2; <span style="color: #008000;">//修正した画像の寸法を取得</span>
 
imgAutoLevel;<span style="color: #008000;">// 画像に自動レベルを適用</span>
 
window <span style="color: #000080;">-</span>s T;       <span style="color: #008000;">//ウィンドウを水平に並べて表示</span>
 <span style="color: #008000;">
//レポート</span>
window <span style="color: #000080;">-</span>n n Report;
old <span style="color: #000080;">=</span> type.<span style="color: #000080;">redirection</span>;
type.<span style="color: #000080;">redirection</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;
type.<span style="color: #000080;">notes</span><span style="color: #000080;">$</span><span style="color: #000080;">=</span>Report;
type <span style="color: #ff00ff;">"Dimension of the original image: "</span>;
type <span style="color: #ff00ff;">"   $(nCol1) * $(nRow1)\r\n"</span>;   <span style="color: #008000;">//  "754 * 668"</span>
type <span style="color: #ff00ff;">"Dimension of the modified image:"</span>;   <span style="color: #008000;">//  "688 * 601"</span>
type <span style="color: #ff00ff;">"   $(nCol2) * $(nRow2)\r\n"</span>;
type.<span style="color: #000080;">redirection</span> <span style="color: #000080;">=</span> old;
</pre>
<p>また、新しい画像ウィンドウで画像の回転、サイズ変更、カラースケールの調整もできます。</p>
<p class="version">必要なOriginのバージョン： 2016 SR0</p>
<pre class="lt" style="font-family: monospace;">
fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> SYSTEM.<span style="color: #000080;">PATH</span>.<span style="color: #000080;">PROGRAM</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">"Samples\Image Processing and Analysis\Rice.bmp"</span>;
cvopen fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fname<span style="color: #000080;">$</span>;  <span style="color: #008000;">//新規ウィンドウにイメージを開く;</span>
cvRotate angle<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">-</span><span style="color: #0000dd;">42</span> interp<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> resize<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> trim<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">//画像の回転とサイズ変更</span>
cvGray img<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>active<span style="color: #000080;">&gt;</span>;
cvHistEq img<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>active<span style="color: #000080;">&gt;</span>;   <span style="color: #008000;">//ヒストグラムを均等化</span>
</pre>
<h2><a name="Edge_Detection" id="Edge_Detection"></a><span class="mw-headline">エッジ検出</span></h2>
<p>細胞の画像から背景を除去し、エッジを検出します。<br />
<a class="image"><img alt="Edges detect from cells.jpg" src="../images/Image_Processing/Edges_detect_from_cells.jpg" width="600" border="0" /></a></p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">//プロジェクトエクスプローラに新しいフォルダを作成</span>
pe_mkdir EdgeDetection path<span style="color: #000000;">:</span><span style="color: #000080;">=</span>aa<span style="color: #000080;">$</span>;
pe_cd aa<span style="color: #000080;">$</span>;
 <span style="color: #008000;">
//行列を作成し、そこに細胞の画像をインポート</span>
window <span style="color: #000080;">-</span>t m;
string fpath<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">"samples\Image Processing and Analysis\cell.jpg"</span>;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> System.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> fpath<span style="color: #000080;">$</span>;
impimage;
cell<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>h;
 <span style="color: #008000;">
//行列を作成し、そこに背景の画像をインポート</span>
window <span style="color: #000080;">-</span>t m;
string fpath<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">"samples\Image Processing and Analysis\bgnd.jpg"</span>;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> System.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> fpath<span style="color: #000080;">$</span>;
impimage;
cellbk<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>h;
 <span style="color: #008000;">
//背景を除去し、前処理を行う</span><span style="color: #008000;">
//x, y はImage2のオフセット</span>
imgSimpleMath img1<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cellbk<span style="color: #000080;">$</span> img2<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cell<span style="color: #000080;">$</span> func<span style="color: #000000;">:</span><span style="color: #000080;">=</span>sub12 x<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">7</span> y<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">13</span> crop<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;<span style="color: #008000;">
//最低および最高の明度をバイナリ0または1に指定する</span>
imgBinary t1<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">65</span> t2<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">255</span>;<span style="color: #008000;">
// メディアンフィルタの次数は18</span>
imgMedian d<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">18</span>;
 <span style="color: #008000;">
//エッジ検出</span><span style="color: #008000;">
// エッジピクセルを決定するのに使用するしきい値12を指定 </span><span style="color: #008000;">
//そして shv(Sobel 水平&amp;垂直) エッジ検出フィルタを適用</span>
imgEdge t<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">12</span> f<span style="color: #000000;">:</span><span style="color: #000080;">=</span>shv;
edge<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>h;
 <span style="color: #008000;">
//エッジを細胞の画像に追加して戻す</span>
imgSimpleMath img1<span style="color: #000000;">:</span><span style="color: #000080;">=</span>edge<span style="color: #000080;">$</span> img2<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cell<span style="color: #000080;">$</span> func<span style="color: #000000;">:</span><span style="color: #000080;">=</span>add;
window <span style="color: #000080;">-</span>z;
</pre>
<h2><a name="Apply_Rainbow_Palette_to_Gray_Image" id="Apply_Rainbow_Palette_to_Gray_Image"></a><span class="mw-headline">Rainbowパレットをグレー画像に適用する</span></h2>
<p>この例では、グレー画像をレインボーカラーに変換する方法を示します。<br />
<a class="image"><img alt="Gray2rainbow.jpg" src="../images/Image_Processing/Gray2rainbow.jpg" width="600" border="0" /></a></p>
<pre class="lt" style="font-family: monospace;">
pe_mkdir Conversion path<span style="color: #000000;">:</span><span style="color: #000080;">=</span>aa<span style="color: #000080;">$</span>;
pe_cd aa<span style="color: #000080;">$</span>;
 <span style="color: #008000;">
//行列を作成し、サンプル画像をインポート</span>
window <span style="color: #000080;">-</span>t m;
path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> System.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span>;
fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> path<span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">"samples\Image Processing and Analysis\myocyte8.tif"</span>;
impimage;
window <span style="color: #000080;">-</span>r <span style="color: #000080;">%</span>h Original;
 
window <span style="color: #000080;">-</span>d; <span style="color: #008000;">//画像の複製</span>
window <span style="color: #000080;">-</span>r <span style="color: #000080;">%</span>h newimage;
 
imgC2gray;      <span style="color: #008000;">//グレーに変換</span>
 <span style="color: #008000;">
//パレットを適用</span>
fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> System.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">"palettes\Rainbow.PAL"</span>;
imgpalette palfile<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fname<span style="color: #000080;">$</span>;
 
window <span style="color: #000080;">-</span>s T;       <span style="color: #008000;">//パレットを適用</span>
</pre>
<p><br />
新しい画像ウィンドウでグレースケール画像にパレットを追加します。</p>
<p class="version">必要なOriginのバージョン：2016 SR0</p>
<pre class="lt" style="font-family: monospace;">
fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> SYSTEM.<span style="color: #000080;">PATH</span>.<span style="color: #000080;">PROGRAM</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">"Samples\Image Processing and Analysis\cell.jpg"</span>;
cvopen fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fname<span style="color: #000080;">$</span>;  <span style="color: #008000;">//新しいウィンドウに画像を開く;</span>
cvGray img<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>active<span style="color: #000080;">&gt;</span>;
cvPalette img<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>active<span style="color: #000080;">&gt;</span> fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">"C:\Program Files\OriginLab\Origin2016\Palettes\Lite Cyan.pal"</span>;
</pre>
<h2><a name="Converting_Image_to_DataConverting_Image_to_Data" id="Converting_Image_to_DataConverting_Image_to_Data"></a><span class="mw-headline">画像をデータに変換する</span></h2>
<p>画像を行列オブジェクトに変換するとき、<b>Image</b>データ型として維持され、ウィンドウの右上にアイコン <b>I</b> で示されます。<b>2D FFT</b> のようなある数学操作を行うには、データ型を<b>Data</b> 型に変換する必要があり、そうすると、ウィンドウの右上のアイコンは<b>D</b> で示されます。</p>
<p>このスクリプト例では、複数の画像を行列ブックにインポートし、それらを<b>data</b>型に変換することを示します。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">//ワイルドカードを使ってファイルを検索</span>
string path<span style="color: #000080;">$</span><span style="color: #000080;">=</span>system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span><span style="color: #000080;">+</span><span style="color: #ff00ff;">"Samples\Image Processing and Analysis"</span>;
findFiles ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">"*tif*"</span>;
 <span style="color: #008000;">
// 新しい行列ブックを作成し、すべての画像を新しいシートとしてインポート</span>
newbook mat<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
impImage options.<span style="color: #000080;">FirstMode</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> options.<span style="color: #000080;">Mode</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">4</span>;<span style="color: #008000;">
//すべてのシートをループし、画像をバイトデータに変換</span>
doc <span style="color: #000080;">-</span>e LW <span style="color: #000000;">{</span>
   img2m om<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>input<span style="color: #000080;">&gt;</span> type<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;<span style="color: #000000;">
}</span>
</pre>
