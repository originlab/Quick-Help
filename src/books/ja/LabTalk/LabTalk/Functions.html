<h1 class="firstheading">関数</h1><p class='urlname' style='display: none'>関数</p>
<p>関数は、ほとんどのプログラミング言語の中核的なものです。以下は、LabTalkでの関数のシンタックスと用法についての説明です。
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Built-In_Functions"><span class="tocnumber">1</span> <span class="toctext">組み込み関数</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#User-Defined_Functions"><span class="tocnumber">2</span> <span class="toctext">ユーザ定義関数</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Passing_Arguments_by_Reference"><span class="tocnumber">2.1</span> <span class="toctext">リファレンスで引数を渡す</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Dataset_Functions"><span class="tocnumber">3</span> <span class="toctext">データセット関数</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Fitting_Functions"><span class="tocnumber">4</span> <span class="toctext">フィット関数</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Scope_of_Functionsscope_of_a_function"><span class="tocnumber">5</span> <span class="toctext">関数のスコープ<span class="OIndex" style="display:none">scope of a function</span></span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Examples:_Scope_of_Functions"><span class="tocnumber">5.1</span> <span class="toctext">サンプル: 関数のスコープ</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#Tutorial:_Using_Multiple_Function_Features"><span class="tocnumber">6</span> <span class="toctext">チュートリアル: 複数の関数機能を使う</span></a></li>
</ul>
</div>

<h2><a name="Built-In_Functions"></a><span class="mw-headline">組み込み関数</span></h2>
<p>LabTalkは、 組み込み関数を使って、多くの操作をサポートしています。関数の一覧およびそれぞれの説明は、<a href="../../LabTalk/Category/Function_Reference_(Labtalk).html" title="カテゴリー:関数リファレンス (Labtalk)">関数リファレンス</a>にあります。   次のようなシンタックスで関数を呼び出します。
</p><p><b><i>outputVariable</i> = <i>FunctionName</i>(Arg1, Arg2, ..., Arg N);</b>
</p><p>以下は組み込み関数の使用例です。
</p><p><a href="../../LabTalk/LabTalk/Count_(function).html" title="LabTalk:Count (関数)"><b>Count</b> (関数)</a> は、ベクターデータ内の要素の数を整数で返します。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// アクティブなワークシートの列Aにある要素の数を返す</span>
int cc <span style="color: #000080;">=</span> count<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;</pre>
<p><a href="../../LabTalk/LabTalk/Ave_(function).html" title="LabTalk:Ave (関数)"><b>Ave</b> (関数)</a>は、データセットのグループの平均を計算し、range変数で結果を返します。
</p>
<pre class="lt" style="font-family:monospace;">range ra <span style="color: #000080;">=</span> <span style="color: #000000;">[</span>Book1<span style="color: #000000;">]</span>Sheet1<span style="color: #000080;">!</span>Col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span>;
range rb <span style="color: #000080;">=</span> <span style="color: #000000;">[</span>Book1<span style="color: #000000;">]</span>Sheet1<span style="color: #000080;">!</span>Col<span style="color: #000000;">(</span>B<span style="color: #000000;">)</span>;
<span style="color: #008000;">// グループの平均値を返す</span>
rb <span style="color: #000080;">=</span> ave<span style="color: #000000;">(</span>ra, <span style="color: #0000dd;">5</span><span style="color: #000000;">)</span>;    <span style="color: #008000;">// 5 = グループサイズ</span></pre>
<p><a href="../../LabTalk/LabTalk/Sin_(function).html" title="LabTalk:Sin (関数)"><b>Sin</b> (関数)</a> は、入力角度のsinを<b>double</b>型で返します。(入力角度の単位は、<b>system.math.angularunits</b>の値で決まります。)
</p>
<pre class="lt" style="font-family:monospace;">system.<span style="color: #000080;">math</span>.<span style="color: #000080;">angularunits</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// 1 = 度数で入力</span>
double dd <span style="color: #000080;">=</span> sin<span style="color: #000000;">(</span><span style="color: #0000dd;">45</span><span style="color: #000000;">)</span>;         <span style="color: #008000;">// ANS: DD = 0.7071</span></pre>
<p>戻り値の型がデータセットまたは文字列配列である関数の場合、[index] を使用して配列内の対応するデータを取得し、それを式で使用できます。
</p><p><a href="../../LabTalk/LabTalk/Unique_(function).html" title="LabTalk:Unique(関数)"><b>Unique</b> (関数)</a>は、指定したデータセット内の固有の数値または文字列のリストを返します。 
</p>
<pre class="lt" style="font-family:monospace;">Col<span style="color: #000000;">(</span>B<span style="color: #000000;">)</span><span style="color: #000080;">=</span>unique<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>; <span style="color: #008000;">//列Aの一意の数値を降順で取得。第2引数は降順を意味します</span>

<span style="color: #008000;">//2番目の引数はスキップされ、出力は昇順になります</span>
<span style="color: #008000;">//[index] - 出力の1番目の値 (最小値) </span>
Col<span style="color: #000000;">(</span>C<span style="color: #000000;">)</span><span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span><span style="color: #000080;">=</span>unique<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>; <span style="color: #008000;">//列Cの行1には、Aで見つかった最小の一意の番号が入力されます</span>

<span style="color: #008000;">//[0] は最後のインデックスなので、 unique(Col(A))[0]はAで見つかった最大の一意の番号を参照</span>
Col<span style="color: #000000;">(</span>D<span style="color: #000000;">)</span><span style="color: #000080;">=</span>Col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span><span style="color: #000080;">-</span>unique<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span>;</pre>
<h2><a name="User-Defined_Functions"></a><span class="mw-headline">ユーザ定義関数</span></h2>
<p>Origin 8.1以降、複数引数のユーザ定義関数がLabTalk でサポートされています。ユーザ定義関数の構文は次のとおりです。
</p><p><b>function <i>dataType</i> <i>funcName</i>(<i>Arg1</i>, <i>Arg2</i>, ..., <i>ArgN</i>)</b>
<b>{<i>script</i>;}</b>
</p>
<p class="version" >必要なOriginのバージョン: Origin 8.6 SR0以降</p>
<p>Note:
</p>
<ol>
<li>関数名は42文字未満にする必要があります。 

<li>引数と戻り値の両方が<b>string</b>、double、int、dataset、<b>tree</b>データ型をサポートしています。デフォルトの引数の型は<b>double</b>です。デフォルトの戻り値の型は<b>int</b>です。

<li>デフォルトでユーザ定義関数の引数は値で渡され、関数内のその引数の値は、関数の外部では利用<i>できません</i>。  しかし、<a href="#Passing_Arguments_by_Reference">リファレンスで渡す引数</a>は、関数内部で引数の値に変わり、関数の外部でも利用できます。外部で利用するには<b>REF</b>というキーワードを使います。
</ol>
<p>数値関数の簡単な例をいくつか示します。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// この関数は数値関数の立方根を計算</span>
function double dCubeRoot<span style="color: #000000;">(</span>double dVal<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    double xVal;
    if<span style="color: #000000;">(</span>dVal<span style="color: #000080;">&lt;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> xVal <span style="color: #000080;">=</span> <span style="color: #000080;">-</span>exp<span style="color: #000000;">(</span>ln<span style="color: #000000;">(</span><span style="color: #000080;">-</span>dVal<span style="color: #000000;">)</span><span style="color: #000080;">/</span><span style="color: #0000dd;">3</span><span style="color: #000000;">)</span>;
    else xVal <span style="color: #000080;">=</span> exp<span style="color: #000000;">(</span>ln<span style="color: #000000;">(</span>dVal<span style="color: #000000;">)</span><span style="color: #000080;">/</span><span style="color: #0000dd;">3</span><span style="color: #000000;">)</span>;
    return xVal;
<span style="color: #000000;">}</span>
<span style="color: #008000;">// ここに示す</span>
dcuberoot<span style="color: #000000;">(</span><span style="color: #000080;">-</span><span style="color: #0000dd;">8</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>;</pre>
<p>以下の関数は、データセットの幾何平均を計算します。
</p>
<pre class="lt" style="font-family:monospace;">function double dGeoMean<span style="color: #000000;">(</span>dataset ds<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    double dG <span style="color: #000080;">=</span> ds<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>; 
    for<span style="color: #000000;">(</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>&nbsp;; ii <span style="color: #000080;">&lt;=</span> ds.<span style="color: #000080;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>&nbsp;; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
        dG <span style="color: #000080;">*</span><span style="color: #000080;">=</span> ds<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span>; <span style="color: #008000;">// データセット内のすべての値を乗算</span>
    return exp<span style="color: #000000;">(</span>ln<span style="color: #000000;">(</span>dG<span style="color: #000000;">)</span><span style="color: #000080;">/</span>ds.<span style="color: #000080;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span>
<span style="color: #008000;">// 引数はデータセットを返す</span>
dGeoMean<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Raw Data&quot;</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>;</pre>
<p>この例は、範囲を引数で受け付けて、その範囲内のデータの平均を返す関数を定義します。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// 範囲の平均を計算</span>
function double dsmean<span style="color: #000000;">(</span>range ra<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
   stats ra;
   return stats.<span style="color: #000080;">mean</span>;
<span style="color: #000000;">}</span>
<span style="color: #008000;">// アクティブブックの最初のシートの</span>
<span style="color: #008000;">// すべての列を指定する範囲を渡す</span>
range rAll <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">:</span>end<span style="color: #000000;">)</span>;
dsMean<span style="color: #000000;">(</span>rAll<span style="color: #000000;">)</span><span style="color: #000080;">=</span>;</pre>
<p>この例は、日付データセット内の特定の曜日の出現を数える関数を定義します。
</p>
<pre class="lt" style="font-family:monospace;">function int iCountDays<span style="color: #000000;">(</span>dataset ds, int iDay<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    int iCount <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
    for<span style="color: #000000;">(</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>&nbsp;; ii <span style="color: #000080;">&lt;=</span> ds.<span style="color: #000080;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>&nbsp;; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        if<span style="color: #000000;">(</span>weekday<span style="color: #000000;">(</span>ds<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span>, <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> <span style="color: #000080;">==</span> iDay<span style="color: #000000;">)</span> iCount<span style="color: #000080;">++</span>;
    <span style="color: #000000;">}</span>
    return iCount;
<span style="color: #000000;">}</span>
<span style="color: #008000;">// ここでは、金曜日を数える</span>
iVal <span style="color: #000080;">=</span> iCountDays<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>,<span style="color: #0000dd;">6</span><span style="color: #000000;">)</span>; <span style="color: #008000;">// weekday(data, 1)で6は金曜日</span>
iVal<span style="color: #000080;">=</span>;</pre>
<p>関数はデータセットを返すこともできます。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// データセットから負の値のみ取得</span>
function dataset dsSub<span style="color: #000000;">(</span>dataset ds1<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    dataset ds2;
    int iRow <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
    for<span style="color: #000000;">(</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>&nbsp;; ii <span style="color: #000080;">&lt;=</span> ds1.<span style="color: #000080;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>&nbsp;; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        if<span style="color: #000000;">(</span>ds1<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span> <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>
        <span style="color: #000000;">{</span>
            ds2<span style="color: #000000;">[</span>iRow<span style="color: #000000;">]</span> <span style="color: #000080;">=</span> ds1<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span>;
            iRow<span style="color: #000080;">++</span>;
        <span style="color: #000000;">}</span>
    <span style="color: #000000;">}</span>
    return ds2;
<span style="color: #000000;">}</span>
<span style="color: #008000;">//列1の負の値すべてを列2に割り当て</span>
col<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> dsSub<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;</pre>
<p>または、文字列を返します。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// サブ文字列が現れるデータセット内のすべての値を取得</span>
function string strFind<span style="color: #000000;">(</span>dataset ds, string strVal<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    string strTest, strResult;
    for<span style="color: #000000;">(</span> int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>&nbsp;; ii <span style="color: #000080;">&lt;=</span> ds.<span style="color: #000080;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>&nbsp;; ii<span style="color: #000080;">++</span> <span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        strTest<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> ds<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span><span style="color: #000080;">$</span>;
        if<span style="color: #000000;">(</span> strTest.<span style="color: #000080;">Find</span><span style="color: #000000;">(</span>strVal<span style="color: #000080;">$</span><span style="color: #000000;">)</span> <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">0</span> <span style="color: #000000;">)</span>
        <span style="color: #000000;">{</span>
            strResult<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span><span style="color: #000000;">(</span>strResult<span style="color: #000080;">$</span><span style="color: #000000;">)</span><span style="color: #000080;">%</span><span style="color: #000000;">(</span>CRLF<span style="color: #000000;">)</span><span style="color: #000080;">%</span><span style="color: #000000;">(</span>strTest<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;
        <span style="color: #000000;">}</span>
    <span style="color: #000000;">}</span>
    return strResult<span style="color: #000080;">$</span>;
<span style="color: #000000;">}</span>
<span style="color: #008000;">// &quot;hadron&quot;が現れる列3のすべてのインスタンスを取得</span>
string MyResults<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> strFind<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">3</span><span style="color: #000000;">)</span>,<span style="color: #ff00ff;">&quot;hadron&quot;</span><span style="color: #000000;">)</span><span style="color: #000080;">$</span>; <span style="color: #008000;">// 「$」記号で終わる事に注意</span>
MyResults<span style="color: #000080;">$</span><span style="color: #000080;">=</span>;</pre>
<h3><a name="Passing_Arguments_by_Reference"></a><span class="mw-headline">リファレンスで引数を渡す</span></h3>
<p>この例は、<b>tree</b> ノードの値を整数（int）(<a href="../../LabTalk/LabTalk/Data_Types_and_Variables.html" title="LabTalk:データ型と変数">tree変数</a>の1要素)として返す関数を示します。  さらに、リファレンスで渡すことは、<b>REF</b>キーワードを使って示しています。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// 関数定義</span>
Function int GetMinMax<span style="color: #000000;">(</span>range rr, ref double min, ref double max<span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
  stats rr;
  <span style="color: #008000;">//stats Xファンクションを実行した後、同じ名前を持つ</span>
  <span style="color: #008000;">//LabTalkのtree変数を作成/更新</span>
  min <span style="color: #000080;">=</span> stats.<span style="color: #000080;">min</span>;
  max <span style="color: #000080;">=</span> stats.<span style="color: #000080;">max</span>;
  return stats.<span style="color: #000080;">N</span>;
<span style="color: #000000;">}</span>

<span style="color: #008000;">// GetMinMax関数を呼び、ワークシート全体に対する最小値と最大値を探す</span>
double y1,y2;
int nn <span style="color: #000080;">=</span> getminmax<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">:</span>end,y1, y2<span style="color: #000000;">)</span>;
type <span style="color: #ff00ff;">&quot;Worksheet has $(nn) points, min=$(y1), max=$(y2)&quot;</span>;</pre>
<p>LabTalk関数でのツリー変数の使用と参照による変数渡しに関する<a href="../../LabTalk/LabTalk/Curve_Fitting.html#Fit_Multiple_Columns_in_a_Worksheet" title="LabTalk:カーブフィット">詳細なサンプル</a>を参照して下さい。
</p><p>リファレンスで文字列の引数を渡す別のサンプルが以下にあり、これは関数呼び出しで、変数の最後に$を付けません。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//最初のシートの範囲文字列を返す</span>
<span style="color: #008000;">//実際の新しいブックのショートネームがName$で返される</span>
Function string GetNewBook<span style="color: #000000;">(</span>int nSheets, ref string Name<span style="color: #000080;">$</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	newbook sheet<span style="color: #000000;">:</span><span style="color: #000080;">=</span> nSheets result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>Name<span style="color: #000080;">$</span>;	
	string strRange<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;[%(Name$)]1!&quot;</span>;	
	return strRange<span style="color: #000080;">$</span>;
<span style="color: #000000;">}</span></pre>
<p>上記関数を呼び出すとき、Name$引数が次に示すように、$記号を付けないことが重要です。
</p>
<pre class="lt" style="font-family:monospace;">string strName<span style="color: #000080;">$</span>;
string strR<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> GetNewBook<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, strName<span style="color: #000000;">)</span><span style="color: #000080;">$</span>;
strName<span style="color: #000080;">$</span><span style="color: #000080;">=</span>;
strR<span style="color: #000080;">$</span><span style="color: #000080;">=</span>;</pre>
<h2><a name="Dataset_Functions"></a><span class="mw-headline">データセット関数</span></h2>
<p>Originは、double型の引数を受け付け、double型で返す数学関数もサポートしています。このような関数の一般的なシンタックスは次の通りです。
</p><p><b>funcName(X) = <i>expressionInvolvingX</i></b>.
</p><p>これらの<span class="OIndex">データセット関数</span>が定義されるとき、これらを呼び出し、名前でデータセットが作成されます。  このデータセットは、関数と結びつき、Originプロジェクトの一部として保存されます。   一度定義したら、データセット関数は、名前で参照され、組み込み関数のように使用することができます。
</p><p>例えば、スクリプトウィンドウに次のスクリプトを入力して、<b>Salary</b>という関数を定義します。  
</p>
<pre class="lt" style="font-family:monospace;">Salary<span style="color: #000000;">(</span>x<span style="color: #000000;">)</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">52</span> <span style="color: #000080;">*</span> x</pre>
<p>一度定義したら、次のように関数を呼び出しできます。
</p>
<pre class="lt" style="font-family:monospace;">Salary<span style="color: #000000;">(</span><span style="color: #0000dd;">100</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span></pre>
<p>これは、<b>Salary(100)=5200</b>のような結果となります。  この場合、結果のデータセットは1つの要素のみを持ちます。  しかし、ベクターデータ(またはデータセット)が入力引数として渡されると、出力は入力時と同じ数の要素のデータセットとなります。
</p><p>他のデータセットと同様、ユーザ定義のデータセット関数は、<b>作図のセットアップ</b>のようなダイアログや<b>レイヤn</b>のようなダイアログ内の<b>利用可能なデータ</b>内に表示されます(そして、他のデータセットのようにプロットできます)。
</p><p>関数が定義されたとき、2Dグラフレイヤがアクティブレイヤの場合、100ポイントのデータセットがX軸スケールを使って、X範囲として作成され、関数データセットが自動的にプロットレイヤに追加されます。
</p><p><b>関数グラフテンプレート</b>(FUNCTION.OTP, <b>標準</b>ツールバーまたは<b>ファイル：新規作成</b>からアクセス可能) も作成され、データセット関数をプロットします。 
</p><p>Originの<b>関数グラフ</b>の機能は、新しいデータセット関数に組み込みおよびユーザ定義関数の組合せから簡単に作成できます。  さらに、新しく作成した関数はリファレンスに対してすぐにプロットされます。
</p><p>この機能には以下のどちらかの方法でアクセスできます。 
</p>
<ol><li> <b>標準</b>ツールバーの<b>新しい関数ウィンドウ</b>ボタンをクリックします。 <a  class="image"><img alt="Button New Function.png" src="../images/Functions/Button_New_Function.png" width="23"  /></a></li>
<li> Originのドロップダウンメニューから<b>ファイル: 新規作成</b>を選び、リストから<b>関数</b>を選び、<b>OK</b>をクリックします。</li></ol>
<p>開いた<b>作図の詳細</b>ダイアログの<b>関数</b>タブに、<i>F1(x) = 5*sin(x)+1</i> のように関数定義を入力し、<b>OK</b>をクリックします。グラフに関数がプロットされます。
</p><p>グラフの<b>新しい関数</b>ボタンをクリックして、<b>作図の詳細</b>に別の関数を追加すれば、別の関数を定義できます。  <b>OK</b>を押すと、新しい関数プロットがグラフに追加されます。  他の関数に対しても行う場合には繰り返します。
</p>
<h2><a name="Fitting_Functions"></a><span class="mw-headline">フィット関数</span></h2>
<p>多くの一般的な関数をサポートするだけでなく、Originは非線形曲線フィットで使用できる自分のフィット関数を作成することができます。   ユーザ定義のフィット関数は、新しいデータセットを生成するのに使われますが、それらを呼び出すのは、特別なシンタックスが必要です。
<span class="OIndex" style="display:none">nlf</span><span class="OIndex" style="display:none">nlf_funcname</span><span class="OIndex" style="display:none">nlf_function</span><span class="OIndex" style="display:none">nlf_FitFuncName</span><span class="OIndex" style="display:none">fitting function</span><span class="OIndex" style="display:none">call a fitting function</span>
</p><p><b>nlf_FitFuncName(ds, <i>p1</i>, <i>p2</i>, ..., <i>pn</i>)</b>
</p><p>ここで、フィット関数は<b>FitFuncName</b>という名前で、<b>ds</b>は独立変数として使われるデータセット、<i>p1</i>--<i>pn</i> はフィット関数のパラメータです。
</p><p>単純な例として、y切片と勾配が入力パラメータとなる<b>MyLine</b>という単純な直線のフィット関数を定義する場合、アクティブワークシートの列Cを独立変数、列Dを関数出力に使うには、次のように入力します。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// 切片 = 0, 傾き = 4</span>
Col<span style="color: #000000;">(</span>D<span style="color: #000000;">)</span> <span style="color: #000080;">=</span> nlf_MyLine<span style="color: #000000;">(</span>Col<span style="color: #000000;">(</span>C<span style="color: #000000;">)</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">4</span><span style="color: #000000;">)</span></pre>
<h2><a name="Scope_of_Functionsscope_of_a_function"></a><span class="mw-headline">関数のスコープ<span class="OIndex" style="display:none">scope of a function</span></span></h2>
<p>ユーザー定義変数と同様に、ユーザ定義関数は制御可能なスコープを持ちます。ユーザ定義関数は、LabTalkスクリプトをサポートしている場所ならOriginプロジェクトのどこからでもアクセスでき、定義のスコープはこのような使用に適用できます。例えば、double型またはデータセットを返す<b>@glob=1</b>で定義された関数は、<b>値の設定</b>ダイアログの<b>列の条件式</b>で使うことができます。スコープについては、<a href="../../LabTalk/LabTalk/Data_Types_and_Variables.html#Scope_of_Variables" title="LabTalk:データ型と変数">データ型と変数</a>をご覧下さい。 
</p>
<ul><li> プロジェクトの<a href="../../LabTalk/Script/ProjectEvents_Script.html" title="Script:ProjectEvents スクリプト">ProjectEvents.OGS</a> ファイルの中で、関数を定義することで、関数とプロジェクトを結びつけることができます。<b>@glob=1</b>を使用すると、プロジェクトを開くたびに関数が使用可能になります（<a href="#Tutorial:_Using_Multiple_Function_Features">このサンプル</a>参照）。</li>
<li> 関数のスコープは、<b>@glob=1</b>を使用して関数を定義し、<a class="external text" href="../../QuickHelp/QuickHelp/What_is_the_User_Files_Folder.html"><b>User Filesフォルダ</b>（<b>UFF</b>）</a>の.ogsファイルに関数を保存して、<a href="../../LabTalk/Script/On_Starting_Origin.html" title="Script:Origin起動中の処理">ここ</a>で説明しているように、Origin.ini(UFF内)の<b>[Startup]</b>セクションから.ogsファイルを呼び出すことで、Originを実行するときにいつでも使用できるように拡張できます。</li></ul>
<h3><a name="Examples:_Scope_of_Functions"></a><span class="mw-headline">サンプル: 関数のスコープ</span></h3>
<p><b>@glob=1</b>を使用して、どこでも関数を呼び出せます。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #000000;">[</span>Main<span style="color: #000000;">]</span>
	@glob<span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// 次の関数をセッションレベルとして定義</span>
	function double dGeoMean<span style="color: #000000;">(</span>dataset ds<span style="color: #000000;">)</span>
	<span style="color: #000000;">{</span>
	    double dG <span style="color: #000080;">=</span> ds<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>; 
	    for<span style="color: #000000;">(</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>&nbsp;; ii <span style="color: #000080;">&lt;=</span> ds.<span style="color: #000080;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>&nbsp;; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
	        dG <span style="color: #000080;">*</span><span style="color: #000080;">=</span> ds<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span>; <span style="color: #008000;">// データセット内の全ての値は全て掛け算する</span>
	    return exp<span style="color: #000000;">(</span>ln<span style="color: #000000;">(</span>dG<span style="color: #000000;">)</span><span style="color: #000080;">/</span>ds.<span style="color: #000080;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
	<span style="color: #000000;">}</span>
	<span style="color: #008000;">// [main]セクション内の関数を呼び出す</span>
	dGeoMean<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>;
<span style="color: #000000;">[</span>section1<span style="color: #000000;">]</span>
	<span style="color: #008000;">// 関数はこのセクションでも呼び出せる</span>
	dGeoMean<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>;</pre>
<p>関数が <b>@glob=1</b>なしで <b>*.ogs</b> ファイルに定義されている場合、そのセクション内でのみ呼び出せます。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #000000;">[</span>Main<span style="color: #000000;">]</span>
	function double dGeoMean<span style="color: #000000;">(</span>dataset ds<span style="color: #000000;">)</span>
	<span style="color: #000000;">{</span>
	    double dG <span style="color: #000080;">=</span> ds<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>; 
	    for<span style="color: #000000;">(</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>&nbsp;; ii <span style="color: #000080;">&lt;=</span> ds.<span style="color: #000080;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>&nbsp;; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
	        dG <span style="color: #000080;">*</span><span style="color: #000080;">=</span> ds<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span>; <span style="color: #008000;">// データセット内の全ての値は全て掛け算する</span>
	    return exp<span style="color: #000000;">(</span>ln<span style="color: #000000;">(</span>dG<span style="color: #000000;">)</span><span style="color: #000080;">/</span>ds.<span style="color: #000080;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
	<span style="color: #000000;">}</span>
	<span style="color: #008000;">// [main]セクション内の関数を呼び出せる</span>
	dGeoMean<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>;
<span style="color: #000000;">[</span>section1<span style="color: #000000;">]</span>
	<span style="color: #008000;">// 関数はこのセクションでも呼び出せない</span>
	dGeoMean<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>;  <span style="color: #008000;">// エラー: Unknown function</span></pre>
<p><b>@glob=1</b>を使用しないでブロック内で定義されると、そのブロックの外では呼び出せません。
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #000000;">[</span>Main<span style="color: #000000;">]</span>
<span style="color: #000000;">{</span>  <span style="color: #008000;">// 括弧間で関数を定義</span>
	function double dGeoMean<span style="color: #000000;">(</span>dataset ds<span style="color: #000000;">)</span>
	<span style="color: #000000;">{</span>
	    double dG <span style="color: #000080;">=</span> ds<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>; 
	    for<span style="color: #000000;">(</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>&nbsp;; ii <span style="color: #000080;">&lt;=</span> ds.<span style="color: #000080;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>&nbsp;; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span>
	        dG <span style="color: #000080;">*</span><span style="color: #000080;">=</span> ds<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span>; <span style="color: #008000;">// データセット内の全ての値は全て掛け算する</span>
	    return exp<span style="color: #000000;">(</span>ln<span style="color: #000000;">(</span>dG<span style="color: #000000;">)</span><span style="color: #000080;">/</span>ds.<span style="color: #000080;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
	<span style="color: #000000;">}</span>
<span style="color: #000000;">}</span>
	<span style="color: #008000;">// 括弧の外では関数を呼び出すことはできない</span>
	dGeoMean<span style="color: #000000;">(</span>col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000080;">=</span>;  <span style="color: #008000;">// エラー: Unknown function</span></pre>
<h2><a name="Tutorial:_Using_Multiple_Function_Features"></a><span class="mw-headline">チュートリアル: 複数の関数機能を使う</span></h2>
<p>次のミニチュートリアルは、Originのプロジェクトレベルにユーザ定義関数を追加し、その関数を使って関数グラフを作成する方法を示しています。 
</p>
<table class="noborder">
	<tr>
	<td style="vertical-align:top" width="60"><img src="../images/Functions/Tutorial_icon.png" width="57"  border="0" />
	</td>
	<td><ol><li> 新しいプロジェクトを開き、Originメニューから<b>表示：コードビルダ</b>を選択してコードビルダを開きます。</li>
<li> 左側のツリーパネルのProjectブランチを開き、<b>ProjectEvents.OGS</b> ファイルをダブルクリックして開きます。このファイルはデフォルトで新しいプロジェクトに存在しています。 </li>
<li> <b>[AfterOpenDoc]</b> セクションの下に次のコード行を追加します。<br />@glob=1;<br />Function double myPeak(double x, double x0)<br />{<br />    double y = 10*exp(-(x-x0)^2/4);<br />   return y;<br />}</li>
<li> ファイルを保存し、コードビルダを閉じます。</li>
<li> Originで、プロジェクトを希望の場所に保存します。OGSファイルがプロジェクトと一緒に保存され、ユーザ定義関数がプロジェクト内で利用できるようになります。</li>
<li> 保存したプロジェクトを再び開きます。これがきっかけとなり、<b>[AfterOpenDoc]</b> セクションが実行され、myPeak 関数が定義されます。</li>
<li> <b>標準</b>ツールバーの<b>2Dグラフ作成</b>ボタンをクリックするか、<b>ファイル：新規作成：関数グラフ：2Dグラフ関数</b>メニューを選択します。</li>
<li> <b>Y(x) =</b>の編集ボックスに<b>myPeak(x, 3)</b>を入力し、追加をクリックします。グラフ内に関数がプロットされます。</li>
<li> 開いているダイアログで、関数を<b>myPeak(x,4)</b>に修正します。下のドロップダウンリストで<b>アクティブなグラフに追加</b>を選択しておきます。<b>追加</b>ボタンをクリックします。修正された関数プロットがグラフに追加されます。 </li>
<li> プロジェクトを保存して他のユーザと共有できます。<b>myPeak</b>関数はプロジェクトのロード時に定義されるため、プロジェクト内でいつでもアクセスできます。</li></ol>
</td></tr></table>



    