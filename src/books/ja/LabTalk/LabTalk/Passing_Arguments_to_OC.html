<h1 class="firstheading">Origin Cに引数を渡す</h1>

  <p class='urlname' style='display: none'>Passing-Arguments-to-OC</p>

  <div id="toc" class="toc">
    <div id="toctitle">
      <h2>目次</h2>
    </div>

    <ul>
      <li class="toclevel-1 tocsection-1"><a href="#Summary"><span class="tocnumber">1</span> <span class="toctext">概要</span></a></li>

      <li class="toclevel-1 tocsection-2">
        <a href="#Examples"><span class="tocnumber">2</span> <span class="toctext">サンプル</span></a>

        <ul>
          <li class="toclevel-2 tocsection-3"><a href="#Pass_int_by_value"><span class="tocnumber">2.1</span> <span class="toctext">int型を値で渡す</span></a></li>

          <li class="toclevel-2 tocsection-4"><a href="#Pass_double_by_value"><span class="tocnumber">2.2</span> <span class="toctext">double型を値で渡す</span></a></li>

          <li class="toclevel-2 tocsection-5"><a href="#Pass_integer_by_reference"><span class="tocnumber">2.3</span> <span class="toctext">整数を参照で渡す</span></a></li>

          <li class="toclevel-2 tocsection-6"><a href="#Pass_string_by_reference"><span class="tocnumber">2.4</span> <span class="toctext">文字列を参照で渡す</span></a></li>

          <li class="toclevel-2 tocsection-7"><a href="#Pass_string_array"><span class="tocnumber">2.5</span> <span class="toctext">文字列配列を渡す</span></a></li>

          <li class="toclevel-2 tocsection-8"><a href="#Pass_column_range"><span class="tocnumber">2.6</span> <span class="toctext">列範囲を渡す</span></a></li>

          <li class="toclevel-2 tocsection-9"><a href="#Pass_worksheet_range"><span class="tocnumber">2.7</span> <span class="toctext">ワークシート範囲を渡す</span></a></li>

          <li class="toclevel-2 tocsection-10"><a href="#Pass_data_plot_range"><span class="tocnumber">2.8</span> <span class="toctext">作図範囲を渡す</span></a></li>

          <li class="toclevel-2 tocsection-11"><a href="#Pass_window_name"><span class="tocnumber">2.9</span> <span class="toctext">ウィンドウ名を渡す</span></a></li>

          <li class="toclevel-2 tocsection-12"><a href="#Pass_tree"><span class="tocnumber">2.10</span> <span class="toctext">ツリーを渡す</span></a></li>

          <li class="toclevel-2 tocsection-13"><a href="#Construct_LabTalk_Tree_with_XML"><span class="tocnumber">2.11</span> <span class="toctext">LabTalkツリーをXMLで構成する</span></a></li>

          <li class="toclevel-2 tocsection-14"><a href="#Return_range_by_string"><span class="tocnumber">2.12</span> <span class="toctext">文字列で範囲を返す</span></a></li>
        </ul>
      </li>
    </ul>
  </div>

  <h2><a name="Summary"></a><span class="mw-headline">概要</span></h2>

  <p>LabTalkとOriginCの間で作業する場合、コードで変数を渡す必要がある場合があります。LabTalkでは、数値変数（int、doubleなど）、文字列変数、および列レベルの範囲変数を直接渡すことができます。他のLabTalkオブジェクト(ワークシート範囲、グラフページ範囲など) は文字列で渡され、Origin C関数内でこれらの文字列を操作する必要があります。次の表は、LabTalkからOrigin Cに値を渡すときに関数の引数を処理する方法をまとめたものです。</p>

  <table class="simple">
    <tr>
      <th align="left">LabTalkのデータ型</th>

      <th align="left">Origin C の引数</th>

      <th align="left">参照渡しをサポート</th>
    </tr>

    <tr>
      <td>double</td>

      <td>double</td>

      <td>可</td>
    </tr>

    <tr>
      <td>int</td>

      <td>int</td>

      <td>可</td>
    </tr>

    <tr>
      <td>string</td>

      <td>string</td>

      <td>可</td>
    </tr>

    <tr>
      <td>column level range</td>

      <td>DataRange</td>

      <td>不可</td>
    </tr>

    <tr>
      <td>range</td>

      <td>string</td>

      <td>不可</td>
    </tr>

    <tr>
      <td>string registers</td>

      <td>string</td>

      <td>不可</td>
    </tr>

    <tr>
      <td>loose dataset</td>

      <td>vector</td>

      <td>不可</td>
    </tr>

    <tr>
      <td>string array</td>

      <td>vector&lt;string&gt;</td>

      <td>不可</td>
    </tr>

    <tr>
      <td>tree</td>

      <td>Tree</td>

      <td>可</td>
    </tr>
  </table>

  <p>以下のサンプルでさまざまなケースへ対処法を紹介しています。</p>

  <h2><a name="Examples"></a><span class="mw-headline">サンプル</span></h2>

  <h3><a name="Pass_int_by_value"></a><span class="mw-headline">int型を値で渡す</span></h3>

  <p>このサンプルでは、Xインデックス番号に基づいて曲線に作用するトレース補間を行い、データの連続的な面を保持して補間します。サンプルでは、Origin CとLabTalkの組み合わせて使用します。曲線の次数を表す整数n が、LabTalkでOrigin Cに渡されます。</p>

  <dl>
    <dd><a class="image"><img alt="Tract int.png" src="../images/Passing_Arguments_to_OC/Tract_int.png" width="319"></a></dd>
  </dl>

  <p><b>Origin C コード：</b></p>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>origin.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
<span style="color: #0000ff;">#define</span> aa <span style="color: #0000dd;">0.5</span>
<span style="color: #0000ff;">void</span> main_Data<span style="color: #000000;">(</span><span style="color: #0000ff;">int</span> n<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    vector<span style="color: #000080;">&lt;</span><span style="color: #0000ff;">double</span><span style="color: #000080;">&gt;</span> x<span style="color: #000080;">=</span><span style="color: #000000;">{</span><span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>, y<span style="color: #000080;">=</span><span style="color: #000000;">{</span><span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>;
    hilbert_2D<span style="color: #000000;">(</span>n, x, y<span style="color: #000000;">)</span>;
    Worksheet wks<span style="color: #000080;">=</span>Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>; 
    <span style="color: #0000ff;">if</span> <span style="color: #000000;">(</span>wks<span style="color: #000000;">)</span><span style="color: #000000;">{</span>                  
        Dataset c1<span style="color: #000000;">(</span>wks,<span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>;
        Dataset c2<span style="color: #000000;">(</span>wks,<span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;        
        c1<span style="color: #000080;">=</span>x;
        c2<span style="color: #000080;">=</span>y;
    <span style="color: #000000;">}</span>    
<span style="color: #000000;">}</span>

<span style="color: #0000ff;">void</span> hilbert_2D<span style="color: #000000;">(</span><span style="color: #0000ff;">int</span> n, vector<span style="color: #000080;">&lt;</span><span style="color: #0000ff;">double</span><span style="color: #000080;">&gt;</span> <span style="color: #000040;">&amp;</span>x, vector<span style="color: #000080;">&lt;</span><span style="color: #0000ff;">double</span><span style="color: #000080;">&gt;</span> <span style="color: #000040;">&amp;</span>y<span style="color: #000000;">)</span>  <span style="color: #008000;">//ヒルベルト曲線を作成</span>
<span style="color: #000000;">{</span>     
        vector x0 <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>, y0 <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>;  
        <span style="color: #0000ff;">while</span><span style="color: #000000;">(</span>n<span style="color: #000040;">--</span><span style="color: #000080;">&gt;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span><span style="color: #000000;">{</span>
                x0<span style="color: #000080;">=</span>x; y0<span style="color: #000080;">=</span>y;
                x.<span style="color: #000000;">RemoveAll</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
                y.<span style="color: #000000;">RemoveAll</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;   
                x.<span style="color: #000000;">Append</span><span style="color: #000000;">(</span>aa<span style="color: #000040;">*</span><span style="color: #000000;">(</span><span style="color: #000040;">-</span>aa<span style="color: #000040;">+</span>y0<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;  
                x.<span style="color: #000000;">Append</span><span style="color: #000000;">(</span>aa<span style="color: #000040;">*</span><span style="color: #000000;">(</span><span style="color: #000040;">-</span>aa<span style="color: #000040;">+</span>x0<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
                x.<span style="color: #000000;">Append</span><span style="color: #000000;">(</span>aa<span style="color: #000040;">*</span><span style="color: #000000;">(</span>aa<span style="color: #000040;">+</span>x0<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
                x.<span style="color: #000000;">Append</span><span style="color: #000000;">(</span>aa<span style="color: #000040;">*</span><span style="color: #000000;">(</span>aa<span style="color: #000040;">-</span>y0<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;

                y.<span style="color: #000000;">Append</span><span style="color: #000000;">(</span>aa<span style="color: #000040;">*</span><span style="color: #000000;">(</span><span style="color: #000040;">-</span>aa<span style="color: #000040;">+</span>x0<span style="color: #000000;">)</span><span style="color: #000000;">)</span>; 
                y.<span style="color: #000000;">Append</span><span style="color: #000000;">(</span>aa<span style="color: #000040;">*</span><span style="color: #000000;">(</span>aa<span style="color: #000040;">+</span>y0<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
                y.<span style="color: #000000;">Append</span><span style="color: #000000;">(</span>aa<span style="color: #000040;">*</span><span style="color: #000000;">(</span>aa<span style="color: #000040;">+</span>y0<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
                y.<span style="color: #000000;">Append</span><span style="color: #000000;">(</span>aa<span style="color: #000040;">*</span><span style="color: #000000;">(</span><span style="color: #000040;">-</span>aa<span style="color: #000040;">-</span>x0<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;  
        <span style="color: #000000;">}</span>
<span style="color: #000000;">}</span>
</pre>

  <p><b>LabTalkスクリプト：</b></p>
  <pre class="lt" style="font-family:monospace;">
newbook name<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Trace_Interp&quot;</span>;
main_Data<span style="color: #000000;">(</span><span style="color: #0000dd;">4</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 4次のヒルベルト曲線</span>
interp1trace <span style="color: #000080;">-</span>r <span style="color: #0000dd;">2</span> iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">[</span>Trace_Interp<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">(</span>A,B<span style="color: #000000;">)</span> method<span style="color: #000000;">:</span><span style="color: #000080;">=</span>spline;  <span style="color: #008000;">//スプライン法でトレース補間.</span>
plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">(</span><span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>,<span style="color: #000000;">(</span><span style="color: #0000dd;">3</span>,<span style="color: #0000dd;">4</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span>;
set <span style="color: #000080;">%</span>C <span style="color: #000080;">-</span>w <span style="color: #0000dd;">1500</span>; <span style="color: #008000;">// 線の太さを設定</span>
</pre>

  <h3><a name="Pass_double_by_value"></a><span class="mw-headline">double型を値で渡す</span></h3>

  <p>double、int、string変数をOrigin C関数に直接渡すことができます。</p>

  <p><b>Origin C コード：</b></p>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>origin.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>

<span style="color: #0000ff;">double</span> GetLarger<span style="color: #000000;">(</span><span style="color: #0000ff;">double</span> a, <span style="color: #0000ff;">double</span> b<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #0000ff;">return</span> a<span style="color: #000080;">&gt;</span>b?a<span style="color: #000000;">:</span>b;
<span style="color: #000000;">}</span>
</pre>

  <p><b>LabTalkスクリプト：</b></p>
  <pre class="lt" style="font-family:monospace;">
double a <span style="color: #000080;">=</span> <span style="color: #0000dd;">3.5</span>, b <span style="color: #000080;">=</span> <span style="color: #0000dd;">8.9</span>;
double c <span style="color: #000080;">=</span> GetLarger<span style="color: #000000;">(</span>a, b<span style="color: #000000;">)</span>;
ty <span style="color: #ff00ff;">&quot;The larger value is $(c)&quot;</span>;
</pre>

  <h3><a name="Pass_integer_by_reference"></a><span class="mw-headline">整数を参照で渡す</span></h3>

  <p>double、int、string型などは参照で渡すこともできます。</p>

  <p><b>Origin C コード：</b></p>
  <pre class="oc" style="font-family:monospace;">

</pre>

  <p><b>LabTalkスクリプト：</b></p>
  <pre class="lt" style="font-family:monospace;">
int a <span style="color: #000080;">=</span> <span style="color: #0000dd;">10</span>, b <span style="color: #000080;">=</span> <span style="color: #0000dd;">20</span>;
ty <span style="color: #ff00ff;">&quot;First, a = $(a), and b = $(b)&quot;</span>;
MySwap<span style="color: #000000;">(</span>a, b<span style="color: #000000;">)</span>;
ty <span style="color: #ff00ff;">&quot;Then, a = $(a), and b = $(b)&quot;</span>;
</pre>

  <h3><a name="Pass_string_by_reference"></a><span class="mw-headline">文字列を参照で渡す</span></h3>

  <p>文字列変数はOrigin C関数に直接渡すことができ、参照でも渡せます。</p>

  <p><b>Origin C コード：</b></p>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>origin.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>

<span style="color: #0000ff;">int</span> CheckFile<span style="color: #000000;">(</span>string<span style="color: #000040;">&amp;</span> strFile, string<span style="color: #000040;">&amp;</span> strExt<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #0000ff;">int</span> nRet <span style="color: #000080;">=</span> strFile.<span style="color: #000000;">IsFile</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
    <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span>nRet <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        separate_file_name_ext<span style="color: #000000;">(</span>strFile, <span style="color: #0000ff;">NULL</span>, <span style="color: #000040;">&amp;</span>strExt<span style="color: #000000;">)</span>;
        strFile <span style="color: #000080;">=</span> GetFileName<span style="color: #000000;">(</span>strFile, <span style="color: #0000ff;">TRUE</span><span style="color: #000000;">)</span>;
    <span style="color: #000000;">}</span>
    
    <span style="color: #0000ff;">return</span> nRet;
<span style="color: #000000;">}</span>
</pre>

  <p><b>LabTalkスクリプト：</b></p>
  <pre class="lt" style="font-family:monospace;">
string strFile<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>Y;
strFile<span style="color: #000080;">$</span> <span style="color: #000080;">=</span>strFile<span style="color: #000080;">$</span><span style="color: #000080;">+</span><span style="color: #ff00ff;">&quot;origin.ini&quot;</span>;
string strExt;
CheckFile<span style="color: #000000;">(</span>strFile<span style="color: #000080;">$</span>, strExt<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;
ty <span style="color: #ff00ff;">&quot;strFile=%(strFile$), strExt=%(strExt$)&quot;</span>
</pre>

  <h3><a name="Pass_string_array"></a><span class="mw-headline">文字列配列を渡す</span></h3>

  <p>vector を使用して、Origin C内で文字列配列またはルースデータセットのコピーを作成できます。</p>

  <p><b>Origin C コード：</b></p>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>origin.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
 
<span style="color: #0000ff;">void</span> TyMyLove<span style="color: #000000;">(</span>vector<span style="color: #000080;">&lt;</span>string<span style="color: #000080;">&gt;</span> strA<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #0000ff;">int</span> nSize <span style="color: #000080;">=</span> strA.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
    <span style="color: #0000ff;">for</span><span style="color: #000000;">(</span><span style="color: #0000ff;">int</span> i<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>; i<span style="color: #000080;">&lt;</span>nSize; i<span style="color: #000040;">++</span><span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;I Love %s!<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span>, strA<span style="color: #000000;">[</span>i<span style="color: #000000;">]</span><span style="color: #000000;">)</span>;
    <span style="color: #000000;">}</span>
<span style="color: #000000;">}</span>
</pre>

  <p><b>LabTalkスクリプト：</b></p>
  <pre class="lt" style="font-family:monospace;">
stringarray aa;
aa.<span style="color: #000080;">Add</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Boston&quot;</span><span style="color: #000000;">)</span>;
aa.<span style="color: #000080;">Add</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;New York&quot;</span><span style="color: #000000;">)</span>;
aa.<span style="color: #000080;">Add</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Los Angeles&quot;</span><span style="color: #000000;">)</span>;
TyMyLove<span style="color: #000000;">(</span>aa<span style="color: #000000;">)</span>;
</pre>

  <h3><a name="Pass_column_range"></a><span class="mw-headline">列範囲を渡す</span></h3>

  <p>列範囲変数は直接渡せます。</p>

  <p>以下のサンプルで、列変数をOrigin Cに渡す方法を示しています。</p>

  <p class="version">必要なOriginのバージョン: 9.0 SR1以降</p>

  <p><b>Origin C コード：</b></p>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>origin.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>

<span style="color: #0000ff;">double</span> MyMean<span style="color: #000000;">(</span>DataRange dr<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
        <span style="color: #0000ff;">double</span> dMean;
        <span style="color: #0000ff;">int</span> nN;    
        vector vec;
        dr.<span style="color: #000000;">GetData</span><span style="color: #000000;">(</span><span style="color: #000040;">&amp;</span>vec, <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">int</span> nRet <span style="color: #000080;">=</span> ocmath_basic_summary_stats<span style="color: #000000;">(</span>vec.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>, vec, <span style="color: #000040;">&amp;</span>nN, <span style="color: #000040;">&amp;</span>dMean<span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span><span style="color: #0000dd;">0</span> <span style="color: #000080;">==</span> nRet<span style="color: #000000;">)</span>
                <span style="color: #0000ff;">return</span> dMean;
        <span style="color: #0000ff;">return</span> NANUM;
<span style="color: #000000;">}</span>
</pre>

  <p><b>LabTalkスクリプト：</b></p>
  <pre class="lt" style="font-family:monospace;">
newbook;
col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> data<span style="color: #000000;">(</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">100</span><span style="color: #000000;">)</span>;
range rr <span style="color: #000080;">=</span> <span style="color: #000000;">[</span><span style="color: #000080;">%</span>H<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span>;
double Rmean<span style="color: #000080;">=</span>MyMean<span style="color: #000000;">(</span>rr<span style="color: #000000;">)</span>;
ty <span style="color: #ff00ff;">&quot;The Mean of %(rr) is $(Rmean)&quot;</span>;
</pre>

  <table class="note">
    <tr>
      <td>
        <b>Note:</b>

        <ol>
          <li>rangeは、1つの列だけでなく、列の範囲も参照できます。たとえば、range [book1]sheet1!1[2]:2[5] は、Origin C関数内で直接解釈できます。</li>

          <li>バージョン9のSR1より前のバージョンでは、rangeを使用する場合、範囲名を文字列として Origin C関数に渡す必要がありました。範囲を文字列として渡す方法については、以下のセクションを参照してください。</li>
        </ol>
      </td>
    </tr>
  </table>

  <h3><a name="Pass_worksheet_range"></a><span class="mw-headline">ワークシート範囲を渡す</span></h3>

  <p>ワークシート範囲を渡す場合、%()表記を使用してワークシート範囲名を渡すか、文字列変数を文字列としてOrigin C関数に渡すことができます。Origin C 関数内では、<i>okxf_resolve_string_get_origin_object()</i>関数 (<i>xfutils.h</i>を含める) によって文字列を適切なオブジェクトにするか、文字列から適切なオブジェクトを作成することもできます。</p>

  <p>LabTalkスクリプトで範囲名を引用するか、文字列変数を直接使用して、文字列を明示的に渡す必要があります。</p>

  <p><b>Origin C コード：</b></p>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>Origin.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>xfutils.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>

<span style="color: #0000ff;">int</span> MyCopyWks<span style="color: #000000;">(</span>string strSource, string strTarget<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    Worksheet sWks, tWks;
    <span style="color: #0000ff;">int</span> nRet <span style="color: #000080;">=</span> okxf_resolve_string_get_origin_object<span style="color: #000000;">(</span>strSource, <span style="color: #000040;">&amp;</span>sWks<span style="color: #000000;">)</span>;
    nRet <span style="color: #000040;">*</span><span style="color: #000080;">=</span> okxf_resolve_string_get_origin_object<span style="color: #000000;">(</span>strTarget, <span style="color: #000040;">&amp;</span>tWks<span style="color: #000000;">)</span>;
    <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> <span style="color: #000040;">!</span>nRet <span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Worksheet name is wrong!<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span><span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span>;
    <span style="color: #000000;">}</span>
    sWks.<span style="color: #000000;">CopyTo</span><span style="color: #000000;">(</span>tWks, <span style="color: #0000dd;">0</span>, <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">0</span>, <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>;
    <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">1</span>;
<span style="color: #000000;">}</span>
</pre>

  <p><b>LabTalkスクリプト：</b></p>
  <pre class="lt" style="font-family:monospace;">
range ra <span style="color: #000080;">=</span> <span style="color: #000000;">[</span>book1<span style="color: #000000;">]</span>sheet1<span style="color: #000080;">!</span>;
range rb <span style="color: #000080;">=</span> <span style="color: #000000;">[</span>book2<span style="color: #000000;">]</span>sheet1<span style="color: #000080;">!</span>;
int nRet <span style="color: #000080;">=</span> MyCopyWks<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;%(ra)&quot;</span>, <span style="color: #ff00ff;">&quot;%(rb)&quot;</span><span style="color: #000000;">)</span>;
</pre>

  <h3><a name="Pass_data_plot_range"></a><span class="mw-headline">作図範囲を渡す</span></h3>

  <p>ワークシート範囲の操作と同様に、プロット範囲を文字列としてOrigin Cに渡すこともできます。</p>

  <p>LabTalkとOrigin C間でやり取りする場合、開始インデックスが異なることに注意してください。</p>

  <p><b>Origin C コード：</b></p>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>Origin.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>xfutils.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>

<span style="color: #0000ff;">int</span> ChangeDPColor<span style="color: #000000;">(</span>string strDP, <span style="color: #0000ff;">int</span> nColor<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    DataPlot dp;
    <span style="color: #0000ff;">int</span> nRet <span style="color: #000080;">=</span> okxf_resolve_string_get_origin_object<span style="color: #000000;">(</span>strDP, <span style="color: #000040;">&amp;</span>dp<span style="color: #000000;">)</span>;
    <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> <span style="color: #000040;">!</span>nRet <span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Not a valid data plot!<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span><span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span>;
    <span style="color: #000000;">}</span>
    <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> nColor <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">1</span> <span style="color: #000040;">||</span> nColor <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">24</span> <span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;LabTalk color number sould be 1 ~ 24!<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span><span style="color: #000000;">)</span>;
    <span style="color: #000000;">}</span>
    <span style="color: #008000;">// Origin Cの色インデックスは0から開始</span>
    nColor<span style="color: #000040;">--</span>;
    dp.<span style="color: #000000;">SetColor</span><span style="color: #000000;">(</span>nColor, <span style="color: #0000ff;">TRUE</span><span style="color: #000000;">)</span>;
    <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">1</span>;
<span style="color: #000000;">}</span>
</pre>

  <p><b>LabTalkスクリプト：</b></p>
  <pre class="lt" style="font-family:monospace;">
newbook;
col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> data<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">10</span><span style="color: #000000;">)</span>;
col<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
white_noise <span style="color: #0000dd;">2</span>;
plotxy <span style="color: #0000dd;">2</span> <span style="color: #0000dd;">202</span>;
Range dp <span style="color: #000080;">=</span> <span style="color: #000000;">[</span><span style="color: #000080;">%</span>H<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span>;
string strDP<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span><span style="color: #000000;">(</span>dp<span style="color: #000000;">)</span>;
int nC <span style="color: #000080;">=</span> color<span style="color: #000000;">(</span>green<span style="color: #000000;">)</span>;
int nRet <span style="color: #000080;">=</span> ChangeDPColor<span style="color: #000000;">(</span>strDP<span style="color: #000080;">$</span>, nC<span style="color: #000000;">)</span>;
</pre>

  <h3><a name="Pass_window_name"></a><span class="mw-headline">ウィンドウ名を渡す</span></h3>

  <p>ウィンドウ名をOrigin C関数に直接渡すことができます。適切なオブジェクトコンストラクターがあれば、Origin Cで対応するオブジェクトを作成できます。</p>

  <p><b>Origin C コード：</b></p>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>Origin.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>

<span style="color: #0000ff;">int</span> GetPlotsNum<span style="color: #000000;">(</span>string pName<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #0000ff;">int</span> nPlots <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
    GraphPage gp<span style="color: #000000;">(</span>pName<span style="color: #000000;">)</span>;
    <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> <span style="color: #000040;">!</span>gp.<span style="color: #000000;">IsValid</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Not a valid page!<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span><span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span>;
    <span style="color: #000000;">}</span>
    foreach<span style="color: #000000;">(</span> GraphLayer gl in gp.<span style="color: #000000;">Layers</span> <span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        foreach<span style="color: #000000;">(</span> DataPlot dp in gl.<span style="color: #000000;">DataPlots</span> <span style="color: #000000;">)</span>
            nPlots<span style="color: #000040;">++</span>;
    <span style="color: #000000;">}</span>
    
    <span style="color: #0000ff;">return</span> nPlots;
<span style="color: #000000;">}</span>
</pre>

  <p><b>LabTalkスクリプト：</b></p>
  <pre class="lt" style="font-family:monospace;">
newbook;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span>;
fname<span style="color: #000080;">$</span> <span style="color: #000080;">+</span><span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Exponential Decay.dat&quot;</span>; 
impasc;
worksheet <span style="color: #000080;">-</span>s <span style="color: #0000dd;">0</span> <span style="color: #0000dd;">0</span> <span style="color: #000080;">-</span><span style="color: #0000dd;">1</span> <span style="color: #000080;">-</span><span style="color: #0000dd;">1</span>;
worksheet <span style="color: #000080;">-</span>p <span style="color: #0000dd;">201</span>;
int nPlots <span style="color: #000080;">=</span> GetPlotsNum<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;%H&quot;</span><span style="color: #000000;">)</span>;
ty <span style="color: #ff00ff;">&quot;There are $(nPlots) plots in %H&quot;</span>;
</pre>

  <h3><a name="Pass_tree"></a><span class="mw-headline">ツリーを渡す</span></h3>

  <p>ツリーをOrigin Cに直接渡すことができます。</p>

  <p><b>Origin C コード：</b></p>
  <pre class="lt" style="font-family:monospace;">
#pragma labtalk<span style="color: #000000;">(</span><span style="color: #0000dd;">4</span><span style="color: #000000;">)</span>
int tt<span style="color: #000000;">(</span>Tree<span style="color: #000080;">&amp;</span> tr, string strAppsPath<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
        Tree tr1;
        if<span style="color: #000000;">(</span><span style="color: #000080;">!</span>tr1.<span style="color: #000080;">Load</span><span style="color: #000000;">(</span>strAppsPath<span style="color: #000000;">)</span><span style="color: #000000;">)</span>
                return <span style="color: #0000dd;">1</span>;
        tr.<span style="color: #000080;">Replace</span><span style="color: #000000;">(</span>tr1, TRUE, TRUE<span style="color: #000000;">)</span>;
        return <span style="color: #0000dd;">0</span>;
<span style="color: #000000;">}</span>
#pragma labtalk<span style="color: #000000;">(</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>
</pre>

  <p><b>LabTalkスクリプト：</b></p>
  <pre class="lt" style="font-family:monospace;">
Tree tr1;
string strApps<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;%@AOpxList.xml&quot;</span>;
if<span style="color: #000000;">(</span><span style="color: #0000dd;">0</span><span style="color: #000080;">==</span>tt<span style="color: #000000;">(</span>tr1,strApps<span style="color: #000080;">$</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>
        tr1.<span style="color: #000080;">=</span>;
</pre>

  <h3><a name="Construct_LabTalk_Tree_with_XML"></a><span class="mw-headline">LabTalkツリーをXMLで構成する</span></h3>

  <p>LabTalkツリーをXMLで構成できます。</p>

  <p><b>XML用のOrigin C コード:</b></p>
  <pre class="lt" style="font-family:monospace;">
string st<span style="color: #000000;">(</span>string strAppsPath<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
        string str;
        Tree tr;
        if<span style="color: #000000;">(</span>tr.<span style="color: #000080;">Load</span><span style="color: #000000;">(</span>strAppsPath<span style="color: #000000;">)</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span>
                tr.<span style="color: #000080;">GetString</span><span style="color: #000000;">(</span>str<span style="color: #000000;">)</span>;
                return str;
        <span style="color: #000000;">}</span>
<span style="color: #000000;">}</span>
</pre>

  <p><b>LabTalkスクリプト：</b></p>
  <pre class="lt" style="font-family:monospace;">
string strApps<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;%@AOpxList.xml&quot;</span>;
string strXML<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> st<span style="color: #000000;">(</span>strApps<span style="color: #000080;">$</span><span style="color: #000000;">)</span><span style="color: #000080;">$</span>;
Tree tr1 <span style="color: #000080;">=</span> strXML<span style="color: #000080;">$</span>;
tr1.<span style="color: #000080;">=</span>
</pre>

  <p>これはデータコネクタで使用できます。例えば、CSVファイルをインポート後以下のスクリプトを実行するとインポートダイアログ設定を取得できます。</p>
  <pre class="lt" style="font-family:monospace;">
Tree tr1<span style="color: #000080;">=</span>wks.<span style="color: #000080;">dc</span>.<span style="color: #000080;">optn</span><span style="color: #000080;">$</span>;
tr1.<span style="color: #000080;">=</span>;
</pre>

  <p>また、その逆もサポートされています。</p>
  <pre class="lt" style="font-family:monospace;">
string str<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> wks.<span style="color: #000080;">dc</span>.<span style="color: #000080;">optn</span><span style="color: #000080;">$</span>;
Tree tr1 <span style="color: #000080;">=</span> str<span style="color: #000080;">$</span>;
tr1.<span style="color: #000080;">=</span>;
</pre>

  <h3><a name="Return_range_by_string"></a><span class="mw-headline">文字列で範囲を返す</span></h3>

  <p>ほとんどのOrigin CオブジェクトはLabTalkに返せません。したがって、rangeを返したい場合は、<i>GetRangeString()</i> メソッドを使用して範囲文字列をLabTalkに返すことができます。</p>

  <p><b>Origin C コード：</b></p>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>origin.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>xfutils.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>

<span style="color: #008000;">// この関数は、strWksNameのデータを使用してレイヤstrGLに3D散布図を挿入</span>
<span style="color: #0000ff;">int</span> Insert3DScatter<span style="color: #000000;">(</span>string strGL, string strWksName<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #008000;">// 名前でグラフレイヤオブジェクトを取得</span>
    GraphLayer gl;
    <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> <span style="color: #000040;">!</span>okxf_resolve_string_get_origin_object<span style="color: #000000;">(</span>strGL, <span style="color: #000040;">&amp;</span>gl<span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        out_str<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Invalid graph layer!&quot;</span><span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span>;
    <span style="color: #000000;">}</span>
    <span style="color: #008000;">// 名前でワークシートを作成</span>
    Worksheet wks<span style="color: #000000;">(</span>strWksName<span style="color: #000000;">)</span>;
 
    DataRange dr;
    <span style="color: #0000ff;">int</span> nR <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
    dr.<span style="color: #000000;">Add</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;X&quot;</span>, wks, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>;
    dr.<span style="color: #000000;">Add</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Y&quot;</span>, wks, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">1</span>, <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
    nR <span style="color: #000080;">=</span> dr.<span style="color: #000000;">Add</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Z&quot;</span>, wks, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">2</span>, <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>;
    <span style="color: #008000;">// 3D散布図を追加</span>
    <span style="color: #0000ff;">int</span> nPlot <span style="color: #000080;">=</span> gl.<span style="color: #000000;">AddPlot</span><span style="color: #000000;">(</span>dr, ID_3D_GRAPH_SCATTER<span style="color: #000000;">)</span>;
    <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> nPlot <span style="color: #000080;">==</span> <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span> <span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        out_str<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Cannot add plot!&quot;</span><span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span>;
    <span style="color: #000000;">}</span>
    DataPlot dp <span style="color: #000080;">=</span> gl.<span style="color: #000000;">DataPlots</span><span style="color: #000000;">(</span>nPlot<span style="color: #000000;">)</span>;
    Tree tr;
    tr <span style="color: #000080;">=</span> dp.<span style="color: #000000;">GetFormat</span><span style="color: #000000;">(</span>FPB_ALL, FOB_ALL, <span style="color: #0000ff;">TRUE</span>, <span style="color: #0000ff;">TRUE</span><span style="color: #000000;">)</span>;
    tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">Symbol</span>.<span style="color: #000000;">Shape</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">11</span>;
    tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">Symbol</span>.<span style="color: #000000;">Interior</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">8</span>;
    tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">Symbol</span>.<span style="color: #000000;">EdgeColor</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">15</span>;
    tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">DropLines</span>.<span style="color: #000000;">Z</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
    <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> <span style="color: #000040;">!</span>dp.<span style="color: #000000;">ApplyFormat</span><span style="color: #000000;">(</span>tr, <span style="color: #0000ff;">TRUE</span>, <span style="color: #0000ff;">TRUE</span><span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        out_str<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Apply format failed!&quot;</span><span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span>
    <span style="color: #000000;">}</span>
    <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">1</span>;
<span style="color: #000000;">}</span>

<span style="color: #008000;">// この関数は透明なメッシュ グラフを作成</span>
<span style="color: #008000;">// グラフレイヤ名strGLNameは参照によって渡され、</span>
<span style="color: #008000;">// LabTalk でこの変数を再利用可能</span>
<span style="color: #0000ff;">int</span> CreateMeshPlot<span style="color: #000000;">(</span>string strMOName, string<span style="color: #000040;">&amp;</span> strGLName<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    <span style="color: #008000;">// 行列オブジェクトを名前で取得</span>
    MatrixObject mo<span style="color: #000000;">(</span>strMOName<span style="color: #000000;">)</span>;
    okxf_resolve_string_get_origin_object<span style="color: #000000;">(</span>strMOName, <span style="color: #000040;">&amp;</span>mo<span style="color: #000000;">)</span>;
    GraphPage gp;
    gp.<span style="color: #000000;">Create</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;mesh&quot;</span><span style="color: #000000;">)</span>;
    GraphLayer gl <span style="color: #000080;">=</span> gp.<span style="color: #000000;">Layers</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
    <span style="color: #008000;">// レイヤにメッシュプロットを追加</span>
    <span style="color: #0000ff;">int</span> nPlot <span style="color: #000080;">=</span> gl.<span style="color: #000000;">AddPlot</span><span style="color: #000000;">(</span>mo, IDM_PLOT_3D_MESH<span style="color: #000000;">)</span>;
    <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> nPlot <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">0</span> <span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        out_str<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Cannot create 3D mesh!&quot;</span><span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span>;
    <span style="color: #000000;">}</span>
    <span style="color: #008000;">// プロットを微調整</span>
    DataPlot dp <span style="color: #000080;">=</span> gl.<span style="color: #000000;">DataPlots</span><span style="color: #000000;">(</span>nPlot<span style="color: #000000;">)</span>;
    Tree tr;
    tr <span style="color: #000080;">=</span> dp.<span style="color: #000000;">GetFormat</span><span style="color: #000000;">(</span>FPB_ALL, FOB_ALL, <span style="color: #0000ff;">TRUE</span>, <span style="color: #0000ff;">TRUE</span><span style="color: #000000;">)</span>;
    tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">Grids</span>.<span style="color: #000000;">FrontColor</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">8</span>;
    tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">Grids</span>.<span style="color: #000000;">BackColor</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">8</span>;
    tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">Grids</span>.<span style="color: #000000;">Width</span>.<span style="color: #000000;">dVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0.8</span>;
    tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">Grids</span>.<span style="color: #000000;">Color</span>.<span style="color: #000000;">dVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">19</span>;
    tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">Grids</span>.<span style="color: #000000;">Transparency</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">70</span>;
    <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> <span style="color: #000040;">!</span>dp.<span style="color: #000000;">ApplyFormat</span><span style="color: #000000;">(</span>tr, <span style="color: #0000ff;">TRUE</span>, <span style="color: #0000ff;">TRUE</span><span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        out_str<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Apply format failed!&quot;</span><span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span>
    <span style="color: #000000;">}</span>
    <span style="color: #008000;">// グラフレイヤの範囲文字列を返す</span>
    gl.<span style="color: #000000;">GetRangeString</span><span style="color: #000000;">(</span>strGLName<span style="color: #000000;">)</span>;
    gl.<span style="color: #000000;">Rescale</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
    <span style="color: #0000ff;">return</span> <span style="color: #0000dd;">1</span>;
<span style="color: #000000;">}</span>
</pre>

  <p><b>LabTalkスクリプト：</b></p>
  <pre class="lt" style="font-family:monospace;">
newbook;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span>;
fname<span style="color: #000080;">$</span> <span style="color: #000080;">+</span><span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Samples\Matrix Conversion and Gridding\XYZ Random Gaussian.dat&quot;</span>; 
impasc;
range rw <span style="color: #000080;">=</span> <span style="color: #000000;">[</span><span style="color: #000080;">%</span>H<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #0000dd;">3</span>;
rw.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">6</span>;
xyz_renka iz<span style="color: #000000;">:</span><span style="color: #000080;">=</span>rw rows<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">20</span> cols<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">20</span>;
range rm <span style="color: #000080;">=</span> <span style="color: #000000;">[</span><span style="color: #000080;">%</span>H<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span>;
<span style="color: #008000;">// 範囲を文字列として渡し、文字列変数を参照で渡す</span>
string strGLName<span style="color: #000080;">$</span>;
CreateMeshPlot<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;%(rm)&quot;</span>, strGLName<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;
<span style="color: #008000;">// 2秒待つ</span>
sec <span style="color: #000080;">-</span>p <span style="color: #0000dd;">3</span>;
string strWksName<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> rw.<span style="color: #000080;">GetLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000080;">$</span>;
<span style="color: #008000;">// レイヤ名、ワークシート名を文字列として渡す</span>
Insert3DScatter<span style="color: #000000;">(</span>strGLName<span style="color: #000080;">$</span>, strWksName<span style="color: #000080;">$</span><span style="color: #000000;">)</span>;
</pre>
