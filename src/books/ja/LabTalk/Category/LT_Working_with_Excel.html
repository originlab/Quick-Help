<h1 class="firstheading">Excelと一緒に操作する</h1>
<p class="urlname" style="display: none;">Working-with-Excel</p>
<p>Originは、Originワークスペース内で直接Excelワークブックを使用できます。Excel ワークブックは、プロジェクト内に保存することや、外部Excelファイル(*.xls, *.xlsx)へのリンクとして保存することができます。Origin内で開いた外部のExcelワークブックを内部用ファイルに変換したり、Origin内で作成したExcelワークブックは外部のExcelファイルに保存することができます。</p>
<div id="toc" class="toc">
<div id="toctitle">
<h2>目次</h2>
</div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Open_Excel_Workbook"><span class="tocnumber">1</span> <span class="toctext">Excelワークブックを開く</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Internal_Excel_Workbook"><span class="tocnumber">1.1</span> <span class="toctext">内部Excelワークブック</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#External_Excel_Workbook"><span class="tocnumber">1.2</span> <span class="toctext">外部Excelワークブック</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Save_Excel_Workbook"><span class="tocnumber">2</span> <span class="toctext">Excelワークブックを保存</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Internal_Excel_Workbook_2"><span class="tocnumber">2.1</span> <span class="toctext">内部Excelワークブック</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#External_Excel_Workbook_2"><span class="tocnumber">2.2</span> <span class="toctext">外部Excelワークブック</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Update_Origin_When_Excel_Workbook_Changes"><span class="tocnumber">3</span> <span class="toctext">Excelワークブックの変更時にOriginを更新</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Connect_Excel_Workbook"><span class="tocnumber">4</span> <span class="toctext">Excelワークブックに接続</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Run_Excel_Macro"><span class="tocnumber">5</span> <span class="toctext">Excelのマクロを実行</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#Invoke_Visual_Basic_Function"><span class="tocnumber">6</span> <span class="toctext">Visual Basic関数を呼び出す</span></a></li>
</ul>
</div>
<h2><a name="Open_Excel_Workbook" id="Open_Excel_Workbook"></a><span class="mw-headline">Excelワークブックを開く</span></h2>
<h3><a name="Internal_Excel_Workbook" id="Internal_Excel_Workbook"></a><span class="mw-headline">内部Excelワークブック</span></h3>
<p>Originで新しいExcelワークブックを作成するには</p>
<pre class="lt" style="font-family: monospace;">
window <span style="color: #000080;">-</span>tx;
</pre>
<p>タイトルバーには、ExcelワークブックがOriginプロジェクトファイル内に保存されることを示す、 <b>[内部]</b> というテキストがあります。</p>
<h3><a name="External_Excel_Workbook" id="External_Excel_Workbook"></a><span class="mw-headline">外部Excelワークブック</span></h3>
<p>外部のExcelファイルを開くには</p>
<pre class="lt" style="font-family: monospace;">
document <span style="color: #000080;">-</span>append D<span style="color: #000000;">:</span>\Test1.<span style="color: #000080;">xls</span>;
</pre>
<p>タイトルバーには、ExcelファイルがOriginプロジェクトファイルの外部に保存されることを示す、Excelファイルのパスとファイル名があります。</p>
<h2><a name="Save_Excel_Workbook" id="Save_Excel_Workbook"></a><span class="mw-headline">Excelワークブックを保存</span></h2>
<h3><a name="Internal_Excel_Workbook_2" id="Internal_Excel_Workbook_2"></a><span class="mw-headline">内部Excelワークブック</span></h3>
<p>内部Excelワークブックは、Originプロジェクトで自動的に保存できますが、この内部Excelワークブックを外部ファイルとして保存すると、リンクされた外部ファイルになります。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// Excelウィンドウがアクティブである必要があり、win -o で一時的にアクティブにできる</span>
window <span style="color: #000080;">-</span>o Book5 <span style="color: #000000;">{</span>
    <span style="color: #008000;">// ファイルパスと拡張子.xlsが必要</span>
    save <span style="color: #000080;">-</span>i D<span style="color: #000000;">:</span>\Test2.<span style="color: #000080;">xls</span>;<span style="color: #000000;">
}</span>
</pre>
<h3><a name="External_Excel_Workbook_2" id="External_Excel_Workbook_2"></a><span class="mw-headline">外部Excelワークブック</span></h3>
<p>元になるファイルをディスクに残しながら新しいファイルとリンクを作成して、外部Excelファイルを新しい場所に再保存することができます。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// Excelワークブックがアクティブである前提</span><span style="color: #008000;">
// %X は、開いているOriginプロジェクトファイルのパス</span>
save <span style="color: #000080;">-</span>i <span style="color: #000080;">%</span>XNewBook.<span style="color: #000080;">xls</span>;
</pre>
<h2><a name="Update_Origin_When_Excel_Workbook_Changes" id="Update_Origin_When_Excel_Workbook_Changes"></a><span class="mw-headline">Excelワークブックの変更時にOriginを更新</span></h2>
<p>Excelワークブックにデータを入力、又は貼り付けたとき、<code>set -ui</code>.により、Originを更新できます。例えば</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">//ファイル: 新規：Excelメニューを選択</span><span style="color: #008000;">
//Excelワークシートの列A行1に123を入力</span>
set Book2 <span style="color: #000080;">-</span>ui; <span style="color: #008000;">// Origin更新</span>
col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span><span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span><span style="color: #000080;">=</span>; <span style="color: #008000;">//列A行1の値を取得</span>
</pre>
<table class="noborder">
<tr>
<td style="vertical-align: top;" width="60"><img src="../images/LT_Working_with_Excel/Tip_icon.png" alt="" width="57" height="57" border="0" /></td>
<td>
<p>OriginのGUIでは、タイトルバーまたはExcelワークブックを右クリックし、コンテキストメニューで<a class="external text" href="../../UserGuide/UserGuide/Working_with_Microsoft_Excel.html#Working_with_Excel_Books_inside_Origin"><b>Originを更新...</b></a>を選択してOriginを更新することもできます。</p>
</td>
</tr>
</table>
<h2><a name="Connect_Excel_Workbook" id="Connect_Excel_Workbook"></a><span class="mw-headline">Excelワークブックに接続</span></h2>
<p>ExcelファイルをOriginプロジェクトにリンクする場合、ddeコマンドでMicrosoft DDEプロトコルを使用できます。例えば</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">// 次のサンプルを実行する前に、Excelブックを手動で起動するかrun -eコマンドを使用</span>
dde <span style="color: #000080;">-</span>c Excel<span style="color: #000080;">|</span><span style="color: #000000;">[</span>Test1.<span style="color: #000080;">xls</span><span style="color: #000000;">]</span>Sheet1 id; <span style="color: #008000;">//Excelワークシート[Test1.xls]Sheet1に接続</span>
if<span style="color: #000000;">(</span>id<span style="color: #000080;">&gt;=</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> <span style="color: #008000;">//接続されたか確認</span><span style="color: #000000;">
{</span>
        <span style="color: #008000;">// Excel ワークシートの列A～Fおよび行12～25でデータを</span>
        <span style="color: #008000;">// Origin のワークシート列1行1以降に送る</span>
        dde <span style="color: #000080;">-</span>rc id R2C1<span style="color: #000000;">:</span>R11C2 <span style="color: #000000;">[</span>Book1<span style="color: #000000;">]</span>Sheet1<span style="color: #000080;">!</span>R1C1; <span style="color: #000000;">
}</span>
dde <span style="color: #000080;">-</span>d id; <span style="color: #008000;">//切断</span>
</pre>
<p><a href="../../LabTalk/LabTalk/DDE_(command).html" title="LabTalk:DDE (コマンド)">dde</a>コマンドも参照してください。</p>
<h2><a name="Run_Excel_Macro" id="Run_Excel_Macro"></a><span class="mw-headline">Excelのマクロを実行</span></h2>
<p>Originは、Excelオブジェクトメソッド<code>excel.run</code>を使用して、OriginからExcelマクロを実行します。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">//SheetNameは、マクロを含むExcelワークシートの名前</span><span style="color: #008000;">
//引数は5つ以下</span>
excel.<span style="color: #000080;">run</span><span style="color: #000000;">(</span>SheetName.<span style="color: #000080;">MacroName</span>, Arg1, Arg2, Arg3..., Arg5<span style="color: #000000;">)</span>;
</pre>
<p>または</p>
<pre class="lt" style="font-family: monospace;">
excel.<span style="color: #000080;">run</span><span style="color: #000000;">(</span>ModuleName.<span style="color: #000080;">MacroName</span>,Arg1, Arg2, Arg3..., Arg5<span style="color: #000000;">)</span>;
</pre>
<p>Excelマクロを実行するための範囲を選択してアクティブにする必要がある場合、<code>excel.runrange</code>を試してください。例えば</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">//アクティブなExcelブックのSheet2をアクティブにし、</span><span style="color: #008000;">
//列A～Fおよび行12～25を選択</span>
excel.<span style="color: #000080;">runRange</span><span style="color: #000000;">(</span>Sheet2,A12<span style="color: #000000;">:</span>F25<span style="color: #000000;">)</span>;
</pre>
<p><a href="../../LabTalk/LabTalk/Excel_(object).html" title="LabTalk:Excel (オブジェクト)">excelオブジェクト</a>も参照してください。</p>
<h2><a name="Invoke_Visual_Basic_Function" id="Invoke_Visual_Basic_Function"></a><span class="mw-headline">Visual Basic関数を呼び出す</span></h2>
<p>OriginのExcelオブジェクトは、Visual Basicアプリケーション機能を呼び出すためのスクリプトアクセスも提供します。OriginでExcelマクロを実行するのと同じように、Visual Basic関数を呼び出すことができます。</p>
<pre class="lt" style="font-family: monospace;">
Excel.<span style="color: #000080;">Run</span><span style="color: #000000;">(</span>FunctionName, Arg1, Arg2,..., Arg5<span style="color: #000000;">)</span>
</pre>
<p>例えば、次のようなVisual Basic関数がある場合を考えます。</p>
<pre class="lt" style="font-family: monospace;">
Sub Hello<span style="color: #000000;">(</span><span style="color: #000000;">)</span>
   MsgBox <span style="color: #000000;">(</span><span style="color: #ff00ff;">"Hello, world!"</span><span style="color: #000000;">)</span>
End Sub
</pre>
<p>この関数を呼び出すには以下のようにします。</p>
<pre class="lt" style="font-family: monospace;">
<span style="color: #008000;">//上記の機能を含むワークブックをアクティブにする</span>
excel.<span style="color: #000080;">run</span><span style="color: #000000;">(</span>Hello<span style="color: #000000;">)</span>; <span style="color: #008000;">//メッセージボックスが表示</span>
</pre>
<p><a href="../../LabTalk/LabTalk/Excel_(object).html" title="LabTalk:Excel (オブジェクト)">excelオブジェクト</a>も参照してください。</p>
