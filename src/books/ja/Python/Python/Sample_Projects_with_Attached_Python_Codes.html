<h1 class="firstheading">Pythonコードが添付されたサンプルプロジェクト</h1><div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Samples_using_Origin_Projects"><span class="tocnumber">1</span> <span class="toctext">Originプロジェクトを使ったサンプル</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Batch_Peak_Analysis_of_Multiple_Files"><span class="tocnumber">1.1</span> <span class="toctext">複数ファイルのバッチピーク分析</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Travelling_Salesperson_Problem"><span class="tocnumber">1.2</span> <span class="toctext">巡回セールスマン問題</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Logistic_Regression"><span class="tocnumber">1.3</span> <span class="toctext">ロジスティック回帰</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Bayesian_Regression"><span class="tocnumber">1.4</span> <span class="toctext">ベイズ回帰</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Friedman.27s_Super_Smoother"><span class="tocnumber">1.5</span> <span class="toctext">FriedmanのSuper Smoother</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Hyperspectral_Image_Stack_and_PCA"><span class="tocnumber">1.6</span> <span class="toctext">ハイパースペクトル画像スタックとPCA</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Extract_Image_Colors"><span class="tocnumber">1.7</span> <span class="toctext">画像の色を抽出</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Lomb-Scargle_Periodogram"><span class="tocnumber">1.8</span> <span class="toctext">Lomb-Scargleピリオドグラム</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Export_all_Graphs"><span class="tocnumber">1.9</span> <span class="toctext">全グラフをエクスポート</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Image_Thinning"><span class="tocnumber">1.10</span> <span class="toctext">画像の細線化</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Peak_Movement"><span class="tocnumber">1.11</span> <span class="toctext">ピーク移動</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Fit_Summation"><span class="tocnumber">1.12</span> <span class="toctext">フィットシミュレーション</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="#How_to_Execute_Python_Code_from_a_Button"><span class="tocnumber">2</span> <span class="toctext">ボタンからPythonコードを実行する方法</span></a>
<ul>
<li class="toclevel-2 tocsection-15"><a href="#The_Show_Code_Button"><span class="tocnumber">2.1</span> <span class="toctext">コードを表示するボタン</span></a></li>
</ul>
</li>
</ul>
</div>

<p><br />
</p>
<h2><a name="Samples_using_Origin_Projects"></a><span class="mw-headline">Originプロジェクトを使ったサンプル</span></h2>
<p>このページでは、Origin/OriginProのバージョン2021で追加された、OriginプロジェクトファイルをベースにしたPythonのサンプルを紹介しています。Pythonコードファイルはプロジェクトに添付されています。プロジェクトには、コードを実行するボタンと、コードビルダでコードを表示し、実行したりデバッグするボタンがあります。
</p><p>これらのプロジェクトは\Samples\Pythonサブフォルダと、F11キーを押して開くラーニングセンターの解析サンプルにあります。
</p><p>以下は各サンプルの簡単な説明とサンプルに関連するコードです。これにより、Originの組み込みPythonでoriginproパッケージを使って作業する簡単な方法について学ぶことができます。
</p>
<h3><a name="Batch_Peak_Analysis_of_Multiple_Files"></a><span class="mw-headline">複数ファイルのバッチピーク解析</span></h3>
<p>このサンプルでは、データフォルダのデータを一度にインポートしてバッチピーク分析を実行します。データでは、ベースラインの減算とピークフィットが実行されます。データとフィット結果を表示するグラフにピークパラメータが配置されます。そして、グラフをpngの画像ファイルとしてエクスポートします。
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #000;">os</span>

path <span style="color: #000;">=</span> op.<span style="color: #000;">path</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;e&apos;</span><span style="color: #000;">)</span> + <span style="color: #0a0;">&quot;samples<span style="color: #000099; font-weight: bold;">\\</span>Batch2<span style="color: #000099; font-weight: bold;">\\</span>&quot;</span> 

<span style="color: #ff7700;font-weight:bold;">for</span> <span style="color: #900090;">file</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #000;">os</span>.<span style="color: #000;">listdir</span><span style="color: #000;">(</span>path<span style="color: #000;">)</span>: 
    fullpath <span style="color: #000;">=</span> <span style="color: #000;">os</span>.<span style="color: #000;">path</span>.<span style="color: #000;">join</span><span style="color: #000;">(</span>path<span style="color: #000;">,</span> <span style="color: #900090;">file</span><span style="color: #000;">)</span>
    wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span>ref<span style="color: #000;">=</span><span style="color: #0a0;">&apos;Book1&apos;</span><span style="color: #000;">)</span>
    wks.<span style="color: #000;">from_file</span><span style="color: #000;">(</span>fullpath<span style="color: #000;">)</span>
    
    op.<span style="color: #000;">wait</span><span style="color: #000;">(</span><span style="color: #000;">)</span> <span style="color: #d00; font-style: italic;"># 処理完了まで待機</span>
    op.<span style="color: #000;">wait</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;s&apos;</span><span style="color: #000;">,</span> <span style="color: #000;">0.05</span><span style="color: #000;">)</span><span style="color: #d00; font-style: italic;">#グラフ更新まで待機</span>
    
    weight <span style="color: #000;">=</span> wks.<span style="color: #000;">get_label</span><span style="color: #000;">(</span><span style="color: #000;">1</span><span style="color: #000;">,</span><span style="color: #0a0;">&apos;C&apos;</span><span style="color: #000;">)</span> <span style="color: #d00; font-style: italic;"># 列コメントを取得してエクスポートグラフの名前にする</span>
    gp <span style="color: #000;">=</span> op.<span style="color: #000;">find_graph</span><span style="color: #000;">(</span><span style="color: #0a0;">&quot;Graph1&quot;</span><span style="color: #000;">)</span>
    graphpath <span style="color: #000;">=</span> gp.<span style="color: #000;">save_fig</span><span style="color: #000;">(</span>op.<span style="color: #000;">path</span><span style="color: #000;">(</span><span style="color: #000;">)</span>+f<span style="color: #0a0;">&apos;weight - {weight}.png&apos;</span><span style="color: #000;">,</span> width<span style="color: #000;">=</span><span style="color: #000;">800</span><span style="color: #000;">)</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: #000;">(</span>graphpath<span style="color: #000;">)</span>
    
<span style="color: #000;">os</span>.<span style="color: #000;">startfile</span><span style="color: #000;">(</span>op.<span style="color: #000;">path</span><span style="color: #000;">(</span><span style="color: #000;">)</span><span style="color: #000;">)</span> <span style="color: #d00; font-style: italic;"># エクスポートグラフのあるフォルダを開く</span></pre>
<h3><a name="Travelling_Salesperson_Problem"></a><span class="mw-headline">営業マンの移動の問題</span></h3>
<p>scikit-optパッケージを使って、巡回セールスマン問題について最適な解決策を見つけるサンプルです。あらかじめscikit-optモジュールのインストールが必要です。緯度経度の値をもつ米国の空港データを目的地として使用します。
ランダムに選択された空港の場所と最適化された経路が、Googleマップ画像上のグラフに表示されます。
</p><p><a  class="image"><img alt="Tsp result.png" src="../images/Sample_Projects_with_Attached_Python_Codes/800px-Tsp_result.png" width="800"   /></a>
</p><p>都市のランダムなセット（ワークシートの行）を選択するコード：
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
<span style="color: #d00; font-style: italic;">#「AllAirports」シートからDataFrameにデータを転送</span>
<span style="color: #d00; font-style: italic;">#次に、ランダムに10都市を選び「Selected」シートに置く</span>
wksSource <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;w&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;[Book2]&quot;All Airports&quot;&apos;</span><span style="color: #000;">)</span>
df <span style="color: #000;">=</span> wksSource.<span style="color: #000;">to_df</span><span style="color: #000;">(</span><span style="color: #000;">)</span>
<span style="color: #d00; font-style: italic;">#スペースがない場合は引用符による囲みは不要</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span>ref<span style="color: #000;">=</span><span style="color: #0a0;">&apos;[Book2]Selected&apos;</span><span style="color: #000;">)</span>
wks.<span style="color: #000;">clear</span><span style="color: #000;">(</span><span style="color: #000;">)</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">(</span>df.<span style="color: #000;">sample</span><span style="color: #000;">(</span><span style="color: #000;">10</span><span style="color: #000;">)</span><span style="color: #000;">)</span></pre>
<p>距離を最適化するコード：
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #d00; font-style: italic;"># scikit_optを使って巡回セールスマン問題を解くPythonコード</span>
<span style="color: #d00; font-style: italic;"># 最適化コードは次のページより引用: https://pypi.org/project/scikit-opt/</span>
    
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #000;">sys</span>
<span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
    
<span style="color: #d00; font-style: italic;"># 「Selected」シートに移動してデータを取得</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span>ref<span style="color: #000;">=</span><span style="color: #0a0;">&apos;[Book2]Selected&apos;</span><span style="color: #000;">)</span>
lat <span style="color: #000;">=</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;LATITUDE&apos;</span><span style="color: #000;">)</span>
lon <span style="color: #000;">=</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;LONGITUDE&apos;</span><span style="color: #000;">)</span>
coordinates <span style="color: #000;">=</span> <span style="color: #900090;">list</span><span style="color: #000;">(</span><span style="color: #900090;">zip</span><span style="color: #000;">(</span>lat<span style="color: #000;">,</span> lon<span style="color: #000;">)</span><span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;"># 列の長さから空港/ポイントの数を取得</span>
num_points <span style="color: #000;">=</span> <span style="color: #900090;">len</span><span style="color: #000;">(</span>coordinates<span style="color: #000;">)</span>

<span style="color: #ff7700;font-weight:bold;">from</span> scipy <span style="color: #ff7700;font-weight:bold;">import</span> spatial
distance_matrix <span style="color: #000;">=</span> spatial.<span style="color: #000;">distance</span>.<span style="color: #000;">cdist</span><span style="color: #000;">(</span>coordinates<span style="color: #000;">,</span> coordinates<span style="color: #000;">,</span> metric<span style="color: #000;">=</span><span style="color: #0a0;">&apos;euclidean&apos;</span><span style="color: #000;">)</span>
<span style="color: #ff7700;font-weight:bold;">def</span> cal_total_distance<span style="color: #000;">(</span>routine<span style="color: #000;">)</span>:
    <span style="color: #0a0;">&apos;&apos;&apos;The objective function. input routine, return total distance.
    cal_total_distance(np.arange(num_points))
    &apos;&apos;&apos;</span>
    num_points<span style="color: #000;">,</span> <span style="color: #000;">=</span> routine.<span style="color: #000;">shape</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #900090;">sum</span><span style="color: #000;">(</span><span style="color: #000;">[</span>distance_matrix<span style="color: #000;">[</span>routine<span style="color: #000;">[</span>i&nbsp;% num_points<span style="color: #000;">]</span><span style="color: #000;">,</span> routine<span style="color: #000;">[</span><span style="color: #000;">(</span>i + <span style="color: #000;">1</span><span style="color: #000;">)</span>&nbsp;% num_points<span style="color: #000;">]</span><span style="color: #000;">]</span> <span style="color: #ff7700;font-weight:bold;">for</span> i <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #900090;">range</span><span style="color: #000;">(</span>num_points<span style="color: #000;">)</span><span style="color: #000;">]</span><span style="color: #000;">)</span>


<span style="color: #d00; font-style: italic;"># 最適化</span>
<span style="color: #ff7700;font-weight:bold;">from</span> sko.<span style="color: #000;">GA</span> <span style="color: #ff7700;font-weight:bold;">import</span> GA_TSP

ga_tsp <span style="color: #000;">=</span> GA_TSP<span style="color: #000;">(</span>func<span style="color: #000;">=</span>cal_total_distance<span style="color: #000;">,</span> n_dim<span style="color: #000;">=</span>num_points<span style="color: #000;">,</span> size_pop<span style="color: #000;">=</span><span style="color: #000;">50</span><span style="color: #000;">,</span> max_iter<span style="color: #000;">=</span><span style="color: #000;">500</span><span style="color: #000;">,</span> prob_mut<span style="color: #000;">=</span><span style="color: #000;">1</span><span style="color: #000;">)</span>
best_points<span style="color: #000;">,</span> best_distance <span style="color: #000;">=</span> ga_tsp.<span style="color: #000;">run</span><span style="color: #000;">(</span><span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;"># best_pointsをリストに変換</span>
order<span style="color: #000;">=</span>best_points.<span style="color: #000;">tolist</span><span style="color: #000;">(</span><span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;"># ループして行の順序リストを作成</span>
row_order <span style="color: #000;">=</span> <span style="color: #000;">[</span><span style="color: #000;">0</span><span style="color: #000;">]</span> * num_points
count<span style="color: #000;">=</span><span style="color: #000;">0</span>
<span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #000;">(</span>count<span style="color: #000;">&lt;</span>num_points<span style="color: #000;">)</span>:
    row_order<span style="color: #000;">[</span>order<span style="color: #000;">[</span>count<span style="color: #000;">]</span><span style="color: #000;">]</span><span style="color: #000;">=</span>count+<span style="color: #000;">1</span>
    count<span style="color: #000;">=</span>count+<span style="color: #000;">1</span>

<span style="color: #d00; font-style: italic;"># 行の順序をワークシートの最初の列に入れ、最初の列でワークシートをソート</span>
wks.<span style="color: #000;">from_list</span><span style="color: #000;">(</span><span style="color: #000;">0</span><span style="color: #000;">,</span> row_order<span style="color: #000;">)</span>
wks.<span style="color: #000;">sort</span><span style="color: #000;">(</span><span style="color: #000;">0</span><span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;"># 最初の行をコピーして最後に追加し、グラフのループを閉じる</span>
row1 <span style="color: #000;">=</span> wks.<span style="color: #000;">to_list2</span><span style="color: #000;">(</span><span style="color: #000;">0</span><span style="color: #000;">,</span><span style="color: #000;">0</span><span style="color: #000;">)</span>
wks.<span style="color: #000;">from_list2</span><span style="color: #000;">(</span>row1<span style="color: #000;">,</span>num_points<span style="color: #000;">)</span></pre>
<h3><a name="Logistic_Regression"></a><span class="mw-headline">ロジスティック回帰</span></h3>
<p>ワークシートデータにロジスティック回帰を実行するサンプルです。分析で得られたパラメータ値と95%信頼区間は、新しいワークシートに出力されます。最適化処理の情報はスクリプトウィンドウに表示されます。この例では、ワークシートのデータのロジスティック回帰分析を実行します。
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #d00; font-style: italic;">#このサンプルはstatsmodelsモジュールのインストールが必要</span>

<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd
<span style="color: #ff7700;font-weight:bold;">import</span> statsmodels.<span style="color: #000;">api</span> <span style="color: #ff7700;font-weight:bold;">as</span> sm

<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op

<span style="color: #d00; font-style: italic;">#アクティブワークシートデータをPythonのDataFrameに送る</span>
<span style="color: #d00; font-style: italic;">#ワークシートの列CとDはカテゴリ列
</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span> <span style="color: #0a0;">&apos;w&apos;</span> <span style="color: #000;">)</span>
df <span style="color: #000;">=</span> wks.<span style="color: #000;">to_df</span><span style="color: #000;">(</span><span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;">#Pythonでロジスティック回帰を実行</span>
cat_columns <span style="color: #000;">=</span> df.<span style="color: #000;">select_dtypes</span><span style="color: #000;">(</span><span style="color: #000;">[</span><span style="color: #0a0;">&apos;category&apos;</span><span style="color: #000;">]</span><span style="color: #000;">)</span>.<span style="color: #000;">columns</span>
df<span style="color: #000;">[</span>cat_columns<span style="color: #000;">]</span> <span style="color: #000;">=</span> df<span style="color: #000;">[</span>cat_columns<span style="color: #000;">]</span>.<span style="color: #000;">apply</span><span style="color: #000;">(</span><span style="color: #ff7700;font-weight:bold;">lambda</span> x: x.<span style="color: #000;">cat</span>.<span style="color: #000;">codes</span><span style="color: #000;">)</span>
df<span style="color: #000;">[</span><span style="color: #0a0;">&apos;intercept&apos;</span><span style="color: #000;">]</span> <span style="color: #000;">=</span> <span style="color: #000;">1.0</span>

logit <span style="color: #000;">=</span> sm.<span style="color: #000;">Logit</span><span style="color: #000;">(</span>df<span style="color: #000;">[</span><span style="color: #0a0;">&apos;Career_Change&apos;</span><span style="color: #000;">]</span><span style="color: #000;">,</span> df<span style="color: #000;">[</span><span style="color: #000;">[</span><span style="color: #0a0;">&apos;Age&apos;</span><span style="color: #000;">,</span><span style="color: #0a0;">&apos;Salary&apos;</span><span style="color: #000;">,</span><span style="color: #0a0;">&apos;Gender&apos;</span><span style="color: #000;">,</span><span style="color: #0a0;">&apos;intercept&apos;</span><span style="color: #000;">]</span><span style="color: #000;">]</span><span style="color: #000;">)</span>

result <span style="color: #000;">=</span> logit.<span style="color: #000;">fit</span><span style="color: #000;">(</span><span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;">#2つのDataFrameをインデックスでマージ：result.params（最初にSeriesをDataFrameに変換）とresult.conf_int()</span>
res_df <span style="color: #000;">=</span> pd.<span style="color: #000;">merge</span><span style="color: #000;">(</span> result.<span style="color: #000;">params</span>.<span style="color: #000;">to_frame</span><span style="color: #000;">(</span><span style="color: #000;">)</span><span style="color: #000;">,</span> result.<span style="color: #000;">conf_int</span><span style="color: #000;">(</span><span style="color: #000;">)</span><span style="color: #000;">,</span> right_index<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">,</span> left_index<span style="color: #000;">=</span><span style="color: #900090;">True</span> <span style="color: #000;">)</span>
res_df.<span style="color: #000;">columns</span> <span style="color: #000;">=</span> <span style="color: #000;">[</span><span style="color: #0a0;">&apos;Fitted Parameter&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;95% CI Lower&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;95% CI Upper&apos;</span><span style="color: #000;">]</span>

<span style="color: #d00; font-style: italic;">#結果をOriginの新しいワークシートに送る</span>
wksR <span style="color: #000;">=</span> op.<span style="color: #000;">new_sheet</span><span style="color: #000;">(</span> <span style="color: #0a0;">&apos;w&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;Logistic Regression Result&apos;</span> <span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;">#DataFrame (res_df)をワークシート (wksR)に送る</span>
<span style="color: #d00; font-style: italic;">#res_df には3つの列があり、そのインデックスは行名で、これもワークシートに設定する必要がある</span>

<span style="color: #d00; font-style: italic;">#DataFrame値をワークシートに送り、DataFrameインデックスの最初の列に送る</span>
wksR.<span style="color: #000;">from_df</span><span style="color: #000;">(</span> res_df<span style="color: #000;">,</span> <span style="color: #000;">0</span><span style="color: #000;">,</span> <span style="color: #900090;">True</span> <span style="color: #000;">)</span></pre>
<p><br />
</p>
<h3><a name="Bayesian_Regression"></a><span class="mw-headline">ベイズ回帰</span></h3>
<p>sklearnパッケージからBayesianRidgeモデルを呼び出すことにより、ベイジアンリッジ回帰を実行するサンプルです。
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #d00; font-style: italic;"># このサンプルはsklearnパッケージのインストールが必要</span>

<span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
<span style="color: #ff7700;font-weight:bold;">from</span> sklearn <span style="color: #ff7700;font-weight:bold;">import</span> linear_model


<span style="color: #d00; font-style: italic;"># ワークシートExpGrowthを検索</span>
<span style="color: #d00; font-style: italic;"># 1番目と2番目の列をそれぞれX、Yに取得</span>
ws <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;w&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;ExpGrowth&apos;</span><span style="color: #000;">)</span>
X <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">(</span>ws.<span style="color: #000;">to_list</span><span style="color: #000;">(</span><span style="color: #000;">0</span><span style="color: #000;">)</span><span style="color: #000;">)</span>  <span style="color: #d00; font-style: italic;"># 最初の列データをnumpy配列として取得</span>
y <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">(</span>ws.<span style="color: #000;">to_list</span><span style="color: #000;">(</span><span style="color: #000;">1</span><span style="color: #000;">)</span><span style="color: #000;">)</span>.<span style="color: #000;">ravel</span><span style="color: #000;">(</span><span style="color: #000;">)</span>  <span style="color: #d00; font-style: italic;"># 2番目の列をnumpy配列として取得</span>

<span style="color: #d00; font-style: italic;"># パラメータを使用してBayesianRidgeオブジェクトを作成</span>
<span style="color: #d00; font-style: italic;"># tol=1e-6, 許容誤差は1e-6</span>
<span style="color: #d00; font-style: italic;"># fit_intercept=True, 切片に合わせる</span>
<span style="color: #d00; font-style: italic;"># compute_score=True, 最適化の各反復で対数周辺尤度を計算</span>
<span style="color: #d00; font-style: italic;"># alpha_init=1, ガンマ分布のアルファの初期値</span>
<span style="color: #d00; font-style: italic;"># lambda_init=1e-3, ガンマ分布のラムダの初期値</span>
blr <span style="color: #000;">=</span> linear_model.<span style="color: #000;">BayesianRidge</span><span style="color: #000;">(</span>tol<span style="color: #000;">=</span><span style="color: #000;">1e-6</span><span style="color: #000;">,</span> fit_intercept<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">,</span> compute_score<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">,</span> alpha_init<span style="color: #000;">=</span><span style="color: #000;">1</span><span style="color: #000;">,</span> lambda_init<span style="color: #000;">=</span><span style="color: #000;">1e-3</span><span style="color: #000;">)</span>

degree <span style="color: #000;">=</span> <span style="color: #000;">10</span>  <span style="color: #d00; font-style: italic;"># ヴァンデルモンドの行列取得のため</span>

<span style="color: #d00; font-style: italic;"># Xを次数10のファンデルモンド行列に展開</span>
<span style="color: #d00; font-style: italic;"># そしてBayesianRidgeモデルのフィット</span>
blr.<span style="color: #000;">fit</span><span style="color: #000;">(</span>np.<span style="color: #000;">vander</span><span style="color: #000;">(</span>X<span style="color: #000;">,</span> degree<span style="color: #000;">)</span><span style="color: #000;">,</span> y<span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;"># Xの同じファンデルモンド行列からyを予測し、標準偏差も返す</span>
ymean<span style="color: #000;">,</span> ystd <span style="color: #000;">=</span> blr.<span style="color: #000;">predict</span><span style="color: #000;">(</span>np.<span style="color: #000;">vander</span><span style="color: #000;">(</span>X<span style="color: #000;">,</span> degree<span style="color: #000;">)</span><span style="color: #000;">,</span> return_std<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;"># 出力結果のワークシートを探す</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;w&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;Results&apos;</span><span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;"># Xは次数10のファンデルモンド行列に展開されるため、係数を出力</span>
<span style="color: #d00; font-style: italic;"># 10個の係数がある</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">(</span>pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">(</span>blr.<span style="color: #000;">coef_</span><span style="color: #000;">,</span> columns<span style="color: #000;">=</span><span style="color: #000;">[</span><span style="color: #0a0;">&apos;Coefficients&apos;</span><span style="color: #000;">]</span><span style="color: #000;">)</span><span style="color: #000;">,</span> <span style="color: #000;">0</span><span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;"># 切片を出力</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">(</span>pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">(</span>np.<span style="color: #000;">array</span><span style="color: #000;">(</span><span style="color: #000;">[</span>blr.<span style="color: #000;">intercept_</span><span style="color: #000;">]</span><span style="color: #000;">)</span><span style="color: #000;">,</span> columns<span style="color: #000;">=</span><span style="color: #000;">[</span><span style="color: #0a0;">&apos;Intercept&apos;</span><span style="color: #000;">]</span><span style="color: #000;">)</span><span style="color: #000;">,</span> <span style="color: #000;">1</span><span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;"># ガンマ分布のアルファとラムダを出力</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">(</span>pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">(</span>np.<span style="color: #000;">c_</span><span style="color: #000;">[</span><span style="color: #000;">[</span><span style="color: #0a0;">&apos;Alpha&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;Lambda&apos;</span><span style="color: #000;">]</span><span style="color: #000;">,</span> <span style="color: #000;">[</span>blr.<span style="color: #000;">alpha_</span><span style="color: #000;">,</span> blr.<span style="color: #000;">lambda_</span><span style="color: #000;">]</span><span style="color: #000;">]</span><span style="color: #000;">,</span> columns<span style="color: #000;">=</span><span style="color: #000;">[</span><span style="color: #0a0;">&apos;Gamma Parameters&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;Gamma Parameter Values&apos;</span><span style="color: #000;">]</span><span style="color: #000;">)</span><span style="color: #000;">,</span> <span style="color: #000;">2</span><span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;"># 各相互作用のスコア出力</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">(</span>pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">(</span>np.<span style="color: #000;">c_</span><span style="color: #000;">[</span>np.<span style="color: #000;">arange</span><span style="color: #000;">(</span><span style="color: #000;">0</span><span style="color: #000;">,</span> blr.<span style="color: #000;">n_iter_</span>+<span style="color: #000;">1</span><span style="color: #000;">)</span><span style="color: #000;">,</span> blr.<span style="color: #000;">scores_</span><span style="color: #000;">]</span><span style="color: #000;">,</span> columns<span style="color: #000;">=</span><span style="color: #000;">[</span><span style="color: #0a0;">&apos;Iteration&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;Score&apos;</span><span style="color: #000;">]</span><span style="color: #000;">)</span><span style="color: #000;">,</span> <span style="color: #000;">4</span><span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;"># 非依存および予測依存、および標準偏差を出力</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">(</span>pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">(</span>np.<span style="color: #000;">c_</span><span style="color: #000;">[</span>X<span style="color: #000;">,</span> ymean<span style="color: #000;">,</span> ystd<span style="color: #000;">]</span><span style="color: #000;">,</span> columns<span style="color: #000;">=</span><span style="color: #000;">[</span><span style="color: #0a0;">&apos;Indep&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;Predicted Y&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;STD&apos;</span><span style="color: #000;">]</span><span style="color: #000;">)</span><span style="color: #000;">,</span> <span style="color: #000;">6</span><span style="color: #000;">)</span></pre>
<h3><a name="Friedman.27s_Super_Smoother"></a><span class="mw-headline">Friedmanの Super Smoother</span></h3>
<p>FriedmanのSuper Smoother方によりノイズのあるデータにスムージングを実行するサンプルです。
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #d00; font-style: italic;">#このサンプルでは、supersmoother およびpandas パッケージのインストールが必要</span>
<span style="color: #ff7700;font-weight:bold;">from</span> supersmoother <span style="color: #ff7700;font-weight:bold;">import</span> SuperSmoother

<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
<span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd

<span style="color: #d00; font-style: italic;">#アクティブワークシートからデータを取得</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;w&apos;</span><span style="color: #000;">)</span>
cx <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">(</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">(</span> <span style="color: #000;">0</span> <span style="color: #000;">)</span> <span style="color: #000;">)</span>
cy <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">(</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">(</span> <span style="color: #000;">1</span> <span style="color: #000;">)</span> <span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;">#FriedmanのSuper Smootherを実行</span>
<span style="color: #d00; font-style: italic;">#alpha: smoothing level, (0 &lt; alpha &lt; 10)</span>
smoother <span style="color: #000;">=</span> SuperSmoother<span style="color: #000;">(</span> alpha <span style="color: #000;">=</span> <span style="color: #000;">2</span> <span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;">#smootherをフィット</span>
smoother.<span style="color: #000;">fit</span><span style="color: #000;">(</span> cx<span style="color: #000;">,</span> cy <span style="color: #000;">)</span><span style="color: #000;">;</span>

<span style="color: #d00; font-style: italic;">#inputxの平滑化関数を予測</span>
yfit <span style="color: #000;">=</span> smoother.<span style="color: #000;">predict</span><span style="color: #000;">(</span> cx <span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;">#スムージング結果をOriginのワークシートに出力</span>
df <span style="color: #000;">=</span> pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">(</span> <span style="color: #000;">{</span><span style="color: #0a0;">&apos;Smoothed&apos;</span>: yfit<span style="color: #000;">}</span> <span style="color: #000;">)</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">(</span> df<span style="color: #000;">,</span> <span style="color: #000;">2</span> <span style="color: #000;">)</span></pre>
<h3><a name="Hyperspectral_Image_Stack_and_PCA"></a><span class="mw-headline">ハイパースペクトル画像スタックとPCA</span></h3>
<p>このサンプルでは、主成分分析（PCA）を使用してイメージスタックデータを削減する方法を示しています。
</p><p>データは、MATLAB .matファイルの波長範囲にわたるハイパースペクトル画像データです。PCAを使用してデータサイズを削減しますが、それでも多くの有用な情報を保持できます。
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
<span style="color: #ff7700;font-weight:bold;">from</span> sklearn.<span style="color: #000;">preprocessing</span> <span style="color: #ff7700;font-weight:bold;">import</span> StandardScaler
<span style="color: #ff7700;font-weight:bold;">from</span> sklearn.<span style="color: #000;">decomposition</span> <span style="color: #ff7700;font-weight:bold;">import</span> PCA


<span style="color: #ff7700;font-weight:bold;">if</span> __name__ <span style="color: #000;">==</span> <span style="color: #0a0;">&apos;__main__&apos;</span>:
    <span style="color: #d00; font-style: italic;"># 行列シートMBook1を探す。このシートには、200バンドのハイパースペクトルデータ用に200の行列オブジェクトが画像スタックとして含まれる</span>
    msX <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;m&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;MBook1&apos;</span><span style="color: #000;">)</span>
    
    <span style="color: #d00; font-style: italic;"># 行列シートから200バンドのデータを3Dnumpy配列として取得</span>
    <span style="color: #d00; font-style: italic;"># dstack=True はdstackを使用し、データは（行、列、深度）の形</span>
    <span style="color: #d00; font-style: italic;"># ここでの深度は200、つまり、200バンド </span>
    <span style="color: #d00; font-style: italic;"># 行と列は、各バンド画像の行と列の数</span>
    X <span style="color: #000;">=</span> msX.<span style="color: #000;">to_np3d</span><span style="color: #000;">(</span>dstack<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">)</span>

    <span style="color: #d00; font-style: italic;"># Xを2D行列に形状変換。ここでは(-1, X.shape[2])</span>
    <span style="color: #d00; font-style: italic;"># Xを2D行列に形状変換。ここでは(-1, X.shape[2])</span>
    <span style="color: #d00; font-style: italic;"># これは X = np.reshape(X, (X.shape[0]*X.shape[1], X.shape[2]))に等しい</span>
    <span style="color: #d00; font-style: italic;"># 2D行列に形状変換した後、行列の1行には200のバンド値がある</span>
    <span style="color: #d00; font-style: italic;"># つまり、行列の1ピクセルには、200枚のスタック画像の深度に沿って200個の値が含まれる</span>
    X <span style="color: #000;">=</span> X.<span style="color: #000;">reshape</span><span style="color: #000;">(</span><span style="color: #000;">(</span>-<span style="color: #000;">1</span><span style="color: #000;">,</span> X.<span style="color: #000;">shape</span><span style="color: #000;">[</span><span style="color: #000;">2</span><span style="color: #000;">]</span><span style="color: #000;">)</span><span style="color: #000;">)</span>
    
    <span style="color: #d00; font-style: italic;"># 行列シートMBook2を探す</span>
    <span style="color: #d00; font-style: italic;"># このシートに16クラス（1から16まで）のグラウンドトゥルースデータが含まれる</span>
    <span style="color: #d00; font-style: italic;"># 0は有効なクラスではない</span>
    msY <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;m&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;MBook2&apos;</span><span style="color: #000;">)</span>
    
    <span style="color: #d00; font-style: italic;"># グラウンドトゥルースデータを行列シートからnumpy配列として取得</span>
    <span style="color: #d00; font-style: italic;"># 次に、1つの列のみを持つ行列として形状変更</span>
    <span style="color: #d00; font-style: italic;"># (-1, 1) は最初の次元のサイズにかかわらず1つの列を使用することを意味する</span>
    mY <span style="color: #000;">=</span> msY.<span style="color: #000;">to_np3d</span><span style="color: #000;">(</span><span style="color: #000;">)</span>.<span style="color: #000;">reshape</span><span style="color: #000;">(</span><span style="color: #000;">(</span>-<span style="color: #000;">1</span><span style="color: #000;">,</span> <span style="color: #000;">1</span><span style="color: #000;">)</span><span style="color: #000;">)</span>
    
    X <span style="color: #000;">=</span> X<span style="color: #000;">[</span>mY.<span style="color: #000;">ravel</span><span style="color: #000;">(</span><span style="color: #000;">)</span> <span style="color: #000;">!=</span> <span style="color: #000;">0</span><span style="color: #000;">,</span>&nbsp;:<span style="color: #000;">]</span>  <span style="color: #d00; font-style: italic;"># クラスが0（0は無効なクラスを意味する）であるピクセル（Xの行）を削除</span>
    
    <span style="color: #d00; font-style: italic;"># 元のバンド数は220</span>
    <span style="color: #d00; font-style: italic;"># 修正されたデータのバンド数は200</span>
    <span style="color: #d00; font-style: italic;"># 吸水領域をカバーするバンドは [104-108], [150-163], 220</span>
    <span style="color: #d00; font-style: italic;"># したがって、利用可能なバンドはこれらの20バンドを除外</span>
    bands <span style="color: #000;">=</span> np.<span style="color: #000;">append</span><span style="color: #000;">(</span>np.<span style="color: #000;">append</span><span style="color: #000;">(</span>np.<span style="color: #000;">array</span><span style="color: #000;">(</span><span style="color: #900090;">range</span><span style="color: #000;">(</span><span style="color: #000;">1</span><span style="color: #000;">,</span> <span style="color: #000;">104</span><span style="color: #000;">)</span><span style="color: #000;">)</span><span style="color: #000;">,</span> np.<span style="color: #000;">array</span><span style="color: #000;">(</span><span style="color: #900090;">range</span><span style="color: #000;">(</span><span style="color: #000;">109</span><span style="color: #000;">,</span> <span style="color: #000;">150</span><span style="color: #000;">)</span><span style="color: #000;">)</span><span style="color: #000;">)</span><span style="color: #000;">,</span> np.<span style="color: #000;">array</span><span style="color: #000;">(</span><span style="color: #900090;">range</span><span style="color: #000;">(</span><span style="color: #000;">164</span><span style="color: #000;">,</span> <span style="color: #000;">220</span><span style="color: #000;">)</span><span style="color: #000;">)</span><span style="color: #000;">)</span>

    <span style="color: #d00; font-style: italic;"># StandardScalerオブジェクトを作成し、Xデータをフィットおよび変換</span>
    <span style="color: #d00; font-style: italic;"># これは、データのさまざまなスケールの問題を回避するためにデータをスケーリングするため</span>
    scaledX <span style="color: #000;">=</span> StandardScaler<span style="color: #000;">(</span><span style="color: #000;">)</span>.<span style="color: #000;">fit_transform</span><span style="color: #000;">(</span>X<span style="color: #000;">)</span>
    
    <span style="color: #d00; font-style: italic;"># 列ヘッダとしてバンドを割り当てることによって</span>
    <span style="color: #d00; font-style: italic;"># スケーリングされたXデータを使用してDataFrameを作成</span>
    scaledX <span style="color: #000;">=</span> pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">(</span>scaledX<span style="color: #000;">,</span> columns<span style="color: #000;">=</span>bands<span style="color: #000;">)</span>  <span style="color: #d00; font-style: italic;"># 列ヘッダが割り当てられますがここではあまり使用しない</span>
    
    n_components <span style="color: #000;">=</span> <span style="color: #000;">50</span>  <span style="color: #d00; font-style: italic;"># データには200の特徴（1つのサンプルの波）がある。ここでは50使用して、次元を200から50に減らします。</span>
    pca <span style="color: #000;">=</span> PCA<span style="color: #000;">(</span>n_components<span style="color: #000;">=</span>n_components<span style="color: #000;">,</span> svd_solver<span style="color: #000;">=</span><span style="color: #0a0;">&apos;randomized&apos;</span><span style="color: #000;">,</span> whiten<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">,</span> random_state<span style="color: #000;">=</span><span style="color: #000;">100</span><span style="color: #000;">,</span> <span style="color: #000;">copy</span><span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">)</span>  <span style="color: #d00; font-style: italic;"># PCAオブジェクト作成</span>
    
    <span style="color: #d00; font-style: italic;"># pcaオブジェクトを使ってscaledXデータをフィットおよび変換</span>
    <span style="color: #d00; font-style: italic;"># データは同じ行数の50列</span>
    pcaX <span style="color: #000;">=</span> pca.<span style="color: #000;">fit_transform</span><span style="color: #000;">(</span>scaledX<span style="color: #000;">)</span>

    <span style="color: #d00; font-style: italic;"># 50個の成分のそれぞれによって説明される分散のパーセンテージの合計を出力</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: #000;">(</span>np.<span style="color: #900090;">sum</span><span style="color: #000;">(</span>pca.<span style="color: #000;">explained_variance_ratio_</span><span style="color: #000;">)</span><span style="color: #000;">)</span>

    ws <span style="color: #000;">=</span> op.<span style="color: #000;">new_sheet</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;w&apos;</span><span style="color: #000;">)</span>  <span style="color: #d00; font-style: italic;"># 出力データ用ワークシートを作成</span>
    
    <span style="color: #d00; font-style: italic;"># PCA結果データpcaXを使用してDataFrameを作成</span>
    <span style="color: #d00; font-style: italic;"># 列ヘッダは、各成分の説明された分散比</span>
    df <span style="color: #000;">=</span> pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">(</span>pcaX<span style="color: #000;">,</span> columns<span style="color: #000;">=</span>pca.<span style="color: #000;">explained_variance_ratio_</span>.<span style="color: #000;">astype</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;str&apos;</span><span style="color: #000;">)</span><span style="color: #000;">)</span>
    ws.<span style="color: #000;">from_df</span><span style="color: #000;">(</span>df<span style="color: #000;">)</span>  <span style="color: #d00; font-style: italic;"># DataFrameをワークシートに置く</span></pre>
<h3><a name="Extract_Image_Colors"></a><span class="mw-headline">画像の色を抽出</span></h3>
<p>この例（Sample\PythonのExtract Image Colors.opju）では、出版物のグラフ画像などの画像からすべての色を取得できます。各色のRGB値およびOriginの色値がワークシートに出力されます。
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> extcolors
<span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op

file_path <span style="color: #000;">=</span> op.<span style="color: #000;">file_dialog</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;*.png;*.jpg;*.bmp&apos;</span><span style="color: #000;">,</span><span style="color: #0a0;">&apos;Select an Image&apos;</span><span style="color: #000;">)</span>
<span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #900090;">len</span><span style="color: #000;">(</span>file_path<span style="color: #000;">)</span> <span style="color: #000;">==</span><span style="color: #000;">0</span>:
    <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #900090;">ValueError</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;user cancel&apos;</span><span style="color: #000;">)</span>
    
colors<span style="color: #000;">,</span> pixel_count <span style="color: #000;">=</span> extcolors.<span style="color: #000;">extract_from_path</span><span style="color: #000;">(</span>file_path<span style="color: #000;">)</span>

colors <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">(</span>colors<span style="color: #000;">)</span>
<span style="color: #d00; font-style: italic;">#rgb = colors[:,0]</span>
rgb<span style="color: #000;">,</span>pixel <span style="color: #000;">=</span> <span style="color: #900090;">map</span><span style="color: #000;">(</span><span style="color: #900090;">list</span><span style="color: #000;">,</span> <span style="color: #900090;">zip</span><span style="color: #000;">(</span>*colors<span style="color: #000;">)</span><span style="color: #000;">)</span>
<span style="color: #d00; font-style: italic;">#print(rgb)</span>
r <span style="color: #000;">=</span> <span style="color: #000;">[</span><span style="color: #000;">]</span>
g <span style="color: #000;">=</span> <span style="color: #000;">[</span><span style="color: #000;">]</span>
b <span style="color: #000;">=</span> <span style="color: #000;">[</span><span style="color: #000;">]</span>
<span style="color: #ff7700;font-weight:bold;">for</span> row <span style="color: #ff7700;font-weight:bold;">in</span> rgb:
    r.<span style="color: #000;">append</span><span style="color: #000;">(</span>row<span style="color: #000;">[</span><span style="color: #000;">0</span><span style="color: #000;">]</span><span style="color: #000;">)</span>
    g.<span style="color: #000;">append</span><span style="color: #000;">(</span>row<span style="color: #000;">[</span><span style="color: #000;">1</span><span style="color: #000;">]</span><span style="color: #000;">)</span>
    b.<span style="color: #000;">append</span><span style="color: #000;">(</span>row<span style="color: #000;">[</span><span style="color: #000;">2</span><span style="color: #000;">]</span><span style="color: #000;">)</span>
<span style="color: #d00; font-style: italic;">#色を出力</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;w&apos;</span><span style="color: #000;">)</span>
wks.<span style="color: #000;">from_list</span><span style="color: #000;">(</span><span style="color: #000;">0</span><span style="color: #000;">,</span> r<span style="color: #000;">)</span>
wks.<span style="color: #000;">from_list</span><span style="color: #000;">(</span><span style="color: #000;">1</span><span style="color: #000;">,</span> g<span style="color: #000;">)</span>
wks.<span style="color: #000;">from_list</span><span style="color: #000;">(</span><span style="color: #000;">2</span><span style="color: #000;">,</span> b<span style="color: #000;">)</span></pre>
<h3><a name="Lomb-Scargle_Periodogram"></a><span class="mw-headline">Lomb-Scargleピリオドグラム</span></h3>
<p>このサンプルでは、間隔が不均一な信号のLomb-Scargleピリオドグラムを計算します。
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #d00; font-style: italic;">#このサンプルはscipy、pandasパッケージのインストールが必要</span>

<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op

<span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">from</span> scipy.<span style="color: #000;">signal</span> <span style="color: #ff7700;font-weight:bold;">import</span> lombscargle

<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd

<span style="color: #d00; font-style: italic;">#アクティブワークシートを使用し、列A、Bのデータを取得</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span><span style="color: #000;">)</span>
t <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">(</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">(</span> <span style="color: #000;">0</span> <span style="color: #000;">)</span> <span style="color: #000;">)</span>
y <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">(</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">(</span> <span style="color: #000;">1</span> <span style="color: #000;">)</span> <span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;">#lombscargle 関数の入力として角周波数を計算</span>
n <span style="color: #000;">=</span> t.<span style="color: #000;">size</span>
ofac <span style="color: #000;">=</span> <span style="color: #000;">4</span>  <span style="color: #d00; font-style: italic;"># オーバーサンプリング因子</span>
hifac <span style="color: #000;">=</span> <span style="color: #000;">1</span>
T <span style="color: #000;">=</span> t<span style="color: #000;">[</span>-<span style="color: #000;">1</span><span style="color: #000;">]</span> - t<span style="color: #000;">[</span><span style="color: #000;">0</span><span style="color: #000;">]</span>
Ts <span style="color: #000;">=</span> T / <span style="color: #000;">(</span>n - <span style="color: #000;">1</span><span style="color: #000;">)</span>
nout <span style="color: #000;">=</span> np.<span style="color: #900090;">round</span><span style="color: #000;">(</span><span style="color: #000;">0.5</span> * ofac * hifac * n<span style="color: #000;">)</span> 
f <span style="color: #000;">=</span> np.<span style="color: #000;">arange</span><span style="color: #000;">(</span><span style="color: #000;">1</span><span style="color: #000;">,</span> nout+<span style="color: #000;">1</span><span style="color: #000;">)</span> / <span style="color: #000;">(</span>n * Ts * ofac<span style="color: #000;">)</span>
f_ang <span style="color: #000;">=</span> f * <span style="color: #000;">2</span> * np.<span style="color: #000;">pi</span>

<span style="color: #d00; font-style: italic;">#Lomb-Scargleピリオドグラム分析を実行</span>
pxx <span style="color: #000;">=</span> lombscargle<span style="color: #000;">(</span>t<span style="color: #000;">,</span> y<span style="color: #000;">,</span> f_ang<span style="color: #000;">,</span> precenter<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">)</span>
pxx <span style="color: #000;">=</span> pxx * <span style="color: #000;">2</span> / n /f<span style="color: #000;">[</span>-<span style="color: #000;">1</span><span style="color: #000;">]</span>

<span style="color: #d00; font-style: italic;">#f 単位: mHz, PSD 単位: dB/Hz</span>
f <span style="color: #000;">=</span> <span style="color: #000;">1000</span>*f
pxx <span style="color: #000;">=</span> <span style="color: #000;">10</span>*np.<span style="color: #000;">log10</span><span style="color: #000;">(</span> pxx <span style="color: #000;">)</span> 
    
df <span style="color: #000;">=</span> pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">(</span> <span style="color: #000;">{</span><span style="color: #0a0;">&apos;Frequency&apos;</span>:f<span style="color: #000;">,</span> <span style="color: #0a0;">&apos;Power/Frequency&apos;</span>:pxx<span style="color: #000;">}</span> <span style="color: #000;">)</span>
<span style="color: #d00; font-style: italic;">#PythonのDataFrameをワークシート列3から送る</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">(</span> df<span style="color: #000;">,</span> <span style="color: #000;">2</span> <span style="color: #000;">)</span></pre>
<h3><a name="Export_all_Graphs"></a><span class="mw-headline">全てのグラフをエクスポート</span></h3>
<p>このサンプル（\Samples\PythonのExport all Graphs.opju）はOriginプロジェクトの全グラフをエクスポートします。このプロジェクトには、それぞれに1つのグラフを持つ2つのサブフォルダがあります。グラフは以前にエクスポートされているため、各グラフにエクスポート設定が自動的に保存されています。 
</p><p><b>Run Code</b>ボタンをクリックすると下に表示されているLabTalkスクリプトを実行します。スクリプトによりGetNダイアログボックスが開き、エクスポートパスの指定や他の設定が可能です。 
</p>
<pre class="lt" style="font-family:monospace;">string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;&quot;</span>;
int fmt<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
double dWidth <span style="color: #000080;">=</span> <span style="color: #0000dd;">500</span>;
int bWidth <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
GetN	
<span style="color: #000000;">(</span>Leave path empty and Format Auto to use settings in each graph<span style="color: #000000;">)</span> <span style="color: #000080;">$</span><span style="color: #000000;">:</span>@HL
<span style="color: #000000;">(</span>Export Path<span style="color: #000000;">)</span> path<span style="color: #000080;">$</span><span style="color: #000000;">:</span>@BBPath
<span style="color: #000000;">(</span>Format<span style="color: #000000;">)</span> fmt<span style="color: #000000;">:</span>r<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Auto|png&quot;</span><span style="color: #000000;">)</span>
<span style="color: #000000;">(</span>Change Width<span style="color: #000000;">)</span> bWidth<span style="color: #000000;">:</span>2s1
<span style="color: #000000;">(</span>New Width<span style="color: #000000;">)</span> dWidth
<span style="color: #000000;">(</span>Graph Export Options<span style="color: #000000;">)</span>;

if<span style="color: #000000;">(</span><span style="color: #0000dd;">0</span><span style="color: #000080;">==</span>bWidth<span style="color: #000000;">)</span> dWidth <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;

py.@expall<span style="color: #000000;">(</span>path<span style="color: #000080;">$</span>, dWidth, fmt<span style="color: #000000;">)</span>;</pre>
<p>スクリプトの最後の行は、グラフをエクスポートするPython関数を呼び出します。<b>py.@expall()</b>という特別な表記は、<b>expall()</b>関数が、プロジェクトに添付されている<b>exp.py</b>ファイルに含まれていることを表しています。
</p><p>以下にPython関数のコードを示します。
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #000;">os</span>
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op

<span style="color: #ff7700;font-weight:bold;">def</span> expall<span style="color: #000;">(</span>fpath<span style="color: #000;">,</span> imgw<span style="color: #000;">,</span> usepng<span style="color: #000;">)</span>:
    <span style="color: #d00; font-style: italic;">#埋め込みグラフを含むプロジェクト内のグラフを全て検索</span>
    <span style="color: #900090;">list</span> <span style="color: #000;">=</span> op.<span style="color: #000;">graph_list</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;p&apos;</span><span style="color: #000;">)</span>
    <span style="color: #ff7700;font-weight:bold;">for</span> graph <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #900090;">list</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> usepng<span style="color: #000;">==</span><span style="color: #000;">0</span> <span style="color: #ff7700;font-weight:bold;">and</span> imgw<span style="color: #000;">==</span><span style="color: #000;">0</span>:
            <span style="color: #d00; font-style: italic;">#グラフに保存されたテーマを使用。fpathが空でない場合パスを変更</span>
            <span style="color: #d00; font-style: italic;">#そうでない場合、各グラフに独自のパスを記録</span>
            result <span style="color: #000;">=</span> graph.<span style="color: #000;">save_fig</span><span style="color: #000;">(</span>fpath<span style="color: #000;">)</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            result <span style="color: #000;">=</span> graph.<span style="color: #000;">save_fig</span><span style="color: #000;">(</span>path<span style="color: #000;">=</span>fpath<span style="color: #000;">,</span> <span style="color: #900090;">type</span><span style="color: #000;">=</span><span style="color: #0a0;">&apos;png&apos;</span><span style="color: #000;">,</span> width<span style="color: #000;">=</span>imgw<span style="color: #000;">)</span>
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: #000;">(</span>result<span style="color: #000;">)</span>
        
    <span style="color: #d00; font-style: italic;">#LTパスから与えられた場合</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #900090;">len</span><span style="color: #000;">(</span>fpath<span style="color: #000;">)</span>:
        <span style="color: #000;">os</span>.<span style="color: #000;">startfile</span><span style="color: #000;">(</span>fpath<span style="color: #000;">)</span></pre>
<h3><a name="Image_Thinning"></a><span class="mw-headline">画像の細線化</span></h3>
<p>opencvパッケージを使用して画像の細線化を実行するサンプルです。
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #d00; font-style: italic;">#元のコード: https://theailearner.com/tag/thinning-opencv/</span>
<span style="color: #d00; font-style: italic;">#pip install opencv-python;// スクリプトウィンドウでcv2をインストールする場合</span>
<span style="color: #ff7700;font-weight:bold;">import</span> cv2
<span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op

<span style="color: #d00; font-style: italic;">#ソース画像をnumpy配列imgにロード</span>
m1 <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;m&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;MBook1&apos;</span><span style="color: #000;">)</span>
img <span style="color: #000;">=</span> m1.<span style="color: #000;">to_np2d</span><span style="color: #000;">(</span><span style="color: #000;">)</span>

<span style="color: #d00; font-style: italic;"># 構造化要素</span>
kernel <span style="color: #000;">=</span> cv2.<span style="color: #000;">getStructuringElement</span><span style="color: #000;">(</span>cv2.<span style="color: #000;">MORPH_CROSS</span><span style="color: #000;">,</span><span style="color: #000;">(</span><span style="color: #000;">3</span><span style="color: #000;">,</span><span style="color: #000;">3</span><span style="color: #000;">)</span><span style="color: #000;">)</span>
<span style="color: #d00; font-style: italic;"># 値を保持するために空の出力画像を作成</span>
thin <span style="color: #000;">=</span> np.<span style="color: #000;">zeros</span><span style="color: #000;">(</span>img.<span style="color: #000;">shape</span><span style="color: #000;">,</span>dtype<span style="color: #000;">=</span><span style="color: #0a0;">&apos;uint8&apos;</span><span style="color: #000;">)</span>
 
<span style="color: #d00; font-style: italic;"># 収縮処理が空のセットまたは最大になるまでループ</span>
<span style="color: #900090;">max</span> <span style="color: #000;">=</span> <span style="color: #000;">50</span>
<span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #000;">(</span>cv2.<span style="color: #000;">countNonZero</span><span style="color: #000;">(</span>img<span style="color: #000;">)</span><span style="color: #000;">!=</span><span style="color: #000;">0</span><span style="color: #000;">)</span>:
    <span style="color: #d00; font-style: italic;"># 収縮処理</span>
    erode <span style="color: #000;">=</span> cv2.<span style="color: #000;">erode</span><span style="color: #000;">(</span>img<span style="color: #000;">,</span>kernel<span style="color: #000;">)</span>
    <span style="color: #d00; font-style: italic;"># 収縮処理後の画像を開く</span>
    opening <span style="color: #000;">=</span> cv2.<span style="color: #000;">morphologyEx</span><span style="color: #000;">(</span>erode<span style="color: #000;">,</span>cv2.<span style="color: #000;">MORPH_OPEN</span><span style="color: #000;">,</span>kernel<span style="color: #000;">)</span>
    <span style="color: #d00; font-style: italic;"># 2つを減算</span>
    subset <span style="color: #000;">=</span> erode - opening
    <span style="color: #d00; font-style: italic;"># 以前のすべてのセットの和集合</span>
    thin <span style="color: #000;">=</span> cv2.<span style="color: #000;">bitwise_or</span><span style="color: #000;">(</span>subset<span style="color: #000;">,</span>thin<span style="color: #000;">)</span>
    <span style="color: #d00; font-style: italic;"># 次の反復のために収縮処理した画像を設定</span>
    img <span style="color: #000;">=</span> erode.<span style="color: #000;">copy</span><span style="color: #000;">(</span><span style="color: #000;">)</span>
    <span style="color: #900090;">max</span> -<span style="color: #000;">=</span> <span style="color: #000;">1</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #900090;">max</span> <span style="color: #000;">==</span> <span style="color: #000;">0</span>:
        <span style="color: #ff7700;font-weight:bold;">break</span>

m2 <span style="color: #000;">=</span> op.<span style="color: #000;">new_sheet</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;m&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;Thinned Result&apos;</span><span style="color: #000;">)</span>
m2.<span style="color: #000;">from_np</span><span style="color: #000;">(</span>thin<span style="color: #000;">)</span>
m2.<span style="color: #000;">show_image</span><span style="color: #000;">(</span><span style="color: #000;">)</span></pre>
<h3><a name="Peak_Movement"></a><span class="mw-headline">ピーク移動</span></h3>
<p>このサンプル（Sample\PythonのPeak Movement.opju）では、ワークシートの連続する列からのデータが1つずつプロットされるので、測定パラメータの関数としてデータがどのように変化しているかを視覚化できます。
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd

<span style="color: #d00; font-style: italic;">#ブック名で検索</span>
wksSource <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;w&apos;</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;Waterfall]&apos;</span><span style="color: #000;">)</span>
df <span style="color: #000;">=</span> wksSource.<span style="color: #000;">to_df</span><span style="color: #000;">(</span><span style="color: #000;">)</span>
<span style="color: #d00; font-style: italic;">#範囲表記でも検索可能</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span>ref<span style="color: #000;">=</span><span style="color: #0a0;">&quot;[Book1]1!&quot;</span><span style="color: #000;">)</span>

<span style="color: #ff7700;font-weight:bold;">for</span> key<span style="color: #000;">,</span> value <span style="color: #ff7700;font-weight:bold;">in</span> df.<span style="color: #000;">iteritems</span><span style="color: #000;">(</span><span style="color: #000;">)</span>: 
    wks.<span style="color: #000;">from_list</span><span style="color: #000;">(</span>key<span style="color: #000;">!=</span><span style="color: #0a0;">&apos;X&apos;</span><span style="color: #000;">,</span> <span style="color: #900090;">list</span><span style="color: #000;">(</span>value<span style="color: #000;">)</span><span style="color: #000;">,</span> comments<span style="color: #000;">=</span>key<span style="color: #000;">)</span>
    op.<span style="color: #000;">wait</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;s&apos;</span><span style="color: #000;">,</span> <span style="color: #000;">0.05</span><span style="color: #000;">)</span></pre>
<h3><a name="Fit_Summation"></a><span class="mw-headline">フィットのシミュレーション</span></h3>
<p>複数の総和を持つ関数にデータをフィットさせるサンプルです。ベクトル形式でフィトパラメータを取得するためにNelder-Meadシンプレックスアルゴリズムが使用されます。</p>
<p>
<a  class="image"><img alt="FitSummation1.png" src="../images/Sample_Projects_with_Attached_Python_Codes/400px-FitSummation1.png" width="400"   /></a>
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">from</span> scipy.<span style="color: #000;">optimize</span> <span style="color: #ff7700;font-weight:bold;">import</span> minimize
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op

<span style="color: #ff7700;font-weight:bold;">def</span> fitfunc<span style="color: #000;">(</span>a<span style="color: #000;">)</span>:
    y1 <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">(</span>y<span style="color: #000;">)</span>  
    y1 <span style="color: #000;">=</span> y1.<span style="color: #000;">reshape</span><span style="color: #000;">(</span><span style="color: #000;">1</span><span style="color: #000;">,</span><span style="color: #900090;">len</span><span style="color: #000;">(</span>y1<span style="color: #000;">)</span><span style="color: #000;">)</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #900090;">sum</span><span style="color: #000;">(</span>np.<span style="color: #000;">square</span><span style="color: #000;">(</span><span style="color: #900090;">sum</span><span style="color: #000;">(</span>C_csk<span style="color: #000;">(</span>a<span style="color: #000;">,</span> x<span style="color: #000;">)</span> - y1<span style="color: #000;">)</span><span style="color: #000;">)</span><span style="color: #000;">)</span> 
    
<span style="color: #ff7700;font-weight:bold;">def</span> C_csk<span style="color: #000;">(</span>a<span style="color: #000;">,</span> x<span style="color: #000;">)</span>:
    <span style="color: #0a0;">&quot;&quot;&quot;
    D:DD
    &quot;&quot;&quot;</span>
    a <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">(</span>a<span style="color: #000;">)</span>
    a <span style="color: #000;">=</span> a.<span style="color: #000;">reshape</span><span style="color: #000;">(</span><span style="color: #900090;">len</span><span style="color: #000;">(</span>a<span style="color: #000;">)</span><span style="color: #000;">,</span><span style="color: #000;">1</span><span style="color: #000;">)</span>
    g <span style="color: #000;">=</span> a<span style="color: #000;">[</span><span style="color: #000;">0</span>:<span style="color: #900090;">int</span><span style="color: #000;">(</span><span style="color: #900090;">len</span><span style="color: #000;">(</span>a<span style="color: #000;">)</span>/<span style="color: #000;">2</span><span style="color: #000;">)</span><span style="color: #000;">]</span>
    d <span style="color: #000;">=</span> a<span style="color: #000;">[</span><span style="color: #900090;">int</span><span style="color: #000;">(</span><span style="color: #900090;">len</span><span style="color: #000;">(</span>a<span style="color: #000;">)</span>/<span style="color: #000;">2</span><span style="color: #000;">)</span>:<span style="color: #000;">]</span>
    x1 <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">(</span>x<span style="color: #000;">)</span>
    x1 <span style="color: #000;">=</span> x1.<span style="color: #000;">reshape</span><span style="color: #000;">(</span><span style="color: #000;">1</span><span style="color: #000;">,</span><span style="color: #900090;">len</span><span style="color: #000;">(</span>x1<span style="color: #000;">)</span><span style="color: #000;">)</span>    
    m0 <span style="color: #000;">=</span> g*np.<span style="color: #000;">exp</span><span style="color: #000;">(</span>-d/x1<span style="color: #000;">)</span>
    m1 <span style="color: #000;">=</span> g*d*np.<span style="color: #000;">exp</span><span style="color: #000;">(</span>-d/x1<span style="color: #000;">)</span>
    m2 <span style="color: #000;">=</span> g*np.<span style="color: #000;">square</span><span style="color: #000;">(</span>d<span style="color: #000;">)</span>*np.<span style="color: #000;">exp</span><span style="color: #000;">(</span>-d/x1<span style="color: #000;">)</span>
    sm <span style="color: #000;">=</span> <span style="color: #000;">(</span>m0.<span style="color: #900090;">sum</span><span style="color: #000;">(</span>axis<span style="color: #000;">=</span><span style="color: #000;">0</span><span style="color: #000;">)</span>*m2.<span style="color: #900090;">sum</span><span style="color: #000;">(</span>axis<span style="color: #000;">=</span><span style="color: #000;">0</span><span style="color: #000;">)</span> - np.<span style="color: #000;">square</span><span style="color: #000;">(</span>m1.<span style="color: #900090;">sum</span><span style="color: #000;">(</span>axis<span style="color: #000;">=</span><span style="color: #000;">0</span><span style="color: #000;">)</span><span style="color: #000;">)</span><span style="color: #000;">)</span>/np.<span style="color: #000;">square</span><span style="color: #000;">(</span>m0.<span style="color: #900090;">sum</span><span style="color: #000;">(</span>axis<span style="color: #000;">=</span><span style="color: #000;">0</span><span style="color: #000;">)</span><span style="color: #000;">)</span>*<span style="color: #000;">8.314</span>/x1/x1
    <span style="color: #ff7700;font-weight:bold;">return</span> sm.<span style="color: #900090;">sum</span><span style="color: #000;">(</span>axis<span style="color: #000;">=</span><span style="color: #000;">0</span><span style="color: #000;">)</span>  

<span style="color: #ff7700;font-weight:bold;">def</span> fitSummation<span style="color: #000;">(</span><span style="color: #000;">)</span>:
    <span style="color: #ff7700;font-weight:bold;">global</span> x<span style="color: #000;">,</span> y
    wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">(</span><span style="color: #000;">)</span>
    x <span style="color: #000;">=</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">(</span><span style="color: #000;">0</span><span style="color: #000;">)</span>
    y <span style="color: #000;">=</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">(</span><span style="color: #000;">1</span><span style="color: #000;">)</span>
    a0 <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">(</span>wks.<span style="color: #000;">to_list</span><span style="color: #000;">(</span><span style="color: #000;">2</span><span style="color: #000;">)</span><span style="color: #000;">)</span>
    res <span style="color: #000;">=</span> minimize<span style="color: #000;">(</span>fitfunc<span style="color: #000;">,</span> a0<span style="color: #000;">,</span> method<span style="color: #000;">=</span><span style="color: #0a0;">&apos;nelder-mead&apos;</span><span style="color: #000;">,</span> options<span style="color: #000;">=</span><span style="color: #000;">{</span><span style="color: #0a0;">&apos;xatol&apos;</span>: <span style="color: #000;">1e-8</span><span style="color: #000;">,</span> <span style="color: #0a0;">&apos;disp&apos;</span>: <span style="color: #900090;">True</span><span style="color: #000;">}</span><span style="color: #000;">)</span>
    wks.<span style="color: #000;">from_list</span><span style="color: #000;">(</span><span style="color: #000;">3</span><span style="color: #000;">,</span> res.<span style="color: #000;">x</span><span style="color: #000;">)</span></pre>
<h2><a name="How_to_Execute_Python_Code_from_a_Button"></a><span class="mw-headline">ボタンからPythonコードを実行する方法</span></h2>
<p>テキストラベルなどのグラフオブジェクトからLabTalkスクリプトを実行するように設定できます。クリック、移動、サイズ変更などのイベントによりスクリプトを実行可能です。 
</p><p>前のセクションで説明したサンプルでは、ボタンとして設定されたテキストラベルを使用して、LabTalkスクリプトを実行します。次に、スクリプトはプロジェクトに添付されたPythonコードを実行します。次のミニチュートリアルでは、その方法を説明します。
</p>
<ol><li> Originでコードビルダを開きます（メニューの<b>表示：コードビルダ</b>を選択）。</li>
<li> メニューの<b>ファイル：新規...</b>を選び、ダイアログで<b>Python File</b>を選択して、ファイル名を<b>test</b>にして<b>OK</b>をクリックします。</li>
<li> 右側のエディタで、以下のPythonコードを入力します。<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">print</span><span style="color: #000;">(</span><span style="color: #0a0;">&apos;Hello from Python!&apos;</span><span style="color: #000;">)</span></pre> 上書き保存ボタンをクリックしてファイルを保存します。</li>
<li> コードビルダの左パネルで、<b>Project</b>ノードを右クリックし、<b>ファイルを追加...</b>を選択します。作成した<b>test.py</b>を選択して、開くをクリックします。これで、ファイルがプロジェクトに添付されました。</li>
<li> Originに戻ります。 </li>
<li> グラフまたはワークシートウィンドウをアクティブにします。</li>
<li> Originウィンドウの左側にある、<b>プロット操作・オブジェクト作成</b>ツールバーから<b>テキスト</b>ツール<a  class="image"><img alt="Button Text Tool.png" src="../images/Sample_Projects_with_Attached_Python_Codes/Button_Text_Tool.png" width="23"  /></a>をクリックします。 </li>
<li> グラフまたはワークシート上の何もない箇所をクリックします。これによりテキスト編集モードになります。  <b>Run Code</b> と入力して、テキストオブジェクト外を一度クリックします。 </li>
<li> 次に、<b>ALT</b>キーを押しながら、今作成したテキストをダブルクリックします。  テキストオブジェクトダイアログの<b>プログラミング</b>タブが開きます。</li>
<li> <b>～の後でスクリプトを実行</b>リストから、<b>ボタンアップ</b>を選びます。</li>
<li> 下のテキストボックスに以下のスクリプトを入力します。 <pre class="lt" style="font-family:monospace;">run <span style="color: #000080;">-</span>pyp test.<span style="color: #000080;">py</span>;</pre>.このスクリプトは、プロジェクトに添付されたtest.pyファイルのPythonコードを実行するようにOriginに伝えるためのものです。</li>
<li> <b>OK</b>をクリックして、ダイアログを閉じます。</li>
<li> テキストラベルがボタンになりました。ボタンをクリックします。スクリプトウィンドウが開き、Pythonのprintステートメントからの出力が表示されます。</li>
<li> このプロジェクトを保存すると、プロジェクトに添付されているPythonコードファイルも一緒に保存されます。</li></ol>
<p>インストール時に付属するOriginのプロジェクトサンプルには、<b>コードを実行する</b>、<b>コードを表示する</b>、<b>必要なパッケージをインストールする</b>などの複数のボタンがあります。ALTキーを押しながら、これらのボタンをダブルクリックすると、スクリプトが表示されます。
</p>
<h3><a name="The_Show_Code_Button"></a><span class="mw-headline">コードを表示するボタン</span></h3>
<p>上記のプロジェクトには、<b>コードを表示する</b>ボタンがあり、クリックすると、コードビルダーIDEでPythonコードが開きます。プロジェクトに添付されている.pyファイルが1つしかない場合は、次のスクリプト行でそのファイルをIDEで開くことができます。
</p>
<pre class="lt" style="font-family:monospace;">ed.<span style="color: #000080;">open</span><span style="color: #000000;">(</span>py.@<span style="color: #000000;">)</span></pre>
<p>プロジェクトに複数のファイルが添付されている場合は、以下のようにして特定のファイルを開くことができます。
</p>
<pre class="lt" style="font-family:monospace;">ed.<span style="color: #000080;">open</span><span style="color: #000000;">(</span>py.@filename<span style="color: #000000;">)</span></pre>
<p>Altキーを押しながら<b>コードを表示する</b>ボタンをダブルクリックすると、このスクリプトを実行するためのボタンの設定を確認できます。
</p><p><b>関連情報：</b>
</p>
<ul><li> <a href="../../Python/Python/Python_Examples_using_originpro.html" title="Python:originproを使ったPythonサンプル"> originproを使ったPythonサンプル</a></li></ul>
<ul><li> <a class="external text" href="https://www.originlab.com/python/doc/originpro/annotated.html" target="_blank">Python originproリファレンス</a></li></ul>







    