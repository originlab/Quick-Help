<h1 class="firstheading">NLFit および ピークアナライザ</h1>
<p><br />
非線形曲線フィットの実行時にPython関数を使用できます。Python関数と、その関数に必要な<b>Pythonパッケージ</b>をインストールするためのスクリプトコマンドを含むフィット関数ファイル（FDFファイル）を作成する必要があります。</p>
<p>次のサンプルで、Python関数を使用してFDFを作成する方法の概要を示します。</p>
<h3><a name="Fitting_Function_for_Mass_Diffusion" id="Fitting_Function_for_Mass_Diffusion"></a><span class="mw-headline">質量拡散のためのフィット関数</span></h3>
<p>このセクションでは、Pythonを関数を使って次の質量拡散方程式のフィッティング関数を作成する手順の概要を説明します。<br />
<a class="image"><img alt="MassDiffusionFittingFunction.png" src="../images/NLFit_and_Peak_Analyzer/300px-MassDiffusionFittingFunction.png" width="300" /></a><br /></p>
<ol>
<li>まず、新しくFDFファイルを作成します。Originのメニューから<b>ツール：フィット関数ビルダー...</b>を選択して、<i>フィット関数ビルダー</i> を開きます。</li>
<li>最初のページでは、<b>新しい関数の作成</b>を選択します。</li>
<li>2ページ目では、<b>関数名</b>をMassDiffusionに設定し、関数形式は<b>Python 関数(Vector)</b>にします。</li>
<li>3ページ目では、独立変数をx、従属変数をy、パラメータをy0, D, Lに設定します。</li>
<li>4ページ目では、<br />
<pre>
from mpmath import nsum, exp, inf
import numpy as np

def MassDiffuse(x, y0, D, L):
        sm = [float((nsum(lambda ii: 1/(2*ii+1)**2*exp(-D*(2*ii+1)**2*np.pi**2*t/(4*L**2)),[0, inf]))) for t in x]
        return [y0*(1-8/np.pi**2*t) for t in sm]
</pre>
<p>のように<b>Python関数(Vector)</b> 編集ボックスに入力します。次に</p>
<pre>
MassDiffuse(x, y0, D, L)
</pre>
<p>のように<b>関数式</b>編集ボックスに入力します。</p>
</li>
<li>5ページ目では、<br />
<pre>
if(Python.chk("mpmath numpy") &gt; 1)
        return 1;
return 0;
</pre>
<p>のように<b>Pythonパッケージ確認（LabTalkスクリプト）</b>に入力します。この関数は、<b>mpmath</b> および <b>numpy</b>パッケージが必要です。関数使用前にこれらをインストールする必要があります。パッケージをインストールするには、Originの<b>接続</b>メニューにあるPythonパッケージツールを使用できます。他のOriginユーザと関数を共有する場合は、Originに関数を追加するときに自動でパッケージをインストールするように設定できます。</p>
</li>
<li><b>進む</b>ボタンをクリックし、<b>完了</b>ボタンをクリックします。</li>
<li>以下のXYデータでフィット関数のテストが可能です。
<pre>
0.00    -0.078
0.20     0.604
0.40     0.842
0.60     1.101
0.80     1.029
1.00     1.083
1.20     0.828
1.40     0.884
1.60     0.991
1.80     1.005
2.00     0.915
</pre>
<p>パラメータの初期値には以下を入力します。</p>
<pre>
y0 = 1, D = 0.5, L = 0.5
</pre>
<p>そしてフィットを実行します。最終的なパラメータ値は以下の通りです。</p>
<pre>
フィット値: y0 = 0.97846, D = 0.37563, L = 0.43781
</pre></li>
</ol>
