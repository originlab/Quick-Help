<h1 class="firstheading">XY検索</h1><p>独立変数から従属変数の値を取得するため、あるいは、従属変数から独立変数の値を取得するために、指定したパラメータ値を使用する方法を示しています。
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Linear"><span class="tocnumber">1</span> <span class="toctext">線形</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Non-linear"><span class="tocnumber">2</span> <span class="toctext">非線形</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Get_Y_from_X"><span class="tocnumber">2.1</span> <span class="toctext">XからYを取得 </span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Get_X_from_Y"><span class="tocnumber">2.2</span> <span class="toctext">YからXを取得 </span></a></li>
</ul>
</li>
</ul>
</div>

<h2><a name="Linear"></a><span class="mw-headline">線形</span></h2>
<p>XからYを取得する式は、
</p>
<pre class="oc" style="font-family:monospace;">y <span style="color: #000080;">=</span> a <span style="color: #000040;">+</span> x <span style="color: #000040;">*</span> b;</pre>
<p>YからXを取得する式は、
</p>
<pre class="oc" style="font-family:monospace;">x <span style="color: #000080;">=</span> <span style="color: #000000;">(</span>y <span style="color: #000040;">-</span> a<span style="color: #000000;">)</span> <span style="color: #000040;">/</span> b;</pre>
<h2><a name="Non-linear"></a><span class="mw-headline">非線形</span></h2>
<p>非線形関数の場合、NumericFunction クラスを使用してxからyを取得し、ocmath_find_xs 関数を使用してyからxを取得します。 
</p><p>サンプルを実行する前に nlsf_utils.cファイルをロードしてコンパイルしておく必要があります。これは、コマンドrun.LoadOC(Originlab\nlsf_utils.c) のスクリプトから実行するか、ワークスペース内にこのファイルを追加して行います。 
</p><p><br />
</p>
<h3><a name="Get_Y_from_X"></a><span class="mw-headline">XからYを取得</span></h3>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>ONLSF.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>..\Originlab\nlsf_utils.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
<span style="color: #0000ff;">void</span> _findy_from_x<span style="color: #000000;">(</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>	
	<span style="color: #008000;">// フィット関数オーガナイザダイアログのカテゴリに関連した</span>
	<span style="color: #008000;">// 適切な関数を使用する。F9キーを押すとこのダイアログが開く。</span>
	<span style="color: #008000;">// Poly 関数はPolynomial カテゴリにある</span>
	string 	strFuncFileName <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Poly&quot;</span>;
	
	Tree	trFF;
	<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> <span style="color: #000040;">!</span>nlsf_load_fdf_tree<span style="color: #000000;">(</span>trFF, strFuncFileName<span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
	<span style="color: #000000;">{</span>
		out_str<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Fail to load function file to tree&quot;</span><span style="color: #000000;">)</span>;
		<span style="color: #0000ff;">return</span>;
	<span style="color: #000000;">}</span>
	
	NumericFunction	func;
	<span style="color: #0000ff;">if</span> <span style="color: #000000;">(</span><span style="color: #000040;">!</span>func.<span style="color: #000000;">SetTree</span><span style="color: #000000;">(</span>trFF<span style="color: #000000;">)</span><span style="color: #000000;">)</span>
	<span style="color: #000000;">{</span>
		out_str<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;NumericFunction object init failed&quot;</span><span style="color: #000000;">)</span>;
		<span style="color: #0000ff;">return</span>;
	<span style="color: #000000;">}</span>
	
	<span style="color: #0000ff;">int</span> nNumParamsInFunc <span style="color: #000080;">=</span> trFF.<span style="color: #000000;">GeneralInformation</span>.<span style="color: #000000;">NumberOfParameters</span>.<span style="color: #000000;">nVal</span>;
	vector vParams<span style="color: #000000;">(</span>nNumParamsInFunc<span style="color: #000000;">)</span>;
	vParams <span style="color: #000080;">=</span> NANUM;
	vParams<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
	vParams<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;
	vParams<span style="color: #000000;">[</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;		

	vector vX <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">1.5</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">}</span>;
	vector vY;
	vY <span style="color: #000080;">=</span> func.<span style="color: #000000;">Evaluate</span><span style="color: #000000;">(</span>vX, vParams<span style="color: #000000;">)</span>;	
<span style="color: #000000;">}</span></pre>
<h3><a name="Get_X_from_Y"></a><span class="mw-headline">YからXを取得</span></h3>
<p>次の関数は、指定したY値から2つのX値を取得する方法を示しています。実行前に、Samples\Curve Fitting\Gaussian.dat をワークシートにインポートし、このワークシートをアクティブにします。 
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>...\originlab\nlsf_utils.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>FDFTree.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span> 
<span style="color: #0000ff;">void</span> _findx_from_y<span style="color: #000000;">(</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	<span style="color: #0000ff;">double</span> y <span style="color: #000080;">=</span> <span style="color: #0000dd;">20</span>; <span style="color: #008000;">// X値取得するY値は 20</span>
	
	Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
	<span style="color: #0000ff;">if</span> <span style="color: #000000;">(</span><span style="color: #000040;">!</span>wks<span style="color: #000000;">)</span>
	<span style="color: #000000;">{</span>
		<span style="color: #0000ff;">return</span>;
	<span style="color: #000000;">}</span>

	<span style="color: #008000;">// フィットするデータを取得</span>
	DataRange dr;
	dr.<span style="color: #000000;">Add</span><span style="color: #000000;">(</span>wks, <span style="color: #0000dd;">0</span>, <span style="color: #ff00ff;">&quot;X&quot;</span><span style="color: #000000;">)</span>;
	dr.<span style="color: #000000;">Add</span><span style="color: #000000;">(</span>wks, <span style="color: #0000dd;">1</span>, <span style="color: #ff00ff;">&quot;Y&quot;</span><span style="color: #000000;">)</span>;
	DWORD dwPlotID;
	vector vDataX, vDataY;
	<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span>dr.<span style="color: #000000;">GetData</span><span style="color: #000000;">(</span>DRR_GET_DEPENDENT <span style="color: #000040;">|</span> DRR_NO_FACTORS, <span style="color: #0000dd;">0</span>, <span style="color: #000040;">&amp;</span>dwPlotID, <span style="color: #0000ff;">NULL</span>, 
	<span style="color: #000040;">&amp;</span>vDataY, <span style="color: #000040;">&amp;</span>vDataX<span style="color: #000000;">)</span> <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>
	<span style="color: #000000;">{</span>
		<span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;failed to get data&quot;</span><span style="color: #000000;">)</span>;
		<span style="color: #0000ff;">return</span>;
	<span style="color: #000000;">}</span>	
	
	uint nFindXNum <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>; <span style="color: #008000;">// Xの個数をセット</span>
	vector vFindX;
	vFindX.<span style="color: #000000;">SetSize</span><span style="color: #000000;">(</span>nFindXNum<span style="color: #000000;">)</span>;
	
	string strFile <span style="color: #000080;">=</span> GetOriginPath<span style="color: #000000;">(</span><span style="color: #000000;">)</span> <span style="color: #000040;">+</span> <span style="color: #ff00ff;">&quot;OriginC<span style="color: #666666; font-weight: bold;">\\</span>OriginLab<span style="color: #666666; font-weight: bold;">\\</span>nlsf_utils.c&quot;</span>;
	PFN_STR_INT_DOUBLE_DOUBLE_DOUBLEP pFunc <span style="color: #000080;">=</span> 
		Project.<span style="color: #000000;">FindFunction</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;compute_y_by_x&quot;</span>, strFile, <span style="color: #0000ff;">true</span><span style="color: #000000;">)</span>;
	string strFuncFileName <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Gauss&quot;</span>;
	vector vParams<span style="color: #000000;">(</span><span style="color: #0000dd;">4</span><span style="color: #000000;">)</span>;
	vParams<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">5.58333</span>; <span style="color: #008000;">// y0</span>
	vParams<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">26</span>; <span style="color: #008000;">// xc</span>
	vParams<span style="color: #000000;">[</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">8.66585</span>; <span style="color: #008000;">// w</span>
	vParams<span style="color: #000000;">[</span><span style="color: #0000dd;">3</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">976.41667</span>; <span style="color: #008000;">// A</span>
	
	<span style="color: #0000ff;">int</span> nRet <span style="color: #000080;">=</span> ocmath_find_xs<span style="color: #000000;">(</span>y, <span style="color: #000000;">(</span>uint<span style="color: #000000;">)</span><span style="color: #000000;">(</span>vDataY.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>, vDataX, 
		vDataY, nFindXNum, vFindX, strFuncFileName, vParams.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>, 
		vParams, pFunc<span style="color: #000000;">)</span>;	
	
	<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> OE_NOERROR <span style="color: #000080;">==</span> nRet <span style="color: #000000;">)</span>
		<span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Y =&nbsp;%g<span style="color: #666666; font-weight: bold;">\t</span>X1 =&nbsp;%g<span style="color: #666666; font-weight: bold;">\t</span>X2 =&nbsp;%g<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span>, y, vFindX<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span>, vFindX<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span><span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span></pre>







    