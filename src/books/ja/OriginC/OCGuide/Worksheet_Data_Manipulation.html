<h1 class="firstheading">ワークシートデータの操作</h1><p>このセクションでは、Origin Cでデータを操作する方法を示すサンプルを紹介します。
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Get_Worksheet_SelectionWorksheet.2C_Get_SelectionWorksheet.2C_Get_Data_from_Specified_Data_Range"><span class="tocnumber">1</span> <span class="toctext">ワークシート選択の取得<span class="OIndex" style="display:none">Worksheet, Get Selection</span><span class="OIndex" style="display:none">Worksheet, Get Data from Specified Data Range</span></span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Set_Display_Range_in_WorksheetWorksheet.2C_Set_Display_Range"><span class="tocnumber">2</span> <span class="toctext">ワークシート内の表示範囲を設定する<span class="OIndex" style="display:none">Worksheet, Set Display Range</span></span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Put_Large_Dataset_to_WorksheetWorksheet.2C_Put_Large_Dataset_toWorksheet.2C_Delete_All_ColumnsColumn.2C_Access_Data_Buffer"><span class="tocnumber">3</span> <span class="toctext">ワークシートに大きなデータセットを配置する<span class="OIndex" style="display:none">Worksheet, Put Large Dataset to</span><span class="OIndex" style="display:none">Worksheet, Delete All Columns</span><span class="OIndex" style="display:none">Column, Access Data Buffer</span></span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Access_Embedded_Graph_in_a_WorksheetWorksheet.2C_Embedded_Graph"><span class="tocnumber">4</span> <span class="toctext">ワークシートの埋め込みグラフにアクセスする<span class="OIndex" style="display:none">Worksheet, Embedded Graph</span></span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Sort_Worksheet_DataWorksheet.2C_Sorting_Data"><span class="tocnumber">5</span> <span class="toctext">ワークシートデータのソート<span class="OIndex" style="display:none">Worksheet, Sorting Data</span></span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Mask_Worksheet_DataWorksheet.2C_Masking_DataWorksheet.2C_Find_Data"><span class="tocnumber">6</span> <span class="toctext">ワークシートデータをマスクする<span class="OIndex" style="display:none">Worksheet, Masking Data</span><span class="OIndex" style="display:none">Worksheet, Find Data</span></span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Set_Size"><span class="tocnumber">7</span> <span class="toctext">サイズをセット</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Reduce_Worksheet_Data"><span class="tocnumber">8</span> <span class="toctext">ワークシートデータを削減</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Extract_Data_from_Worksheet_with_LT_ConditionWorksheet.2C_Extract_Data"><span class="tocnumber">9</span> <span class="toctext">LT条件でワークシートからデータを抽出<span class="OIndex" style="display:none">Worksheet, Extract Data</span></span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#Compare_Data_in_Two_WorksheetsWorksheet.2C_Compare_Data"><span class="tocnumber">10</span> <span class="toctext">2つのワークシート内のデータを比較する<span class="OIndex" style="display:none">Worksheet, Compare Data</span></span></a></li>
</ul>
</div>

<h2><a name="Get_Worksheet_SelectionWorksheet.2C_Get_SelectionWorksheet.2C_Get_Data_from_Specified_Data_Range"></a><span class="mw-headline">ワークシート選択の取得<span class="OIndex" style="display:none">Worksheet, Get Selection</span><span class="OIndex" style="display:none">Worksheet, Get Data from Specified Data Range</span></span></h2>
<p><a href="../../OriginC/OriginC/Worksheet-GetSelectedRange.html" title="OriginC:Worksheet-GetSelectedRange">Worksheet::GetSelectedRange</a> は、ワークシートから1つまたは複数の選択したデータを取得するのに使うことができます。次のコードは、ワークシート選択で1つの列からデータを取得する方法を示しています。この関数は、1つの列、1つの行、ワークシート全体など範囲データ型を返します。
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;

<span style="color: #0000ff;">int</span> r1, c1, r2, c2;
<span style="color: #0000ff;">int</span> nRet <span style="color: #000080;">=</span> wks.<span style="color: #000000;">GetSelectedRange</span><span style="color: #000000;">(</span>r1, c1, r2, c2<span style="color: #000000;">)</span>;

<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> WKS_SEL_ONE_COL <span style="color: #000040;">&amp;</span> nRet <span style="color: #000000;">)</span> <span style="color: #008000;">// 1つの列だけを選択</span>
<span style="color: #000000;">{</span>
	<span style="color: #008000;">// 選択でデータ範囲オブジェクトを構築</span>
	DataRange dr;
	dr.<span style="color: #000000;">Add</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;X&quot;</span>, wks, r1, c1, r2, c2<span style="color: #000000;">)</span>;
	
	<span style="color: #008000;">// 選択した列からデータを取得</span>
	vector vData;
	dr.<span style="color: #000000;">GetData</span><span style="color: #000000;">(</span><span style="color: #000040;">&amp;</span>vData, <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span></pre>
<h2><a name="Set_Display_Range_in_WorksheetWorksheet.2C_Set_Display_Range"></a><span class="mw-headline">ワークシート内の表示範囲を設定する<span class="OIndex" style="display:none">Worksheet, Set Display Range</span></span></h2>
<p>Worksheet内の表示範囲を設定する場合、<a href="../../OriginC/OriginC/Worksheet-SetBounds.html" title="OriginC:Worksheet-SetBounds">Worksheet::SetBounds</a>を使い、開始行／終了行に設定と同じです。  
</p><p>次のコードは、現在のワークシートウィンドウにすべての列の開始と終了をセットする方法を示します。
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;

<span style="color: #008000;">// 行の開始と終了 	</span>
<span style="color: #0000ff;">int</span> begin <span style="color: #000080;">=</span> <span style="color: #0000dd;">9</span>, end <span style="color: #000080;">=</span> <span style="color: #0000dd;">19</span>;

<span style="color: #008000;">// すべての列の開始と終了をセット</span>
<span style="color: #0000ff;">int</span> c1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>, c2 <span style="color: #000080;">=</span> <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">// -1は終了</span>

wks.<span style="color: #000000;">SetBounds</span><span style="color: #000000;">(</span>begin, c1, end, c2<span style="color: #000000;">)</span>;</pre>
<h2><a name="Put_Large_Dataset_to_WorksheetWorksheet.2C_Put_Large_Dataset_toWorksheet.2C_Delete_All_ColumnsColumn.2C_Access_Data_Buffer"></a><span class="mw-headline">ワークシートに大きなデータセットを配置する<span class="OIndex" style="display:none">Worksheet, Put Large Dataset to</span><span class="OIndex" style="display:none">Worksheet, Delete All Columns</span><span class="OIndex" style="display:none">Column, Access Data Buffer</span></span></h2>
<p>ワークシート内で大きなデータセット(例:1000列)を操作するとき、Origin C関数を効率よく実行するためには、以下のステップを使います。 
</p>
<ul><li> ワークシートにデータを配置する列と行を準備します。 </li>
<li> サイズをセットするには、<a href="../../OriginC/OriginC/Worksheet-SetSize.html" title="OriginC:ワークシートの並べ替え">Worksheet::SetSize</a>を使い、<a href="../../OriginC/OriginC/Worksheet-AddCol.html" title="OriginC:Worksheet-AddCol">Worksheet::AddCol</a> は使いません。</li>
<li> Originが新しい列を追加するときに重複した名前を持たないように既存の列のショートネームをチェックする必要があるので、事前に空のワークシートでサイズをセットし、列と行の属性は無しにします。これにより時間が削減できます。  while( wks.DeleteCol(0) ); を使って、すべての列を削除して、空のワークシートを作成します。 </li>
<li> <a href="../../OriginC/OriginC/DataObject-GetInternalDataBuffer.html" title="OriginC:DataObject-GetInternalDataBuffer">DataObject::GetInternalDataBuffer</a>を使って、バッファでワークシート列にデータを配置します。 </li>
<li> 実行スピードを上げるために関数を実行しているとき、コードビルダは閉じておきます。 </li></ul>
<p>以下のサンプルコードをご覧ください。
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// ワークシートサイズの準備</span>
Worksheet wks;
wks.<span style="color: #000000;">Create</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Origin&quot;</span><span style="color: #000000;">)</span>;
<span style="color: #0000ff;">while</span><span style="color: #000000;">(</span> wks.<span style="color: #000000;">DeleteCol</span><span style="color: #000000;">(</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> <span style="color: #000000;">)</span>; 
<span style="color: #0000ff;">int</span> rows <span style="color: #000080;">=</span> <span style="color: #0000dd;">100</span>, cols <span style="color: #000080;">=</span> <span style="color: #0000dd;">1000</span>;
wks.<span style="color: #000000;">SetSize</span><span style="color: #000000;">(</span>rows, cols<span style="color: #000000;">)</span>;

<span style="color: #008000;">// ワークシート列に1つずつデータを配置</span>
foreach<span style="color: #000000;">(</span>Column col in wks.<span style="color: #000000;">Columns</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
    col.<span style="color: #000000;">SetFormat</span><span style="color: #000000;">(</span>OKCOLTYPE_NUMERIC<span style="color: #000000;">)</span>;
    col.<span style="color: #000000;">SetInternalData</span><span style="color: #000000;">(</span>FSI_SHORT<span style="color: #000000;">)</span>;
    col.<span style="color: #000000;">SetUpperBound</span><span style="color: #000000;">(</span>rows<span style="color: #000040;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;<span style="color: #008000;">// 最後の行のインデックス, 0 オフセット</span>
    
    <span style="color: #0000ff;">int</span>     nElementSize;
    uint    nNum;
    LPVOID  pData <span style="color: #000080;">=</span> col.<span style="color: #000000;">GetInternalDataBuffer</span><span style="color: #000000;">(</span><span style="color: #000040;">&amp;</span>nElementSize, <span style="color: #000040;">&amp;</span>nNum<span style="color: #000000;">)</span>;        
    <span style="color: #0000ff;">short</span><span style="color: #000040;">*</span> psBuff <span style="color: #000080;">=</span> <span style="color: #000000;">(</span><span style="color: #0000ff;">short</span><span style="color: #000040;">*</span><span style="color: #000000;">)</span>pData;
    
    <span style="color: #008000;">// OC のループは遅いですがDLLにポインタを渡すと</span>
    <span style="color: #008000;">// 操作が高速になる。ここではポインタの動作の表示のみ</span>
    <span style="color: #0000ff;">for</span><span style="color: #000000;">(</span><span style="color: #0000ff;">int</span> ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; ii <span style="color: #000080;">&lt;</span> rows; ii<span style="color: #000040;">++</span>, psBuff<span style="color: #000040;">++</span><span style="color: #000000;">)</span>
    <span style="color: #000000;">{</span>
        <span style="color: #000040;">*</span>psBuff <span style="color: #000080;">=</span> <span style="color: #000000;">(</span>ii<span style="color: #000040;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> <span style="color: #000040;">*</span> <span style="color: #000000;">(</span>col.<span style="color: #000000;">GetIndex</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000040;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
    <span style="color: #000000;">}</span>
    col.<span style="color: #000000;">ReleaseBuffer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>; <span style="color: #008000;">// この呼び出しを記録しない</span>
<span style="color: #000000;">}</span></pre>
<h2><a name="Access_Embedded_Graph_in_a_WorksheetWorksheet.2C_Embedded_Graph"></a><span class="mw-headline">ワークシートの埋め込みグラフにアクセスする<span class="OIndex" style="display:none">Worksheet, Embedded Graph</span></span></h2>
<p>新しいグラフと新しいワークシートを作成し、1つのワークシートセルにグラフを埋め込みます。
</p>
<pre class="oc" style="font-family:monospace;">GraphPage gp;
gp.<span style="color: #000000;">Create</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Origin&quot;</span><span style="color: #000000;">)</span>;

Worksheet wks;
wks.<span style="color: #000000;">Create</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;

<span style="color: #0000ff;">int</span> nOptions <span style="color: #000080;">=</span> EMBEDGRAPH_KEEP_ASPECT_RATIO <span style="color: #000040;">|</span> EMBEDGRAPH_HIDE_LEGENDS;

<span style="color: #008000;">// ワークシートセル(0, 0)にグラフを配置</span>
wks.<span style="color: #000000;">EmbedGraph</span><span style="color: #000000;">(</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, gp, nOptions<span style="color: #000000;">)</span>;</pre>
<p>ワークシート内に埋め込んだグラフに名前またはインデックスでアクセスします。 
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// アクティブワークシートから埋め込みグラフを取得</span>
Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;

GraphPage gp;
gp <span style="color: #000080;">=</span> wks.<span style="color: #000000;">EmbeddedPages</span><span style="color: #000000;">(</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>; <span style="color: #008000;">// 埋め込みグラフページをインデックスで取得</span>

gp <span style="color: #000080;">=</span> wks.<span style="color: #000000;">EmbeddedPages</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Graph1&quot;</span><span style="color: #000000;">)</span>; <span style="color: #008000;">// 埋め込みグラフページを名前で取得</span></pre>
<h2><a name="Sort_Worksheet_DataWorksheet.2C_Sorting_Data"></a><span class="mw-headline">ワークシートデータのソート<span class="OIndex" style="display:none">Worksheet, Sorting Data</span></span></h2>
<p><b>Sort</b> メソッドを使って列データをソートすることができます。  1つの列をソートし、<a href="../../OriginC/OriginC/Vectorbase-Sort.html" title="OriginC:Vectorbase-Sort">vectorbase::Sort</a> メソッドを使います。 
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// 列のソート</span>
<span style="color: #008000;">// 実行前に2列を持つアクティブワークシートにデータを入力</span>
<span style="color: #008000;">// 例えば、\Samples\Mathematics\Sine Curve.datをワークシートにインポート</span>
Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
Column colY<span style="color: #000000;">(</span>wks, <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>; <span style="color: #008000;">// Y 列</span>

<span style="color: #008000;">// ソートした後、 (x, y)の元の関係は崩れる</span>
vectorbase<span style="color: #000040;">&amp;</span> vec <span style="color: #000080;">=</span> colY.<span style="color: #000000;">GetDataObject</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
vec.<span style="color: #000000;">Sort</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;</pre>
<p>ワークシート内のすべての列をソートするには、<a href="../../OriginC/OriginC/Worksheet-Sort.html" title="OriginC:Worksheet-Sort">Worksheet::Sort</a> メソッドを使います。 
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// ワークシートのソート</span>
<span style="color: #008000;">// 実行前に2列を持つアクティブワークシートにデータを入力</span>
<span style="color: #008000;">// 例えば、\Samples\Mathematics\Sine Curve.datをワークシートにインポート</span>
Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
 
<span style="color: #0000ff;">int</span> nCol <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; <span style="color: #008000;">// 2番目の列にすべてのワークシートデータを昇順ソート</span>
<span style="color: #0000ff;">BOOL</span> bIsAscending <span style="color: #000080;">=</span> <span style="color: #0000ff;">true</span>;
<span style="color: #0000ff;">BOOL</span> bMissingValuesSmall <span style="color: #000080;">=</span> <span style="color: #0000ff;">TRUE</span>; <span style="color: #008000;">// 欠損値を最小値として取り扱う</span>
<span style="color: #0000ff;">int</span> r1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>, c1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>, r2 <span style="color: #000080;">=</span> <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>, c2 <span style="color: #000080;">=</span> <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">// -1はr2とc2の最後</span>
 
<span style="color: #008000;">// ソート後、各(x, y)は元の関係を維持</span>
wks.<span style="color: #000000;">Sort</span><span style="color: #000000;">(</span>nCol, bIsAscending, bMissingValuesSmall, r1, c1, r2, c2<span style="color: #000000;">)</span>;</pre>
<h2><a name="Mask_Worksheet_DataWorksheet.2C_Masking_DataWorksheet.2C_Find_Data"></a><span class="mw-headline">ワークシートデータをマスクする<span class="OIndex" style="display:none">Worksheet, Masking Data</span><span class="OIndex" style="display:none">Worksheet, Find Data</span></span></h2>
<p>次のコードは、指定した列に対して、0と等しいか、それより小さいデータ行にマスクをセットする方法を示します。
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">int</span> nCol <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
Column col<span style="color: #000000;">(</span>wks, nCol<span style="color: #000000;">)</span>;
vector vData <span style="color: #000080;">=</span> col.<span style="color: #000000;">GetDataObject</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;

<span style="color: #008000;">// 0と等しいか、それより小さいすべてのデータを見つけて、インデックスを返す</span>
vector<span style="color: #000080;">&lt;</span>uint<span style="color: #000080;">&gt;</span> vnRowIndex;
vData.<span style="color: #000000;">Find</span><span style="color: #000000;">(</span>MATREPL_TEST_LESSTHAN <span style="color: #000040;">|</span> MATREPL_TEST_EQUAL, <span style="color: #0000dd;">0</span>, vnRowIndex<span style="color: #000000;">)</span>;

<span style="color: #008000;">// 行と列のインデックスで追加される複数の部分範囲を含む範囲を構築</span>
DataRange dr;
<span style="color: #0000ff;">for</span><span style="color: #000000;">(</span><span style="color: #0000ff;">int</span> nn <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; nn <span style="color: #000080;">&lt;</span> vnRowIndex.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>; nn<span style="color: #000040;">++</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	<span style="color: #0000ff;">int</span> r1, c1, r2, c2;
	r1 <span style="color: #000080;">=</span> r2 <span style="color: #000080;">=</span> vnRowIndex<span style="color: #000000;">[</span>nn<span style="color: #000000;">]</span>;
	c1 <span style="color: #000080;">=</span> c2 <span style="color: #000080;">=</span> nCol;
	dr.<span style="color: #000000;">Add</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;X&quot;</span>, wks, r1, c1, r2, c2<span style="color: #000000;">)</span>; 		
<span style="color: #000000;">}</span>

<span style="color: #008000;">// データ範囲にマスクをセット</span>
dr.<span style="color: #000000;">SetMask</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;</pre>
<h2><a name="Set_Size"></a><span class="mw-headline">サイズをセット</span></h2>
<p><a href="../../OriginC/OriginC/Worksheet-SetSize.html" title="OriginC:ワークシートの並べ替え">Worksheet::SetSize</a> メソッドを使用して、ワークシートの行と列の数をセットできます。
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// 行と列の数をセット。データは保持</span>
<span style="color: #008000;">// 一度に多くの列が行を追加したい場合SetSizeを使用した方が良い</span>
<span style="color: #0000ff;">int</span> nNumRows <span style="color: #000080;">=</span> <span style="color: #0000dd;">100</span>;
<span style="color: #0000ff;">int</span> nNumCols <span style="color: #000080;">=</span> <span style="color: #0000dd;">20</span>;
wks.<span style="color: #000000;">SetSize</span><span style="color: #000000;">(</span>nNumRows, nNumCols<span style="color: #000000;">)</span>; 
<span style="color: #008000;">// 行の数を変更して列の数は変更しない場合
</span>
<span style="color: #008000;">// 代わりに -1 を使用。例えば、</span>
wks.<span style="color: #000000;">SetSize</span><span style="color: #000000;">(</span>nNumRows, <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>; 
<span style="color: #008000;">// 列の数は変更して行は変更しない場合も同様</span></pre>
<h2><a name="Reduce_Worksheet_Data"></a><span class="mw-headline">ワークシートデータを削減する</span></h2>
<p>ワークシート内のXYデータの削減のために、Origin Cいくつかの関数を提供してます。 例えば、X増分によるXYデータの削減には<a href="../../OriginC/OriginC/Ocmath_reducexy_fixing_increbin_(global_function).html" title="OriginC:Ocmath reducexy fixing increbin (global function)">ocmath_reducexy_fixing_increbin</a>、グループの数によるXYデータの削減には<a href="../../OriginC/OriginC/Ocmath_reducexy_n_groups_(global_function).html" title="OriginC:Ocmath reducexy n groups (global function)">ocmath_reducexy_n_groups</a>、NポイントごとにXYデータを削減するには<a href="../../OriginC/OriginC/Ocmath_reducexy_n_points_(global_function).html" title="OriginC:Ocmath reducexy n points (global function)">ocmath_reducexy_n_points</a>を使用します。ここでは、NポイントごとにXYデータを削減する方法を、以下のサンプルで示します。
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// アクティブワークシートを取得</span>
<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span><span style="color: #000040;">!</span>wks<span style="color: #000000;">)</span> 
<span style="color: #000000;">{</span>
	<span style="color: #0000ff;">return</span>;
<span style="color: #000000;">}</span>
Column colX<span style="color: #000000;">(</span>wks, <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// ワークシートの1列目</span>
Column colY<span style="color: #000000;">(</span>wks, <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// ワークシートの2列目</span>
<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span>colX <span style="color: #000040;">&amp;&amp;</span> colY<span style="color: #000000;">)</span> 
<span style="color: #000000;">{</span> 
	vectorbase <span style="color: #000040;">&amp;</span>vbInterY <span style="color: #000080;">=</span> colY.<span style="color: #000000;">GetDataObject</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// Y列データを取得</span>
	vector vY <span style="color: #000080;">=</span> vbInterY;
	vector vReduced<span style="color: #000000;">(</span>vY.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
	<span style="color: #0000ff;">int</span> nPoints <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;
	<span style="color: #008000;">// 3ポイントごとに削減。結果は各3ポイントの平均とする</span>
	<span style="color: #0000ff;">int</span> nNewSize <span style="color: #000080;">=</span> ocmath_reducexy_n_points<span style="color: #000000;">(</span>vY, vReduced, vY.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>, 
		nPoints, REDUCE_XY_STATS_MEAN<span style="color: #000000;">)</span>;
	<span style="color: #0000ff;">int</span> iReduced <span style="color: #000080;">=</span> wks.<span style="color: #000000;">AddCol</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Reduced&quot;</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// 結果のために新しい列を追加</span>
	Column colReduced<span style="color: #000000;">(</span>wks, iReduced<span style="color: #000000;">)</span>;
	vectorbase <span style="color: #000040;">&amp;</span>vbReduced <span style="color: #000080;">=</span> colReduced.<span style="color: #000000;">GetDataObject</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
	vbReduced <span style="color: #000080;">=</span> vReduced;
<span style="color: #000000;">}</span></pre>
<h2><a name="Extract_Data_from_Worksheet_with_LT_ConditionWorksheet.2C_Extract_Data"></a><span class="mw-headline">LT条件でワークシートからデータを抽出<span class="OIndex" style="display:none">Worksheet, Extract Data</span></span></h2>
<p><a href="../../OriginC/OriginC/Worksheet-SelectRows.html" title="OriginC:Worksheet-SelectRows">Worksheet::SelectRows </a>メソッドを使ってワークシートデータを選択します。  行は、複数の列をまたがって選択できます。
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// 条件を元にしたワークシートからデータを選択</span>
<span style="color: #008000;">// &apos;uint&apos;型のvectorに選択した行のインデックスを配置</span>
Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;

<span style="color: #008000;">// 条件式に基づくワークシートデータをチェックし</span>
<span style="color: #008000;">// 行インデックスを&apos;vnRowIndices&apos;に出力</span>

<span style="color: #008000;">// LabTalkの範囲オブジェクト &apos;a&apos; = column 1, &apos;b&apos; = column 2を定義        </span>
string strLTRunBeforeloop <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;range a=1; range b=2&quot;</span>; 
string strCondition <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;abs(a) &gt;= 1 &amp;&amp; abs(b) &gt;= 1&quot;</span>;	    
vector<span style="color: #000080;">&lt;</span>uint<span style="color: #000080;">&gt;</span> vnRowIndices; <span style="color: #008000;">// 出力</span>
<span style="color: #0000ff;">int</span> r1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>, r2 <span style="color: #000080;">=</span> <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">// 行範囲, -1はr2の最後の行</span>
 
<span style="color: #008000;">// 任意の最大行数, -1は制限なし</span>
<span style="color: #0000ff;">int</span> nMax <span style="color: #000080;">=</span> <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>;

<span style="color: #0000ff;">int</span> num <span style="color: #000080;">=</span> wks.<span style="color: #000000;">SelectRows</span><span style="color: #000000;">(</span>strCondition, vnRowIndices, r1, r2, nMax, 
		strLTRunBeforeloop<span style="color: #000000;">)</span>;</pre>
<p>選択をハイライトする2つの方法があります。  最初の方法は選択したインデックスをハイライトする方法です。
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// 方法1：vnRowIndicesで行をハイライト</span>
Grid gg;
<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> gg.<span style="color: #000000;">Attach</span><span style="color: #000000;">(</span>wks<span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	<span style="color: #008000;">// uint型 の vectorデータを int型のvectorに変換  </span>
    vector<span style="color: #000080;">&lt;</span><span style="color: #0000ff;">int</span><span style="color: #000080;">&gt;</span> vnRows;
    vnRows <span style="color: #000080;">=</span> vnRowIndices;	        
    
    gg.<span style="color: #000000;">SetSelection</span><span style="color: #000000;">(</span>vnRows<span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span></pre>
<p>データ選択をハイライトする2つ目の方法は、選択した行の塗り色を指定する方法です。 
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// 方法2： vnRowIndicesで選択した行の色を塗りつぶす
</span>
DataRange dr;

<span style="color: #008000;">// vnRowIndicesで行インデックスでデータ範囲を構築</span>
<span style="color: #0000ff;">for</span><span style="color: #000000;">(</span><span style="color: #0000ff;">int</span> index<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>; index<span style="color: #000080;">&lt;</span>vnRowIndices.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>; index<span style="color: #000040;">++</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	<span style="color: #008000;">// すべての列に対して 0(最初の列) および -1(最後の列)</span>
	<span style="color: #008000;">// 範囲名の変数に対して&quot;&quot;であればデフォルト名を使用</span>
	dr.<span style="color: #000000;">Add</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;&quot;</span>, wks, vnRowIndices<span style="color: #000000;">[</span>index<span style="color: #000000;">]</span>, <span style="color: #0000dd;">0</span>, vnRowIndices<span style="color: #000000;">[</span>index<span style="color: #000000;">]</span>, <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span>

Tree tr;
tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">CommonStyle</span>.<span style="color: #000000;">Fill</span>.<span style="color: #000000;">FillColor</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> SYSCOLOR_BLUE; <span style="color: #008000;">// 塗りつぶし色 = 青</span>
tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">CommonStyle</span>.<span style="color: #000000;">Color</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> SYSCOLOR_WHITE; <span style="color: #008000;">// フォントの色 = 白</span>

<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> <span style="color: #0000dd;">0</span> <span style="color: #000080;">==</span> dr.<span style="color: #000000;">UpdateThemeIDs</span><span style="color: #000000;">(</span>tr.<span style="color: #000000;">Root</span><span style="color: #000000;">)</span> <span style="color: #000000;">)</span> <span style="color: #008000;">// エラーなしで0を返す</span>
<span style="color: #000000;">{</span>
	<span style="color: #0000ff;">bool</span> bRet <span style="color: #000080;">=</span> dr.<span style="color: #000000;">ApplyFormat</span><span style="color: #000000;">(</span>tr, <span style="color: #0000ff;">true</span>, <span style="color: #0000ff;">true</span><span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span></pre>
<h2><a name="Compare_Data_in_Two_WorksheetsWorksheet.2C_Compare_Data"></a><span class="mw-headline">2つのワークシート内のデータを比較する<span class="OIndex" style="display:none">Worksheet, Compare Data</span></span></h2>
<p>2つのワークシートの行数または列数を比較したり、データ自体を比較するのに役立ちます。  <a href="../../OriginC/OriginC/Datasheet-GetNumRows.html" title="OriginC:Datasheet-GetNumRows">Datasheet::GetNumRows</a>および <a href="../../OriginC/OriginC/Datasheet-GetNumCols.html" title="OriginC:Datasheet-GetNumCols">Datasheet::GetNumCols</a>メソッドを使って、ワークシートから行や列をカウントします。 
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> wks1.<span style="color: #000000;">GetNumRows</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span> <span style="color: #000040;">!</span><span style="color: #000080;">=</span> wks2.<span style="color: #000000;">GetNumRows</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span> 
	<span style="color: #000040;">||</span> wks1.<span style="color: #000000;">GetNumCols</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span> <span style="color: #000040;">!</span><span style="color: #000080;">=</span> wks2.<span style="color: #000000;">GetNumCols</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	out_str<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;The two worksheets are not the same size&quot;</span><span style="color: #000000;">)</span>;
	<span style="color: #0000ff;">return</span>;
<span style="color: #000000;">}</span></pre>
<p>似たような操作を実行する別の方法は、それぞれのワークシートのデータをvectorにコピーし、それぞれのvectorデータを比較します。 
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// ワークシート1の列から1つずつすべてのデータを取得</span>
vector vec1;
foreach<span style="color: #000000;">(</span>Column col in wks1.<span style="color: #000000;">Columns</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	vector<span style="color: #000040;">&amp;</span> vecCol <span style="color: #000080;">=</span> col.<span style="color: #000000;">GetDataObject</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
	vec1.<span style="color: #000000;">Append</span><span style="color: #000000;">(</span>vecCol<span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span>

<span style="color: #008000;">// ワークシート2の列から1つずつすべてのデータを取得</span>
vector vec2;
foreach<span style="color: #000000;">(</span>col in wks2.<span style="color: #000000;">Columns</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	vector<span style="color: #000040;">&amp;</span> vecCol <span style="color: #000080;">=</span> col.<span style="color: #000000;">GetDataObject</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
	vec2.<span style="color: #000000;">Append</span><span style="color: #000000;">(</span>vecCol<span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span>	

<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> vec1.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span> <span style="color: #000040;">!</span><span style="color: #000080;">=</span> vec2.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span> <span style="color: #000000;">)</span> 
<span style="color: #000000;">{</span>
	out_str<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;The size of the two data sets is not equal&quot;</span><span style="color: #000000;">)</span>;
	<span style="color: #0000ff;">return</span>;
<span style="color: #000000;">}</span></pre>
<p>データ要素自体を比較するには、上記サンプルでvectorに対して、<a href="../../OriginC/OriginC/Ocmath_compare_data_(global_function).html" title="OriginC:Ocmath compare data (global function)">ocmath_compare_data</a> 関数を使います。
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">bool</span> bIsSame <span style="color: #000080;">=</span> <span style="color: #0000ff;">false</span>;
<span style="color: #0000ff;">double</span> dTolerance <span style="color: #000080;">=</span> 1e<span style="color: #000040;">-</span>10;
ocmath_compare_data<span style="color: #000000;">(</span>vec1.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>, vec1, vec2, <span style="color: #000040;">&amp;</span>bIsSame, dTolerance<span style="color: #000000;">)</span>;
<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> bIsSame <span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	out_str<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Data in the two worksheets are the same&quot;</span><span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span></pre>







    