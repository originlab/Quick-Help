<h1 class="firstheading">メタデータにアクセスする</h1><p><br />
メタデータは、他のデータを参照する情報です。サンプルには、データが元々収集された時刻、データを収集した機器を操作した人、調べた標本の温度が含まれます。メタデータはプロジェクト、ページ、レイヤ、列に保存することができます。
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Access_DataRangeProject.2C_Add_Range_VariableProject.2C_List_All_Range_Variables"><span class="tocnumber">1</span> <span class="toctext">データ範囲にアクセスする<span class="OIndex" style="display:none">Project, Add Range Variable</span><span class="OIndex" style="display:none">Project, List All Range Variables</span></span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Access_Tree"><span class="tocnumber">2</span> <span class="toctext">ツリーにアクセス</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Access_a_Tree_in_a_ProjectProject.2C_Add_Tree_Variable"><span class="tocnumber">2.1</span> <span class="toctext">プロジェクト内のツリーにアクセスする<span class="OIndex" style="display:none">Project, Add Tree Variable</span></span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Add_Tree"><span class="tocnumber">2.1.1</span> <span class="toctext">ツリーの追加</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#Get_Tree"><span class="tocnumber">2.1.2</span> <span class="toctext">ツリーの取得</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#Get_the_Names_of_All_LabTalk_Trees"><span class="tocnumber">2.1.3</span> <span class="toctext">すべてのLabTalkツリーの名前を取得 </span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-7"><a href="#Access_Tree_in_a_Worksheet"><span class="tocnumber">2.2</span> <span class="toctext">ワークシート内のツリーにアクセスする </span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="#Add_Tree_2"><span class="tocnumber">2.2.1</span> <span class="toctext">ツリーの追加</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#Get_Tree_2"><span class="tocnumber">2.2.2</span> <span class="toctext">ツリーの取得</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="#Get_the_Names_of_All_Trees"><span class="tocnumber">2.2.3</span> <span class="toctext">すべてのツリーの名前を取得 </span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-11"><a href="#Access_Tree_in_a_Worksheet_Column"><span class="tocnumber">2.3</span> <span class="toctext">ワークシート列内のツリーにアクセスする</span></a>
<ul>
<li class="toclevel-3 tocsection-12"><a href="#Add_Tree_3"><span class="tocnumber">2.3.1</span> <span class="toctext">ツリーの追加</span></a></li>
<li class="toclevel-3 tocsection-13"><a href="#Get_Tree_3"><span class="tocnumber">2.3.2</span> <span class="toctext">ツリーの取得</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#Get_the_Names_of_All_Trees_2"><span class="tocnumber">2.3.3</span> <span class="toctext">すべてのツリーの名前を取得 </span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-15"><a href="#Access_Import_File_Tree_NodesImport_File.2C_Get_Storage_Tree_by_Name"><span class="tocnumber">2.4</span> <span class="toctext">ファイルインポートのツリーノードにアクセスする <span class="OIndex" style="display:none">Import File, Get Storage Tree by Name</span></span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Access_Report_Sheet_TreeReport_Sheet.2C_Get_Result_Tree"><span class="tocnumber">2.5</span> <span class="toctext">レポートシートツリーにアクセスする <span class="OIndex" style="display:none">Report Sheet, Get Result Tree</span></span></a></li>
</ul>
</li>
</ul>
</div>

<h2><a name="Access_DataRangeProject.2C_Add_Range_VariableProject.2C_List_All_Range_Variables"></a><span class="mw-headline">データ範囲にアクセスする<span class="OIndex" style="display:none">Project, Add Range Variable</span><span class="OIndex" style="display:none">Project, List All Range Variables</span></span></h2>
<p>Origin CのProjectクラスは、Origin CのDataRangeオブジェクトを現在のプロジェクトに追加、取得、削除するメソッドを提供しています。 
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;

DataRange dr;                   <span style="color: #008000;">// 範囲オブジェクトを構成</span>
dr.<span style="color: #000000;">Add</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;X&quot;</span>, wks, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>, <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>; <span style="color: #008000;">// ワークシート全体を範囲に追加</span>
dr.<span style="color: #000000;">SetName</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Range1&quot;</span><span style="color: #000000;">)</span>;           <span style="color: #008000;">// 範囲名をセット</span>
<span style="color: #0000ff;">int</span> UID <span style="color: #000080;">=</span> dr.<span style="color: #000000;">GetUID</span><span style="color: #000000;">(</span><span style="color: #0000ff;">TRUE</span><span style="color: #000000;">)</span>;      <span style="color: #008000;">//範囲オブジェクトの固有IDを取得</span>

<span style="color: #0000ff;">int</span> nn <span style="color: #000080;">=</span> Project.<span style="color: #000000;">AddDataRange</span><span style="color: #000000;">(</span>dr<span style="color: #000000;">)</span>; <span style="color: #008000;">// 範囲をプロジェクトに追加</span></pre>
<p>コマンドウィンドウまたはスクリプトウィンドウで、LabTalkコマンド<b> list r</b> を使って、現在のプロジェクトのすべてのDataRangeオブジェクトを一覧表示します。
</p>
<h2><a name="Access_Tree"></a><span class="mw-headline">ツリーにアクセス</span></h2>
<h3><a name="Access_a_Tree_in_a_ProjectProject.2C_Add_Tree_Variable"></a><span class="mw-headline">プロジェクト内のツリーにアクセスする<span class="OIndex" style="display:none">Project, Add Tree Variable</span></span></h3>
<h4><a name="Add_Tree"></a><span class="mw-headline">ツリーの追加</span></h4>
<p>このコードは、ツリー型の変数を宣言し、いくつかのデータをツリーのノードに割り当て、ツリーを現在のプロジェクトにツリーを追加します。
</p>
<pre class="oc" style="font-family:monospace;">Tree tr;
tr.<span style="color: #000000;">FileInfo</span>.<span style="color: #000000;">name</span>.<span style="color: #000000;">strVal</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Test.XML&quot;</span>;
tr.<span style="color: #000000;">FileInfo</span>.<span style="color: #000000;">size</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">255</span>;

<span style="color: #008000;">//ツリー変数をプロジェクトに追加</span>
<span style="color: #0000ff;">int</span> nNumTrees <span style="color: #000080;">=</span> Project.<span style="color: #000000;">AddTree</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Test&quot;</span>, tr<span style="color: #000000;">)</span>; 
out_int<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;The number of trees in project: &quot;</span>, nNumTrees<span style="color: #000000;">)</span>;</pre>
<p><br />
</p>
<h4><a name="Get_Tree"></a><span class="mw-headline">ツリーを取得</span></h4>
<p>同様に、似たようなコードは、<i>Test</i> という既存のツリー変数に保存され、<i>trTest</i> という新しいツリー変数に配置します。
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// 名前でプロジェクトからツリーを取得</span>
Tree trTest;
<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> Project.<span style="color: #000000;">GetTree</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Test&quot;</span>, trTest<span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
	out_tree<span style="color: #000000;">(</span>trTest<span style="color: #000000;">)</span>;</pre>
<h4><a name="Get_the_Names_of_All_LabTalk_Trees"></a><span class="mw-headline">すべてのLabTalkツリーの名前を取得 </span></h4>
<p><b><a href="../../OriginC/OriginC/Project-GetTreeNames.html" title="OriginC:Project-GetTreeNames">Project::GetTreeNames</a></b>メソッドは、プロジェクト内のすべてのLabTalkツリー変数の名前を取得します。  ここで、名前はstring vectorに割り当てられ、割り当てられる文字列の数は、int型で返されます。 
</p>
<pre class="oc" style="font-family:monospace;">vector<span style="color: #000080;">&lt;</span>string<span style="color: #000080;">&gt;</span> vsTreeNames;
<span style="color: #0000ff;">int</span> nNumTrees <span style="color: #000080;">=</span> Project.<span style="color: #000000;">GetTreeNames</span><span style="color: #000000;">(</span>vsTreeNames<span style="color: #000000;">)</span>;</pre>
<h3><a name="Access_Tree_in_a_Worksheet"></a><span class="mw-headline">ワークシート内のツリーにアクセスする </span></h3>
<p><b><a href="../../OriginC/OriginC/OriginObject-PutBinaryStorage.html" title="OriginC:OriginObject-PutBinaryStorage">OriginObject::PutBinaryStorage </a></b>がOriginオブジェクト、例えば、WorksheetPage, Worksheet, Column, GraphPage, MatrixPage などの多くの型にツリーを配置するのに使われます。 
</p>
<h4><a name="Add_Tree_2"></a><span class="mw-headline">ツリーの追加</span></h4>
<p>現在のプロジェクトにワークシートウィンドウを保持し、下記のサンプルコードを実行します。ユーザツリーを追加するコードを実行した後、ワークシートウィンドウのタイトルを右クリックし、オーガナイザの表示を選び、右側のパネルに追加したユーザツリーが表示されます。 
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> wks <span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	Tree tr;
	tr.<span style="color: #000000;">name</span>.<span style="color: #000000;">strVal</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Jacky&quot;</span>;
	tr.<span style="color: #000000;">id</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">7856</span>;
	
	<span style="color: #008000;">// wksTreeというツリーをワークシートオブジェクトに配置</span>
	string strStorageName <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;wksTree&quot;</span>;
	wks.<span style="color: #000000;">PutBinaryStorage</span><span style="color: #000000;">(</span>strStorageName, tr<span style="color: #000000;">)</span>;	
<span style="color: #000000;">}</span></pre>
<h4><a name="Get_Tree_2"></a><span class="mw-headline">ツリーを取得</span></h4>
<p><b><a href="../../OriginC/OriginC/OriginObject-GetBinaryStorage.html" title="OriginC:OriginObject-GetBinaryStorage">OriginObject::GetBinaryStorage</a></b> メソッドは、名前でOriginオブジェクトからツリーを取得するのに使われます。 
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> wks <span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>	
	Tree tr;
	string strStorageName <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;wksTree&quot;</span>;
	
	<span style="color: #008000;">// wksTreeというツリーが存在していればTrueを返す
</span>
	<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> wks.<span style="color: #000000;">GetBinaryStorage</span><span style="color: #000000;">(</span>strStorageName, tr<span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
		out_tree<span style="color: #000000;">(</span>tr<span style="color: #000000;">)</span>; <span style="color: #008000;">// ツリーを出力 </span>
<span style="color: #000000;">}</span></pre>
<h4><a name="Get_the_Names_of_All_Trees"></a><span class="mw-headline">すべてのツリーの名前を取得</span></h4>
<p><b><a href="../../OriginC/OriginC/OriginObject-GetStorageNames.html" title="OriginC:OriginObject-GetStorageNames">OriginObject::GetStorageNames</a></b> メソッドはOriginオブジェクト内に保存されるすべての名前を取得します。INI とバイナリの2つのストレージタイプがあります。ツリーはバイナリストレージに属し、以下のサンプルコードはワークシートからバイナリストレージを取得する方法を示します。 
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> wks <span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	<span style="color: #008000;">// すべてのバイナリタイプのストレージの名前を取得 </span>
	vector<span style="color: #000080;">&lt;</span>string<span style="color: #000080;">&gt;</span> vsNames;
	wks.<span style="color: #000000;">GetStorageNames</span><span style="color: #000000;">(</span>vsNames, STORAGE_TYPE_BINARY<span style="color: #000000;">)</span>; 
	
	<span style="color: #0000ff;">for</span><span style="color: #000000;">(</span><span style="color: #0000ff;">int</span> nn <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; nn <span style="color: #000080;">&lt;</span> vsNames.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>; nn<span style="color: #000040;">++</span><span style="color: #000000;">)</span>
		out_str<span style="color: #000000;">(</span>vsNames<span style="color: #000000;">[</span>nn<span style="color: #000000;">]</span><span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span></pre>
<h3><a name="Access_Tree_in_a_Worksheet_Column"></a><span class="mw-headline">ワークシート列内のツリーにアクセスする</span></h3>
<p>ワークシート列でツリーをセットおよび取得するには、上記で説明したようにワークシートでツリーをセットおよび取得するのと同じ方法を使います。 
</p>
<h4><a name="Add_Tree_3"></a><span class="mw-headline">ツリーの追加</span></h4>
<p><span class="OIndex" style="display:none">Column, Add Tree Variable</span>
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
Column col<span style="color: #000000;">(</span>wks, <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>;

Tree tr;
tr.<span style="color: #000000;">test</span>.<span style="color: #000000;">strVal</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;This is a column&quot;</span>;
tr.<span style="color: #000000;">value</span>.<span style="color: #000000;">dVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0.15</span>;

col.<span style="color: #000000;">PutBinaryStorage</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;colTree&quot;</span>, tr<span style="color: #000000;">)</span>;</pre>
<h4><a name="Get_Tree_3"></a><span class="mw-headline">ツリーを取得</span></h4>
<p><span class="OIndex" style="display:none">Column, Get Tree Variable</span>
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
Column col<span style="color: #000000;">(</span>wks, <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>;

Tree tr;	
<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> col.<span style="color: #000000;">GetBinaryStorage</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;colTree&quot;</span>, tr<span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
	out_tree<span style="color: #000000;">(</span>tr<span style="color: #000000;">)</span>;</pre>
<h4><a name="Get_the_Names_of_All_Trees_2"></a><span class="mw-headline">すべてのツリーの名前を取得</span></h4>
<p><span class="OIndex" style="display:none">Column, Get the Names of All Storages</span>
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
Column col<span style="color: #000000;">(</span>wks, <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>;

<span style="color: #008000;">// すべてのバイナリタイプのストレージの名前を取得 </span>
vector<span style="color: #000080;">&lt;</span>string<span style="color: #000080;">&gt;</span> vsNames;
col.<span style="color: #000000;">GetStorageNames</span><span style="color: #000000;">(</span>vsNames, STORAGE_TYPE_BINARY<span style="color: #000000;">)</span>; 

<span style="color: #0000ff;">for</span><span style="color: #000000;">(</span><span style="color: #0000ff;">int</span> nn <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; nn <span style="color: #000080;">&lt;</span> vsNames.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>; nn<span style="color: #000040;">++</span><span style="color: #000000;">)</span>
	out_str<span style="color: #000000;">(</span>vsNames<span style="color: #000000;">[</span>nn<span style="color: #000000;">]</span><span style="color: #000000;">)</span>;</pre>
<h3><a name="Access_Import_File_Tree_NodesImport_File.2C_Get_Storage_Tree_by_Name"></a><span class="mw-headline">ファイルインポートのツリーノードにアクセスする <span class="OIndex" style="display:none">Import File, Get Storage Tree by Name</span></span></h3>
<p>ワークシートにデータをインポートしたあと、Originはページレベルで特別なツリーのような構造のメタデータを保存します。ファイルについての基本情報は、ツリーから直接取り出したり、配置することができます。
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
WorksheetPage wksPage <span style="color: #000080;">=</span> wks.<span style="color: #000000;">GetPage</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;

storage st;
st <span style="color: #000080;">=</span> wksPage.<span style="color: #000000;">GetStorage</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;system&quot;</span><span style="color: #000000;">)</span>;   

Tree    tr;
tr <span style="color: #000080;">=</span> st;

<span style="color: #0000ff;">double</span> dDate <span style="color: #000080;">=</span> tr.<span style="color: #000000;">Import</span>.<span style="color: #000000;">FileDate</span>.<span style="color: #000000;">dVal</span>;    
<span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;File Date:&nbsp;%s<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span>, get_date_str<span style="color: #000000;">(</span>dDate, LDF_SHORT_AND_HHMMSS_SEPARCOLON<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
<span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;File Name:&nbsp;%s<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span>, tr.<span style="color: #000000;">Import</span>.<span style="color: #000000;">FileName</span>.<span style="color: #000000;">strVal</span><span style="color: #000000;">)</span>;
<span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;File Path:&nbsp;%s<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span>, tr.<span style="color: #000000;">Import</span>.<span style="color: #000000;">FilePath</span>.<span style="color: #000000;">strVal</span><span style="color: #000000;">)</span>;</pre>
<h3><a name="Access_Report_Sheet_TreeReport_Sheet.2C_Get_Result_Tree"></a><span class="mw-headline">レポートシートツリーにアクセスする <span class="OIndex" style="display:none">Report Sheet, Get Result Tree</span></span></h3>
<p>分析レポートシートは、ツリー構造に基づく特別な形式のワークシートです。次のように、レポートシートからレポートツリーを取得できます。 
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;

Tree trReport;
uint uid; <span style="color: #008000;">// レポート範囲のUIDを受け取る</span>
<span style="color: #008000;">// エスケープ操作文字列を変換する(ex.?$OP:A=1) </span>
<span style="color: #008000;">// 戻りのツリーに実際のデータセット名</span>
<span style="color: #0000ff;">bool</span> bTranslate <span style="color: #000080;">=</span> <span style="color: #0000ff;">true</span>; 
<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> wks.<span style="color: #000000;">GetReportTree</span><span style="color: #000000;">(</span>trReport, <span style="color: #000040;">&amp;</span>uid, <span style="color: #0000dd;">0</span>, GRT_TYPE_RESULTS, <span style="color: #0000ff;">true</span><span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	out_tree<span style="color: #000000;">(</span>trReport<span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span></pre>







    