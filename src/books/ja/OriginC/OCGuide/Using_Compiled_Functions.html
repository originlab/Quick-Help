<h1 class="firstheading">コンパイルした関数を使用する</h1><p><br />
Origin C関数をコンパイル、リンク、ロードしたら、Originで使用する準備ができています。  これは名前で関数を呼び出し、LabTalkスクリプトコマンドを受け付けるOriginのどの場所からでも必要な引数を提供できるということです。  スクリプトウィンドウ、コマンドウィンドウ、Origin GUI内のカスタムボタンなどから関数を呼び出せます。  <a class="external text" href="../../LabTalk/Category/LT_Running_Scripts.html">LabTalkスクリプトガイドのスクリプトの実行</a>の章では、Origin C関数を使用することができるOrigin内のすべての場所についての詳細があります。
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Accessing_Origin_C_Functions_from_LabTalk_ScriptFunctions.2C_Calling_Origin_C_Function_from_Script"><span class="tocnumber">1</span> <span class="toctext">LabTalkスクリプトからOrigin C関数にアクセスする<span class="OIndex" style="display:none">Functions, Calling Origin C Function from Script</span></span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Origin_C_Access_from_LabTalkFunctions.2C_Control_LabTalk_Access"><span class="tocnumber">1.1</span> <span class="toctext">LabTalkからOrigin C関数にアクセスする<span class="OIndex" style="display:none">Functions, Control LabTalk Access</span></span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Listing_Functions_that_can_be_Called_from_LabTalkFunctions.2C_List_All_LabTalk_Callable_Origin_C_Functions"><span class="tocnumber">1.2</span> <span class="toctext">LabTalkから呼び出せる関数を一覧表示する<span class="OIndex" style="display:none">Functions, List All LabTalk Callable Origin C Functions</span></span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Passing_Arguments_to_Functions"><span class="tocnumber">1.3</span> <span class="toctext">関数に引数を渡す</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="#Passing_by_Value"><span class="tocnumber">1.3.1</span> <span class="toctext">値を渡す</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#Passing_by_Reference"><span class="tocnumber">1.3.2</span> <span class="toctext">参照を渡す</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-7"><a href="#Precedence_Rules_for_Functions_with_the_Same_NameFunctions.2C_Precedence_Rules_for_the_Same_Name_Functions"><span class="tocnumber">1.4</span> <span class="toctext">同じ名前を持つ関数の優先規則<span class="OIndex" style="display:none">Functions, Precedence Rules for the Same Name Functions</span></span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#Defining_Functions_for_the_Set_Values_DialogFunctions.2C_Adding_for_Set_Values_Dialog_F.28x.29_menu"><span class="tocnumber">2</span> <span class="toctext">値の設定ダイアログの関数を定義する<span class="OIndex" style="display:none">Functions, Adding for Set Values Dialog F(x) menu</span></span></a></li>
</ul>
</div>

<h2><a name="Accessing_Origin_C_Functions_from_LabTalk_ScriptFunctions.2C_Calling_Origin_C_Function_from_Script"></a><span class="mw-headline">LabTalkスクリプトからOrigin C関数にアクセスする<span class="OIndex" style="display:none">Functions, Calling Origin C Function from Script</span></span></h2>
<p>Origin C関数は、他のOrigin CやLabTalkスクリプトから呼び出すことができます。   このセクションでは、Origin C関数をLabTalkからアクセスする方法について説明しています。
</p><p>Origin CコードからLabTalkにアクセスすることについての情報は、<a href="../../OriginC/Category/Accessing_LabTalk(OC_Guide).html" title="Category:LabTalkにアクセスする(OC Guide)">LabTalkにアクセスする</a>の章を参照してください。
</p>
<h3><a name="Origin_C_Access_from_LabTalkFunctions.2C_Control_LabTalk_Access"></a><span class="mw-headline">LabTalkからOrigin C関数にアクセスする<span class="OIndex" style="display:none">Functions, Control LabTalk Access</span></span></h3>
<p>関数定義の前にOrigin Cコードにpragmaステートメントを配置して、Origin CコードにアクセスするLabTalkを制御できます。
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">#pragma</span> labtalk<span style="color: #000000;">(</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> <span style="color: #008000;">// LabTalkでOC 関数を無効に </span>
<span style="color: #0000ff;">void</span> foo0<span style="color: #000000;">(</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
<span style="color: #000000;">}</span>

<span style="color: #0000ff;">#pragma</span> labtalk<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> <span style="color: #008000;">// LabTalkでOC関数を有効に（デフォルト）</span>
<span style="color: #0000ff;">void</span> foo1<span style="color: #000000;">(</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
<span style="color: #000000;">}</span>

<span style="color: #0000ff;">#pragma</span> labtalk<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span><span style="color: #000000;">)</span> <span style="color: #008000;">// LabTalkコマンド &apos;&apos;&apos;run -oc&apos;&apos;&apos; が必要</span>
<span style="color: #0000ff;">void</span> foo2<span style="color: #000000;">(</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
<span style="color: #000000;">}</span></pre>
<p>上記のコードは、foo0をLabTalkからの呼び出しを禁止し、foo1はLabTalkから呼び出すことができ、foo2は、<b>run -oc </b>コマンドを使って、LabTalkから呼び出すことができます。  2番目のpragmaをコメントアウトしていると、foo0 と foo1の両方がLabTalkから呼び出すことができません。これは、1つのpragmaステートメントがpragmaの後のすべての関数に適用され、次のpragmaまたはファイルの最後まで続きます。
</p><p>Origin C関数にアクセスするLabTalkを制御するLabTalkのシステム変数もあります。  変数は <b>@OC</b>で、そのデフォルトは1であり、アクセス可能ということです。   変数を0にセットするとアクセス不可となります。
</p>
<h3><a name="Listing_Functions_that_can_be_Called_from_LabTalkFunctions.2C_List_All_LabTalk_Callable_Origin_C_Functions"></a><span class="mw-headline">LabTalkから呼び出せる関数を一覧表示する<span class="OIndex" style="display:none">Functions, List All LabTalk Callable Origin C Functions</span></span></h3>
<p>LabTalkの <b>list</b> コマンドは、LabTalkから呼び出すことができるOrigin C関数のすべての名前を出力するのに使用できます。オプションを使って、関数を一覧表示する形式を変更することができます。Options let you modify which type of functions is listed:
</p>
<pre class="lt" style="font-family:monospace;">list f;  <span style="color: #008000;">// LabTalkから呼び出し可能な関数一覧</span>
list fs; <span style="color: #008000;">// stringを返す関数の一覧</span>
list fv; <span style="color: #008000;">// vectorを返す関数の一覧</span>
list fn; <span style="color: #008000;">// numericを返す関数の一覧</span>
list fo; <span style="color: #008000;">// voidを返す関数の一覧</span></pre>
<p><b>@OC=0</b> という設定は、Origin C関数をLabTalkで非表示にし、そのため<b>list f</b> コマンドは結果を表示しません。
</p>
<h3><a name="Passing_Arguments_to_Functions"></a><span class="mw-headline">関数に引数を渡す</span></h3>
<p>LabTalkスクリプトはOrigin Cの内部で使用しているすべてのデータ型をサポートしているわけではありません。次の表は、与えられた引数(戻り)の型でOrigin C関数を呼び出すときに、渡される(返される<a class="external text" href="../../LabTalk/LabTalk/Data_Types_and_Variables.html">)LabTalk変数の型</a> です。  最後の列は、引数の型が参照によって渡すことができるかどうかを示しています。
</p>
<table class="simple">
<tr>
<th> Origin C </th>
<th> LabTalk </th>
<th> 参照渡し
</th></tr>
<tr>
<td> int
</td>
<td> int
</td>
<td> 可
</td></tr>
<tr>
<td> double
</td>
<td> double
</td>
<td> 可
</td></tr>
<tr>
<td> string
</td>
<td> string
</td>
<td> 可
</td></tr>
<tr>
<td> bool
</td>
<td> int
</td>
<td> 不可
</td></tr>
<tr>
<td> matrix
</td>
<td> matrix range
</td>
<td> 可
</td></tr>
<tr>
<td> vector&lt;int&gt;
</td>
<td> dataset
</td>
<td> 可
</td></tr>
<tr>
<td> vector&lt;double&gt;
</td>
<td> dataset
</td>
<td> 可
</td></tr>
<tr>
<td> vector&lt;complex&gt;
</td>
<td> dataset
</td>
<td> 不可
</td></tr>
<tr>
<td> vector&lt;string&gt;
</td>
<td> dataset, string array*
</td>
<td> 不可
</td></tr></table>
<p>* 文字列配列は参照渡しができません。
</p><p><br />
この表が示すように、<b>string</b>, <b>int</b>, <b>double</b> 型のOrigin C関数の引数はLabTalkから値または参照で渡すことができます。   しかし、Origin C関数は実行時に渡される型で記述しなければなりません。
</p>
<h4><a name="Passing_by_Value"></a><span class="mw-headline">値で渡す</span></h4>
<p>以下は、LabTalkからOrigin Cに値で引数を渡すサンプルです。各サンプルに対するフォーマットは、Origin C関数の宣言の行を与え、LabTalkのコードを使って呼び出されます。  Origin C関数の本体は、変数を渡すというサンプルに対しては重要ではないので、除外しています。  
</p><p>関数の単純なケースは、引数を受け付け、double型の引数を受付け、double型を返します。
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">double</span> square<span style="color: #000000;">(</span><span style="color: #0000ff;">double</span> a<span style="color: #000000;">)</span>  <span style="color: #008000;">// Origin C関数の宣言</span></pre>
<pre class="lt" style="font-family:monospace;">double dd <span style="color: #000080;">=</span> <span style="color: #0000dd;">3.2</span>;         <span style="color: #008000;">// LabTalk関数呼び出し</span>
double ss <span style="color: #000080;">=</span> square<span style="color: #000000;">(</span>dd<span style="color: #000000;">)</span>;
ss <span style="color: #000080;">=</span>;                    <span style="color: #008000;">// ss = 10.24</span></pre>
<p>ここで、データタイプに割り当てるデータセット変数または範囲を使って、vector引数を取り、vectorを返すOrigin C関数がLabTalkから呼ばれます。
</p>
<pre class="oc" style="font-family:monospace;">vector<span style="color: #000080;">&lt;</span>string<span style="color: #000080;">&gt;</span> PassStrArray<span style="color: #000000;">(</span>vector<span style="color: #000080;">&lt;</span>string<span style="color: #000080;">&gt;</span> strvec<span style="color: #000000;">)</span></pre>
<p>LabTalkから3つの方法で呼び出すことができます。
</p>
<pre class="lt" style="font-family:monospace;">dataset dA, dB;
dB <span style="color: #000080;">=</span> Col<span style="color: #000000;">(</span>B<span style="color: #000000;">)</span>;
dA<span style="color: #000080;">=</span>PassStrArray<span style="color: #000000;">(</span>dB<span style="color: #000000;">)</span>;

Col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span><span style="color: #000080;">=</span>PassStrArray<span style="color: #000000;">(</span>Col<span style="color: #000000;">(</span>B<span style="color: #000000;">)</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// または、直接Colを使い、Col = dataset</span>

<span style="color: #008000;">// または、LabTalk範囲が使用される</span>
range ra <span style="color: #000080;">=</span> <span style="color: #000000;">[</span>Book1<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span>, rb <span style="color: #000080;">=</span> <span style="color: #000000;">[</span>Book1<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #0000dd;">2</span>;
ra <span style="color: #000080;">=</span> PassStrArray<span style="color: #000000;">(</span>rb<span style="color: #000000;">)</span>;</pre>
<h4><a name="Passing_by_Reference"></a><span class="mw-headline">参照で引数を渡す</span></h4>
<p>以下のOrigin C関数に対して、引数宣言内のアンパサンド <b>&amp;</b>の文字は、引数が参照で渡されていることを示しています。


</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">double</span> increment<span style="color: #000000;">(</span><span style="color: #0000ff;">double</span><span style="color: #000040;">&amp;</span> a, <span style="color: #0000ff;">double</span> dStep<span style="color: #000000;">)</span></pre>
<pre class="lt" style="font-family:monospace;">double d <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;
increment<span style="color: #000000;">(</span>d, <span style="color: #0000dd;">6</span><span style="color: #000000;">)</span>;
type <span style="color: #000080;">-</span>a <span style="color: #ff00ff;">&quot;d = $(d)&quot;</span>;  <span style="color: #008000;">// d = 10</span></pre>
<p>次は、参照で渡すいくつかの引数とそれ以外を値で渡すサンプルです。
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">int</span> get_min_max_double_arr<span style="color: #000000;">(</span>vector<span style="color: #000080;">&lt;</span><span style="color: #0000ff;">double</span><span style="color: #000080;">&gt;</span> vd, <span style="color: #0000ff;">double</span><span style="color: #000040;">&amp;</span> min, <span style="color: #0000ff;">double</span><span style="color: #000040;">&amp;</span> max<span style="color: #000000;">)</span></pre>
<pre class="lt" style="font-family:monospace;">dataset ds <span style="color: #000080;">=</span> data<span style="color: #000000;">(</span><span style="color: #0000dd;">2</span>, <span style="color: #0000dd;">30</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>;
double dMin, dMax;
get_min_max_double_arr<span style="color: #000000;">(</span>ds, dMin, dMax<span style="color: #000000;">)</span>;

<span style="color: #008000;">//または列からデータセットを使う、Col(A)にデータがあること</span>
get_min_max_double_arr<span style="color: #000000;">(</span>Col<span style="color: #000000;">(</span>A<span style="color: #000000;">)</span>, dMin,  dMax<span style="color: #000000;">)</span>;</pre>
<p>次のサンプルは、LabTalkのmatrix range変数をOrigin C関数に参照で渡すことを示しています。
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// データをvectorからmatrixにセット</span>
<span style="color: #0000ff;">void</span> set_mat_data<span style="color: #000000;">(</span><span style="color: #0000ff;">const</span> vector<span style="color: #000080;">&lt;</span><span style="color: #0000ff;">double</span><span style="color: #000080;">&gt;</span><span style="color: #000040;">&amp;</span> vd, matrix<span style="color: #000040;">&amp;</span> mat<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	mat.<span style="color: #000000;">SetSize</span><span style="color: #000000;">(</span><span style="color: #0000dd;">4</span>,<span style="color: #0000dd;">4</span><span style="color: #000000;">)</span>;
	mat.<span style="color: #000000;">SetByVector</span><span style="color: #000000;">(</span>vd<span style="color: #000000;">)</span>;
<span style="color: #000000;">}</span></pre>
<pre class="lt" style="font-family:monospace;">range mm <span style="color: #000080;">=</span> <span style="color: #000000;">[</span>MBook1<span style="color: #000000;">]</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span>;
dataset ds <span style="color: #000080;">=</span> data<span style="color: #000000;">(</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">30</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>;
set_mat_data<span style="color: #000000;">(</span>ds, mm<span style="color: #000000;">)</span>;</pre>
<h3><a name="Precedence_Rules_for_Functions_with_the_Same_NameFunctions.2C_Precedence_Rules_for_the_Same_Name_Functions"></a><span class="mw-headline">同じ名前を持つ関数の優先規則<span class="OIndex" style="display:none">Functions, Precedence Rules for the Same Name Functions</span></span></h3>
<p>ユーザ定義またはグローバルなOrigin C関数が組み込みのLabTalk関数と同じ名前を持つとき、LabTalkのvecotr表記を使う時を除いて、Origin C関数が優先順位が高くなります。 
</p><p><b>優先順位</b>
</p>
<ol><li> LabTalk 関数 (vector)</li>
<li> Origin C 関数</li>
<li> LabTalk 関数 (scalar)</li></ol>
<p><br />
通常のLabTalk関数(値の範囲を戻し、vector表記で使われる)は、同じ名前のOrigin C関数よりも優先順位が高くなります。  それ以外の場合には、Origin C関数が呼ばれます。
</p>
<h2><a name="Defining_Functions_for_the_Set_Values_DialogFunctions.2C_Adding_for_Set_Values_Dialog_F.28x.29_menu"></a><span class="mw-headline">値の設定ダイアログの関数を定義する<span class="OIndex" style="display:none">Functions, Adding for Set Values Dialog F(x) menu</span></span></h2>
<p>列または行列のどちらかの<b>値の設定</b>メニューで現れるダイアログボックスで、Origin Cを使って関数を定義することができます。
</p><p>Origin C関数がOriginプロジェクトの一部としてビルドされると、---コードビルダのProjectまたはSystemに自動的に配置されるか、userフォルダ内の関数を手動でビルドするかのいずれか---(列と行列の両方)の<b>値の設定</b>ダイアログの <b>F(x)</b> の<b>ユーザ定義</b>セクションで利用できます。  <b>F(x)</b>メニューの異なるセクションに関数を割り当てるには、関数ヘッダの一部として、新しいセクション名を含むpragmaを発行します。例えば、次のコードは、Mathセクションに関数 <b>add2num</b> を追加し、統計セクションに関数 <b>mean2num</b> を追加します。
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">#pragma</span> labtalk<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,Math<span style="color: #000000;">)</span>
<span style="color: #0000ff;">double</span> add2num<span style="color: #000000;">(</span><span style="color: #0000ff;">double</span> a, <span style="color: #0000ff;">double</span> b<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	  <span style="color: #0000ff;">return</span> a <span style="color: #000040;">+</span> b;
<span style="color: #000000;">}</span>

<span style="color: #0000ff;">#pragma</span> labtalk<span style="color: #000000;">(</span><span style="color: #0000dd;">1</span>,Statistics<span style="color: #000000;">)</span>
<span style="color: #0000ff;">double</span> mean2num<span style="color: #000000;">(</span><span style="color: #0000ff;">double</span> a, <span style="color: #0000ff;">double</span> b<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	  <span style="color: #0000ff;">return</span> <span style="color: #000000;">(</span>a <span style="color: #000040;">+</span> b<span style="color: #000000;">)</span><span style="color: #000040;">/</span><span style="color: #0000dd;">2</span>;
<span style="color: #000000;">}</span></pre>
<p>この方法で、多くの関数を1つのソースファイル内で定義し、ビルドし、<b>F(x)</b>メニューの目的の場所で直ちに利用できます。
</p><p><b>F(x)</b>メニューに追加される関数は、次の制約に従います。
</p>
<ul><li> 関数の戻り型は、void型にすることはできません。 </li>
<li> 関数は引数の型に対して、参照またはポインタ(&amp;)を持つことはできません。</li></ul>







    