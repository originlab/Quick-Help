<h1 class="firstheading">OriginC: Regression Analysis</h1>

  <p>&#160;</p>

  <p>&#160;</p>

  <div id="toc" class="toc">
    <div id="toctitle">
      <h2>Contents</h2>
    </div>

    <ul>
      <li class="toclevel-1 tocsection-1"><a href="#Version_Info"><span class="tocnumber">1</span> <span class="toctext">Version Info</span></a></li>

      <li class="toclevel-1 tocsection-2"><a href="#Linear_Regression"><span class="tocnumber">2</span> <span class="toctext">Linear Regression</span></a></li>

      <li class="toclevel-1 tocsection-3"><a href="#Multiple_Linear_Regression"><span class="tocnumber">3</span> <span class="toctext">Multiple Linear Regression</span></a></li>

      <li class="toclevel-1 tocsection-4"><a href="#Nonlinear_Regression"><span class="tocnumber">4</span> <span class="toctext">Nonlinear Regression</span></a></li>
    </ul>
  </div>

  <h2><a name="Version_Info"></a><span class="mw-headline">Version Info</span></h2>

  <p class="version">Minimum Origin Version Required: Origin 8 SR0</p>

  <h2><a name="Linear_Regression"></a><span class="mw-headline">Linear Regression</span></h2>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>oc_nag.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
<span style="color: #008000;">//#include  &lt;nag\OC_nag_ex.h&gt; //not need, only oc_nag.h required.</span>
<span style="color: #0000ff;">void</span> nag_linear_regression_ex1<span style="color: #000000;">(</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
   <span style="color: #008000;">// data input directly by vector</span>
   vector vx <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">0</span>,<span style="color: #0000dd;">4</span>,<span style="color: #0000dd;">7.5</span>,<span style="color: #0000dd;">2.5</span>,<span style="color: #0000dd;">0</span>,<span style="color: #0000dd;">10</span>,<span style="color: #0000dd;">5</span><span style="color: #000000;">}</span>; 
   vector vy <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">20</span>,<span style="color: #0000dd;">15.5</span>,<span style="color: #0000dd;">28.3</span>,<span style="color: #0000dd;">45</span>,<span style="color: #0000dd;">24.5</span>,<span style="color: #0000dd;">10</span>,<span style="color: #0000dd;">99</span>,<span style="color: #0000dd;">31.2</span><span style="color: #000000;">}</span>;
   vector vw <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">1</span><span style="color: #000000;">}</span>;

                                        
   Nag_SumSquare mean <span style="color: #000080;">=</span> Nag_AboutMean;
   <span style="color: #0000ff;">int</span>  n;
   n <span style="color: #000080;">=</span> vx.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
                        
   <span style="color: #0000ff;">double</span> a, b, err_a, err_b, rsq, rss, df;
                
   g02cac<span style="color: #000000;">(</span>mean, n, vx, vy, vw, <span style="color: #000040;">&amp;</span>a, <span style="color: #000040;">&amp;</span>b, <span style="color: #000040;">&amp;</span>err_a, <span style="color: #000040;">&amp;</span>err_b, <span style="color: #000040;">&amp;</span>rsq, <span style="color: #000040;">&amp;</span>rss,
             <span style="color: #000040;">&amp;</span>df, NAGERR_DEFAULT<span style="color: #000000;">)</span>;


        
   <span style="color: #008000;">// output intepretation: a+b*x  b is the slope, a is the intercept   </span>
   <span style="color: #0000ff;">if</span> <span style="color: #000000;">(</span>mean <span style="color: #000080;">==</span> Nag_AboutMean<span style="color: #000000;">)</span>
     <span style="color: #000000;">{</span>
       <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"<span style="color: #666666; font-weight: bold;">\n</span>Regression constant a = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>, a<span style="color: #000000;">)</span>;
       <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"Standard error of the regression constant a = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>,err_a<span style="color: #000000;">)</span>; 
     <span style="color: #000000;">}</span>
        
   <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"Regression coefficient b = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>, b<span style="color: #000000;">)</span>;
   <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"Standard error of the regression coefficient b = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>,err_b<span style="color: #000000;">)</span>;

   <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"The regression coefficient of determination = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>, rsq<span style="color: #000000;">)</span>;
   <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"The sum of squares of the residuals about the "</span> <span style="color: #ff00ff;">"regression = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>, rss<span style="color: #000000;">)</span>;
   <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"Number of degrees of freedom about the "</span> <span style="color: #ff00ff;">"regression = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>,df<span style="color: #000000;">)</span>;  

    <span style="color: #008000;">//Expected Result:      </span>
    <span style="color: #008000;">//Regression constant a = 7.5982</span>
 
    <span style="color: #008000;">//Standard error of the regression constant a = 6.6858</span>
    <span style="color: #008000;">//</span>
    <span style="color: #008000;">//Regression coefficient b = 7.0905</span>
    <span style="color: #008000;">//</span>
    <span style="color: #008000;">//Standard error of the regression coefficient b = 1.3224</span>
    <span style="color: #008000;">//</span>
    <span style="color: #008000;">//The regression coefficient of determination = 0.8273</span>
    <span style="color: #008000;">//</span>
    <span style="color: #008000;">//The sum of squares of the residuals about the regression = 965.2454</span>
    <span style="color: #008000;">//</span>
    <span style="color: #008000;">//Number of degrees of freedom about the regression = 6.0000</span>
 
<span style="color: #000000;">}</span>
</pre>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>oc_nag.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
<span style="color: #008000;">//#include  &lt;nag\OC_nag_ex.h&gt;  //not need, only oc_nag.h required.</span>
<span style="color: #0000ff;">void</span> nag_linear_regression_ex2<span style="color: #000000;">(</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
<span style="color: #008000;">// obtain regression data from an Origin Worksheet</span>
    Worksheet wks<span style="color: #000080;">=</span>Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
    <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span><span style="color: #000040;">!</span>wks<span style="color: #000000;">)</span>
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"no active worksheet found<span style="color: #666666; font-weight: bold;">\n</span>"</span><span style="color: #000000;">)</span>;    
    Dataset dsSrcX<span style="color: #000000;">(</span>wks,<span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>; <span style="color: #008000;">// assume that the x, y data and weight data are in the first three columns</span>
    Dataset dsSrcY<span style="color: #000000;">(</span>wks,<span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
    Dataset dsSrcW<span style="color: #000000;">(</span>wks,<span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>;
    <span style="color: #0000ff;">int</span> nSize;
    vector vx<span style="color: #000000;">(</span>nSize<span style="color: #000000;">)</span>;
    vector vy<span style="color: #000000;">(</span>nSize<span style="color: #000000;">)</span>;
    vector vw<span style="color: #000000;">(</span>nSize<span style="color: #000000;">)</span>;
    vx<span style="color: #000080;">=</span>dsSrcX;
    vy<span style="color: #000080;">=</span>dsSrcY;
    vw<span style="color: #000080;">=</span>dsSrcW;

    <span style="color: #0000ff;">int</span>  n;
    n <span style="color: #000080;">=</span> vx.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
    Nag_SumSquare mean <span style="color: #000080;">=</span> Nag_AboutMean;

    <span style="color: #0000ff;">double</span> a, b, err_a, err_b, rsq, rss, df;
                
   g02cac<span style="color: #000000;">(</span>mean, n, vx, vy, vw, <span style="color: #000040;">&amp;</span>a, <span style="color: #000040;">&amp;</span>b, <span style="color: #000040;">&amp;</span>err_a, <span style="color: #000040;">&amp;</span>err_b, <span style="color: #000040;">&amp;</span>rsq, <span style="color: #000040;">&amp;</span>rss,
             <span style="color: #000040;">&amp;</span>df, NAGERR_DEFAULT<span style="color: #000000;">)</span>;
 
       
   <span style="color: #008000;">// output intepretation: a+b*x  b is the slope, a is the intercept </span>
   <span style="color: #0000ff;">if</span> <span style="color: #000000;">(</span>mean <span style="color: #000080;">==</span> Nag_AboutMean<span style="color: #000000;">)</span>
     <span style="color: #000000;">{</span>
       <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"<span style="color: #666666; font-weight: bold;">\n</span>Regression constant a = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>, a<span style="color: #000000;">)</span>;
       <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"Standard error of the regression constant a = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>,err_a<span style="color: #000000;">)</span>; 
     <span style="color: #000000;">}</span>
        
   <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"Regression coefficient b = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>, b<span style="color: #000000;">)</span>;
   <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"Standard error of the regression coefficient b = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>,err_b<span style="color: #000000;">)</span>;

   <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"The regression coefficient of determination = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>, rsq<span style="color: #000000;">)</span>;
   <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"The sum of squares of the residuals about the "</span> <span style="color: #ff00ff;">"regression = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>, rss<span style="color: #000000;">)</span>;
   <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"Number of degrees of freedom about the "</span> <span style="color: #ff00ff;">"regression = %6.4f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>,df<span style="color: #000000;">)</span>;  

  

<span style="color: #000000;">}</span>
</pre>

  <h2><a name="Multiple_Linear_Regression"></a><span class="mw-headline">Multiple Linear Regression</span></h2>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>oc_nag.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
<span style="color: #008000;">//#include  &lt;nag\OC_nag_ex.h&gt;  //not need, only oc_nag.h required.</span>
<span style="color: #0000ff;">void</span> nag_regsn_mult_linear_ex<span style="color: #000000;">(</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
        
                
        <span style="color: #0000ff;">double</span> rss, tol;
        <span style="color: #0000ff;">int</span> i, ip, rank, j, m, n;
        <span style="color: #0000ff;">double</span> df;
        Boolean svd;
        <span style="color: #0000ff;">char</span> weight, meanc;
        Nag_IncludeMean mean;
        <span style="color: #0000ff;">double</span> b<span style="color: #000000;">[</span><span style="color: #0000dd;">20</span><span style="color: #000000;">]</span>;
        <span style="color: #0000ff;">double</span> cov<span style="color: #000000;">[</span><span style="color: #0000dd;">210</span><span style="color: #000000;">]</span>, h<span style="color: #000000;">[</span><span style="color: #0000dd;">20</span><span style="color: #000000;">]</span>, p<span style="color: #000000;">[</span><span style="color: #0000dd;">440</span><span style="color: #000000;">]</span>;
        <span style="color: #0000ff;">double</span> res<span style="color: #000000;">[</span><span style="color: #0000dd;">20</span><span style="color: #000000;">]</span>, se<span style="color: #000000;">[</span><span style="color: #0000dd;">20</span><span style="color: #000000;">]</span>;
        <span style="color: #0000ff;">double</span> com_ar<span style="color: #000000;">[</span><span style="color: #0000dd;">495</span><span style="color: #000000;">]</span>;
        <span style="color: #0000ff;">double</span> wt<span style="color: #000000;">[</span><span style="color: #0000dd;">20</span><span style="color: #000000;">]</span>;
        matrix q;
        q.<span style="color: #000000;">SetSize</span><span style="color: #000000;">(</span><span style="color: #0000dd;">20</span>, <span style="color: #0000dd;">21</span><span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">double</span> <span style="color: #000040;">*</span>wtptr;
        n <span style="color: #000080;">=</span> <span style="color: #0000dd;">12</span>;
        m <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;
        mean <span style="color: #000080;">=</span> Nag_MeanInclude;
        wtptr <span style="color: #000080;">=</span><span style="color: #0000ff;">NULL</span>;
        
        <span style="color: #008000;">// input data is only the first four columns, the design matrix</span>
        matrix x <span style="color: #000080;">=</span>         <span style="color: #000000;">{</span><span style="color: #000000;">{</span><span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,  
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,            
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,            
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,     
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,            
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,  
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>,
                         <span style="color: #000000;">{</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">}</span>
                        <span style="color: #000000;">}</span>;

        <span style="color: #0000ff;">double</span> y<span style="color: #000000;">[</span><span style="color: #0000dd;">20</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">33.63</span>, <span style="color: #0000dd;">39.62</span>, <span style="color: #0000dd;">38.18</span>, <span style="color: #0000dd;">41.46</span>, <span style="color: #0000dd;">38.02</span>, <span style="color: #0000dd;">35.83</span>, 
                        <span style="color: #0000dd;">35.99</span>, <span style="color: #0000dd;">36.58</span>, <span style="color: #0000dd;">42.92</span>, <span style="color: #0000dd;">37.80</span>, <span style="color: #0000dd;">40.43</span>, <span style="color: #0000dd;">37.89</span><span style="color: #000000;">}</span>; <span style="color: #008000;">// the y data</span>
                
        <span style="color: #0000ff;">int</span> sx<span style="color: #000000;">[</span><span style="color: #0000dd;">20</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">1</span><span style="color: #000000;">}</span>;
        
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"The  input data are as follows<span style="color: #666666; font-weight: bold;">\n</span>"</span><span style="color: #000000;">)</span>;
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"n = 12, m = 4, tol = 0.000001e0<span style="color: #666666; font-weight: bold;">\n</span>"</span><span style="color: #000000;">)</span>;
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"x<span style="color: #666666; font-weight: bold;">\n</span>"</span><span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">for</span><span style="color: #000000;">(</span>i <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; i <span style="color: #000080;">&lt;</span> n; i<span style="color: #000040;">++</span><span style="color: #000000;">)</span> 
        <span style="color: #000000;">{</span>
                <span style="color: #0000ff;">for</span><span style="color: #000000;">(</span>j <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; j <span style="color: #000080;">&lt;</span> m; j<span style="color: #000040;">++</span><span style="color: #000000;">)</span>
                        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"%2.1f, "</span>,x<span style="color: #000000;">[</span>i<span style="color: #000000;">]</span><span style="color: #000000;">[</span>j<span style="color: #000000;">]</span><span style="color: #000000;">)</span>;
                        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"<span style="color: #666666; font-weight: bold;">\n</span>"</span><span style="color: #000000;">)</span>;
        <span style="color: #000000;">}</span>
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"<span style="color: #666666; font-weight: bold;">\n</span>y<span style="color: #666666; font-weight: bold;">\n</span>"</span><span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">for</span><span style="color: #000000;">(</span>i <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; i <span style="color: #000080;">&lt;</span> n; i <span style="color: #000040;">++</span><span style="color: #000000;">)</span>
        <span style="color: #000000;">{</span>
                <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"%5.3f, "</span>, y<span style="color: #000000;">[</span>i<span style="color: #000000;">]</span><span style="color: #000000;">)</span>;
                <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span><span style="color: #000000;">(</span>i <span style="color: #000040;">+</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> <span style="color: #000040;">%</span> <span style="color: #0000dd;">7</span> <span style="color: #000080;">==</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>
                        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"<span style="color: #666666; font-weight: bold;">\n</span>"</span><span style="color: #000000;">)</span>;
        <span style="color: #000000;">}</span>
                
        ip <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
        <span style="color: #0000ff;">if</span> <span style="color: #000000;">(</span>mean<span style="color: #000080;">==</span>Nag_MeanInclude<span style="color: #000000;">)</span>
                ip <span style="color: #000040;">+</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
        <span style="color: #0000ff;">for</span> <span style="color: #000000;">(</span>i<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>; i<span style="color: #000080;">&lt;</span>m; i<span style="color: #000040;">++</span><span style="color: #000000;">)</span>
                <span style="color: #0000ff;">if</span> <span style="color: #000000;">(</span>sx<span style="color: #000000;">[</span>i<span style="color: #000000;">]</span><span style="color: #000080;">&gt;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> ip <span style="color: #000040;">+</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
        tol <span style="color: #000080;">=</span> 0.00001e0;
                
        nag_regsn_mult_linear<span style="color: #000000;">(</span>mean, n, x, <span style="color: #0000dd;">20</span>, m, sx, ip, y,
                wtptr, <span style="color: #000040;">&amp;</span>rss, <span style="color: #000040;">&amp;</span>df, b, se, cov, res, h, q, <span style="color: #0000dd;">21</span>, <span style="color: #000040;">&amp;</span>svd, <span style="color: #000040;">&amp;</span>rank, p, tol, com_ar, NAGERR_DEFAULT<span style="color: #000000;">)</span>;

        <span style="color: #0000ff;">if</span> <span style="color: #000000;">(</span>svd<span style="color: #000000;">)</span>
        <span style="color: #000000;">{</span>     <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"<span style="color: #666666; font-weight: bold;">\n</span>Model not of full rank, rank = %4ld<span style="color: #666666; font-weight: bold;">\n</span>"</span>, rank<span style="color: #000000;">)</span>;
                <span style="color: #000000;">ASSERT</span><span style="color: #000000;">(</span> rank <span style="color: #000080;">==</span> <span style="color: #0000dd;">4</span> <span style="color: #000000;">)</span>;
        <span style="color: #000000;">}</span>
        
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"Residual sum of squares = %12.4e<span style="color: #666666; font-weight: bold;">\n</span>"</span>, rss<span style="color: #000000;">)</span>;   
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"Degrees of freedom = %3.1f<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span>, df<span style="color: #000000;">)</span>;
        

        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"Variable       Parameter           Estimate Standard error<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// the standard error</span>
        <span style="color: #0000ff;">for</span> <span style="color: #000000;">(</span>j<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>; j<span style="color: #000080;">&lt;</span>ip; j<span style="color: #000040;">++</span><span style="color: #000000;">)</span>
                <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"%6ld%20.4e%20.4e<span style="color: #666666; font-weight: bold;">\n</span>"</span>, j<span style="color: #000040;">+</span><span style="color: #0000dd;">1</span>, b<span style="color: #000000;">[</span>j<span style="color: #000000;">]</span>, se<span style="color: #000000;">[</span>j<span style="color: #000000;">]</span><span style="color: #000000;">)</span>;
        
        
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"<span style="color: #666666; font-weight: bold;">\n</span>"</span><span style="color: #000000;">)</span>;
        <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"Obs            Residuals           h<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>"</span><span style="color: #000000;">)</span>;  <span style="color: #008000;">// the residuals</span>
        <span style="color: #0000ff;">for</span> <span style="color: #000000;">(</span>i<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>; i<span style="color: #000080;">&lt;</span>n; i<span style="color: #000040;">++</span><span style="color: #000000;">)</span>
                <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"%6ld%20.4e%20.4e<span style="color: #666666; font-weight: bold;">\n</span>"</span>, i<span style="color: #000040;">+</span><span style="color: #0000dd;">1</span>, res<span style="color: #000000;">[</span>i<span style="color: #000000;">]</span>, h<span style="color: #000000;">[</span>i<span style="color: #000000;">]</span><span style="color: #000000;">)</span>;
                
<span style="color: #000000;">}</span>
</pre>

  <h2><a name="Nonlinear_Regression"></a><span class="mw-headline">Nonlinear Regression</span></h2>
  <pre class="oc" style="font-family:monospace;">
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>OC_nag.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>

<span style="color: #008000;">//Callback to calculate objective subfunction values, and (optionally) its Jacobian</span>
<span style="color: #0000ff;">void</span> NAG_CALL objfun_callback<span style="color: #000000;">(</span><span style="color: #0000ff;">int</span> m, <span style="color: #0000ff;">int</span> n, <span style="color: #0000ff;">double</span> p<span style="color: #000000;">[</span><span style="color: #000000;">]</span>, <span style="color: #0000ff;">double</span> f<span style="color: #000000;">[</span><span style="color: #000000;">]</span>, 
                              <span style="color: #0000ff;">double</span> fjac<span style="color: #000000;">[</span><span style="color: #000000;">]</span>, <span style="color: #0000ff;">int</span> tdfjac,Nag_Comm <span style="color: #000040;">*</span>comm<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
<span style="color: #0000ff;">#define</span> FJAC<span style="color: #000000;">(</span>I,J<span style="color: #000000;">)</span> fjac<span style="color: #000000;">[</span><span style="color: #000000;">(</span>I<span style="color: #000000;">)</span><span style="color: #000040;">*</span>tdfjac <span style="color: #000040;">+</span><span style="color: #000000;">(</span>J<span style="color: #000000;">)</span><span style="color: #000000;">]</span>
        
        <span style="color: #0000ff;">static</span> vector x <span style="color: #000080;">=</span> <span style="color: #000000;">{</span>
                <span style="color: #0000dd;">8.0</span>, <span style="color: #0000dd;">8.0</span>, <span style="color: #0000dd;">10.0</span>, <span style="color: #0000dd;">10.0</span>, <span style="color: #0000dd;">10.0</span>, <span style="color: #0000dd;">10.0</span>, <span style="color: #0000dd;">12.0</span>, <span style="color: #0000dd;">12.0</span>, <span style="color: #0000dd;">12.0</span>, <span style="color: #0000dd;">12.0</span>, <span style="color: #0000dd;">14.0</span>, <span style="color: #0000dd;">14.0</span>,
                <span style="color: #0000dd;">14.0</span>, <span style="color: #0000dd;">16.0</span>, <span style="color: #0000dd;">16.0</span>, <span style="color: #0000dd;">16.0</span>, <span style="color: #0000dd;">18.0</span>, <span style="color: #0000dd;">18.0</span>, <span style="color: #0000dd;">20.0</span>, <span style="color: #0000dd;">20.0</span>, <span style="color: #0000dd;">20.0</span>, <span style="color: #0000dd;">22.0</span>, <span style="color: #0000dd;">22.0</span>, <span style="color: #0000dd;">22.0</span>,
                <span style="color: #0000dd;">24.0</span>, <span style="color: #0000dd;">24.0</span>, <span style="color: #0000dd;">24.0</span>, <span style="color: #0000dd;">26.0</span>, <span style="color: #0000dd;">26.0</span>, <span style="color: #0000dd;">26.0</span>, <span style="color: #0000dd;">28.0</span>, <span style="color: #0000dd;">28.0</span>, <span style="color: #0000dd;">30.0</span>, <span style="color: #0000dd;">30.0</span>, <span style="color: #0000dd;">30.0</span>, <span style="color: #0000dd;">32.0</span>,
                <span style="color: #0000dd;">32.0</span>, <span style="color: #0000dd;">34.0</span>, <span style="color: #0000dd;">36.0</span>, <span style="color: #0000dd;">36.0</span>, <span style="color: #0000dd;">38.0</span>, <span style="color: #0000dd;">38.0</span>, <span style="color: #0000dd;">40.0</span>, <span style="color: #0000dd;">42.0</span><span style="color: #000000;">}</span>;
        
        <span style="color: #0000ff;">double</span> temp;       
        <span style="color: #0000ff;">for</span><span style="color: #000000;">(</span><span style="color: #0000ff;">int</span> i <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; i <span style="color: #000080;">&lt;</span> m; <span style="color: #000040;">++</span>i<span style="color: #000000;">)</span>
        <span style="color: #000000;">{</span>
                <span style="color: #008000;">//evaluate objective subfunction f(i+1) only if required</span>
                <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span>comm<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>needf <span style="color: #000080;">==</span> i<span style="color: #000040;">+</span><span style="color: #0000dd;">1</span> <span style="color: #000040;">||</span> comm<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>needf <span style="color: #000080;">==</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>
                <span style="color: #000000;">{</span>
                        temp <span style="color: #000080;">=</span> <span style="color: #000000;">exp</span><span style="color: #000000;">(</span><span style="color: #000040;">-</span>p<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #000040;">*</span> <span style="color: #000000;">(</span>x<span style="color: #000000;">[</span>i<span style="color: #000000;">]</span> <span style="color: #000040;">-</span> <span style="color: #0000dd;">8.0</span><span style="color: #000000;">)</span><span style="color: #000000;">)</span>;
                        f<span style="color: #000000;">[</span>i<span style="color: #000000;">]</span> <span style="color: #000080;">=</span> p<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span> <span style="color: #000040;">+</span> <span style="color: #000000;">(</span>.49 <span style="color: #000040;">-</span> p<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span><span style="color: #000000;">)</span> <span style="color: #000040;">*</span> temp;                        
                <span style="color: #000000;">}</span>
                <span style="color: #008000;">//evaluate the Jacobian if required</span>
                <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span>comm<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>flag <span style="color: #000080;">==</span> <span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>
                <span style="color: #000000;">{</span>
                        FJAC<span style="color: #000000;">(</span>i, <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1.0</span> <span style="color: #000040;">-</span> temp;
                        FJAC<span style="color: #000000;">(</span>i, <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> <span style="color: #000040;">-</span><span style="color: #000000;">(</span><span style="color: #0000dd;">0.49</span> <span style="color: #000040;">-</span> p<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span><span style="color: #000000;">)</span> <span style="color: #000040;">*</span> <span style="color: #000000;">(</span>x<span style="color: #000000;">[</span>i<span style="color: #000000;">]</span> <span style="color: #000040;">-</span> <span style="color: #0000dd;">8.0</span><span style="color: #000000;">)</span> <span style="color: #000040;">*</span> temp;
                <span style="color: #000000;">}</span>             
        <span style="color: #000000;">}</span>     
<span style="color: #000000;">}</span>

<span style="color: #008000;">//Callback to calculate nonlinear constraints and (optinally) its Jacobian</span>
<span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> NAG_CALL confun_callback<span style="color: #000000;">(</span><span style="color: #0000ff;">int</span> n, <span style="color: #0000ff;">int</span> ncnlin, <span style="color: #0000ff;">int</span> needc<span style="color: #000000;">[</span><span style="color: #000000;">]</span>, <span style="color: #0000ff;">double</span> p<span style="color: #000000;">[</span><span style="color: #000000;">]</span>, 
                                    <span style="color: #0000ff;">double</span> conf<span style="color: #000000;">[</span><span style="color: #000000;">]</span>, <span style="color: #0000ff;">double</span> cjac<span style="color: #000000;">[</span><span style="color: #000000;">]</span>, Nag_Comm <span style="color: #000040;">*</span>comm<span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
<span style="color: #0000ff;">#define</span> CJAC<span style="color: #000000;">(</span>I, J<span style="color: #000000;">)</span> cjac<span style="color: #000000;">[</span><span style="color: #000000;">(</span>I<span style="color: #000000;">)</span><span style="color: #000040;">*</span>n <span style="color: #000040;">+</span> <span style="color: #000000;">(</span>J<span style="color: #000000;">)</span><span style="color: #000000;">]</span>
        
        <span style="color: #008000;">//First call to confun. Set all Jacobian elements to zero.</span>
        <span style="color: #008000;">//Note that this will only work when options.obj_deriv = TRUE(default)</span>
        <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span>comm<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>first <span style="color: #000080;">==</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">)</span>           
                CJAC<span style="color: #000000;">(</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> CJAC<span style="color: #000000;">(</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0.0</span>;
        
        <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span>needc<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span> <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>
        <span style="color: #000000;">{</span>
                conf<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> <span style="color: #000040;">-</span>.09 <span style="color: #000040;">-</span> p<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span><span style="color: #000040;">*</span>p<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #000040;">+</span> <span style="color: #0000dd;">0.49</span><span style="color: #000040;">*</span>p<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>;
                <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span>comm<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>flag <span style="color: #000080;">==</span> <span style="color: #0000dd;">2</span><span style="color: #000000;">)</span>
                <span style="color: #000000;">{</span>
                        CJAC<span style="color: #000000;">(</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> <span style="color: #000040;">-</span>p<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>;
                        CJAC<span style="color: #000000;">(</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">1</span><span style="color: #000000;">)</span> <span style="color: #000080;">=</span> <span style="color: #000040;">-</span>p<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span> <span style="color: #000040;">+</span> .49;
                <span style="color: #000000;">}</span>
        <span style="color: #000000;">}</span>
<span style="color: #000000;">}</span>

<span style="color: #0000ff;">void</span> nag_opt_nlin_lsq_ex<span style="color: #000000;">(</span><span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
        vector y <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">0.49</span>, <span style="color: #0000dd;">0.49</span>, <span style="color: #0000dd;">0.48</span>, <span style="color: #0000dd;">0.47</span>, <span style="color: #0000dd;">0.48</span>, <span style="color: #0000dd;">0.47</span>, <span style="color: #0000dd;">0.46</span>, <span style="color: #0000dd;">0.46</span>, <span style="color: #0000dd;">0.45</span>, <span style="color: #0000dd;">0.43</span>, <span style="color: #0000dd;">0.45</span>,
                                <span style="color: #0000dd;">0.43</span>, <span style="color: #0000dd;">0.43</span>, <span style="color: #0000dd;">0.44</span>, <span style="color: #0000dd;">0.43</span>, <span style="color: #0000dd;">0.43</span>, <span style="color: #0000dd;">0.46</span>, <span style="color: #0000dd;">0.45</span>, <span style="color: #0000dd;">0.42</span>, <span style="color: #0000dd;">0.42</span>, <span style="color: #0000dd;">0.43</span>, <span style="color: #0000dd;">0.41</span>,
                                <span style="color: #0000dd;">0.41</span>, <span style="color: #0000dd;">0.40</span>, <span style="color: #0000dd;">0.42</span>, <span style="color: #0000dd;">0.40</span>, <span style="color: #0000dd;">0.40</span>, <span style="color: #0000dd;">0.41</span>, <span style="color: #0000dd;">0.40</span>, <span style="color: #0000dd;">0.41</span>, <span style="color: #0000dd;">0.41</span>, <span style="color: #0000dd;">0.40</span>, <span style="color: #0000dd;">0.40</span>,
                                <span style="color: #0000dd;">0.40</span>, <span style="color: #0000dd;">0.38</span>, <span style="color: #0000dd;">0.41</span>, <span style="color: #0000dd;">0.40</span>, <span style="color: #0000dd;">0.40</span>, <span style="color: #0000dd;">0.41</span>, <span style="color: #0000dd;">0.38</span>, <span style="color: #0000dd;">0.40</span>, <span style="color: #0000dd;">0.40</span>, <span style="color: #0000dd;">0.39</span>, <span style="color: #0000dd;">0.39</span><span style="color: #000000;">}</span>;
        
        <span style="color: #0000ff;">int</span> m <span style="color: #000080;">=</span> y.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>, n <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;
        <span style="color: #0000ff;">int</span> tda <span style="color: #000080;">=</span> n, tdfjac <span style="color: #000080;">=</span> n;
        <span style="color: #0000ff;">int</span> nclin <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>, ncnlin <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
        
        vector p <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">0.4</span>, <span style="color: #0000dd;">0.0</span><span style="color: #000000;">}</span>;<span style="color: #008000;">//initial parameters</span>
        vector a <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">1.0</span><span style="color: #000000;">}</span>;<span style="color: #008000;">//linear constraints</span>
        vector bl <span style="color: #000080;">=</span> <span style="color: #000000;">{</span><span style="color: #0000dd;">0.4</span>, <span style="color: #000040;">-</span><span style="color: #0000dd;">4.0</span>, <span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">0.0</span><span style="color: #000000;">}</span>; <span style="color: #008000;">//lower bounds</span>
        vector bu <span style="color: #000080;">=</span> <span style="color: #000000;">{</span>1.0e<span style="color: #000040;">+</span>25, 1.0e<span style="color: #000040;">+</span>25, 1.0e<span style="color: #000040;">+</span>25, 1.0e<span style="color: #000040;">+</span>25<span style="color: #000000;">}</span>; <span style="color: #008000;">//upper bounds</span>
        vector f<span style="color: #000000;">(</span>m<span style="color: #000000;">)</span>, fjac<span style="color: #000000;">(</span>m<span style="color: #000040;">*</span>n<span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">double</span> objf;
        
        Nag_E04_Opt options;
        nag_opt_init<span style="color: #000000;">(</span><span style="color: #000040;">&amp;</span>options<span style="color: #000000;">)</span>;
        <span style="color: #000000;">strcpy</span><span style="color: #000000;">(</span>options.<span style="color: #000000;">outfile</span>, <span style="color: #ff00ff;">"c:<span style="color: #666666; font-weight: bold;">\\</span>nag_opt_nlin_lsq_ex.txt"</span><span style="color: #000000;">)</span>;
        
        NagError fail;
        
        e04unc<span style="color: #000000;">(</span>m, n, nclin, ncnlin, a, tda, bl, bu, y, objfun_callback, confun_callback,
                p, <span style="color: #000040;">&amp;</span>objf, f, fjac, tdfjac, <span style="color: #000040;">&amp;</span>options, NAGCOMM_NULL, <span style="color: #000040;">&amp;</span>fail<span style="color: #000000;">)</span>;
                        
        <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span>fail.<span style="color: #000000;">code</span> <span style="color: #000080;">==</span> NE_NOERROR<span style="color: #000000;">)</span>
        <span style="color: #000000;">{</span>
                <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"fitting paramters: %lf %lf <span style="color: #666666; font-weight: bold;">\n</span>"</span>, p<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span>, p<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span><span style="color: #000000;">)</span>;
                <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"value of objective function: %lf <span style="color: #666666; font-weight: bold;">\n</span>"</span>, objf<span style="color: #000000;">)</span>; 
        <span style="color: #000000;">}</span>
        <span style="color: #0000ff;">else</span>
        <span style="color: #000000;">{</span>
                <span style="color: #000000;">printf</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">"fitting failed, error code = %d"</span>, fail.<span style="color: #000000;">code</span><span style="color: #000000;">)</span>;
        <span style="color: #000000;">}</span>
        
        <span style="color: #008000;">//Expected Result:  </span>
        <span style="color: #008000;">//fitting paramters: 0.419953 1.284845 </span>
        <span style="color: #008000;">//value of objective function: 0.014230</span>
<span style="color: #000000;">}</span>
</pre>
