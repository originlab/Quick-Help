<h1 class="firstheading">3変数の陰関数でフィット</h1><p class='urlname' style='display: none'>ImplicitFit-3Var</p>
<div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Summary"><span class="tocnumber">1</span> <span class="toctext">概要</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#What_you_will_learn"><span class="tocnumber">2</span> <span class="toctext">学習する項目</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Examples_and_Steps"><span class="tocnumber">3</span> <span class="toctext">サンプルとステップ</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Import_Data"><span class="tocnumber">3.1</span> <span class="toctext">データをインポート</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Define_Fitting_Function"><span class="tocnumber">3.2</span> <span class="toctext">フィット関数を定義する</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Fit_the_Curve"><span class="tocnumber">3.3</span> <span class="toctext">曲線をフィットする</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Fitting_Results"><span class="tocnumber">3.4</span> <span class="toctext">フィット結果</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Fitted_Surface"><span class="tocnumber">3.5</span> <span class="toctext">フィット曲線</span></a></li>
</ul>
</li>
</ul>
</div>
<p><br />
</p>
<table class="simple" style="width: 80%">
<tr style="vertical-align: top;">
<td style="width: 40%"><a  class="image"><img alt="Video Image.png" src="../images/Implicit_Fitting_with_Three_Variables/Video_Image.png" width="33"  /></a> <a  class="image"><img alt="Video Text Image.png" src="../images/Implicit_Fitting_with_Three_Variables/Video_Text_Image.png" width="135"  /></a>
<ul><li> <a class="external text" href="https://www.originlab.com/videos/details.aspx?id=98" target="_blank">陰関数曲線フィット</a></li></ul>
</td>
<td style="width: 40%"><a  class="image"><img alt="Website blog icon circle.png" src="../images/Implicit_Fitting_with_Three_Variables/Website_blog_icon_circle.png" width="31"  /></a> <a  class="image"><img alt="Blog Image 33x33px.png" src="../images/Implicit_Fitting_with_Three_Variables/Blog_Image_33x33px.png" width="135"  /></a>
</td></tr></table>
<h2><a name="Summary"></a><span class="mw-headline">概要</span></h2>
<p>このチュートリアルでは変数の陰関数を定義する方法と、フィットデータを使って陰関数フィットを行います。
</p>
<p class="version" >必要なOriginのバージョン: OriginPro 9.0 SR0以降</p>
<h2><a name="What_you_will_learn"></a><span class="mw-headline">学習する項目</span></h2>
<p>このチュートリアルでは、以下の項目について解説します。
</p>
<ol><li> 陰フィット関数を定義する</li>
<li> 3つの独立変数から陰関数のフィッティングを行う</li>
<li> フィット曲面を作図する</li></ol>
<h2><a name="Examples_and_Steps"></a><span class="mw-headline">サンプルとステップ</span></h2>
<h3><a name="Import_Data"></a><span class="mw-headline">データのインポート</span></h3>
<ol><li> 新しいワークブックを用意します。<b>ヘルプ: フォルダを開く: サンプルフォルダ</b>を選択して、サンプルフォルダを開きます。このフォルダ内の<i>Curve Fitting</i>サブフォルダにある<i>Ellipsoid.dat</i> ファイルを探します。空のワークシートにファイルをドラッグアンドドロップしてインポートします。</li>
<li> C列を選択して右クリックし、コンテキストメニューから<b>列XY属性の設定：Z列</b>を選択します。Originのメニューから<b><b>作図：3D：3D散布図</b></b>を選択します。グラフ上でダブルクリックします。<b><b>作図の詳細</b></b>ダイアログの左側パネルで<b><b>Layer1</b></b>を選択し、<b><b>軸</b></b>タブを開いてから<b><b>X、Y、Zの長さ</b></b>を順番に100, 75, 50と設定しOKボタンをクリックします。<b>3D回転</b>ツールバーの<b>フレームに合わせる</b>ボタン<a  class="image"><img alt="Fit Frame To Layer.PNG" src="../images/Implicit_Fitting_with_Three_Variables/16px-Fit_Frame_To_Layer.PNG" width="16"   /></a>をクリックします。グラフは次のようになります。<br /><a  class="image"><img alt="Implicit 3V G1.png" src="../images/Implicit_Fitting_with_Three_Variables/Implicit_3V_G1.png" width="553"  /></a></li></ol>
<h3><a name="Define_Fitting_Function"></a><span class="mw-headline">フィット関数を定義する</span></h3>
<p>このグラフは楕円体でフィットする事ができます。この関数は次のように表現できます。
</p>
<dl><dd><img src="../images/Implicit_Fitting_with_Three_Variables/math-b71f95ed35e1ed11ba596b7160b40af7.png" title="\frac{(x-x_0)^2}{a^2}+\frac{(y-y_0)^2}{b^2}+\frac{(z-z_0)^2}{c^2}=1" alt="\frac{(x-x_0)^2}{a^2}+\frac{(y-y_0)^2}{b^2}+\frac{(z-z_0)^2}{c^2}=1" class="tex"/></dd></dl>
<p>ここで、<img src="../images/Implicit_Fitting_with_Three_Variables/math-4e08dd6cdde437884ad3dbe20a20c05f.png" title="(x_0, y_0, z_0) \;" alt="(x_0, y_0, z_0) \;" class="tex"/>は楕円体の中心位置、<b><b>a</b></b>, <b><b>b</b></b>, <b><b>c</b></b>は各方向の形の半分の長さ、<b><b>x</b></b>, <b><b>y</b></b>, <b><b>z</b></b> はフィットデータの3つの独立変数です。
</p><p>フィット関数は、<b><b>フィット関数ビルダー</b></b>ツールを使用して定義できます。
</p>
<ol><li> <b><b>ツール：フィット関数ビルダー</b></b>をメニューから選択します。</li>
<li> <b><b>フィット関数ビルダー</b></b>ダイアログの<b><b>処理のゴール</b></b>ページで<b><b>進む</b></b>ボタンをクリックします。</li>
<li> <b><b>関数名と関数形式</b></b>のページでは<b><b>関数カテゴリーの選択/新規名称</b></b>のドロップダウンリストから<b><b>Implicit</b></b>を選択します。次に<b><b>関数名</b></b>のエリアに <b><b>Ellipsoid</b></b>と入力し、<b><b>関数モデル</b></b>では<b><b>陰関数</b></b>グループを選択します。<b><b>進む</b></b>をクリックします。<br /><a  class="image"><img alt="Implicit 3V G2.png" src="../images/Implicit_Fitting_with_Three_Variables/Implicit_3V_G2.png" width="678"  /></a><br /><br /><b>Note</b>: 陰関数は<b><b>Implicit</b></b>カテゴリ内で定義する必要があります。</li>
<li> <b><b>変数とパラメータ</b></b>ページでは、<b>変数</b>エリアに<b><b>x, y, z</b></b>と入力し、<b><b>パラメータ</b></b>エリアには<b><b>x0, y0, z0, a, b, c</b></b>と入力します。<b><b>進む</b></b>をクリックします。</li>
<li> <b><b>式形式の関数</b></b>ページで、以下のスクリプトを<b><b>関数内容</b></b>編集ボックスに入力します。<pre class="lt" style="font-family:monospace;"><span style="color: #000000;">(</span>x<span style="color: #000080;">-</span>x0<span style="color: #000000;">)</span><span style="color: #000080;">^</span><span style="color: #0000dd;">2</span><span style="color: #000080;">/</span>a<span style="color: #000080;">^</span><span style="color: #0000dd;">2</span><span style="color: #000080;">+</span><span style="color: #000000;">(</span>y<span style="color: #000080;">-</span>y0<span style="color: #000000;">)</span><span style="color: #000080;">^</span><span style="color: #0000dd;">2</span><span style="color: #000080;">/</span>b<span style="color: #000080;">^</span><span style="color: #0000dd;">2</span><span style="color: #000080;">+</span><span style="color: #000000;">(</span>z<span style="color: #000080;">-</span>z0<span style="color: #000000;">)</span><span style="color: #000080;">^</span><span style="color: #0000dd;">2</span><span style="color: #000080;">/</span>c<span style="color: #000080;">^</span><span style="color: #0000dd;">2</span><span style="color: #000080;">-</span><span style="color: #0000dd;">1</span></pre>陰関数<img src="../images/Implicit_Fitting_with_Three_Variables/math-44b22fd696dfa3566db742efbaf49ac6.png" title="f_1(x_i,p_i)=f_2(x_i,p_i)\;" alt="f_1(x_i,p_i)=f_2(x_i,p_i)\;" class="tex"/>内では、<img src="../images/Implicit_Fitting_with_Three_Variables/math-1ba8aaab47179b3d3e24b0ccea9f4e30.png" title="x_i" alt="x_i" class="tex"/>(i=1,2..) は独立変数、<img src="../images/Implicit_Fitting_with_Three_Variables/math-eca91c83a74a2373ca5f796700e99fd3.png" title="p_i" alt="p_i" class="tex"/> (i=1,2...) はパラメータとなり、Origin内では<b><b>f</b></b>を<b><b>推定値</b></b>として <img src="../images/Implicit_Fitting_with_Three_Variables/math-0310b55a8aedb17e29866a5e31a05588.png" title="f=f_1(x_i,p_i)-f_2(x_i,p_i)\;" alt="f=f_1(x_i,p_i)-f_2(x_i,p_i)\;" class="tex"/> のように定義されています。<b><b>パラメータ</b></b>タブで初期パラメータを以下のように設定します。<pre class="lt" style="font-family:monospace;">x0<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> y0<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> z0<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> a<span style="color: #000080;">=</span><span style="color: #0000dd;">3</span> b<span style="color: #000080;">=</span><span style="color: #0000dd;">3</span> c<span style="color: #000080;">=</span><span style="color: #0000dd;">3</span></pre><b><b>クイックチェック</b></b>グループで<b><b>評価</b></b>ボタンをクリックして x=1, y=1, z=1 がf=-0.667になる事を確認します。<br /><a  class="image"><img alt="Implicit 3V G3.png" src="../images/Implicit_Fitting_with_Three_Variables/Implicit_3V_G3.png" width="678"  /></a><br /><b><b>進む</b></b>ボタンをクリックし、もう一度<b><b>進む</b></b>ボタンをクリックします。</li>
<li> <b><b>境界条件と一般線形制約</b></b>ページでは<b><b>a</b></b>, <b><b>b</b></b>, <b><b>c</b></b>の下限値を次のように設定します。<b>完了</b>ボタンをクリックして、ダイアログを閉じます。<br />
<dl><dd> <a  class="image"><img alt="Bounds general linear constraints.png" src="../images/Implicit_Fitting_with_Three_Variables/Bounds_general_linear_constraints.png" width="314"  /></a> </dd></dl></li></ol>
<p><b><b>Note</b></b><b> </b>陰関数が<b><b>ユーザファイルフォルダ</b></b>に保存されたという内容が<b><b>メッセージログ</b></b>に表示されます。
</p>
<h3><a name="Fit_the_Curve"></a><span class="mw-headline">曲線をフィットする</span></h3>
<ol><li> Originは2つ以上の独立変数を持つ陰関数のフィットはワークブックからの入力データのみをサポートしています。グラフからはサポートしていません。つまり、フィットする前にフィットデータが入ったアクティブなワークブックを作成する必要があります。ワークブックをアクティブにしてから<b><b>解析： フィット：非線形陰関数カーブフィット</b></b>をメニューから選択します。<b><b>NLFit</b></b>ダイアログで、<b><b>設定：関数選択</b></b>と選択して、<b><b>関数</b></b>ドロップダウンリストから<b>Ellipsoid</b> 関数を選択します。</li>
<li> <b><b>データ選択</b></b>ページに移動し、<b><b>入力データ：範囲1</b></b>を開き、「A:X、B:Y、C:Z」として割り当てます。<b><b>設定</b></b>パネルの下部にエラーメッセージが出力されます。エラーメッセージの情報に従い、<b><b>フィット曲線</b></b>ページを開き、Xのデータタイプのドロップダウンリストで<b><b>入力データのフィットしたポイント</b></b>に変更します。<b><b>yのデータタイプ</b></b>と<b><b>z</b></b>は自動的に変更されます。<br /><a  class="image"><img alt="Implicit 3V G4.png" src="../images/Implicit_Fitting_with_Three_Variables/Implicit_3V_G4.png" width="851"  /></a><br /><b><b>Note</b></b> Originは2つ以上の独立変数を持つ陰関数でのフィットでは、<b><b>NLFit</b></b>ダイアログ内での<b><b>フィット曲線</b></b>プレビューをサポートしていません。</li>
<li> <b><b>フィット関数ビルダ</b></b>で初期のパラメータを知っていしているので、<b><b>フィット</b></b>ボタンをクリックします。</li></ol>
<h3><a name="Fitting_Results"></a><span class="mw-headline">フィット結果</span></h3>
<p>フィットレポートに切り替えます。<b><b>パラメータ</b></b>と<b><b>統計値</b></b>の表がレポートに表示されます。<br />
</p><p>フィットパラメータは以下の通りです。
</p>
<table class="simple">
<tr>
<th><b>パラメータ</b>
</th>
<th><b>値</b>
</th>
<th><b>標準誤差<b></b></b>
</th></tr>
<tr>
<th><b>x0</b>
</th>
<td>0.41073
</td>
<td>0.01576
</td></tr>
<tr>
<th><b>y0</b>
</th>
<td>0.32043
</td>
<td>0.01352
</td></tr>
<tr>
<th><b>z0</b>
</th>
<td>0.00147
</td>
<td>0.00749
</td></tr>
<tr>
<th><b>a</b>
</th>
<td>4.00325
</td>
<td>0.02076
</td></tr>
<tr>
<th><b>b</b>
</th>
<td>3.00097
</td>
<td>0.01881
</td></tr>
<tr>
<th><b>c</b>
</th>
<td>1.99972
</td>
<td>0.00933
</td></tr></table>
<p>そして、<b>Adj.です。<b>補正R二乗</b></b>が0.99823となっているので、このフィット結果はとても良い事を示しています。<b><b>Note</b></b> Origin9.0 32ビット版とOrigin9.0 64ビット版でフィットした結果は若干異なりますが、64ビット版の方がより正確な結果を示しています。 
</p><p><b>FitODRCurve1</b>ワークシートでは、最初の3列はフィットしたポイントのXYY座標を示しています。
</p><p><b><b>Note</b></b> 陰関数のフィッティングでは、x、y、zは全て独立変数であり、フィットが反復されるごとに値の調整が行われます。
</p>
<h3><a name="Fitted_Surface"></a><span class="mw-headline">フィット曲面</span></h3>
<p>Origin9.0SR1では、2つ以上独立変数による陰関数のフィッティングではフィット曲面がレポートに表示されません。このような場合は、以下のように<b>3Dパラメトリック関数グラフ</b>を利用して楕円グラフにフィットさせることができます。
</p>
<ol>
<li> フィットレポートを選択して、<b><b>スクリプトウィンドウ</b></b>で以下のLabTalkスクリプトを実行して、フィットされたパラメータ変数を入手します。
<pre class="lt" style="font-family:monospace;">getnlr tr<span style="color: #000000;">:</span><span style="color: #000080;">=</span>tt;
x0<span style="color: #000080;">=</span>tt.<span style="color: #000080;">x0</span>;
y0<span style="color: #000080;">=</span>tt.<span style="color: #000080;">y0</span>;
z0<span style="color: #000080;">=</span>tt.<span style="color: #000080;">z0</span>;
a<span style="color: #000080;">=</span>tt.<span style="color: #000080;">a</span>;
b<span style="color: #000080;">=</span>tt.<span style="color: #000080;">b</span>;
c<span style="color: #000080;">=</span>tt.<span style="color: #000080;">c</span>;</pre>
<p>変数<b><b>x0</b></b>、<b><b>y0</b></b>、<b><b>z0</b></b>、<b><b>a</b></b>、<b><b>b</b></b>、<b><b>c</b></b>は以下の方法で利用することもできます。
</p>
<li><b><b>Graph 1</b></b>をアクティブにします。メニューから<b><b>ファイル：新規作成：関数グラフ:3Dパラメトリック関数グラフ</b></b>を選択します。<b><b><b>3Dパラメトリック関数グラフ</b>を作成する</b></b>ダイアログで、<b><b>u</b></b>を0からπに、<b><b>v</b></b>を0から2*πに設定します。<b><b>X</b></b>、<b><b>Y</b></b>、<b><b>Z</b></b>を以下のように定義します。
<pre class="lt" style="font-family:monospace;">X<span style="color: #000000;">(</span>u,v<span style="color: #000000;">)</span><span style="color: #000080;">=</span>x0<span style="color: #000080;">+</span>a<span style="color: #000080;">*</span>sin<span style="color: #000000;">(</span>u<span style="color: #000000;">)</span><span style="color: #000080;">*</span>cos<span style="color: #000000;">(</span>v<span style="color: #000000;">)</span>
Y<span style="color: #000000;">(</span>u,v<span style="color: #000000;">)</span><span style="color: #000080;">=</span>y0<span style="color: #000080;">+</span>b<span style="color: #000080;">*</span>sin<span style="color: #000000;">(</span>u<span style="color: #000000;">)</span><span style="color: #000080;">*</span>sin<span style="color: #000000;">(</span>v<span style="color: #000000;">)</span>
Z<span style="color: #000000;">(</span>u,v<span style="color: #000000;">)</span><span style="color: #000080;">=</span>z0<span style="color: #000080;">+</span>c<span style="color: #000080;">*</span>cos<span style="color: #000000;">(</span>u<span style="color: #000000;">)</span></pre>
<p>ダイアログ左下のドロップダウンリストで、<b><b>アクティブなグラフに追加する</b></b>を選択します。<br />
</p><p><a  class="image"><img alt="Implicit 3V G5.png" src="../images/Implicit_Fitting_with_Three_Variables/Implicit_3V_G5.png" width="461"  /></a><br />
</p><p><b>OK</b>ボタンをクリックして、ダイアログを閉じます。<b><b>Graph 1</b></b>に3D楕円グラフが追加されます。
</p>
<li> グラフ上でダブルクリックします。<b><b>作図の詳細</b></b>ダイアログで、以下のようにグラフをカスタマイズします。<br />
<b><b>Note</b></b> Origin9.0では、OpenGLのバージョンが2.1以上の場合、3D透過に対応しています。Originのメニューから<b><b>ツール:3D OpenGLの設定</b></b>と選択すると、ご利用いただいているPCのOpenGLバージョンを確認できます。バージョンが2.1よりも低い場合、3D透過のステップを無視してステップ3.2に進んでください。
<ol>
<li>左のパネルで<b><b>Layer 1</b></b>を選択し、<b><b>サイズ/描画スピード</b></b>タブを開き、<b><b>スピードモード(必要に応じてポイントスキップ)</b></b>グループで<b><b>ワークシートデータ、曲線あたりの最大ポイント数</b></b>のチェックを外します。<b><b>ライティング</b></b>タブを開き、<b><b>モード</b></b>グループで<b><b>平行光源</b></b>を選択し、<b><b>光の色</b></b>グループで<b><b>環境光</b></b>に青を設定します。
<li><b><b>Layer1</b></b>のブランチで2つ目のプロットを選択し、<b><b>面</b></b>タブを開いてから<b><b>透明度</b></b>を50%に変更します。<b><b>塗りつぶし</b></b>タブを開き、<b><b>表面</b></b>グループで<b><b>ひとつずつ塗りつぶす</b></b>色を白にします。<b>OK</b>ボタンをクリックして、ダイアログを閉じます。
</ol>
<p>楕円グラフにフィットしたグラフは以下のようになります。<br />
</p><p><a  class="image"><img alt="Implicit 3V G7.png" src="../images/Implicit_Fitting_with_Three_Variables/Implicit_3V_G7.png" width="553"  /></a>
</p>
</ol>




    