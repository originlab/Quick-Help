<h1 class="firstheading">ピークアナライザで基線のアンカーポイントを検索するスクリプトを使用する<br /></h1>
<div id="toc" class="toc">
<div id="toctitle">
<h2>目次</h2>
</div>
<ol>
<li class="toclevel-1 tocsection-1"><a href="#Summary"><span class="tocnumber">1</span> <span class="toctext">サマリー</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#What_you_will_learn"><span class="tocnumber">2</span> 学習する項目</a></li>
<li class="toclevel-1 tocsection-3"><a href="#Steps"><span class="tocnumber">3</span> <span class="toctext">ステップ</span></a>
<ol>
<li class="toclevel-2 tocsection-4"><a href="#Create_baseline_with_User-Defined_Scripts"><span class="tocnumber">3.1</span> <span class="toctext">ユーザ定義のスクリプトで基線を作成</span></a></li>
</ol>
</li>
</ol>
</div>
<h2><a name="Summary" id="Summary"></a><span class="mw-headline">サマリー</span></h2>
<p>OriginProでは、ピークアナライザを使って、基線の作成または減算オプションを実行することができます。最初に基線のアンカーポイントを検索し、補間またはフィッティングにより検索したアンカーポイントを接続して、基線を作成します。基線のアンカーポイントの検索には、ビルトインの方法または、ユーザが作成したLabTalkスクリプトにより定義します。</p>
<h2><a name="What_you_will_learn" id="What_you_will_learn"></a><span class="mw-headline">学習する項目</span></h2>
<ul>
<li>ユーザ定義のスクリプトで基線を作成する方法</li>
<li>ユーザ定義の基線からピークを検出する方法</li>
</ul>
<h2><a name="Steps" id="Steps"></a><span class="mw-headline">ステップ</span></h2>
<h3><a name="Create_baseline_with_User-Defined_Scripts" id="Create_baseline_with_User-Defined_Scripts"></a><span class="mw-headline">ユーザ定義のスクリプトで基線を作成</span></h3>
<ol>
<li>新しい<b>ワークブック</b>を開き、<i>&lt;Origin EXE Folder&gt;\Samples\Spectroscopy\Chromatography\Liquid chromatogram.dat</i>ファイルをインポートします。2列目を選択します。メインメニューで、<b>解析：ピークと基線：ピークアナライザ</b>を選択してピークアナライザのダイアログを開きます。</li>
<li><b style="font-weight: bold;">処理</b> の項目を<b>ピーク検索</b> に設定し、<b>次へ</b> ボタンをクリックして<b>基線モード</b> ページに移動します。</li>
<li><b style="font-weight: bold;">基線モード</b> を <b>ユーザ定義</b> に設定し、<b>基線アンカーポイント</b>ノードで、<b>アンカーポイントを見つける</b>のオプションを<b>検索のスクリプトを使用</b> に設定します。</li>
<li><i style="font-style: italic;">apt_x</i> と <i>apt_y</i> を <b>X=</b> と <b>Y=</b> の編集ボックスにそれぞれ入力します。次に、下のスクリプトを<b>実行前の処理スクリプト</b> ボックスに入力し、<b>検索</b> ボタンをクリックして、スクリプトを実行します。検出された基線のアンカーポイントは、プレビューウィンドウに表示されます。</li>
</ol>
<dl>
<dd><a class="image" style="color: #0000ff; text-decoration: underline;"><img alt="UseScriptToSearch.png" src="../images/Use_Script_to_Search_Baseline_Anchor_Points_in_Peak_Analyzer/600px-UseScriptToSearch.png" width="848" height="729" border="0" /></a></dd>
</dl>
<pre class="lt" style="font-family: monospace;">
Dataset dspos;
pkfind iy<span>:</span><span style="color: #000080;">=</span><span>(</span>dsx, dsy<span>)</span> dir<span>:</span><span style="color: #000080;">=</span>p npts<span>:</span><span style="color: #000080;">=</span><span style="color: rgb(0, 0, 221);">5</span> value<span>:</span><span style="color: #000080;">=</span><span style="color: rgb(0, 0, 221);">200</span> ocenter<span>:</span><span style="color: #000080;">=</span>dspos; <span style="color: #008000;">// </span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">主ピーク位置を検出</span>
int npk<span style="color: #000080;">=</span>dspos.<span style="color: #000080;">GetSize</span><span>()</span>; <span style="color: #008000;">// </span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">主ピークの数を取得</span>
 <span style="color: #008000;">// </span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">アンカーポイントを入力したデータセットを作成</span>
int nn <span style="color: #000080;">=</span> dsx.<span style="color: #000080;">GetSize</span><span>()</span>; <span style="color: #008000;">// </span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">Ｘ数のソースを取得</span>
dataset apt_x, apt_y;<span style="color: #008000;">// </span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">アンカーポイントを入力したデータセットを作成</span>
apt_x.<span style="color: #000080;">SetSize</span><span>(</span>npk<span style="color: #000080;">+</span><span style="color: rgb(0, 0, 221);">1</span><span>)</span>; <span style="color: #008000;">// </span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">アンカーポイントの数を設定</span>
apt_y.<span style="color: #000080;">SetSize</span><span>(</span>npk<span style="color: #000080;">+</span><span style="color: rgb(0, 0, 221);">1</span><span>)</span>;
apt_x<span>[</span><span style="color: rgb(0, 0, 221);">1</span><span>]</span> <span style="color: #000080;">=</span> dsx<span>[</span><span style="color: rgb(0, 0, 221);">1</span><span>]</span>; <span style="color: #008000;">// </span><span lang="EN-US" xml:lang="EN-US" style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'Courier New'; mso-fareast-font-family: 'ＭＳ 明朝'; mso-fareast-theme-font: minor-fareast; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">1</span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">番目のアンカーポイントとして、</span><span lang="EN-US" xml:lang="EN-US" style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'Courier New'; mso-fareast-font-family: 'ＭＳ 明朝'; mso-fareast-theme-font: minor-fareast; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">1</span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">番目のデータポイントを設定</span>
apt_y<span>[</span><span style="color: rgb(0, 0, 221);">1</span><span>]</span> <span style="color: #000080;">=</span> dsy<span>[</span><span style="color: rgb(0, 0, 221);">1</span><span>]</span>; 
apt_x<span>[</span>npk<span style="color: #000080;">+</span><span style="color: rgb(0, 0, 221);">1</span><span>]</span> <span style="color: #000080;">=</span> dsx<span>[</span>nn<span>]</span>; <span style="color: #008000;">// </span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">最後のアンカーポイントとして、最後のデータポイントを設定</span>
apt_y<span>[</span>npk<span style="color: #000080;">+</span><span style="color: rgb(0, 0, 221);">1</span><span>]</span> <span style="color: #000080;">=</span> dsy<span>[</span>nn<span>]</span>; 
for <span>(</span>ii<span style="color: #000080;">=</span><span style="color: rgb(0, 0, 221);">1</span>; ii<span style="color: #000080;">&lt;=</span>npk; ii<span style="color: #000080;">++</span><span>)</span> <span>
{</span>
int istart <span style="color: #000080;">=</span> dspos<span>[</span>ii<span>]</span>; <span style="color: #008000;">// </span><span lang="EN-US" xml:lang="EN-US" style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'Courier New'; mso-fareast-font-family: 'ＭＳ 明朝'; mso-fareast-theme-font: minor-fareast; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">ii</span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">番目のピークの行番号を取得</span>
int iend <span style="color: #000080;">=</span> dspos<span>[</span>ii<span style="color: #000080;">+</span><span style="color: rgb(0, 0, 221);">1</span><span>]</span>; <span style="color: #008000;">// </span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">次のピークの列番号を取得</span>
range rtemp <span style="color: #000080;">=</span> <span>[</span>??<span>]</span><span style="color: #000080;">!</span>dsy<span>[</span><span style="color: #000080;">$</span><span>(</span>istart<span>):</span><span style="color: #000080;">$</span><span>(</span>iend<span>)]</span>; <span style="color: #008000;">// </span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">自由データセットに範囲とポイントを宣言</span>
limit rtemp; <span style="color: #008000;">// </span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">サブレンジの統計値を取得</span>
int ind <span style="color: #000080;">=</span> limit.<span style="color: #000080;">imin</span>; <span style="color: #008000;">// </span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">最小</span><span lang="EN-US" xml:lang="EN-US" style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'Courier New'; mso-fareast-font-family: 'ＭＳ 明朝'; mso-fareast-theme-font: minor-fareast; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">Y</span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">行の行番号を取得</span>
apt_y<span>[</span>ii<span style="color: #000080;">+</span><span style="color: rgb(0, 0, 221);">1</span><span>]</span><span style="color: #000080;">=</span>limit.<span style="color: #000080;">ymin</span>; <span style="color: #008000;">// </span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">アンカーポイントとして</span><span lang="EN-US" xml:lang="EN-US" style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'Courier New'; mso-fareast-font-family: 'ＭＳ 明朝'; mso-fareast-theme-font: minor-fareast; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">2</span><span style="font-size: 9.0pt; mso-bidi-font-size: 11.0pt; font-family: 'ＭＳ 明朝', serif; mso-ascii-font-family: 'Courier New'; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New'; color: #008000; mso-ansi-language: EN-US; mso-fareast-language: JA; mso-bidi-language: AR-SA;">つのピーク間の最小Ｙを取得</span>
apt_x<span>[</span>ii<span style="color: #000080;">+</span><span style="color: rgb(0, 0, 221);">1</span><span>]</span><span style="color: #000080;">=</span>dsx<span>[</span>ind<span>]</span>; <span>
}</span>;
</pre>
<p>スクリプトでは、まず全ての主なピーク位置を検索し、隣接する2つのピーク間全てでの最小値を基線のアンカーポイントとして扱います。さらに、データポイントの最初と最後を基線のアンカーポイントに加えます。</p>
<p><font color="#FF0000">Note:</font> <b>自動検索をオン</b> のチェックボックスからチェックを外して、<b>追加</b> または <b>編集/削除</b>を使って基線のあんかーぽいんとを追加/削除が出来ます。</p>
<p><br />
5.<b>進む</b> ボタンをクリックして、<b>基線の作成</b> ページに進みます。<b>接続線</b>は<b>補間</b>が選択され、<b>補間方法</b>は<b>線</b>を選択してください。<b>完了</b>をクリックして、個々のピークに対する適切な基線を取得します。</p>
