<h1 class="firstheading">OriginC関数を管理したり、アクセスする</h1>
<a name="Summary" id="Summary"></a>
<h2><span class="mw-headline">サマリー</span></h2>
<p>このチュートリアルでは、Origin C関数を呼び出す方法について学習します。</p>
<p class="version">必要なOriginのバージョン:Origin 8.0 SR0</p>
<a name="What_you_will_learn" id="What_you_will_learn"></a>
<h2><span class="mw-headline">学習する項目</span></h2>
<p>このチュートリアルでは、以下の項目について説明します。</p>
<ul>
<li>プロジェクトと一緒にOrigin C関数を保存する</li>
<li>図形オブジェクトとプログラムを結びつける</li>
<li>スクリプトからOrigin C関数をロード、コンパイルする</li>
</ul>
<a name="Saving_your_Origin_C_Function_with_your_Project" id="Saving_your_Origin_C_Function_with_your_Project"></a>
<h2><span class="mw-headline">プロジェクトと一緒にOrigin C関数を保存する</span></h2>
<p>Origin C関数をロードして、コンパイルする1つの方法は、Origin CファイルをOriginのプロジェクトファイル（.opj）に添付して、保存することです。プロジェクトが開くと、プロジェクトに添付しているすべてのファイルが取り出され、一時フォルダに保存されます。さらに、添付されたOrigin Cファイルはコードビルダワークスペースにロードされ、コンパイルされます。そして、関数は開いているOriginプロジェクトファイルから呼び出される準備が整います。</p>
<ol>
<li><b style="font-weight: bold;">標準</b>ツールバーの<b>新規プロジェクト</b>ボタン<a><img alt="Image:Button_New.png" src="../images/Organizing_and_Accessing_Origin_C_Functions/Button_New.png" width="21" height="21" border="0" /></a> をクリックして、新しいプロジェクトを開きます。</li>
<li><b style="font-weight: bold;">標準</b>ツールバーで、<b>コードビルダ</b>ボタン<a><img alt="Image:Button_Code_Builder.png" src="../images/Organizing_and_Accessing_Origin_C_Functions/Button_Code_Builder.png" width="23" height="23" border="0" /></a>をクリックします。</li>
<li><b style="font-weight: bold;">コードビルダ</b>のメニューで<b>ファイル：新規</b>を選びます。これで<b>新規ファイル</b>ダイアログが開かれます。</li>
<li>最初のリストボックスで、<b>C File</b>を選びます。</li>
<li><b style="font-weight: bold;">ファイル名</b>テキストボックスに<b>Test</b>と入力します。<b>ワークスペースに追加</b>、のチェックは付けたままにします。<b>OK</b>をクリックします。すると、Test.cがワークスペースに追加されます。</li>
<li>以下の関数をTest.cにコピー&amp;ペーストします。「//start your functions here」　のすぐ下にテキストを貼り付けてください。</li>
</ol>
<pre class="oc">
<span style="color: #0000ff;">void</span> Plot_Data<span style="color: #000000;">(</span>string strTemplate, string strData<span style="color: #000000;">)</span> <span style="color: #000000;">
{</span>
        <span style="color: #008000;">// テンプレートからグラフウィンドウを作成</span>
        GraphPage gp;                   
        <span style="color: #0000ff;">BOOL</span> bOK <span style="color: #000080;">=</span> gp.<span style="color: #000000;">Create</span><span style="color: #000000;">(</span>strTemplate, CREATE_VISIBLE<span style="color: #000000;">)</span>;
        <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> <span style="color: #000040;">!</span>bOK <span style="color: #000000;">)</span>
                <span style="color: #0000ff;">return</span>;
 
        <span style="color: #008000;">// 最初のレイヤ(0)をGraphLayerオブジェクトに接続      </span>
        GraphLayer gl <span style="color: #000080;">=</span> gp.<span style="color: #000000;">Layers</span><span style="color: #000000;">(</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>; 
 
        <span style="color: #008000;">//データセットをCurveオブジェクトに接続    </span>
        Curve crv<span style="color: #000000;">(</span>strData<span style="color: #000000;">)</span>; 
 
        <span style="color: #008000;">// Curveをグラフレイヤに追加       </span>
        <span style="color: #0000ff;">int</span> nPlot <span style="color: #000080;">=</span> gl.<span style="color: #000000;">AddPlot</span><span style="color: #000000;">(</span>crv<span style="color: #000000;">)</span>;   
        <span style="color: #0000ff;">if</span><span style="color: #000000;">(</span>nPlot <span style="color: #000080;">&gt;=</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">)</span>      
        <span style="color: #000000;">{</span>                     
                <span style="color: #008000;">// プロットの色をGreen(2)にセット</span>
                gl.<span style="color: #000000;">DataPlots</span><span style="color: #000000;">(</span>nPlot<span style="color: #000000;">)</span>.<span style="color: #000000;">SetColor</span><span style="color: #000000;">(</span><span style="color: #0000dd;">2</span>, <span style="color: #0000ff;">TRUE</span><span style="color: #000000;">)</span>;
 
                <span style="color: #008000;">// このグラフレイヤを再スケール</span>
                gl.<span style="color: #000000;">Rescale</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
        <span style="color: #000000;">}</span><span style="color: #000000;">
}</span>
</pre>
<p>Plot_Data関数は、2つの引数を取ります。(1)テンプレート名、(2)（プロットの）レイヤに含めるYデータセット名です。</p>
<ol start="7">
<li><b style="font-weight: bold;">ビルド</b>ボタン<a><img alt="Image:Button_Build.png" src="../images/Organizing_and_Accessing_Origin_C_Functions/Button_Build.png" width="23" height="22" border="0" /></a> をクリックしてファイルのコンパイルリンクを行います。</li>
</ol>
<ol start="8">
<li>ワークスペースツリーのUserサブフォルダブランチにあるTest.cファイルを、Projectサブフォルダにドラッグアンドドロップします。(<b>Hint:</b> 最初にUserサブフォルダを開いて、ドラッグする前にTest.c を表示する必要があります。)</li>
</ol>
<ol start="9">
<li>Originのユーザインターフェースに戻り、標準ツールバーの<b>保存</b>ボタン <a><img alt="Image:Button_Save_Project.png" src="../images/Organizing_and_Accessing_Origin_C_Functions/Button_Save_Project.png" width="23" height="23" border="0" /></a> をクリックしてプロジェクトを保存します。プロジェクトの名前をTest.OPJにして、選択した場所に保存します。</li>
</ol>
<ol start="10">
<li>これで、Origin Cファイル, Test.c, がプロジェクトと一緒に保存されました。これを確認するには、プロジェクトを閉じ、コードビルダに戻ります。ワークスペースツリーのProjectフォルダには何もないことがわかります。Originインターフェースに戻り、プロジェクトを再度開きます。コードビルダに行き、今度はTest.cがProjectサブフォルダに表示されていることが確認できます。(<b>Hint:</b> Test.cを表示するためにProjectサブフォルダを開く必要があるかもしれません。)</li>
</ol>
<a name="Associating_your_Programs_with_Visual_Objects" id="Associating_your_Programs_with_Visual_Objects"></a>
<h2><span class="mw-headline">図形オブジェクトとプログラムを結びつける</span></h2>
<p>ではワークシートにボタンを作成し、プロジェクトと一緒に保存したTest.cファイルにあるOrigin C関数をそのボタンから呼び出すようにプログラムする方法について学びます。</p>
<ol>
<li>ステップ9(<a href="../../Tutorial/Tutorial/Organizing_and_Accessing_Origin_C_Functions.html#Saving_your_Origin_C_Function_with_your_Project" title="Tutorial:Organizing and Accessing Origin C Functions">前のセクション</a>)で保存したTest.OPJプロジェクトを開きます。</li>
<li>列A(X)と列B(Y)を選択し、右クリックして、<b>列値の一律設定：行番号</b>を選択します。</li>
<li>メニューから、<b>フォーマット：ワークシートの表示属性</b>を選択し、<b>ワークシートプロパティ</b>ダイアログを開きます。</li>
<li><b style="font-weight: bold;">サイズ</b>タブの<b>ワークシート寸法</b>ブランチで、<b>上からのギャップ</b>を<b>40</b>にして、<b>OK</b>をクリックして、ダイアログを閉じます。</li>
</ol>
<dl>
<dd><a style="color: #0000ff; text-decoration: underline;"><img alt="Image:Organizing_and_Accessing_Origin_C_Functions_1.png" src="../images/Organizing_and_Accessing_Origin_C_Functions/Organizing_and_Accessing_Origin_C_Functions_1.png" width="396" height="323" border="0" /></a></dd>
</dl>
<p>これで、ワークシートの列ヘッダの上側にテキストラベルを追加する十分な余白ができました。</p>
<p>2列のすぐ上の領域を右クリックし、<b>テキストの追加</b>を選びます。</p>
<ol start="5">
<li>カーソル位置で、<b>Plot Data</b>と入力します。</li>
</ol>
<ol start="6">
<li>テキストラベルの外側をクリックし、選択を解除します。</li>
</ol>
<ol start="7">
<li>テキストラベルを右クリックし、<b>オブジェクトのプログラム制御</b>を選び、<b>オブジェクトのプログラム制御</b>ダイアログボックスを開きます。(<b>Hint:</b> Origin7.5では<b>ラベルの制御</b>でした。)</li>
</ol>
<ol start="8">
<li><b style="font-weight: bold;">～の後でスクリプトを実行</b>ドロップダウンリストから、<b>ボタンアップ</b>を選びます。</li>
</ol>
<ol start="9">
<li>ダイアログの下にあるテキストボックスに次のスクリプトを入力します。</li>
</ol>
<pre>
Plot_Data("scatter","book1_b");
</pre>
<ol start="10">
<li><b style="font-weight: bold;">OK</b>をクリックします。</li>
</ol>
<p>テキストラベルはボタンのように表示されます。</p>
<dl>
<dd><a style="color: #0000ff; text-decoration: underline;"><img alt="Image:Organizing_and_Accessing_Origin_C_Functions_2.png" src="../images/Organizing_and_Accessing_Origin_C_Functions/Organizing_and_Accessing_Origin_C_Functions_2.png" width="398" height="322" border="0" /></a></dd>
</dl>
<ol start="11">
<li>ワークシートの<b>Plot Data</b> ボタンをクリックします。</li>
</ol>
<ol start="12">
<li>Test.cファイルのPlot_Data関数が呼ばれ、散布図が作成されます。</li>
</ol>
<table class="note">
<tr>
<td><b style="font-weight: bold;">Note:</b>ボタンに結びついたスクリプトは、Data1ワークシートの列B(Y)にデータがあり、それに結びついたXデータがあるものとしています。</td>
</tr>
</table>
<a name="Loading_and_Compiling_your_Origin_C_Function_from_Script" id="Loading_and_Compiling_your_Origin_C_Function_from_Script"></a>
<h2><span class="mw-headline">スクリプトからOrigin C関数をロード、コンパイルする</span></h2>
<p>このチュートリアルで、プロジェクトファイルと一緒にOrigin C関数を保存して、Originインターフェースから関数にアクセスする方法を学びました。Origin Cファイルをプロジェクトと一緒に保存すると、Origin C関数は、そのプロジェクト内でしかアクセスできないという制限があります。新しいプロジェクトを開くと、その関数は利用できなくなります。</p>
<p>保存したOrigin Cファイルの関数にアクセスするのため、LabTalkスクリプトを使って、ファイルをプログラムでロードし、コンパイルすることができます。プログラムでのロード/コンパイルを実行するスクリプトコマンドは、run.LoadOCです。このコマンドの使用についての詳細は、<b>LabTalk</b>ヘルプ(<b>ヘルプ：プログラミング：LabTalk</b>)を参照してください。</p>
<p>これで、<b>Origin C関数</b>チュートリアルを終了します。</p>
