<h1 class="firstheading">コードビルダでプログラミング</h1>
<p><span class="OIndex" style="display: none;">Xファンクション, コードビルダでコーディング</span> 
 コードビルダボタン<a class="image"><img alt="Ocguide xfdialog codebuilderbutton.png" 
								 src="../images/Programming_in_Code_Builder/Ocguide_xfdialog_codebuilderbutton.png" 
								 width="23" height="23" border="0" /></a>をクリックしてコードビルダでXファンクションを開くとOrigin 
 C のコードを記述できます。</p>
<table id="toc" class="toc">
	<tr>
		<td><div id="toctitle">
			<h2>内容</h2>
		</div>
		<ol>
			<li class="toclevel-1 tocsection-1"><a href="#Editor_Window"><span 
			 class="tocnumber">1</span> <span class="toctext">編集ウィンドウ</span></a></li>
			<li class="toclevel-1 tocsection-2"><a href="#Include_header_Files"><span 
			 class="tocnumber">2</span> <span class="toctext">ヘッダファイルをインクルードする</span></a> 
			 
			<ol>
				<li class="toclevel-2 tocsection-3"><a href="#Search_Paths"><span 
				 class="tocnumber">2.1</span> <span class="toctext">検索パス</span></a></li>
				<li class="toclevel-2 tocsection-4"><a href="#X-Function.2C_Auto_Compile_Dependent_FilesAuto_Compile_Dependent_Files"><span 
				 class="tocnumber">2.2</span> <span class="toctext"><span 
				 class="OIndex" style="display: none;">Xファンクション, 自動コンパイル依存ファイル</span> 
				 <?rh-ignored text="自動コンパイル依存ファイル" ?>自動コンパイル依存ファイル</span></a></li>
			</ol></li>
			<li class="toclevel-1 tocsection-5"><a href="#X-Function.2C_Add_Internal_FunctionsDefine_Internal_Functions"><span 
			 class="tocnumber">3</span> <span class="toctext"><span class="OIndex" 
			 style="display: none;">Xファンクション, 内部関数を追加</span>内部関数を定義する</span></a></li>
			<li class="toclevel-1 tocsection-6"><a href="#X-Function.2C_Main_FunctionMain_Function"><span 
			 class="tocnumber">4</span> <span class="toctext"><span class="OIndex" 
			 style="display: none;">Xファンクション, メイン関数</span> <?rh-ignored 
			 text="メイン関数" ?>メイン関数</span></a></li>
			<li class="toclevel-1 tocsection-7"><a href="#X-Function.2C_Event_Handling_FunctionsEvent_Handling_Functions"><span 
			 class="tocnumber">5</span> <span class="toctext"><span class="OIndex" 
			 style="display: none;">Xファンクション, イベントハンドリング関数</span> <?rh-ignored 
			 text="イベントハンドリング関数" ?>イベントハンドリング関数</span></a> 
			<ol>
				<li class="toclevel-2 tocsection-8"><a href="#before_executeX-Function.2C_before_execute"><span 
				 class="tocnumber">5.1</span> <span class="toctext">before_execute<span 
				 class="OIndex" style="display: none;">Xファンクション, before_execute</span></span></a></li>
				<li class="toclevel-2 tocsection-9"><a href="#make_treeX-Function.2C_make_tree"><span 
				 class="tocnumber">5.2</span> <span class="toctext">make_tree<span 
				 class="OIndex" style="display: none;">Xファンクション, make_tree</span></span></a></li>
				<li class="toclevel-2 tocsection-10"><a href="#event1_and_event1_ex"><span 
				 class="tocnumber">5.3</span> <span class="toctext">event1 
				 及び event1_ex</span></a></li>
				<li class="toclevel-2 tocsection-11"><a href="#X-Function.2C_Event_Handler_Functions_in_Preview_DialogGetNGraphPreview_Event_Handler_Functions"><span 
				 class="tocnumber">5.4</span> <span class="toctext"><span 
				 class="OIndex" style="display: none;">Xファンクション, プレビューダイアログでのイベントハンドラー関数</span>GetNGraphPreview 
				 イベントハンドラー関数</span></a></li>
				<li class="toclevel-2 tocsection-12"><a href="#X-Function.2C_Event_Handler_Functions_in_Image_DialogGetNImageBox_Event_Handler_Functions"><span 
				 class="tocnumber">5.5</span> <span class="toctext"><span 
				 class="OIndex" style="display: none;">Xファンクション, プレビューダイアログでのイベントハンドラー関数</span>GetNImageBox 
				 イベントハンドラー関数</span></a></li>
			</ol></li>
			<li class="toclevel-1 tocsection-13"><a href="#X-Function.2C_Error_HandlingError_Handling"><span 
			 class="tocnumber">6</span> <span class="toctext"><span class="OIndex" 
			 style="display: none;">Xファンクション, エラーハンドリング</span> <?rh-ignored 
			 text="エラーハンドリング" ?>エラーハンドリング</span></a> 
			<ol>
				<li class="toclevel-2 tocsection-14"><a href="#X-Function.2C_Display_Error_Message_on_DialogDisplay_an_Error_Message_in_the_Dialog"><span 
				 class="tocnumber">6.1</span> <span class="toctext"><span 
				 class="OIndex" style="display: none;">Xファンクション, ダイアログにエラーメッセージを表示</span>ダイアログ内にエラーメッセージを表示する</span></a></li>
				<li class="toclevel-2 tocsection-15"><a href="#X-Function.2C_Output_Error_MessageOutput_Error_Message"><span 
				 class="tocnumber">6.2</span> <span class="toctext"><span 
				 class="OIndex" style="display: none;">Xファンクション, エラーメッセージを出力する</span>エラーメッセージを出力する</span></a></li>
			</ol></li>
		</ol></td>
	</tr>
</table>
<a name="Editor_Window" id="Editor_Window"></a> 
<h2><span class="mw-headline">編集ウィンドウ</span></h2>
<p>編集ウィンドウ上部付近に2つのボタン、コンパイルボタン<a class="image"><img alt="Ocguide XF Compile Button.PNG" 
													 src="../images/Programming_in_Code_Builder/Ocguide_XF_Compile_Button.PNG" 
													 width="107" height="24" 
													 border="0" /></a>とダイアログに戻るボタン<a 
	 class="image"><img alt="Ocguide XF Returntodialog Button.PNG" src="../images/Programming_in_Code_Builder/Ocguide_XF_Returntodialog_Button.PNG" 
						 width="107" height="24" border="0" /></a>があります。コンパイルボタンは、XファンクションのOrigin 
 Cコードをコンパイルするのに使用します。ダイアログに戻るボタンは、編集ウィンドウを閉じ、Xファンクションビルダダイアログに戻ります。</p>
<p>編集ウィンドウでは、いくつかのOrigin Cコードの背景が灰色になっています。これらのコードは読み取り専用で、変更できません。Xファンクションフレームワークはこの部分のコードを生成し、この部分は必須シンタックスになっています。</p>
<a name="Include_header_Files" id="Include_header_Files"></a> 
<h2><span class="mw-headline">ヘッダファイルをインクルードする</span></h2>
<p>XファンクションのOrigin Cコードに追加のヘッダファイルをインクルードできます。特別な理由がなければ、追加のヘッダファイルはファイルの上部の次の行の下にインクルードすることをお勧めします。</p>
<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">//put additional include files here</span>
</pre>
<p>この行の下にヘッダファイルをインクルードする事で、ファイルを整理して他のXファンクションと一貫性を持たせられます。</p>
<a name="Search_Paths" id="Search_Paths"></a> 
<h3><span class="mw-headline">検索パス</span></h3>
<p><span class="OIndex" style="display: none;">Xファンクション, ヘッダファイルのインクルード</span>&lt; 
 と &gt; のブラケットを使ってファイルをインクルードすると、そのファイルは、Origin インストールフォルダのOrigin C\Systemフォルダからインクルードされます。相対パスを使って、Systemフォルダの上位のフォルダに移動することもできます。これらのブラケットは、 
 .c および .cpp ファイルをコンパイルするときに同じ動作をします。</p>
<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">// &quot;OriginC\System&quot;フォルダにあるfft_utils.hをインクルード</span>
#include <span style="color: #000080;">&lt;</span>fft_utils.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
&#160;<span style="color: #008000;">
// &quot;OriginC\OriginLab&quot;フォルダにあるabffiles.hをインクルード</span>
#include <span style="color: #000080;">&lt;</span>..\OriginLab\abffiles.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span> <span style="color: #008000;">// 相対パス</span>
</pre>
<p>ダブルクオテーション(&quot;&quot;)を使ってファイルをインクルードすると、それらのファイルは、ユーザファイルフォルダの「Origin 
 C\X-Functions」フォルダからインクルードされます。この動作は、Origin Cで .c または .cpp ファイルをコンパイルするときとは異なります。この動作の違いが必要なのは、XファンクションがOriginによって維持される場所にインストールされるためです。</p>
<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">// ユーザファイルフォルダの &quot;OriginC\X-Functions&quot;フォルダに</span><span style="color: #008000;">
// あるmyOtherheader.hファイル</span>
#include <span style="color: #ff00ff;">&quot;myOtherheader.h&quot;</span>
</pre>
<p>絶対パスをダブルクオテーションで囲んで指定すると、そのファイルはファイルの場所を無視してインクルードされます。</p>
<a name="X-Function.2C_Auto_Compile_Dependent_FilesAuto_Compile_Dependent_Files" 
	 id="X-Function.2C_Auto_Compile_Dependent_FilesAuto_Compile_Dependent_Files"></a> 
 
<h3><span class="mw-headline"><span class="OIndex" style="display: none;">Xファンクション, 
 自動コンパイル依存ファイル</span> 自動コンパイル依存ファイル</span></h3>
<p>Xファンクションビルダのツリービューで、自動コンパイル依存ファイルというオプションがあります。このオプションをオンにすると、コンパイラはインクルードされた.hファイルと同じ名前を持つ.c 
 または .cpp ファイルをチェックします。 .c または .cpp ファイルが見つかったら、ロードされ、コンパイルされます。</p>
<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">// &quot;OriginC\Originlab&quot;フォルダにあるgraph_utils.hをインクルード</span><span style="color: #008000;">
// 自動コンパイル依存ファイルがオンの場合</span><span style="color: #008000;">
// 同じフォルダにあるgraph_utils.cファイルをロードし、コンパイル</span>
#include <span style="color: #000080;">&lt;</span>..\Originlab\graph_utils.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
</pre>
<a name="X-Function.2C_Add_Internal_FunctionsDefine_Internal_Functions" 
	 id="X-Function.2C_Add_Internal_FunctionsDefine_Internal_Functions"></a> 
 
<h2><span class="mw-headline"><span class="OIndex" style="display: none;">Xファンクション, 
 内部関数を追加</span>内部関数を定義する</span></h2>
<p>他のプログラミング言語に対しても同様ですが、関数をより明確に読みやすく、作成したコードが将来でも理解しやすく、なおかつメンテナンスしやすくするために、長い関数を機能的に独立させて分割し、短い構造にすることをお勧めします。Xファンクションでは、これらの短い関数を次の行の後にキーワード 
 static を持つ内部関数のように追加可能です。</p>
<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">//put your own support static functions here</span>
</pre>
<p>例えば、GUIとのやり取りが多くあるXファンクションでは、多くのコードは <i>xfname</i>_event1( )で必要とされ、Originのinterp1 
 Xファンクションに似たスタティック関数を追加できます。</p>
<pre class="oc" style="font-family: monospace;">
static void _update_method_show<span style="color: #000000;">(</span>TreeNode<span style="color: #000040;">&amp;</span> trGetN<span style="color: #000000;">)</span>
</pre>
<p>ご覧のように、アンダーバーを使って関数名のコンポーネントを分割した表記にすることをお勧めします。</p>
<a name="X-Function.2C_Main_FunctionMain_Function" id="X-Function.2C_Main_FunctionMain_Function"></a> 
 
<h2><span class="mw-headline"><span class="OIndex" style="display: none;">Xファンクション, 
 メイン関数</span> メイン関数</span></h2>
<p>メイン関数は、Xファンクションの主要な操作を実行するすべてのコードを配置します。</p>
<p>Xファンクションのメイン関数は、XファンクションビルダでXファンクションと同じ名前を持ちます。例えば、Xファンクションに <b>myXFunc</b> 
 という名前を付けると、メイン関数も <b>myXFunc</b>という名前になります。</p>
<p>メイン関数に渡される引数は、Xファンクションビルダダイアログにリストされた変数です。Inputとしてセットされるすべての変数は、定数の参照で渡され、OutputまたはInput/Outputとしてセットされる変数は書き換え可能な参照として渡されます。</p>
<a name="X-Function.2C_Event_Handling_FunctionsEvent_Handling_Functions" 
	 id="X-Function.2C_Event_Handling_FunctionsEvent_Handling_Functions"></a> 
 
<h2><span class="mw-headline"><span class="OIndex" style="display: none;">Xファンクション, 
 イベントハンドリング関数</span> イベントハンドリング関数</span></h2>
<p>Xファンクションのソースコードは、さまざまなイベントを取り扱うために使用する関数を含みます。各イベントハンドラー関数の名前は、Xファンクションの名前がプレフィックスとなり、アンダーバーの後にイベント名となります。例えば、Xファンクションの名前が 
 <b>myXFunc</b> の場合、<b>before_execute</b> イベントハンドラー関数は <b>myXFunc_before_execute</b>という名前になります。</p>
<p>以下は、イベントの一覧です。</p>
<ul>
	<li>before_execute</li>
	<li>event1</li>
	<li>event1_ex</li>
	<li>make_tree</li>
</ul>
<p>デフォルトで、すべてのイベントハンドラー関数は空です。デフォルトの動作を変更したり、イベントに追加の処理を行う時のみ、イベントハンドラー関数にコードを追加します。</p>
<p>次のセクションは、各イベントハンドラーの目的、渡される関数、戻り型など詳細について説明しています。</p>
<a name="before_executeX-Function.2C_before_execute" id="before_executeX-Function.2C_before_execute"></a> 
 
<h3><span class="mw-headline">before_execute<span class="OIndex" style="display: none;">Xファンクション, 
 before_execute</span></span></h3>
<p>この関数は、メイン関数の実行前に2回、3回呼び出されます。</p>
<p><b style="font-weight: bold;">プロトタイプ</b></p>
<pre class="oc" style="font-family: monospace;">
void xfname_before_execute<span style="color: #000000;">(</span>TreeNode<span style="color: #000040;">&amp;</span> trGetN, int nGetNDialog, int<span style="color: #000040;">&amp;</span> nRet, int dwCntrl<span style="color: #000000;">)</span>
</pre>
<p><b style="font-weight: bold;">パラメータ</b></p>
<p><u style="text-decoration: underline; ">trGetN</u></p>
<p>Xファンクションに渡される変数を含むツリーノードです。</p>
<p><u style="text-decoration: underline; ">nGetNDialog</u></p>
<p>関数が呼ばれるときに示される整数値です。</p>
<p>0より大きい値は、関数のダイアログを表示する前に呼ばれることを示します。これは、メニューから<b>ダイアログを開く</b>を選んだり、プログラムで 
 <b>-d</b> オプションを付けてXファンクションを呼び出したり、手動再計算を行うために<b>パラメータの変更</b>を選ぶときに発生します。</p>
<table class="simple">
	<tr>
		<th>値</th>
		<th>ダイアログを開く前</th>
	</tr>
	<tr>
		<td>1</td>
		<td>単純GetNBox</td>
	</tr>
	<tr>
		<td>2</td>
		<td>プレビュー付きGetNGraphBox</td>
	</tr>
	<tr>
		<td>3</td>
		<td>GetNImageBox</td>
	</tr>
</table>
<p>-1という値は、ユーザがOKボタンを押すことによって、ダイアログが閉じたことを示しています。</p>
<p>0という値は、メイン関数が呼ばれようとしていることを示しています。</p>
<p><u style="text-decoration: underline; ">nRet</u></p>
<p>このオプションは、Xファンクションの実行状態を制御できます。</p>
<pre class="oc" style="font-family: monospace;">
XFEVT_PROCEED &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span> <span style="color: #008000;">// 通常の実行を続ける</span>
XFEVT_ABORT &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span> <span style="color: #008000;">// 実行中止</span>
XFEVT_PROCEED_NO_DLG &#160;<span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span> <span style="color: #008000;">// ダイアログを開かずに実行</span>
</pre>
<p><u style="text-decoration: underline; ">dwCntrl</u></p>
<p>このオプションは、このXファンクションがどのようにアクセスされるかを決めるのに使用できます。可能な値は、次のようになります。</p>
<pre class="oc" style="font-family: monospace;">
LTXF_FROM_GUI_MENU &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #008000;">// メニューからアクセス</span>
LTXF_FROM_GUI_PROMPT &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #008000;">// コマンドウィンドウからアクセス</span>
LTXF_FROM_AUTO_UPDATE &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #008000;">// 自動更新でアクセス</span>
LTXF_FROM_FUNCTION &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #008000;">// Origin C関数からアクセス</span>
LTXF_THEME_USED &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #008000;">// テーマを使用</span>
LTXF_CHANGE_PARAM &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #008000;">// パラメータ変更でアクセス</span>
</pre>
<p>次のサンプルは、Xファンクションがコマンドウィンドウからアクセスし、テーマを使用する方法を示しています。(コマンドウィンドウに <b><i>xfname</i> 
 -t</b> <i><b>themename</b></i> と入力)</p>
<pre class="oc" style="font-family: monospace;">
if<span style="color: #000000;">(</span><span style="color: #000040;">!</span><span style="color: #000000;">(</span>dwCntrl <span style="color: #000040;">&amp;</span> LTXF_FROM_GUI_PROMPT<span style="color: #000000;">)</span> <span style="color: #000040;">&amp;&amp;</span> <span style="color: #000000;">(</span>dwCntrl <span style="color: #000040;">&amp;</span> LTXF_THEME_USED<span style="color: #000000;">)</span><span style="color: #000000;">)</span><span style="color: #000000;">
{</span>
&#160;&#160;&#160;&#160;<span style="color: #008000;">// このケースを取り扱い</span><span style="color: #000000;">
}</span></pre>
<a name="make_treeX-Function.2C_make_tree" id="make_treeX-Function.2C_make_tree"></a> 
 
<h3><span class="mw-headline">make_tree<span class="OIndex" style="display: none;">Xファンクション, 
 make_tree</span></span></h3>
<p>この関数は、Xファンクションに渡される各ツリーノード変数に対して1回呼び出されます。呼び出しは、<b>before_execute</b> 
 関数が呼ばれる前に起こります。</p>
<p><b style="font-weight: bold;">プロトタイプ</b></p>
<pre class="oc" style="font-family: monospace;">
int xfname_make_tree<span style="color: #000000;">(</span>TreeNode<span style="color: #000040;">&amp;</span> tr, LPCSTR lpcszVarName<span style="color: #000000;">)</span>
</pre>
<p><b style="font-weight: bold;">戻り値</b></p>
<p>ダイアログを更新するには0、ダイアログを更新しない場合は-1を返します。デフォルトの動作では-1を返します。</p>
<p><b style="font-weight: bold;">パラメータ</b></p>
<p><u style="text-decoration: underline; ">tr</u></p>
<p>作成されるツリーノードです。これはXファンクションの入力TreeNode型で定義される必要があります。</p>
<p><u style="text-decoration: underline; ">lpcszVarName</u></p>
<p>TreeNode変数の名前を示します。</p>
<a name="event1_and_event1_ex" id="event1_and_event1_ex"></a> 
<h3><span class="mw-headline">event1 及び event1_ex</span></h3>
<p><span class="OIndex" style="display: none;">Xファンクション, event1</span> 
 これらは、主要なイベントハンドリング関数です。これらはダイアログの初期化、ダイアログ内の設定の変更、ボタンクリックなど、どんなイベントでも呼ばれます。これらの関数は、単純GetNダイアログを持つXファンクションでのみ使われます。グラフプレビュー付き、イメージプレビュー付きのXファンクションは、後のセクションで説明する異なるイベントハンドラー関数を使用します。</p>
<p><b style="font-weight: bold;">プロトタイプ</b></p>
<pre class="oc" style="font-family: monospace;">
int xfname_event1<span style="color: #000000;">(</span>TreeNode<span style="color: #000040;">&amp;</span> trGetN, int nRow, int nEventID, DWORD<span style="color: #000040;">&amp;</span> dwEnables,
&#160;&#160;&#160;&#160;LPCSTR lpcszNodeName, WndContainer<span style="color: #000040;">&amp;</span> DynaCntrlContainer,
&#160;&#160;&#160;&#160;string<span style="color: #000040;">&amp;</span> strAux, string<span style="color: #000040;">&amp;</span> strErrMsg<span style="color: #000000;">)</span>
</pre>
<p><b style="font-weight: bold;">戻り値</b></p>
<p>Trueが返されると、ダイアログが更新されます。</p>
<p><b style="font-weight: bold;">パラメータ</b></p>
<p><u style="text-decoration: underline; ">trGetN</u></p>
<p>これは、Xファンクションで定義する変数のツリーノードです。</p>
<p><u style="text-decoration: underline; ">nRow</u></p>
<p>ツリーノード trGetNで値変更コントロール行のインデックスです。 コントロール値が変更しないというイベントのとき、値は-1です。</p>
<p><u style="text-decoration: underline; ">nEventID</u></p>
<p>イベントタイプのID、例えばGETNE_ON_INIT, GETNE_ON_THEME等です。</p>
<p><u style="text-decoration: underline; ">dwEnables</u></p>
<p>このパラメータは、OKボタン、適用ボタン、その他カスタムボタンを有効または無効にするのに使います。これはデフォルトでTrueで、ユーザの設定が無効の時Falseにセットされ、OKボタンと適用ボタンが無効になります。</p>
<p><u style="text-decoration: underline; ">lpcszNodeName</u></p>
<p>イベントがダイアログのコントロールの変更によって生成されると、このコントロールの変数名になります。それ以外の場合、空の文字列になります。</p>
<p><u style="text-decoration: underline; ">DynaCntrlContainer</u></p>
<p>Xファンクションのダイアログウィンドウを入れるコンテナです。</p>
<p><u style="text-decoration: underline; ">strAux</u></p>
<p>このパラメータは、補助的な文字列で、高度な利用を行うためのものです。以下の定義のように、詳細はヘッダファイル&lt;Originのインストールフォルダ&gt;\OriginC\System\GetNBox.hをご覧ください。</p>
<pre class="oc" style="font-family: monospace;">
#define DLG_NEED_CHANGE_GRID <span style="color: #ff00ff;">&quot;GETN_CHANGE_GRID&quot;</span>
#define GETN_CHANGE_GRID &#160;set_aux_value<span style="color: #000000;">(</span>strAux, DLG_NEED_CHANGE_GRID<span style="color: #000000;">)</span>;
</pre>
<p><u style="text-decoration: underline; ">strErrMsg</u></p>
<p>これは、ダイアログの下に表示される文字列のメッセージです。これは通常、変数値の入力中に発生するエラーをユーザに通知するのに使います。</p>
<a name="X-Function.2C_Event_Handler_Functions_in_Preview_DialogGetNGraphPreview_Event_Handler_Functions" 
	 id="X-Function.2C_Event_Handler_Functions_in_Preview_DialogGetNGraphPreview_Event_Handler_Functions"></a> 
 
<h3><span class="mw-headline"><span class="OIndex" style="display: none;">Xファンクション, 
 プレビューダイアログでのイベントハンドラー関数</span>GetNGraphPreview イベントハンドラー関数</span></h3>
<p><b style="font-weight: bold;">event1</b> および <b>event1_ex</b> イベントハンドラー関数は、グラフプレビュー付きのXファンクションで使われません。代わりに、<b>GetNGraphPreview</b> 
 関数を使用します。</p>
<ul>
	<li>GetNGraphPreview_OnInitGrid</li>
</ul>
<dl>
	<dd>このイベント関数は、ダイアログのコントロールを初期化するのに使用します。</dd>
</dl>
<ul>
	<li>GetNGraphPreview_OnInitGraph</li>
</ul>
<dl>
	<dd>このイベント関数はプレビューグラフを起動する時に使用します。</dd>
</dl>
<ul>
	<li>GetNGraphPreview_OnUpdateGraph</li>
</ul>
<dl>
	<dd>イベント関数は、別のイベント、例えばGUIが変わったことでプロビューグラフを更新するのに使います。</dd>
</dl>
<ul>
	<li>GetNGraphPreview_OnChange</li>
</ul>
<dl>
	<dd>設定などの変更はこのイベント関数のトリガーになり、この関数はプレビューグラフを更新するか、この変更によりダイアログを更新するか決定します。</dd>
</dl>
<ul>
	<li>GetNGraphPreview_OnDialogSetup</li>
	<li>GetNGraphPreview_OnDestroy</li>
	<li>GetNGraphPreview_OnCustomButton</li>
</ul>
<p><br />
グラフプレビューダイアログを持つXファンクションを作成する方法のサンプルは、<b><a href="../../XFunction/X-Function/Creating_Graph_Preview_GetN_Dialog.html" 
											 title="X-Function:GetNダイアログでグラフプレビューを作成">GetNダイアログでグラフプレビューを作成</a></b> 
 セクションをご覧ください。</p>
<a name="X-Function.2C_Event_Handler_Functions_in_Image_DialogGetNImageBox_Event_Handler_Functions" 
	 id="X-Function.2C_Event_Handler_Functions_in_Image_DialogGetNImageBox_Event_Handler_Functions"></a> 
 
<h3><span class="mw-headline"><span class="OIndex" style="display: none;">Xファンクション, 
 プレビューダイアログでのイベントハンドラー関数</span>GetNImageBox イベントハンドラー関数</span></h3>
<p><b style="font-weight: bold;">event1</b> および <b>event1_ex</b> イベントハンドラー関数は、イメージプレビュー付きのXファンクションで使われません。代わりに、<b>GetNImageBox</b> 
 関数を使用します。</p>
<ul>
	<li>GetNImageBox_OnInit</li>
</ul>
<dl>
	<dd>イベント関数はイメージGetNダイアログが開いた時に呼び出されます。関数は、ダイアログを更新したり、OKボタンを有効または無効にするか、呼び出した後、ダイアログの下部にエラーメッセージを表示するかどうかを決定します。</dd>
</dl>
<ul>
	<li>GetNImageBox_OnChange</li>
</ul>
<dl>
	<dd>ユーザがダイアログのコントロールを変更するときにはいつでもイベント関数が呼ばれます。関数は、ダイアログを更新したり、イメージプレビューを更新したり、OKボタンを有効または無効にするか、呼び出した後、ダイアログの下部にエラーメッセージを表示するかどうかを決定します。</dd>
</dl>
<p>イメージプレビューダイアログを持つXファンクションを作成する方法のサンプルは、<b><a href="../../XFunction/X-Function/Creating_Image_GetN_Dialog.html" 
												 title="Xファンクション：イメージGetNダイアログを作成">イメージGetNダイアログでグラフプレビューを作成</a></b> 
 セクションをご覧ください。</p>
<a name="X-Function.2C_Error_HandlingError_Handling" id="X-Function.2C_Error_HandlingError_Handling"></a> 
 
<h2><span class="mw-headline"><span class="OIndex" style="display: none;">Xファンクション, 
 エラーハンドリング</span> エラーハンドリング</span></h2>
<a name="X-Function.2C_Display_Error_Message_on_DialogDisplay_an_Error_Message_in_the_Dialog" 
	 id="X-Function.2C_Display_Error_Message_on_DialogDisplay_an_Error_Message_in_the_Dialog"></a> 
 
<h3><span class="mw-headline"><span class="OIndex" style="display: none;">Xファンクション, 
 ダイアログにエラーメッセージを表示</span>ダイアログ内にエラーメッセージを表示する</span></h3>
<p>ユーザが悪い値を <b>-d</b> オプションと一緒にXファンクションに渡したり、Xファンクションダイアログに悪い値を入力した時に、イベントハンドラー関数に渡されるstrErrMsg引数をセットしておくと、ダイアログにエラーメッセージを表示します。</p>
<p>どのイベントハンドラー関数が呼ばれるかはXファンクションが使用しているGetNダイアログに依存します。</p>
<table class="simple">
	<tr>
		<th>使用されるGetNダイアログ</th>
		<th>イベントハンドラー関数</th>
	</tr>
	<tr>
		<td>単純GetNBox</td>
		<td>xfname_event1</td>
	</tr>
	<tr>
		<td>プレビュー付きGetNGraphBox</td>
		<td>GetNGraphPreview_OnChange</td>
	</tr>
	<tr>
		<td>GetNImageBox</td>
		<td>GetNImageBox_OnChange</td>
	</tr>
</table>
<p><b style="font-weight: bold;">x1</b>という整数型の変数を受け付けるXファンクションがあるとします。次のコードを適切なイベントハンドラー関数に挿入すると、変数 
 <b>x1</b> の値が0以下か100以上かをチェックします。ダイアログで表示するためにstrErrMsgを適切なメッセージにセットすると、OKボタンを無効にします。値が受け入れられる範囲内にある場合、OKボタンが有効になります。</p>
<pre class="oc" style="font-family: monospace;">
if<span style="color: #000000;">(</span> trGetN.<span style="color: #000000;">x1</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">0</span> <span style="color: #000040;">||</span> <span style="color: #0000dd;">100</span> <span style="color: #000080;">&lt;</span> trGetN.<span style="color: #000000;">x1</span>.<span style="color: #000000;">nVal</span> <span style="color: #000000;">)</span><span style="color: #000000;">
{</span>
&#160;&#160;&#160;&#160;strErrMsg <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;x1 is out of range.Must be from zero to 100.&quot;</span>;
&#160;&#160;&#160;&#160;bOKEnable <span style="color: #000080;">=</span> false;<span style="color: #000000;">
}</span>
else
&#160;&#160;&#160;&#160;bOKEnable <span style="color: #000080;">=</span> true;
</pre>
<a name="X-Function.2C_Output_Error_MessageOutput_Error_Message" id="X-Function.2C_Output_Error_MessageOutput_Error_Message"></a> 
 
<h3><span class="mw-headline"><span class="OIndex" style="display: none;">Xファンクション, 
 エラーメッセージを出力する</span>エラーメッセージを出力する</span></h3>
<p>Xファンクションがプログラムで呼ばれてそのダイアログボックスは表示されないので、エラーが発生したことをユーザに通知するため別の方法が必要になります。Origin 
 Cは、エラーメッセージを 結果ログ、コマンドウィンドウ、スクリプトウィンドウに出力するマクロを定義しています。out_str またはprintfではなく、これらのマクロを使用することを強くお勧めします。</p>
<p><span class="OIndex">XF_WARN マクロ</span><span class="OIndex" style="display: none;">Xファンクション, 
 出力警告メッセージ</span>は警告メッセージを出力しますが、実行は停止しません。 これら3つのマクロは、最初の引数として警告メッセージを含む文字列を受け付けます。他の引数を受け付ける2つのマクロは、警告メッセージが1つまたは2つの値のフォーマット文字列であるものとします。</p>
<ul>
	<li>XF_WARN(msg)</li>
	<li>XF_WARN_EX(msg, arg1)</li>
	<li>XF_WARN_EX2(msg, arg1, arg2)</li>
</ul>
<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">// 以下を仮定する</span><span style="color: #008000;">
// #define MIN_DATA_POINTS 5</span><span style="color: #008000;">
// int nNumPts = 3;</span><span style="color: #008000;">
// string strWksName = &quot;Book1&quot;;</span>
XF_WARN<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Too few data points.&quot;</span><span style="color: #000000;">)</span>;
XF_WARN_EX<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Number of data points less than %d.&quot;</span>, MIN_DATA_POINTS<span style="color: #000000;">)</span>;
XF_WARN_EX<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Worksheet named %s was not found.&quot;</span>, strWksName<span style="color: #000000;">)</span>;
XF_WARN_EX2<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Only %d data points, need at least %d.&quot;</span>, nNumPts, MIN_DATA_POINTS<span style="color: #000000;">)</span>;
</pre>
<p><span class="OIndex">XF_TRACE マクロ</span>は、実行停止しないという点でXF_WARNマクロに似ています。最初の引数に対するメッセージを取ることもできますが、追加の引数もいくつでも取ることができます。</p>
<ul>
	<li>XF_TRACE(msg, ...)</li>
</ul>
<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">// 以下を仮定する</span><span style="color: #008000;">
// #define MIN_DATA_POINTS 5</span><span style="color: #008000;">
// int nNumPts = 3;</span><span style="color: #008000;">
// string strWksName = &quot;Book1&quot;;</span>
XF_TRACE<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Only %d data points found in %s, need at least %d.&quot;</span>,
&#160;&#160;&#160;&#160;nNumPts, strWksName, MIN_DATA_POINTS<span style="color: #000000;">)</span>;
</pre>
<p><span class="OIndex">XF_THROW マクロ</span><span class="OIndex" style="display: none;">Xファンクション, 
 ランタイムエラーの取り扱い</span>は実行を停止しますが、それ以外はXF_WARN マクロと同じです。これら3つのマクロは、最初の引数として警告メッセージを含む文字列を受け付けます。他の引数を受け付ける2つのマクロは、警告メッセージが1つまたは2つの値のフォーマット文字列であるものとします。</p>
<ul>
	<li>XF_THROW(msg)</li>
	<li>XF_THROW_EX(msg, arg1)</li>
	<li>XF_THROW_EX2(msg, arg1, arg2)</li>
</ul>
<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">// 以下を仮定する</span><span style="color: #008000;">
// #define MIN_DATA_POINTS 5</span><span style="color: #008000;">
// int nNumPts = 3;</span><span style="color: #008000;">
// string strWksName = &quot;Book1&quot;;</span>
XF_THROW<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Too few data points.&quot;</span><span style="color: #000000;">)</span>;
XF_THROW_EX<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Number of data points less than %d.&quot;</span>, MIN_DATA_POINTS<span style="color: #000000;">)</span>;
XF_THROW_EX<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Worksheet named %s was not found.&quot;</span>, strWksName<span style="color: #000000;">)</span>;
XF_THROW_EX2<span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Only %d data points, need at least %d.&quot;</span>, nNumPts, MIN_DATA_POINTS<span style="color: #000000;">)</span>;
</pre>

