<h1 class="firstheading">GetNダイアログのグラフプレビューを作成</h1><p><span class="OIndex" style="display:none">GetN Graph Preview Dialog</span>
このセクションはXファンクションのGetNダイアログのグラフプレビューを作成する方法を示します。これはプレビューグラフの起動、GUIの変更をプレビューグラフで更新、グラフ上で四角形が移動された時にどのよううにGUIを更新するか、等を含みます。 
</p><p><a  class="image"><img alt="Ocguide xf graphpreview dialog.png" src="../images/Creating_Graph_Preview_GetN_Dialog/Ocguide_xf_graphpreview_dialog.png" width="535"  /></a>
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>目次</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Create_an_Empty_GetN_Graph_Preview_Dialog"><span class="tocnumber">1</span> <span class="toctext">空のGetN グラフプレビューダイアログを作成する </span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#X-Function.2C_Coding_in_Code_BuilderCoding_X-Function_in_Code_Builder"><span class="tocnumber">2</span> <span class="toctext"><span class="OIndex" style="display:none">X-Function, Coding in Code Builder</span>コードビルダでＸファンクションをコーディングする</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Initialize_Preview_Graph"><span class="tocnumber">3</span> <span class="toctext">プレビューグラフの初期化</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Update_Preview_Graph_on_GUI_Change"><span class="tocnumber">4</span> <span class="toctext">GUI変更時にプレビューグラフを更新</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Update_GUI_on_Graph_Object_Event"><span class="tocnumber">5</span> <span class="toctext">グラフオブジェクトイベントでGUIを更新</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Add_Preview_buttons"><span class="tocnumber">6</span> <span class="toctext">プレビューボタンを追加</span></a></li>
</ul>
</div>

<h2><a name="Create_an_Empty_GetN_Graph_Preview_Dialog"></a><span class="mw-headline">空のGetN グラフプレビューダイアログを作成する </span></h2>
<ul>
<li><b>ツール：Xファンクション・ビルダ</b>を選択するしてビルダを開きます。 </li>
<li>Ｘファンクション名として<b>PrevBox</b>を入力します。</li>
<li>変数リスト上で右クリックして<b>変数の追加</b>を選択して2つ目の変数を追加します。 </li>
<li>変数の名前、ラベル、他の値を次の画像と同じになるように入力します。 <br /><a  class="image"><img alt="Ocguide xf graphpreview variables.png" src="../images/Creating_Graph_Preview_GetN_Dialog/Ocguide_xf_graphpreview_variables.png" width="425"  /></a></li>
<li>ツリービューボタン<a  class="image"><img alt="Ocguide xf treeview button.png" src="../images/Creating_Graph_Preview_GetN_Dialog/Ocguide_xf_treeview_button.png" width="23"  /></a>をクリックします。<b>使用のコンテクスト→メニュー</b>にある<b>自動GetNダイアログ</b>のドロップダウンリストで<b>プレビュー付きGetNGraphBox</b>を選択します。</li>
<li><b>保存</b>ボタンをクリックして、このＸファンクションを<b>X-Functions-&gt; Miscellaneous</b>にサブフォルダに保存します。</li>
<li>Ｘファンクションビルダを閉じ、コマンドウィンドウで<b>prevbox -d</b> を実行します。グラフプレビュー付きのGetNダイアログが開きます。 </li>
</ul>
<h2><a name="X-Function.2C_Coding_in_Code_BuilderCoding_X-Function_in_Code_Builder"></a><span class="mw-headline"><span class="OIndex" style="display:none">X-Function, Coding in Code Builder</span>コードビルダでＸファンクションをコーディングする</span></h2>
<ul> コーディングを開始する際は、<b>Ｘファンクションビルダ</b>ダイアログでXファンクションをロードし、そこにある<b>コードビルダ</b>ボタンをクリックするのが最も簡単です。関連するXFCファイルがロードされ、上部の <b>コンパイル</b>と<b>ダイアログに戻る</b>ボタンが利用できます。また、コードビルダウィンドウで直接Ｘファンクションをロードすることもできます。
<li> Originで、<b>表示：コードビルダ</b>メニューを選択するか、<b>コードビルダ</b>ボタンをクリックしてコードビルダを開きます。
<li> コードビルダで、<b>ファイル：開く</b>メニューを選択し、対応するXファンクションサブフォルダ、例えば<b>User Files -&gt; X-Functions -&gt; Miscellaneous</b> を参照し、<b>PrevBox.OXF</b>を選択します。</li>
<li> <b>ワークスペースに追加</b>にチェックを付けます。<b>OK</b>ボタンをクリックします。
<li> <b>PrevBox.XFC</b>がOrigin CワークスペースのUserフォルダに追加されアクティブタブで表示されます。</li>
<li> <b>//put additional include files here</b>と書いてある行の後に、追加のヘッダファイルを追記します。例えば、
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">//put additional include files here</span>
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>..\Originlab\grobj_utils.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span></pre>
</li>
</ul>
<h2><a name="Initialize_Preview_Graph"></a><span class="mw-headline">プレビューグラフの初期化</span></h2>
<ul>
<li><b>GetNGraphPreview_OnInitGraph</b>はプレビューグラフを起動する時に使用します。以下のコードをコピーして、この関数本体の空の領域に貼り付けます。</li>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// cast pgTemp from PageBase class object to GraphPage object</span>
GraphPage gp<span style="color: #000000;">(</span>pgTemp<span style="color: #000000;">)</span>; 

<span style="color: #008000;">// load this template to the graph in order to contain zoom </span>
<span style="color: #008000;">// in/out button on the graph.If this is not required, </span>
<span style="color: #008000;">// remove this line.</span>
page_load<span style="color: #000000;">(</span>gp, <span style="color: #ff00ff;">&quot;CurvePreview&quot;</span><span style="color: #000000;">)</span>; 

<span style="color: #008000;">// get active graph layer in the graph page</span>
GraphLayer gl <span style="color: #000080;">=</span> gp.<span style="color: #000000;">Layers</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>; 

<span style="color: #008000;">// add a rectangle, set x position reference to xfrom and xto </span>
<span style="color: #008000;">// variables</span>
GraphObject go;
add_rect<span style="color: #000000;">(</span>gl, go, trGetN.<span style="color: #000000;">xfrom</span>.<span style="color: #000000;">dVal</span>, <span style="color: #0000dd;">0</span>, trGetN.<span style="color: #000000;">xto</span>.<span style="color: #000000;">dVal</span>, <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>, 
    SYSCOLOR_BLUE, <span style="color: #0000dd;">2</span>, LN_VERTICAL, <span style="color: #0000ff;">true</span>, <span style="color: #0000ff;">false</span><span style="color: #000000;">)</span>;</pre>
<li>コンパイルボタンをクリックします。</li>
<li>コードビルダの右下にある<b>コマンド_結果</b>ウィンドウを使用します。 </li>
<li><b>prevbox -d</b>と入力し、Enterキーを押してXファンクションのダイアログを開きます。グラフ内に青い四角形が表示されます。移動しても、X開始 と X終了の値はまだ更新されません。</li>
</ul>
<h2><a name="Update_Preview_Graph_on_GUI_Change"></a><span class="mw-headline">GUI変更時にプレビューグラフを更新</span></h2>
<ul><li>プレビューグラフの更新を促すには、<b>GetNGraphPreview_OnChange</b>関数のdwUpdateGraph 変数にUPDATE_GRAPH_CHANGED 部分を追加する必要があります。例えば、
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// include the bit to call GetNGraphPreview_OnUpdateGraph </span>
<span style="color: #008000;">// to update graph</span>
<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> <span style="color: #000040;">!</span><span style="color: #000000;">(</span>dwUpdateGraph <span style="color: #000040;">&amp;</span> UPDATE_GRAPH_CHANGED<span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
	dwUpdateGraph <span style="color: #000040;">|</span><span style="color: #000080;">=</span> UPDATE_GRAPH_CHANGED;</pre>
</li>
<li>以下のコードを<b>GetNGraphPreview_OnUpdateGraph</b> 関数に追加してグラフが更新されるようにします。コンパイルボタンをクリックし、コマンドウィンドウで「PrevBox -d」を実行します。 
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// cast pgTemp from PageBase class object to GraphPage </span>
<span style="color: #008000;">// object</span>
GraphPage gp<span style="color: #000000;">(</span>pgTemp<span style="color: #000000;">)</span>; 

GraphLayer gl <span style="color: #000080;">=</span> gp.<span style="color: #000000;">Layers</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>; <span style="color: #008000;">// get active graph layer </span>
GraphObject go <span style="color: #000080;">=</span> gl.<span style="color: #000000;">GraphObjects</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Rect&quot;</span><span style="color: #000000;">)</span>; 		

<span style="color: #0000ff;">double</span> x0 <span style="color: #000080;">=</span> trGetN.<span style="color: #000000;">xfrom</span>.<span style="color: #000000;">dVal</span>;
<span style="color: #0000ff;">double</span> x1 <span style="color: #000080;">=</span> trGetN.<span style="color: #000000;">xto</span>.<span style="color: #000000;">dVal</span>;

<span style="color: #008000;">// update x position of rectangle on GUI</span>
vector vv<span style="color: #000000;">(</span><span style="color: #0000dd;">4</span><span style="color: #000000;">)</span>;
vv<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> x0; vv<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> x1; vv<span style="color: #000000;">[</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> x1; vv<span style="color: #000000;">[</span><span style="color: #0000dd;">3</span><span style="color: #000000;">]</span> <span style="color: #000080;">=</span> x0;

Tree tr;
tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">Data</span>.<span style="color: #000000;">X</span>.<span style="color: #000000;">dVals</span> <span style="color: #000080;">=</span> vv;	
go.<span style="color: #000000;">UpdateThemeIDs</span><span style="color: #000000;">(</span>tr.<span style="color: #000000;">Root</span><span style="color: #000000;">)</span>;		
go.<span style="color: #000000;">ApplyFormat</span><span style="color: #000000;">(</span>tr, <span style="color: #0000ff;">true</span>, <span style="color: #0000ff;">true</span><span style="color: #000000;">)</span>;

<span style="color: #008000;">// refresh graph window</span>
gp.<span style="color: #000000;">Refresh</span><span style="color: #000000;">(</span><span style="color: #0000ff;">TRUE</span><span style="color: #000000;">)</span>;</pre>
</li>
</ul>
<h2><a name="Update_GUI_on_Graph_Object_Event"></a><span class="mw-headline">グラフオブジェクトイベントでGUIを更新</span></h2>
<p>プレビューグラフ上で四角形を移動/サイズ変更した時にGUIを更新するには、以下のように設定します。
</p>
<ul><li><b>GetNGraphPreview_OnInitGraph</b>関数の<b>add_rect</b> 関数の後に、次のコマンドを追加します。 
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// set event script to notify preview dialog when rectangle </span>
<span style="color: #008000;">// is moved or resized.For other event types see the GRCT_*</span>
<span style="color: #008000;">// in oc_const.h file.</span>
set_LT_script<span style="color: #000000;">(</span>go, <span style="color: #ff00ff;">&quot;run -oc notify_dlg_on_move_obj;&quot;</span>, 
              GRCT_SIZEMOVE<span style="color: #000000;">)</span>;</pre>
</li>
<li><b>GetNGraphPreview_OnChange</b>に以下のコードを追加して、GUI上の新しい位置に更新します。コンパイルボタンをクリックし、コマンドウィンドウで「PrevBox -d」を実行します。
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> bChangedByGraph <span style="color: #000000;">)</span>
<span style="color: #000000;">{</span>
	<span style="color: #008000;">// get rectangle x from/to and update GUI</span>
	GraphPage gp<span style="color: #000000;">(</span>pgTemp<span style="color: #000000;">)</span>;
	GraphLayer gl <span style="color: #000080;">=</span> gp.<span style="color: #000000;">Layers</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>;
	GraphObject goRect <span style="color: #000080;">=</span> gl.<span style="color: #000000;">GraphObjects</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;Rect&quot;</span><span style="color: #000000;">)</span>;
	
	Tree tr;
	tr <span style="color: #000080;">=</span> goRect.<span style="color: #000000;">GetFormat</span><span style="color: #000000;">(</span>FPB_DATA, FOB_ALL, <span style="color: #0000ff;">TRUE</span>, <span style="color: #0000ff;">TRUE</span><span style="color: #000000;">)</span>;
	
	vector vv;
	vv <span style="color: #000080;">=</span> tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">Data</span>.<span style="color: #000000;">X</span>.<span style="color: #000000;">dVals</span>;
	
	trGetN.<span style="color: #000000;">xfrom</span>.<span style="color: #000000;">dVal</span> <span style="color: #000080;">=</span> vv<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span>;
	trGetN.<span style="color: #000000;">xto</span>.<span style="color: #000000;">dVal</span> <span style="color: #000080;">=</span> vv<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>;
	
	<span style="color: #008000;">// to include UPDATE_GRID_* bits to update GUI</span>
	<span style="color: #0000ff;">if</span><span style="color: #000000;">(</span> <span style="color: #000040;">!</span><span style="color: #000000;">(</span>dwUpdateGrid <span style="color: #000040;">&amp;</span> UPDATE_GRID_SIMPLE<span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
		dwUpdateGrid <span style="color: #000040;">|</span><span style="color: #000080;">=</span> UPDATE_GRID_SIMPLE; 
<span style="color: #000000;">}</span></pre>
</li>
</ul>
<h2><a name="Add_Preview_buttons"></a><span class="mw-headline">プレビューボタンを追加</span></h2>
<p>プレビューボタンを追加したり自動プレビューチェックボックスを追加するには<a href="../../XFunction/X-Function/Adding_Custom_Button_on_Dialog.html#Show_Preview_Button_on_Graph_Preview_GetN_Dialog" title="X-Function:Adding Custom Button on Dialog">Xファンクション: Xファンクションのカスタマイズ: ダイアログにカスタムボタンを追加する: GetN グラフプレビューダイアログにプレビューボタンを表示する</a>を確認してください。
</p>






    