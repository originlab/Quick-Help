<h1 class="firstheading">Xファンクションのレポートデータサンプル</h1>
<table id="toc" class="toc">
	<tr>
		<td><div id="toctitle">
			<h2>内容</h2>
		</div>
		<ol>
			<li class="toclevel-1 tocsection-1"><a href="#Summary"><span 
			 class="tocnumber">1</span> <span class="toctext">サマリー</span></a></li>
			<li class="toclevel-1 tocsection-2"><a href="#You_will_learn"><span 
			 class="tocnumber">2</span> <span class="toctext">学習する項目</span></a></li>
			<li class="toclevel-1 tocsection-3"><a href="#Steps"><span 
			 class="tocnumber">3</span> <span class="toctext">ステップ</span></a></li>
			<li class="toclevel-1 tocsection-4"><a href="#Run_the_X-Function"><span 
			 class="tocnumber">4</span> <span class="toctext">Xファンクションを実行する</span></a></li>
		</ol></td>
	</tr>
</table>
<a name="Summary" id="Summary"></a> 
<h2><span class="mw-headline">サマリー</span></h2>
<p>このサンプルでは、複数XYデータセットを取得し、それぞれについて線形フィットを実行してフィットデータを新しい結果シートに出力します。</p>
<p>出力データ型はReportTreeのとき、ダイアログには、再計算コンボボックスが表示され、レポートシートの再計算モードを「手動」、「自動」、「なし」にセットできます。</p>
<a name="You_will_learn" id="You_will_learn"></a> 
<h2><span class="mw-headline">学習する項目</span></h2>
<ol>
	<li>複数XYデータセットで動作する方法</li>
	<li>再計算の鍵付きの新しい結果シートにデータをレポートする方法</li>
</ol>
<a name="Steps" id="Steps"></a> 
<h2><span class="mw-headline">ステップ</span></h2>
<ol start="1">
	<li>F10キーをおして、Xファンクションビルダを開き、Xファンクションの名前と変数を下図のように入力して、保存<a class="image"><img 
	 alt="Ocguide xfdialog savebutton.png" src="../images/X-Function_ReportData_Example/Ocguide_xfdialog_savebutton.png" 
	 width="23" height="23" border="0" /></a>をクリックします。<br />
	<a class="image"><img alt="OCguide xf example FitLinearReport.png" 
							 src="../images/X-Function_ReportData_Example/OCguide_xf_example_FitLinearReport.png" 
							 width="551" height="261" border="0" /></a></li>
	<li>このXファンクションをコードビルダで開き、ソースコードを編集します。まず、以下のように必要なヘッダファイルを含めます。 
	<pre class="oc" style="font-family: monospace;">
#include <span style="color: #000080;">&lt;</span>ReportTree.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span> <span style="color: #008000;">// ReportTableクラスに必要</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</pre></li>
	<li><i style="font-style: italic;">//put your own support static functions 
	 here</i>という行の下に、必要なマクロを追加します。このマクロは、Xファンクションのメイン関数で使用されます。 
	<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">// ID はどの値でも良いが、固有である必要がある</span>
#define TABLE_ID &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #0000dd;">1</span>
#define SUBNODE_ID_BEGIN &#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #0000dd;">1000</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</pre></li>
	<li>Xファンクションのメイン関数<i>FitLinearReport</i>に以下のコードを追加し、指定したデータ範囲からXYデータを取得し、それぞれ線形フィットしてレポートシートを作成します。 
	 
	<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">// レポート表を作成</span>
ReportTable &#160;&#160;&#160;&#160;rt; &#160;&#160;&#160;&#160;
rt <span style="color: #000080;">=</span> rd.<span style="color: #000000;">CreateTable</span><span style="color: #000000;">(</span><span style="color: #ff00ff;">&quot;ReportData&quot;</span>, <span style="color: #ff00ff;">&quot;Fitted Data&quot;</span>, TABLE_ID<span style="color: #000000;">)</span>; &#160;&#160;
int nSubID <span style="color: #000080;">=</span> SUBNODE_ID_BEGIN;
&#160;
DWORD dwRules <span style="color: #000080;">=</span> DRR_GET_DEPENDENT <span style="color: #000040;">|</span> DRR_NO_FACTORS;
int nNumData <span style="color: #000080;">=</span> iy.<span style="color: #000000;">GetNumData</span><span style="color: #000000;">(</span>dwRules<span style="color: #000000;">)</span>;
&#160;
for<span style="color: #000000;">(</span>int nRange <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; nRange <span style="color: #000080;">&lt;</span> nNumData; nRange<span style="color: #000040;">++</span><span style="color: #000000;">)</span><span style="color: #000000;">
{</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DataRange drOne;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;iy.<span style="color: #000000;">GetSubRange</span><span style="color: #000000;">(</span>drOne, dwRules, nRange<span style="color: #000000;">)</span>;
&#160;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;vector vx, vy;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;drOne.<span style="color: #000000;">GetData</span><span style="color: #000000;">(</span>dwRules, <span style="color: #0000dd;">0</span>, NULL, NULL, <span style="color: #000040;">&amp;</span>vy, <span style="color: #000040;">&amp;</span>vx<span style="color: #000000;">)</span>;
&#160;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #008000;">// 線形フィットには、2つのパラメータが存在</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FitParameter sFitParameter<span style="color: #000000;">[</span><span style="color: #0000dd;">2</span><span style="color: #000000;">]</span>; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if<span style="color: #000000;">(</span> STATS_NO_ERROR <span style="color: #000080;">==</span> ocmath_linear_fit<span style="color: #000000;">(</span>vx, vy, 
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;vy.<span style="color: #000000;">GetSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>, sFitParameter<span style="color: #000000;">)</span> <span style="color: #000000;">)</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #000000;">{</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #008000;">// フィットXデータをレポート表に追加</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string strName <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;X&quot;</span> <span style="color: #000040;">+</span> <span style="color: #000000;">(</span>nRange<span style="color: #000040;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string strLongName <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;X&quot;</span>;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rt.<span style="color: #000000;">AddColumn</span><span style="color: #000000;">(</span>vx, strName, nSubID<span style="color: #000040;">++</span>, strLongName,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OKDATAOBJ_DESIGNATION_X<span style="color: #000000;">)</span>;
&#160;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #008000;">// フィットYデータを計算</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;double dIntercept <span style="color: #000080;">=</span> sFitParameter<span style="color: #000000;">[</span><span style="color: #0000dd;">0</span><span style="color: #000000;">]</span>.<span style="color: #000000;">Value</span>;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;double dSlope <span style="color: #000080;">=</span> sFitParameter<span style="color: #000000;">[</span><span style="color: #0000dd;">1</span><span style="color: #000000;">]</span>.<span style="color: #000000;">Value</span>; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;vector vFitY;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;vFitY <span style="color: #000080;">=</span> vx <span style="color: #000040;">*</span> dSlope <span style="color: #000040;">+</span> dIntercept; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
&#160;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #008000;">// フィットYデータをレポート表に追加</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;strName <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Y&quot;</span> <span style="color: #000040;">+</span> <span style="color: #000000;">(</span>nRange<span style="color: #000040;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">)</span>;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string strRange;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;strRange <span style="color: #000080;">=</span> drOne.<span style="color: #000000;">GetDescription</span><span style="color: #000000;">(</span>GETLC_COL_LN_ONLY<span style="color: #000000;">)</span>; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;strLongName <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Fitted data on &quot;</span> <span style="color: #000040;">+</span> strRange;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rt.<span style="color: #000000;">AddColumn</span><span style="color: #000000;">(</span>vFitY, strName, nSubID<span style="color: #000040;">++</span>, strLongName, 
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OKDATAOBJ_DESIGNATION_Y<span style="color: #000000;">)</span>;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #000000;">}</span><span style="color: #000000;">
}</span></pre></li>
</ol>
<a name="Run_the_X-Function" id="Run_the_X-Function"></a> 
<h2><span class="mw-headline">Xファンクションを実行する</span></h2>
<ol>
	<li>ワークシートにOriginExePath\Samples\Curve FittingフォルダのLinear Fit.datファイルをインポートします。</li>
	<li>全ての列を選択して、スクリプトウィンドウで<i>FitLinearReport -d</i> を実行すると、以下のようなダイアログが開きます。 
	 
	<div>
		<a class="image" style="color: #0000ff; text-decoration: underline; "><img 
		 alt="Ocguide xfdialog FitLinearReport display.png" src="../images/X-Function_ReportData_Example/Ocguide_xfdialog_FitLinearReport_display.png" 
		 width="426" height="258" border="0" /></a>
	</div></li>
	<li>デフォルトのまま、OKボタンをクリックします。3つのグループフィッティングXYデータセットのレポートシートが生成されます。 
	<div>
		<p><a class="image"><img alt="Ocguide xfdialog FitLinearReport result.png" 
								 src="../images/X-Function_ReportData_Example/Ocguide_xfdialog_FitLinearReport_result.png" 
								 width="331" height="322" border="0" /></a></p>
	</div></li>
</ol>


