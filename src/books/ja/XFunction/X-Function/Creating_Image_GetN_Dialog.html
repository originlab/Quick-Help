<h1 class="firstheading">イメージGetNダイアログを作成</h1>
<p><span class="OIndex" style="display: none;">GetN, イメージダイアログ</span> このセクションではXファンクションのGetNダイアログを行列画像と共にプレビューする為のダイアログを作成します。これは、ダイアログのコントロールと画像のプレビューを起動する、画像のプレビューを更新する、ファイアログのコントロールをプレビューに反映するなどが含まれます。</p>
<p><a class="image"><img alt="Ocguide xf imagepreview dialog.png" src="../images/Creating_Image_GetN_Dialog/Ocguide_xf_imagepreview_dialog.png" 
						 width="486" height="533" border="0" /></a></p>
<table id="toc" class="toc">
	<tr>
		<td><div id="toctitle">
			<h2>内容</h2>
		</div>
		<ol>
			<li class="toclevel-1 tocsection-1"><a href="#Create_an_Empty_GetN_Image_Preview_Dialog"><span 
			 class="tocnumber">1</span> <span class="toctext">空のGetN イメージプレビューダイアログを作成する</span></a></li>
			<li class="toclevel-1 tocsection-2"><a href="#X-Function.2C_Coding_in_Code_BuilderCoding_X-Function_in_Code_Builder"><span 
			 class="tocnumber">2</span> <span class="toctext"><span class="OIndex" 
			 style="display: none;">Xファンクション, コードビルダでコーディング</span>コードビルダでXファンクションをコーディングする</span></a></li>
			<li class="toclevel-1 tocsection-3"><a href="#X-Function.2C_Image_Dialog_Init_Event_FunctionGetNImageBox_OnInit_Event_Function"><span 
			 class="tocnumber">3</span> <span class="toctext"><span class="OIndex" 
			 style="display: none;">Xファンクション, イメージダイアログ Init イベント関数</span>GetNImageBox_OnInit 
			 イベント関数</span></a></li>
			<li class="toclevel-1 tocsection-4"><a href="#X-Function.2C_Image_Dialog_OnChange_Event_FunctionGetNImageBox_OnChange_Event_Function"><span 
			 class="tocnumber">4</span> <span class="toctext"><span class="OIndex" 
			 style="display: none;">Xファンクション, イメージダイアログ OnChangeイベント関数</span>GetNImageBox_OnChange 
			 イベント関数</span></a></li>
			<li class="toclevel-1 tocsection-5"><a href="#Main_Function"><span 
			 class="tocnumber">5</span> <span class="toctext">メイン関数</span></a></li>
			<li class="toclevel-1 tocsection-6"><a href="#Using_X-Function_X-Function.2C_Execution"><span 
			 class="tocnumber">6</span> <span class="toctext">Xファンクションの使用 
			 <span class="OIndex" style="display: none;">Xファンクション, 実行</span></span></a></li>
		</ol></td>
	</tr>
</table>
<h2><a name="Create_an_Empty_GetN_Image_Preview_Dialog" id="Create_an_Empty_GetN_Image_Preview_Dialog"></a><span 
	 class="mw-headline">空のGetN イメージプレビューダイアログを作成する</span></h2>
<ol>
	<li>Xファンクションビルダを開くためにF10キーを押してください。</li>
	<li>Xファンクション編集ボックスに「ImageBox」と入力して、Xファンクションの名前にします。</li>
	<li>変数リスト上で右クリックし、「変数の追加」を選択していくつかの変数を追加します。変数の名前、ラベル、他の値を次の画像と同じになるように入力します。 
	 
	<div>
		<a class="image" style="color: #0000ff; text-decoration: underline; "><img 
		 alt="Ocguide xf imagepreview variables.png" src="../images/Creating_Image_GetN_Dialog/Ocguide_xf_imagepreview_variables.png" 
		 width="504" height="297" border="0" /></a>
	</div></li>
	<li>Xファンクションビルダのツリービューボタン<a class="image"><img alt="Ocguide xf treeview button.png" 
													 src="../images/Creating_Image_GetN_Dialog/Ocguide_xf_treeview_button.png" 
													 width="23" height="23" 
													 border="0" /></a>をクリックしてツリービューに移動します。「使用のコンテクスト→メニュー」にある「自動GetNダイアログ」のドロップダウンリストで「GetNImageBox」を選択してから保存ボタンをクリックしてXファンクションを保存します。</li>
	<li>Xファンクションビルダを閉じ、新規行列ウィンドウを開きます。メニューから「ファイル→インポート→イメージファイルを行列へインポート」と操作してイメージファイルを選択し、行列ウィンドウにイメージをインポートします。</li>
	<li>行列ウィンドウをアクティブにしたままコマンドウィンドウで「ImageBox -d」を実行します。GetNイメージプレビューダイアログが開きます。</li>
</ol>
<h2><a name="X-Function.2C_Coding_in_Code_BuilderCoding_X-Function_in_Code_Builder" 
		 id="X-Function.2C_Coding_in_Code_BuilderCoding_X-Function_in_Code_Builder"></a><span 
	 class="mw-headline"><span class="OIndex" style="display: none;">Xファンクション, 
 コードビルダでコーディング</span>コードビルダでXファンクションをコーディングする</span></h2>
<ol>
	<li>Originのコードビルダを開き、メニューからファイル→開く、と選択して先程保存したXファンクションを見つけて開きます。開くダイアログで「ワークスペースに追加」にチェックがついている事を確認してからOKをクリックします。ImageBox.XFCがOriginCワークスペースビューのユーザフォルダに追加され、編集ビューに関数のボディを表示します。</li>
	<li><b style="font-weight: bold;">//put additional include files here</b>行の後に、次のような行を追加します。 
	 
	<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">//put additional include files here</span>
#include <span style="color: #000080;">&lt;</span>image_utils.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
#include <span style="color: #000080;">&lt;</span>..\Originlab\matdata_utils.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</pre></li>
	<li><b style="font-weight: bold;">//put your own support static functions 
	 here</b> と入力された行の下に、以下のようなstatic関数を追加します。 
	<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">//サポート目的のstatic 関数をここに入力</span>
static bool _adjust_image_brightness_ex<span style="color: #000000;">(</span>BITMAPHANDLE<span style="color: #000040;">*</span> pPreviewBitmap, TreeNode<span style="color: #000040;">&amp;</span> 
trGetN, bool<span style="color: #000040;">&amp;</span> bOKEnable, string<span style="color: #000040;">&amp;</span> strErrMsg<span style="color: #000000;">)</span><span style="color: #000000;">
{</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;int nRet <span style="color: #000080;">=</span> adjust_image_brightness<span style="color: #000000;">(</span>pPreviewBitmap, trGetN.<span style="color: #000000;">level</span>.<span style="color: #000000;">nVal</span><span style="color: #000000;">)</span>;
&#160;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if<span style="color: #000000;">(</span> SUCCESS <span style="color: #000040;">!</span><span style="color: #000080;">=</span> nRet<span style="color: #000000;">)</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #000000;">{</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bOKEnable <span style="color: #000080;">=</span> false; <span style="color: #008000;">//イメージの調整に失敗するとOKボタンを無効化</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;strErrMsg <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Fail to adjust image brightness&quot;</span>; <span style="color: #008000;">// エラーメッセージの文字列</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return false;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color: #000000;">}</span>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true; &#160;&#160;&#160;<span style="color: #000000;">
}</span></pre></li>
</ol>
<h2><a name="X-Function.2C_Image_Dialog_Init_Event_FunctionGetNImageBox_OnInit_Event_Function" 
		 id="X-Function.2C_Image_Dialog_Init_Event_FunctionGetNImageBox_OnInit_Event_Function"></a><span 
	 class="mw-headline"><span class="OIndex" style="display: none;">Xファンクション, 
 イメージダイアログ Init イベント関数</span>GetNImageBox_OnInit イベント関数</span></h2>
<p>このイベント関数はGetNイメージプレビューダイアログが開いた時に呼び出されます。これはイメージのプレビュー、ダイアログのコントロールを起動する時やOKボタンの有効化/無効化で使用できます。例えば、次のコードをGetNImageBox_OnInit 
 関数に追加してレベルコントロールの値を元に画像の明るさを変更するようにします。</p>
<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">// イメージプレビューコントロールからビットマップのハンドルポインタを入手</span>
pBITMAPHANDLE pPreviewBitmap <span style="color: #000080;">=</span> pimgCntrl<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>GetBitmapHandlePtr<span style="color: #000000;">(</span><span style="color: #000000;">)</span>; &#160;&#160;&#160;&#160;
&#160;<span style="color: #008000;">
// 内部関数を呼び出してイメージを調整</span>
_adjust_image_brightness_ex<span style="color: #000000;">(</span>pPreviewBitmap, trGetN, bOKEnable, strErrMsg<span style="color: #000000;">)</span>;
</pre>
<h2><a name="X-Function.2C_Image_Dialog_OnChange_Event_FunctionGetNImageBox_OnChange_Event_Function" 
		 id="X-Function.2C_Image_Dialog_OnChange_Event_FunctionGetNImageBox_OnChange_Event_Function"></a><span 
	 class="mw-headline"><span class="OIndex" style="display: none;">Xファンクション, 
 イメージダイアログ OnChangeイベント関数</span>GetNImageBox_OnChange イベント関数</span></h2>
<p>このイベント関数はグリッドがユーザによって変数された時に呼び出されます。これはダイアログコントロールで変更になったイメージプレビューを更新する時、ダイアログのコントロールを他のコントロールが変更になったところで更新する時、あるいはOKボタンの有効化/無効化について更新する時などに使用します。以下のコードをGetNImageBox_OnChange関数に追加してください。</p>
<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">// 内部関数を呼び出してイメージを調整。イメージプレビューを更新するにはtureを返す</span>
bUpdatePreview <span style="color: #000080;">=</span> _adjust_image_brightness_ex<span style="color: #000000;">(</span>pPreviewBitmap, trGetN,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bOKEnable, strErrMsg<span style="color: #000000;">)</span>;
</pre>
<h2><a name="Main_Function" id="Main_Function"></a><span class="mw-headline">メイン関数</span></h2>
<p>メイン関数は対応するXファンクションと同じ名前を有します。以下のコードをメイン関数に追加してコンパイルボタンをクリックします。</p>
<pre class="oc" style="font-family: monospace;">
<span style="color: #008000;">// ビットマップハンドルポインタを入力イメージから出力イメージへコピー</span>
bool bCopy <span style="color: #000080;">=</span> true;
oimg.<span style="color: #000000;">SetLBmp</span><span style="color: #000000;">(</span>iimg.<span style="color: #000000;">GetLBmp</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>, bCopy<span style="color: #000000;">)</span>;
&#160;<span style="color: #008000;">
// 出力イメージからビットマップハンドルポインタを入手</span>
pBITMAPHANDLE phBmp <span style="color: #000080;">=</span> oimg.<span style="color: #000000;">GetLBmp</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>; &#160;&#160;&#160;&#160;&#160;&#160;
&#160;<span style="color: #008000;">
// 調整</span>
adjust_image_brightness<span style="color: #000000;">(</span>phBmp, level<span style="color: #000000;">)</span>;
</pre>
<h2><a name="Using_X-Function_X-Function.2C_Execution" id="Using_X-Function_X-Function.2C_Execution"></a><span 
	 class="mw-headline">Xファンクションの使用 <span class="OIndex" style="display: none;">Xファンクション, 
 実行</span></span></h2>
<ol>
	<li>コマンドウィンドウで「ImageBox -d」を実行し、このXファンクションのダイアログを開きます。レベルコントロールの値を変更してプレビューの明るさが変更する事を確認します。</li>
	<li><a class="image"><img alt="Ocguide dialog theme.png" src="../images/Creating_Image_GetN_Dialog/Ocguide_dialog_theme.png" 
								 width="21" height="23" border="0" /></a>ボタンをクリックしてテーマコンテキストメニューを開き、名前を付けて保存をクリックした後に「mylevel」としてテーマ名ボックスに入力します。そしてOKをクリックしてテーマファイルを作成します。キャンセルを押してXファンクションダイアログを閉じます。</li>
	<li>コマンドウィンドウで「ImageBox -d -t mylevel」を実行し、Xファンクションをダイアログを指定したテーマで開きます。</li>
</ol>


