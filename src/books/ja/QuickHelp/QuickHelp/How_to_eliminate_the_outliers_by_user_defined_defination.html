<h1 class="firstheading">FAQ-878 ユーザーが設定した定義によって外れ値を排除するには?</h1><p class='urlname' style='display: none'>Identify-and-Eliminate-User-Defined-Outliers</p>
<p class='faqID'>最終更新日:2017/7/4</p>
<p>ワークシート内のセルを独自の外れ値の定義によって識別するには、LabTalk関数を使用する必要があります。次のサンプルコードでは、Z絶対値(=abs((x-<i>MeanOfColumn</i>)/<i>SDOfColumn</i>))が設定した閾値より大きいときに、値を外れ値として定義します。</p>
<pre class="lt" style="font-family:monospace;">function dataset remoutliers<span style="color: #000000;">(</span>dataset ds1, double zthresh<span style="color: #000000;">)</span> <span style="color: #000000;">{</span> dataset ds2; double ii; sum<span style="color: #000000;">(</span>ds1<span style="color: #000000;">)</span>; <span style="color: #008000;">//ds1の統計を収集</span> double summean<span style="color: #000080;">=</span>sum.<span style="color: #000080;">mean</span>; <span style="color: #008000;">//平均値を保存</span> double sumsd<span style="color: #000080;">=</span>sum.<span style="color: #000080;">SD</span>; <span style="color: #008000;">//SDを保存</span> double nr<span style="color: #000080;">=</span>ds1.<span style="color: #000080;">getSize</span><span style="color: #000000;">(</span><span style="color: #000000;">)</span>; <span style="color: #008000;">//行数</span> for<span style="color: #000000;">(</span>ii<span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; ii<span style="color: #000080;">&lt;=</span>nr; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span> ds2<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span><span style="color: #000080;">=</span>abs<span style="color: #000000;">(</span>ds1<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span><span style="color: #000080;">-</span>summean<span style="color: #000000;">)</span><span style="color: #000080;">/</span>sumsd<span style="color: #000080;">&lt;=</span>zthresh?ds1<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span><span style="color: #000000;">:</span><span style="color: #0000dd;">0</span><span style="color: #000080;">/</span><span style="color: #0000dd;">0</span>; <span style="color: #008000;">//外れ値なら欠損値に設定</span> <span style="color: #000000;">}</span> return ds2; <span style="color: #000000;">}</span></pre>
<p>全シートの検索に、関数<i>remoutliers</i> を使用します。例えば、次のワークシート内の外れ値をマスクする場合を考えます。</p><p><a class="image"><img alt="FAQ 878 1.png" src="../images/How_to_eliminate_the_outliers_by_user_defined_defination/FAQ_878_1.png" width="397"  /></a></p><p>スクリプトは次のようになります。</p>
<pre class="lt" style="font-family:monospace;">zthreshold<span style="color: #000080;">=</span><span style="color: #0000dd;">1.0</span>; <span style="color: #008000;">//しきい値をセット</span> nc<span style="color: #000080;">=</span>wks.<span style="color: #000080;">ncols</span>; <span style="color: #008000;">//列の数</span> nr<span style="color: #000080;">=</span>wks.<span style="color: #000080;">maxrows</span>; <span style="color: #008000;">//行の数</span> for<span style="color: #000000;">(</span>jj<span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; jj<span style="color: #000080;">&lt;=</span>nc; jj<span style="color: #000080;">++</span><span style="color: #000000;">)</span><span style="color: #000000;">{</span> dataset ds<span style="color: #000080;">=</span>wcol<span style="color: #000000;">(</span>jj<span style="color: #000000;">)</span>; range rc<span style="color: #000080;">=</span>wcol<span style="color: #000000;">(</span>jj<span style="color: #000000;">)</span>; wcol<span style="color: #000000;">(</span>jj<span style="color: #000000;">)</span><span style="color: #000080;">=</span>remoutliers<span style="color: #000000;">(</span>wcol<span style="color: #000000;">(</span>jj<span style="color: #000000;">)</span>,zthreshold<span style="color: #000000;">)</span>; for<span style="color: #000000;">(</span>ii<span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; ii<span style="color: #000080;">&lt;=</span>nr; ii<span style="color: #000080;">++</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span> if<span style="color: #000000;">(</span>rc<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span><span style="color: #000080;">==</span><span style="color: #0000dd;">0</span><span style="color: #000080;">/</span><span style="color: #0000dd;">0</span><span style="color: #000000;">)</span> <span style="color: #000000;">{</span> rc<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span><span style="color: #000080;">=</span>ds<span style="color: #000000;">[</span>ii<span style="color: #000000;">]</span>; <span style="color: #008000;">//オリジナルからデータを回復</span> rc<span style="color: #000080;">&lt;</span>ii<span style="color: #000080;">&gt;=</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">//セルが欠損ならマスクする</span> <span style="color: #000000;">}</span> <span style="color: #000000;">}</span> <span style="color: #000000;">}</span></pre>
<p>次のような結果が出力されます。</p><p><a class="image"><img alt="FAQ 878 2.png" src="../images/How_to_eliminate_the_outliers_by_user_defined_defination/FAQ_878_2.png" width="395"  /></a></p><p><b>Note</b>: データセットが行方向の場合は、最初にワークシートの列を転置する必要があります。</p>

<hr class='keywordshr'><p><span class='keywords'>キーワード:</span><span class='keywordsInput'>外れ値のマスク, 外れ値検出</span></p>







    