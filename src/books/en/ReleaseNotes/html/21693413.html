<link rel="stylesheet" href="//d2mvzyuse3lwjc.cloudfront.net/global/confWiki.css?t=201612160906" />
<div id="page">
    <div id="main" class="aui-page-panel">
        <div id="main-header">
            <h1 id="title-heading" class="pagetitle">
                <span id="title-text">
                    Workbook Protection
                </span>
            </h1>
        </div>
        <div id="content" class="view">
            <div id="main-content" class="wiki-content group">
                <p style="text-align: left;">(<a href="https://originlab.jira.com/browse/ORG-8018" class="external-link" rel="nofollow">ORG-8018</a>)</p><h1 style="text-align: left;" id="WorkbookProtection-ProjectProtectionandAdminMode">Project Protection and Admin Mode</h1><p></p><div class="toc-macro client-side-toc-macro  conf-macro output-block"> <ul class="toc-indentation"><li><a href="#WorkbookProtection-ProjectProtectionandAdminMode">Project Protection and Admin Mode</a><ul class="toc-indentation"><li><a href="#WorkbookProtection-ProtectionFlags">Protection Flags</a></li><li><a href="#WorkbookProtection-ProtectionCommands">Protection Commands</a></li><li><a href="#WorkbookProtection-ExclusionZonesonRead-OnlySheet">Exclusion Zones on Read-Only Sheet</a></li><li><a href="#WorkbookProtection-AdminMode">Admin Mode</a></li><li><a href="#WorkbookProtection-AppTitleBarIndicationofAdminMode">App Title Bar Indication of Admin Mode</a></li><li><a href="#WorkbookProtection-AdminModeandSavingofOPJ">Admin Mode and&#160;Saving of OPJ</a></li><li><a href="#WorkbookProtection-ProtectingGraphs">Protecting Graphs</a></li><li><a href="#WorkbookProtection-ScriptExample">Script Example</a></li></ul></li></ul></div><p>LabTalk commands to enable various protections on worksheets and workbooks have been introduced in Origin 9.1. Further more, Admin mode has been introduced to allow better protection controls on Origin projects. You may control protection attributes of Origin object (like a book) without involving Admin mode, but such protection is not secured, anyone can run LabTalk command to remove these protections. To ensure secured protection, you must setup Admin password for the Origin project and then Origin Object protections cannot be altered until the correct password is entered. Very often, security is not an issue and you may just want to prevent inadvertent or accidental modification or delete of certain book or sheet, and in such situation, you may add protection without Admin password, which certainly make things easier, not having to remember a password on given OPJ.</p><h2 id="WorkbookProtection-ProtectionFlags">Protection Flags</h2><p> Various objects like worksheet, workbooks can be assigned different protection flags. These flags are listed in the following table</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Hex Value</p></th><th class="confluenceTh">Description</th></tr><tr><td style="text-align: right;" class="confluenceTd">2</td><td class="confluenceTd">Data: This include all the cells in a worksheet, data cells or label cells</td></tr><tr><td style="text-align: right;" class="confluenceTd">4</td><td class="confluenceTd">Style: Display style, like the color of the cell, or the cell formatting, this is currently not yet fully implemented</td></tr><tr><td colspan="1" style="text-align: right;" class="confluenceTd">10</td><td colspan="1" class="confluenceTd">Formula: Column Formula, Analysis Operation, Codes attached to Project etc. <span style="color: rgb(255,0,0);">(Not Ready)</span></td></tr><tr><td colspan="1" style="text-align: right;" class="confluenceTd">80</td><td colspan="1" class="confluenceTd">Structure: Keep the columns in the sheet unchanged, prevent insert/delete columns or moving columns, but still allow rows to be changed.</td></tr><tr><td colspan="1" style="text-align: right;" class="confluenceTd"> 100</td><td colspan="1" class="confluenceTd"> Rename: For sheet, to prevent user to change a sheet's name</td></tr><tr><td colspan="1" style="text-align: right;" class="confluenceTd"> 400</td><td colspan="1" class="confluenceTd"> Delete: Prevent the object from being deleted</td></tr></tbody></table></div><h2 id="WorkbookProtection-ProtectionCommands">Protection Commands</h2><p>You can use the following labtalk commands to lock a sheet of a book. If Admin password has not been set, these commands will work fine. Once Admin password is set, then you must login first before using these commands.</p><p>Multiple protection flags can be combined as can be seen in the examples.</p><p>There is a general inheritance rule on protection flags. Once you set protection on a book, then all sheets inside the book will inherent the flags from the book. The exception to this rule is <strong>Delete</strong>, you must separately control book and sheet delete flag, like you may want the book not to allow delete but individual sheet may allow.</p><p> </p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Command</th><th class="confluenceTh">Description</th><th colspan="1" class="confluenceTh">          Examples       </th></tr><tr><td class="confluenceTd"><p><code>layer -lw n</code></p></td><td class="confluenceTd">set worksheet write access flags</td><td colspan="1" class="confluenceTd"><p><code>lay -lw hex(82);//set active sheet to protect data and structure</code></p><p><code><code>lay -lw;//protect everything</code></code></p><p><code><code><code>lay -lw 2;// protect only data</code></code></code></p><p><code><code><code>lay -lw hex(180);//no insert/del col/rows, no worksheet rename</code></code></code></p><p><code><code><code><code>lay -lw 0;</code>//remove all the protections on the current sheet</code></code></code></p></td></tr><tr><td colspan="1" class="confluenceTd"><code>layer -lt</code></td><td colspan="1" class="confluenceTd"> print out current protection flags</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td class="confluenceTd"><code>page -lw n</code></td><td class="confluenceTd">set workbook write access flags</td><td colspan="1" class="confluenceTd"><p> //the following will prepare the book for locking active sheet but allow analysis results added to book</p><p><code>lay -lw hex(582);//no del, no rename, no add/insert/move col/rows, no edit</code></p><p><code>page -lw hex(400);//no del book</code></p><p> </p><p>//other examples</p><p><code>page -lw;</code>//lock book and all sheets, nothing can be changed and cannot delete book or sheets</p><p><code>page -lw hex(400);</code>//prevent user deleting the book</p><p><code>page -lw;</code> //lock the book completely, cannot even delete</p><p><code>page -lw hex(482);</code> //lock delete, structure change and data edit</p></td></tr><tr><td class="confluenceTd"> <code>page -lt</code></td><td class="confluenceTd"> print out the current protection flags</td><td colspan="1" class="confluenceTd"> </td></tr></tbody></table></div><p> </p><h2 id="WorkbookProtection-ExclusionZonesonRead-OnlySheet">Exclusion Zones on Read-Only Sheet</h2><p>Once you have lock a worksheet from modifications, all the cells in the sheet become read-only. Often it is desirable to setup a sheet as a form, such that only certain cells can be modified to allow user to enter values into. To achieve this, we have added the LabTalk command to add such <strong>Exclusion Zones</strong>.</p><div class="code panel pdl conf-macro output-block" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Command to manage Exclusion Zones</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre">Layer -les n</pre>
</div></div><p> where n can be of the followings:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Value</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">0</td><td class="confluenceTd">Clear all the Exclusion Zones on the active sheet</td></tr><tr><td colspan="1" class="confluenceTd">1</td><td colspan="1" class="confluenceTd">Add the current selection, one range or multiple via cntrl-select, to add as new Exclusion Zones </td></tr><tr><td class="confluenceTd">2</td><td class="confluenceTd">List the Exclusion Zones into the script window</td></tr></tbody></table></div><p>Please note that you can only make Exclusion Zone modification when the sheet is unprotected. So to set the sheet up as a form, you should first add all the needed Exclusion Zones, then protect the sheet from modification with <code>lay -lw hex(82);</code> for example. </p><h2 id="WorkbookProtection-AdminMode">Admin Mode</h2><p>We have introduced the concept of Admin Mode to the Origin Project, with an Admin password. Once a project is protected by a password, worksheet and workbook protection features can be accessed only after user has logined with the admin password. We have also added LabTalk access to protect books and sheets.</p><p>The following is a listing of the currently supported <strong>doc</strong> commands control the Admin mode. Text inside square brackets is optional.</p><hr /><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Command</th><th class="confluenceTh">Description</th><th class="confluenceTh">     Examples        </th></tr><tr><td class="confluenceTd"><code><code>doc -pwa [password]</code></code></td><td class="confluenceTd"><p>Add Admin password <em>password</em> to the project. You will still need to login after adding password to turn on Admin mode.</p><p>When you do not specify a password, then &quot;origin&quot; is assumed. Not using password will help situation where security is not so much of a concern and not running the risk of forgetting the password used.</p></td><td class="confluenceTd"><p><code>doc -pwa</code></p><p><code>doc -pwa test</code></p></td></tr><tr><td class="confluenceTd"><code>doc -pw [password]</code></td><td class="confluenceTd">login with password, if no Admin password added yet, error message will be shown</td><td class="confluenceTd"><p>doc -pw;</p><p>doc -pw test;</p></td></tr><tr><td class="confluenceTd"><code>doc -pwx</code></td><td class="confluenceTd">logout, once logout, cannot change anything related to protections</td><td class="confluenceTd"> </td></tr><tr><td class="confluenceTd"><code>doc -pwta</code></td><td class="confluenceTd">list all the book/sheets with protection turned on</td><td class="confluenceTd"> </td></tr><tr><td class="confluenceTd"><code>doc -pwr [password]</code></td><td class="confluenceTd">remove password, if no password specified, then must login first to do so, otherwise must give correct password</td><td class="confluenceTd">doc -pwr;</td></tr></tbody></table></div><p>After a command is entered, you App title will change accordingly, so will the status bar to indicate current status.</p><h2 id="WorkbookProtection-AppTitleBarIndicationofAdminMode">App Title Bar Indication of Admin Mode</h2><p>Normally, Origin title bar looks like this</p><p> <span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" width="500" src="https://dl.dropboxusercontent.com/u/69570665/JIRA/admin%20mode%20without%20pwd.png" /></span></p><p>there is a &quot;-&quot; that separates the 32/64 bit and the path of the file. To save space, we are just changing this &quot;-&quot; character to indicate Admin status.</p><p>For OPJ file that has added Admin password, the &quot;-&quot; character will be replaced by the &quot;@&quot; character before you enter the Admin password to login, like this</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" width="500" src="https://dl.dropboxusercontent.com/u/69570665/JIRA/admin%20mode%20before%20login.png" /></span></p><p>After login, the &quot;@&quot; character is replaced by the &quot;=&quot; character, like this</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" width="500" src="https://dl.dropboxusercontent.com/u/69570665/JIRA/admin%20mode%20after%20login.png" /></span></p><h2 id="WorkbookProtection-AdminModeandSavingofOPJ">Admin Mode and Saving of OPJ</h2><p>Once a project has Admin Mode enabled, namely Admin password has been set, it can no longer be overwritten from Origin without login. When an Admin enabled OPJ is open and before login, you may modify the OPJ in unprotected area and see the * added to the App title, to indicate dirtiness of the OPJ, but you will not be able to save the OPJ. You can also just exit Origin with a dirty OPJ and will not be prompted to save.</p><p>To modify and save an Admin enabled OPJ, you must first login with the Admin password.</p><h2 id="WorkbookProtection-ProtectingGraphs">Protecting Graphs</h2><p>Even though the script commands described here were implemented for workbook and worksheet, the <strong>Delete</strong> flag is general and can be used in graphs as well. For example:</p><div class="code panel pdl conf-macro output-block" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Delete all graph windows except Graph4</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre">repeat 10 {win -t plot}; //create 10 graph windows
win -o graph4 {page -lw hex(400)}; //set graph4 protection
doc -e P {win -c}; //Use a loop to delete all graph windows in the opj, Graph4 will be kept because of the protection</pre>
</div></div><h2 id="WorkbookProtection-ScriptExample">Script Example</h2><p>The following script sets up a workbook with a locked data sheet, and the workbook is also protected from deletion. The OPJ can then be saved and shared with others who can view, graph, and analyze the data, but cannot edit or delete. Analysis results need to go to additional sheets, so routines such as Smooth should use settings to send output to another sheet, as the data sheet will be protected in this example from any modifications.</p><div class="code panel pdl conf-macro output-block" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre">// Import a sample file
newbook;
string fname$=system.path.program$+&quot;Samples\Curve Fitting\Gaussian.dat&quot;;
impasc;
// Set password and login - change mypwd to your desired password string
doc -pwa mypwd;
doc -pw mypwd;
// Protect data sheet structure, prevent editing, deleting
lay -lw hex(482);
// Protect page from deletion
page -lw hex(400);
// logout
doc -pwx;
// Now you can save the OPJ and others can view data, graph, and also analyze
// Analysis results can go into new sheets, not new cols in same sheet</pre>
</div></div>
            </div>
        </div>
    </div>
</div>
