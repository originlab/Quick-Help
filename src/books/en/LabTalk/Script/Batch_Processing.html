<h1 class="firstHeading">2.18.3 Batch Processing</h1><p class='urlname' style='display: none'>Batch-Processing</p>
<p><span class="OIndex" style="display:none">Batch Processing</span>One may often encounter the need to perform <span class="OIndex">batch processing</span> of multiple sets of data files or datasets in Origin, repeating the same analysis procedure on each set of data. This can be achieved in three different ways, and the following sections provide information and examples of each.
</p>
<h2><a name="Processing_Each_Dataset_in_a_Loop"></a><span class="mw-headline">Processing Each Dataset in a Loop</span></h2>
<p>One way to achieve batch processing is to <span class="OIndex">loop over multiple files</span> or datasets, and within the loop process each dataset by calling appropriate X-Functions and other script commands to perform the necessary data processing.
</p><p>The following example shows how to import 10 files and perform a curve fit operation and print out the fitting results:
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Find all files using wild card</span>
string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Batch Processing&quot;</span>;  <span style="color: #008000;">// Path to find files</span>
<span style="color: #008000;">// Find the files in the folder specified by path$ variable (default)</span>
<span style="color: #008000;">// The result file names are stored in the string variable fname$</span>
<span style="color: #008000;">// Separated by CRLF (default). Here wild card * is used, which means</span>
<span style="color: #008000;">// all files start with &quot;T&quot;, and with the extension &quot;csv&quot;</span>
findFiles ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;T*.csv&quot;</span>;

<span style="color: #008000;">// Start a new book with no sheets</span>
newbook sheet<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
<span style="color: #008000;">// Loop over all files</span>
for<span style="color: #000000;">&#40;</span>int iFile <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; iFile <span style="color: #000080;">&lt;=</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">&#40;</span>CRLF<span style="color: #000000;">&#41;</span>; iFile<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #008000;">// Get file name</span>
	string file<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetToken</span><span style="color: #000000;">&#40;</span>iFile, CRLF<span style="color: #000000;">&#41;</span><span style="color: #000080;">$</span>;
	<span style="color: #008000;">// Import file into a new sheet</span>
	newsheet;
	impasc file<span style="color: #000080;">$</span>;
	<span style="color: #008000;">// Perform gaussian fitting to col 2 of the current data</span>
	nlbegin iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> func<span style="color: #000000;">:</span><span style="color: #000080;">=</span>gaussamp nltree<span style="color: #000000;">:</span><span style="color: #000080;">=</span>myfitresult;
	<span style="color: #008000;">// Just fit and end with no report</span>
	nlfit;
	nlend;
	<span style="color: #008000;">// Print out file name and results</span>
	type <span style="color: #ff00ff;">&quot;File Name:&#160;%(file$)&quot;</span>;
	type <span style="color: #ff00ff;">&quot;   Peak Center= $(myfitresult.xc)&quot;</span>;	
	type <span style="color: #ff00ff;">&quot;   Peak Height= $(myfitresult.A)&quot;</span>;	
	type <span style="color: #ff00ff;">&quot;   Peak Width=  $(myfitresult.w)&quot;</span>;	
<span style="color: #000000;">&#125;</span></pre>
<h2><a name="Using_Analysis_Template_in_a_Loop"></a><span class="mw-headline">Using Analysis Template in a Loop</span></h2>
<p>Custom templates for analysis can be created in Origin by performing the necessary data processing from the GUI on a representative dataset and then saving the workbook, or the entire project, as an <b><span class="OIndex">Analysis Template</span></b>. The following example shows how to make use of an existing analysis template to perform curve fitting on 10 files:
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Find all files using wild card</span>
string fpath<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Samples\Batch Processing\&quot;</span>;
string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> fpath<span style="color: #000080;">$</span>;  <span style="color: #008000;">// Path to find files</span>
<span style="color: #008000;">// Find the files in the folder specified by path$ variable (default)</span>
<span style="color: #008000;">// The result file names are stored in the string variable fname$</span>
<span style="color: #008000;">// Separated by CRLF (default). Here wild card * is used, which means</span>
<span style="color: #008000;">// all files start with &quot;T&quot;, and with the extension &quot;csv&quot;</span>
findFiles ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;T*.csv&quot;</span>;
 
<span style="color: #008000;">// Set path of Analysis Template</span>
string templ<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> path<span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Peak Analysis.OGW&quot;</span>;
<span style="color: #008000;">// Loop over all files</span>
for<span style="color: #000000;">&#40;</span>int iFile <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; iFile <span style="color: #000080;">&lt;=</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">&#40;</span>CRLF<span style="color: #000000;">&#41;</span>; iFile<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>	
   <span style="color: #008000;">// Open an instance of the analysis template</span>
   doc <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>templ<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span>;
   <span style="color: #008000;">// Import current file into first sheet</span>
   page.<span style="color: #000080;">active</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
   impasc fname.<span style="color: #000080;">GetToken</span><span style="color: #000000;">&#40;</span>iFile, CRLF<span style="color: #000000;">&#41;</span><span style="color: #000080;">$</span>
<span style="color: #000000;">&#125;</span>

<span style="color: #008000;">// Issue a command to update all pending operations</span>
<span style="color: #008000;">// in case the operations were set to manual recalculate in the template</span>
run <span style="color: #000080;">-</span>p au;</pre>
<h2><a name="Using_Batch_Processing_X-Functions"></a><span class="mw-headline">Using Batch Processing X-Functions</span></h2>
<p>Origin provides script-accessible X-Functions to perform batch processing, where there is no need to loop over files or datsets. One simply creates a list of desired data to be processed and calls the relevant X-Function. The X-Function then either uses a template or a theme to process all of the specified data. Some of these X-Functions can also create an optional <span class="OIndex">summary report</span> that contains results from each file/dataset that were marked for reporting by the user, in their custom analysis template.
</p><p>The table below lists X-Functions available for batch analysis:
</p>
<table class="simple">
<tr>
<th> Name</th>
<th> Brief Description
</th></tr>
<tr>
<td> <a class="external text" href="../../XFunction/X-Function/BatchProcess.html">batchProcess</a>
</td>
<td>
<p>Perform batch processing of multiple files or datasets using Analysis Template, with optional summary report sheet
</p>
</td></tr>
<tr>
<td> <a class="external text" href="../../XFunction/X-Function/PaMultiY.html">paMultiY</a>
</td>
<td> Perform peak analysis of multiple Y datasets using Peak Analyzer theme
</td></tr>
</table>
<p>The following script shows how to use the <a class="external text" href="../../XFunction/X-Function/BatchProcess.html">batchProcess X-Function</a> to perform curve fitting of data from 10 files using an analysis template, with a summary report created at the end of the process.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Find all files using wild card</span>
string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Batch Processing\&quot;</span>;  <span style="color: #008000;">// Path to find files</span>
<span style="color: #008000;">// Find the files in the folder specified by path$ variable (default)</span>
<span style="color: #008000;">// The result file names are stored in the string variable fname$</span>
<span style="color: #008000;">// Separated by CRLF (default). Here wild card * is used, which means</span>
<span style="color: #008000;">// all files start with &quot;T&quot;, and with the extension &quot;csv&quot;</span>
findFiles ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;T*.csv&quot;</span>;
 
<span style="color: #008000;">// Set path of Analysis Template</span>
string templ<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> path<span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Peak Analysis.OGW&quot;</span>;

<span style="color: #008000;">// Call the Batch Processing X-Function</span>
<span style="color: #008000;">// Keep only the final summary sheet, delete intermediate books</span>
batchProcess batch<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> name<span style="color: #000000;">:</span><span style="color: #000080;">=</span>templ<span style="color: #000080;">$</span> data<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> fill<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Raw Data&quot;</span> 
             append<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Summary&quot;</span> remove<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> method<span style="color: #000000;">:</span><span style="color: #000080;">=</span>impASC;</pre>
<hr />
<p>Batch processing using X-Functions can also be performed by calling Origin from an external console; for more see Running Scripts <a href="../../LabTalk/Script/From_Console.html" title="Script:From Console">From Console</a>.
</p>





