<h1 class="firstHeading">4.5.2 Curve Fitting</h1><p class='urlname' style='display: none'>Curve-Fitting</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Linear_Fit"><span class="tocnumber">1</span> <span class="toctext">Linear Fit</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Fit_XYYYY_Data_and_Plot_Each_Fit_in_Separate_Window"><span class="tocnumber">1.1</span> <span class="toctext">Fit XYYYY Data and Plot Each Fit in Separate Window</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#US_Total_Population"><span class="tocnumber">1.2</span> <span class="toctext">US Total Population</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Get_and_Change_Existing_Linear_Fit_Operation"><span class="tocnumber">1.3</span> <span class="toctext">Get and Change Existing Linear Fit Operation</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Apparent_Linear_Fit_with_xop_X-Function_and_Get_Result_Tree"><span class="tocnumber">1.4</span> <span class="toctext">Apparent Linear Fit with xop X-Function and Get Result Tree</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Perform_Linear_Regression_from_a_graph"><span class="tocnumber">2</span> <span class="toctext">Perform Linear Regression from a graph</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Polynomial_Fit"><span class="tocnumber">3</span> <span class="toctext">Polynomial Fit</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#Time_Series_Data.2C_Fitting_the_RMB_Exchange_Rate"><span class="tocnumber">3.1</span> <span class="toctext">Time Series Data, Fitting the RMB Exchange Rate</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Polynomial_Fit_with_xop_X-Function_and_Get_Result_Tree"><span class="tocnumber">3.2</span> <span class="toctext">Polynomial Fit with xop X-Function and Get Result Tree</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#Multiple_Linear_Regression"><span class="tocnumber">4</span> <span class="toctext">Multiple Linear Regression</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#Composite_Spectrum_Fitting_with_Multiple_Components"><span class="tocnumber">4.1</span> <span class="toctext">Composite Spectrum Fitting with Multiple Components</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Multiple_Linear_Regression_with_xop_X-Function_and_Get_Result_Tree"><span class="tocnumber">4.2</span> <span class="toctext">Multiple Linear Regression with xop X-Function and Get Result Tree</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#Nonlinear_Fit"><span class="tocnumber">5</span> <span class="toctext">Nonlinear Fit</span></a>
<ul>
<li class="toclevel-2 tocsection-14"><a href="#Predicting_Further_Strengthening_of_the_Chinese_Currency"><span class="tocnumber">5.1</span> <span class="toctext">Predicting Further Strengthening of the Chinese Currency</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Fit_Multiple_Peaks_with_Replica"><span class="tocnumber">5.2</span> <span class="toctext">Fit Multiple Peaks with Replica</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Global_Fit_with_Parameter_Sharing_on_Plot_Segments"><span class="tocnumber">5.3</span> <span class="toctext">Global Fit with Parameter Sharing on Plot Segments</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Creating_Multiple_Simulated_Curves_With_a_User-Defined_Fitting_Function"><span class="tocnumber">5.4</span> <span class="toctext">Creating Multiple Simulated Curves With a User-Defined Fitting Function</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Fit_Parameter_Rearrangement_in_Post_Fit_Worsksheet_Script"><span class="tocnumber">5.5</span> <span class="toctext">Fit Parameter Rearrangement in Post Fit Worsksheet Script</span></a>
<ul>
<li class="toclevel-3 tocsection-19"><a href="#Worksheet_Script"><span class="tocnumber">5.5.1</span> <span class="toctext">Worksheet Script</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#Setting_up_the_Analysis_Template"><span class="tocnumber">5.5.2</span> <span class="toctext">Setting up the Analysis Template</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-21"><a href="#Fit_Multiple_Columns_in_a_Worksheet"><span class="tocnumber">5.6</span> <span class="toctext">Fit Multiple Columns in a Worksheet</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#Change_Parameters_of_an_Existing_Operation"><span class="tocnumber">5.7</span> <span class="toctext">Change Parameters of an Existing Operation</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><a name="Linear_Fit"></a><span class="mw-headline">Linear Fit</span></h2>
<h3><a name="Fit_XYYYY_Data_and_Plot_Each_Fit_in_Separate_Window"></a><span class="mw-headline">Fit XYYYY Data and Plot Each Fit in Separate Window</span></h3>
<p>The following code will work with active book with 1st sheet having data in XYYYY form. Each Y column is fit to the first X column and a resulting fit line is added to a newly added sheet. We then plot each data and fit in a new graph.
</p>
<pre class="lt" style="font-family:monospace;">string mybk<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>H;  <span style="color: #008000;">// Save the active workbook name</span>
newsheet name<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitLines outname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitLines<span style="color: #000080;">$</span> cols<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// Add new sheet to hold fit lines</span>
range aa <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;  <span style="color: #008000;">// 1st sheet, assume we start with just one data sheet</span>
range bb <span style="color: #000080;">=</span> <span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>FitLines<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// The newly added sheet, name is stored in FitLines$ variable</span>
bb.<span style="color: #000080;">nCols</span> <span style="color: #000080;">=</span> aa.<span style="color: #000080;">nCols</span>;  <span style="color: #008000;">// Add new columns in newly added sheet</span>
<span style="color: #008000;">// Loop all columns and perform linear fit and put results into newly added sheet</span>
<span style="color: #008000;">// the fitlr X-Function is used</span>
dataset slopes, intercepts;  <span style="color: #008000;">// To hold fitting result parameters</span>
slopes.<span style="color: #000080;">SetSize</span><span style="color: #000000;">&#40;</span>aa.<span style="color: #000080;">nCols</span><span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Number of Ys in the data worksheet</span>
intercepts.<span style="color: #000080;">SetSize</span><span style="color: #000000;">&#40;</span>slopes.<span style="color: #000080;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Not needed for now, but maybe want this later</span>
loop<span style="color: #000000;">&#40;</span>ii, <span style="color: #0000dd;">2</span>, aa.<span style="color: #000080;">nCols</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	range dd <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
	fitlr iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span>dd oy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>FitLines<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, wcol<span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
	slopes<span style="color: #000000;">&#91;</span>ii<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> fitlr.<span style="color: #000080;">b</span>;  <span style="color: #008000;">// ii-1 because loop from 2</span>
	intercepts<span style="color: #000000;">&#91;</span>ii<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> fitlr.<span style="color: #000080;">a</span>;
<span style="color: #000000;">&#125;</span>
<span style="color: #008000;">// Now make a plot with all the source data and fitted data</span>
<span style="color: #008000;">// And add a label to show name and slope</span>
loop<span style="color: #000000;">&#40;</span>ii, <span style="color: #0000dd;">2</span>, aa.<span style="color: #000080;">nCols</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	range data <span style="color: #000080;">=</span> <span style="color: #000000;">&#91;</span>mybk<span style="color: #000080;">$</span><span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, wcol<span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
	range fit <span style="color: #000080;">=</span> <span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>FitLines<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, wcol<span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
	win <span style="color: #000080;">-</span>t plot;  <span style="color: #008000;">// Create a new graph window</span>
	plotxy data plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">201</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>active<span style="color: #000080;">&gt;</span>;  <span style="color: #008000;">// Plot source data as scatter</span>
	plotxy fit plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> color<span style="color: #000000;">:</span><span style="color: #000080;">=</span>color<span style="color: #000000;">&#40;</span>red<span style="color: #000000;">&#41;</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>active<span style="color: #000080;">&gt;</span>;  <span style="color: #008000;">// Plot fitted data as red line</span>
	label <span style="color: #000080;">-</span>r legend;  <span style="color: #008000;">// Don't really need a legend, delete it</span>
	label <span style="color: #000080;">-</span>s <span style="color: #000080;">-</span>q <span style="color: #0000dd;">2</span> <span style="color: #000080;">-</span>n myLabel1 <span style="color: #ff00ff;">&quot;Linear Fit to&#160;%(1, @LM)%(CRLF)slope=$(slopes[ii-1])&quot;</span>;
<span style="color: #000000;">&#125;</span></pre>
<h3><a name="US_Total_Population"></a><span class="mw-headline">US Total Population</span></h3>
<p>The script below fit the total US population since the 1950s and project the year when the number will cross over into 400 million. 
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Get the US population data file from SP website</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;%YUSpop.txt&quot;</span>;
string url<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;https://research.stlouisfed.org/fred2/data/POP.txt&quot;</span>;
web2file;
if<span style="color: #000000;">&#40;</span>exist<span style="color: #000000;">&#40;</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	type <span style="color: #ff00ff;">&quot;failed to get &quot;</span> <span style="color: #000080;">+</span> url<span style="color: #000080;">$</span>;
	return <span style="color: #0000dd;">0</span>;
<span style="color: #000000;">&#125;</span>
<span style="color: #008000;">// Clean the project to start with empty space</span>
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">&#123;</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">&#125;</span>
newbook s<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> name<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;US Population&quot;</span>;
<span style="color: #008000;">// Import the data</span>
impAsc options.<span style="color: #000080;">sparklines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> options.<span style="color: #000080;">Miscellaneous</span>.<span style="color: #000080;">AllowAllText</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
wks.<span style="color: #000080;">nCols</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">7</span>;
wks.<span style="color: #000080;">Labels</span><span style="color: #000000;">&#40;</span>LU<span style="color: #000000;">&#41;</span>;
range aa <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>, bb <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>, yr <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>, pop <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>, param <span style="color: #000080;">=</span> <span style="color: #0000dd;">5</span>, fitx <span style="color: #000080;">=</span> <span style="color: #0000dd;">6</span>, fity <span style="color: #000080;">=</span> <span style="color: #0000dd;">7</span>;
int nMonths <span style="color: #000080;">=</span> aa.<span style="color: #000080;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
yr.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// X</span>
yr<span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Year&quot;</span>;
pop<span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;US Population&quot;</span>;
pop<span style="color: #000000;">&#91;</span>U<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Thousands&quot;</span>;
fitx.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;
fitx<span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;LR Fit X&quot;</span>;
fity<span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;LR Fit Y&quot;</span>;

int nYears <span style="color: #000080;">=</span> nMonths<span style="color: #000080;">/</span><span style="color: #0000dd;">12</span>;  <span style="color: #008000;">// Imported monthly data to get number of years</span>
<span style="color: #008000;">// Get April data to represent that year's value</span>
for<span style="color: #000000;">&#40;</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">16</span>, jj <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ii <span style="color: #000080;">&lt;=</span> nMonths; ii<span style="color: #000080;">+</span><span style="color: #000080;">=</span><span style="color: #0000dd;">12</span>, jj<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	string str<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> aa<span style="color: #000000;">&#91;</span>ii<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span>;
	string strYear<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> str.<span style="color: #000080;">left</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">4</span><span style="color: #000000;">&#41;</span><span style="color: #000080;">$</span>;
	yr<span style="color: #000000;">&#91;</span>jj<span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>strYear<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span>;
	pop<span style="color: #000000;">&#91;</span>jj<span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> bb<span style="color: #000000;">&#91;</span>ii<span style="color: #000000;">&#93;</span>;
<span style="color: #000000;">&#125;</span>
plotxy pop plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">201</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span><span style="color: #000000;">&#93;</span>;
y2 <span style="color: #000080;">=</span> <span style="color: #0000dd;">405000</span>;  <span style="color: #008000;">// Slightly above 400M</span>
x2 <span style="color: #000080;">=</span> <span style="color: #0000dd;">2060</span>;
fitlr;  <span style="color: #008000;">// Fit active plot of active graph</span>
fitx <span style="color: #000080;">=</span> data<span style="color: #000000;">&#40;</span>x1, x2<span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Increment of 1 = 1 year</span>
fity <span style="color: #000080;">=</span> fitlr.<span style="color: #000080;">a</span><span style="color: #000080;">+</span>fitlr.<span style="color: #000080;">b</span><span style="color: #000080;">*</span>fitx;
param<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> fitlr.<span style="color: #000080;">a</span>;
param<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> fitlr.<span style="color: #000080;">b</span>;
plotxy fity <span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;  <span style="color: #008000;">// Use default X for fity add to layer 1 without rescale</span>
<span style="color: #008000;">// Add a vertical line at where the fit Y is at 400M</span>
double yy <span style="color: #000080;">=</span> <span style="color: #0000dd;">400000</span>;
double xx <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span>yy<span style="color: #000080;">-</span>fitlr.<span style="color: #000080;">a</span><span style="color: #000000;">&#41;</span><span style="color: #000080;">/</span>fitlr.<span style="color: #000080;">b</span>;
type <span style="color: #ff00ff;">&quot;US Population will reach 400M at year $(xx,&#160;%d)&quot;</span>;
draw <span style="color: #000080;">-</span>l <span style="color: #000080;">-</span>v xx;
<span style="color: #008000;">// Let also remove the legend as we don't really need it</span>
label <span style="color: #000080;">-</span>r legend;</pre>
<h3><a name="Get_and_Change_Existing_Linear_Fit_Operation"></a><span class="mw-headline">Get and Change Existing Linear Fit Operation</span></h3>
<p>This example shows how to get an existing linear fit operation, then change some settings, and update the operation programmatically. This is equivalent to how user can in the GUI click the operation lock and select change parameters to change settings.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Open sample analysis template for linear regression</span>
string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Linear Regression.ogw&quot;</span>;
doc <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>path<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Set &quot;Data&quot; sheet of template active, and import sample data file</span>
page.<span style="color: #000080;">active</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Data&quot;</span>;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Sensor01.dat&quot;</span>;
impasc;

<span style="color: #008000;">// Get the operation tree from the linear fit report sheet</span>
op_change ir<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitLinear1<span style="color: #000080;">!</span> tr<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mytree;

<span style="color: #008000;">// Change intercept to be fixed to zero</span>
mytree.<span style="color: #000080;">gui</span>.<span style="color: #000080;">fit</span>.<span style="color: #000080;">FixIntercept</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
mytree.<span style="color: #000080;">gui</span>.<span style="color: #000080;">fit</span>.<span style="color: #000080;">FixInterceptAt</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;

<span style="color: #008000;">// Set tree back to change the operation and run</span>
op_change ir<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitLinear1<span style="color: #000080;">!</span> tr<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mytree op<span style="color: #000000;">:</span><span style="color: #000080;">=</span>run;</pre>
<h3><a name="Apparent_Linear_Fit_with_xop_X-Function_and_Get_Result_Tree"></a><span class="mw-headline">Apparent Linear Fit with xop X-Function and Get Result Tree</span></h3>
<p>This example shows how to perform apparent linear fit by using the <b>xop</b> X-Function, including creating the GUI tree, setting the parameters, running the fitting and generating result tree, and printing out the result from the output result tree.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Open sample data and create the desired graph</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Apparent Fit.dat&quot;</span>;
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">&#123;</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">&#125;</span>;  <span style="color: #008000;">// Clean the project to start with empty space</span>
newbook result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>apparentfit<span style="color: #000080;">$</span>;  <span style="color: #008000;">// Create a new workbook for data</span>
impasc;  <span style="color: #008000;">// Import data</span>
plotxy <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Make a scatter plot</span>
layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// Set Y axis type to Log10</span>
layer <span style="color: #000080;">-</span>a;  <span style="color: #008000;">// Rescale the layer</span>

<span style="color: #008000;">// Use the FitLinear class to create a GUI tree &quot;lrGUI&quot;</span>
tree lrGUI;
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>init classname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitLinear iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lrGUI;
<span style="color: #008000;">// Use the data in the active plot, no need to set dataset</span>
<span style="color: #008000;">// Set Apparent Fit</span>
lrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">Fit</span>.<span style="color: #000080;">ApparentFit</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
<span style="color: #008000;">// Run the fitting and get the result into tree &quot;lrOut&quot;</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>run iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lrGUI otrresult<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lrOut;
<span style="color: #008000;">// Clean up operation objects after fit</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cleanup;

<span style="color: #008000;">// Get the result from the output tree and print them</span>
type <span style="color: #ff00ff;">&quot;The fitted result is:&quot;</span>;
type <span style="color: #ff00ff;">&quot;A = $(lrOut.Summary.R1.Intercept_Value), Error = $(lrOut.Summary.R1.Intercept_Error)&quot;</span>;
type <span style="color: #ff00ff;">&quot;B = $(lrOut.Summary.R1.Slope_Value), Error = $(lrOut.Summary.R1.Slope_Error)&quot;</span>;
type <span style="color: #ff00ff;">&quot;Forumla is:&quot;</span>;
type <span style="color: #ff00ff;">&quot;y = $(lrOut.Summary.R1.Slope_Value,&#160;%3.2f)x + $(lrOut.Summary.R1.Intercept_Value,&#160;%3.2f)&quot;</span>;</pre>
<h2><a name="Perform_Linear_Regression_from_a_graph"></a><span class="mw-headline">Perform Linear Regression from a graph</span></h2>
<p>Perform Linear Regression from a graph with multiple dataplots in a single layer. Generate all fitted lines on graph and create fitting report table.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// first import some data</span>
filename<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Linear Fit.dat&quot;</span>; 
newbook;
impASC filename<span style="color: #000080;">$</span>;
 
 
<span style="color: #008000;">//create a graph with the data</span>
range data <span style="color: #000080;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000080;">&lt;</span>active<span style="color: #000080;">&gt;</span><span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">:</span> wcol<span style="color: #000000;">&#40;</span>wks.<span style="color: #000080;">ncols</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
plotxy data plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">201</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>active<span style="color: #000080;">&gt;</span>;  <span style="color: #008000;">// Plot source data as scatter</span>
 
 
<span style="color: #008000;">//use the FitLinear class to create a GUI tree &quot;lrGUI&quot;</span>
tree lrGUI;  
<span style="color: #008000;">// initialize the GUI tree, with the FitLinear class</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>init classname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitLinear iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lrGUI;
 
<span style="color: #008000;">//Specify all data plots on graph to be input data in the GUI tree</span>
ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
doc <span style="color: #000080;">-</span>e d <span style="color: #008000;">//loop all plots in the active layer</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #000080;">%</span>A <span style="color: #000080;">=</span>  xof<span style="color: #000000;">&#40;</span><span style="color: #000080;">%</span>C<span style="color: #000000;">&#41;</span>;   <span style="color: #008000;">//Specify XY datasets</span>
	lrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span>.<span style="color: #000080;">X</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>A;
	lrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span>.<span style="color: #000080;">Y</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>C;	
	range rPlot <span style="color: #000080;">=</span> <span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span>; <span style="color: #008000;">//define a labtalk range for each dataplot</span>
	int uid <span style="color: #000080;">=</span> range2uid<span style="color: #000000;">&#40;</span>rPlot<span style="color: #000000;">&#41;</span>; <span style="color: #008000;">//get the uid of the range</span>
	lrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span>.<span style="color: #000080;">SetAttribute</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;PlotObjUID&quot;</span>, <span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>uid<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// set the uid for plot</span>
	ii <span style="color: #000080;">=</span> ii <span style="color: #000080;">+</span> <span style="color: #0000dd;">1</span>;
<span style="color: #000000;">&#125;</span>
<span style="color: #008000;">// perform linear fit and generate a report with the prepared GUI tree</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>report iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lrGUI;
<span style="color: #008000;">// clean up linear fit operation objects after fitting</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cleanup;</pre>
<h2><a name="Polynomial_Fit"></a><span class="mw-headline">Polynomial Fit</span></h2>
<h3><a name="Time_Series_Data.2C_Fitting_the_RMB_Exchange_Rate"></a><span class="mw-headline">Time Series Data, Fitting the RMB Exchange Rate</span></h3>
<p>When X column contains date, it is internally in Julian Days and thus some very large numbers. Internally, special code was used to shift the data so that numeric computation round-off can be minized to produce a good fit. This example shows the fit to the RMB vs USD exchange rate before year of 2010.
</p><p><font color="red"><b>Following script requires the date format in your OS is MM/dd/yyyy (for example, 7/22/2005)</b></font>
</p><p><a  class="image"><img alt="RMB Exchange.png" src="../images/Curve_Fitting/RMB_Exchange.png?v=31934" width="317"  /></a>
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Get the file from SP website</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;%YDEXCHUS.txt&quot;</span>;
string url<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;https://research.stlouisfed.org/fred2/data/DEXCHUS.txt&quot;</span>;
web2file;
if<span style="color: #000000;">&#40;</span>exist<span style="color: #000000;">&#40;</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	type <span style="color: #ff00ff;">&quot;Failed to get &quot;</span> <span style="color: #000080;">+</span> url<span style="color: #000080;">$</span>;
	return <span style="color: #0000dd;">0</span>;
<span style="color: #000000;">&#125;</span>
<span style="color: #008000;">// Clean the project to start with empty space</span>
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">&#123;</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">&#125;</span>
newbook sheet<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
impAsc options.<span style="color: #000080;">sparklines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
wks.<span style="color: #000080;">col1</span>.<span style="color: #000080;">setFormat</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">4</span>, <span style="color: #0000dd;">22</span>, yyyy<span style="color: #ff00ff;">'-'</span>MM<span style="color: #ff00ff;">'-'</span>dd<span style="color: #000000;">&#41;</span>;
range dd <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>, val <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;
dd<span style="color: #000000;">&#91;</span>C<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Date&quot;</span>; val<span style="color: #000000;">&#91;</span>C<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;RMB vs USD&quot;</span>;
<span style="color: #008000;">// Clear of the Units and Long Name imported into wrong place</span>
dd<span style="color: #000000;">&#91;</span>U<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;&quot;</span>; val<span style="color: #000000;">&#91;</span>U<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;&quot;</span>;
dd<span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Date&quot;</span>; val<span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Rate&quot;</span>;
dd.<span style="color: #000080;">width</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">9</span>; val.<span style="color: #000080;">width</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">7</span>;
wks.<span style="color: #000080;">labels</span><span style="color: #000000;">&#40;</span>LC<span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Setup worksheet to store polynomial fit</span>
<span style="color: #008000;">// Setup the range variables, we are going to put all things into one worksheet</span>
range coef <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>, fitx <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>, fity <span style="color: #000080;">=</span> <span style="color: #0000dd;">5</span>, fitplot <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">4</span>, <span style="color: #0000dd;">5</span><span style="color: #000000;">&#41;</span>;
fitx <span style="color: #000080;">=</span> data<span style="color: #000000;">&#40;</span>date<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">9</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2005</span><span style="color: #000000;">&#41;</span>, date<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2010</span><span style="color: #000000;">&#41;</span>, <span style="color: #0000dd;">90</span><span style="color: #000000;">&#41;</span>;
fity <span style="color: #000080;">=</span> fitx;  <span style="color: #008000;">// Just to fill data so that column will be created</span>
fitx.<span style="color: #000080;">format</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// Date</span>
d0 <span style="color: #000080;">=</span> date<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">7</span><span style="color: #000080;">/</span><span style="color: #0000dd;">22</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2005</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// X (date) to begin to range to fit</span>
d1 <span style="color: #000080;">=</span> date<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">4</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2010</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// X (date) to end to range to fit</span>
ii <span style="color: #000080;">=</span> list<span style="color: #000000;">&#40;</span>d0, col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Find corresponding row</span>
jj <span style="color: #000080;">=</span> list<span style="color: #000000;">&#40;</span>d1, col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Find corresponding row</span>
<span style="color: #008000;">// Fit 3rd order polynomial and get only coefficients</span>
fitpoly <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span><span style="color: #000000;">:</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>jj<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#93;</span> <span style="color: #0000dd;">3</span> coef<span style="color: #000000;">:</span><span style="color: #000080;">=</span>coef;
fity <span style="color: #000080;">=</span> poly<span style="color: #000000;">&#40;</span>fitx, coef<span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Put in proper labels so they can appear in plot</span>
fitx.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// X column, not really needed for plotting, but good to see on worksheet</span>
fity<span style="color: #000000;">&#91;</span>C<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;3rd order polynomial fit&quot;</span>;
plotxy <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span> <span style="color: #0000dd;">200</span>;
x1 <span style="color: #000080;">=</span> d0<span style="color: #000080;">-</span><span style="color: #0000dd;">10</span>; x2 <span style="color: #000080;">=</span> date<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2010</span><span style="color: #000000;">&#41;</span>; x3 <span style="color: #000080;">=</span> <span style="color: #0000dd;">365</span>;  <span style="color: #008000;">// Inc by one year</span>
y1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">5</span>; y2 <span style="color: #000080;">=</span> <span style="color: #0000dd;">8.5</span>;
plotxy fitplot <span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;  <span style="color: #008000;">// Used saved plot range and add to layer 1 without rescale</span>
range pp <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// 2nd plot is our new fit curve</span>
set pp <span style="color: #000080;">-</span>c color<span style="color: #000000;">&#40;</span>red<span style="color: #000000;">&#41;</span>;</pre>
<h3><a name="Polynomial_Fit_with_xop_X-Function_and_Get_Result_Tree"></a><span class="mw-headline">Polynomial Fit with xop X-Function and Get Result Tree</span></h3>
<p>The example below demonstrates 2nd and 3rd order polynomial fit with the <b>xop</b> X-Function.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Open sample data</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Polynomial Fit.dat&quot;</span>;
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">&#123;</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">&#125;</span>;  <span style="color: #008000;">// Clean the project to start with empty space</span>
newbook result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyfit<span style="color: #000080;">$</span>;  <span style="color: #008000;">// Create a new workbook for data</span>
impasc;  <span style="color: #008000;">// Import data</span>
polyfit<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>H;  <span style="color: #008000;">// Get the current workbook name</span>

<span style="color: #008000;">// Setup the worksheet columns for the fitting results</span>
wks.<span style="color: #000080;">ncols</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">6</span>;  <span style="color: #008000;">// Add 3 more columns</span>
range coef <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>, fitx <span style="color: #000080;">=</span> <span style="color: #0000dd;">5</span>, fity <span style="color: #000080;">=</span> <span style="color: #0000dd;">6</span>, fitxy <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">5</span>, <span style="color: #0000dd;">6</span><span style="color: #000000;">&#41;</span>;
coef<span style="color: #000000;">&#91;</span>C<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;coefficients of 2nd polynomial fit&quot;</span>;
fitx.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// X column</span>
fitx <span style="color: #000080;">=</span> data<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">100</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Use the FitPolynomail class to create a GUI tree &quot;polyGUI&quot;</span>
tree polyGUI;
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>init classname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitPolynomial iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyGUI;
<span style="color: #008000;">// Set the input data</span>
polyGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">X</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;
polyGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">Y</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span>;
<span style="color: #008000;">// Run the fitting and get the result to tree &quot;polyOut&quot;</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>run iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyGUI otrresult<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyOut;
<span style="color: #008000;">// Clean up operation objects after fit</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cleanup;

<span style="color: #008000;">// Get the coefficients from the output tree</span>
coef<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Intercept</span>.<span style="color: #000080;">Value</span>;
coef<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">B1</span>.<span style="color: #000080;">Value</span>;
coef<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">3</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">B2</span>.<span style="color: #000080;">Value</span>;
<span style="color: #008000;">// Generate the fitted Y from X</span>
fity <span style="color: #000080;">=</span> poly<span style="color: #000000;">&#40;</span>fitx, coef<span style="color: #000000;">&#41;</span>;
fity<span style="color: #000000;">&#91;</span>C<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;2nd order polynomial fit&quot;</span>;
<span style="color: #008000;">// Make the plot</span>
plotxy <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Scatter</span>
plotxy fitxy <span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;  <span style="color: #008000;">// Line to the same layer</span>
range pp <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// 2nd plot is the new fitted curve</span>
set pp <span style="color: #000080;">-</span>c color<span style="color: #000000;">&#40;</span>red<span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Set color to red</span>

<span style="color: #008000;">// Do the similar to column 3</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>polyfit<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Activate the data workbook</span>
wks.<span style="color: #000080;">ncols</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">9</span>;  <span style="color: #008000;">// Add 3 more columns</span>
range coef1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">7</span>, fitx1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">8</span>, fity1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">9</span>, fitxy1 <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">8</span>, <span style="color: #0000dd;">9</span><span style="color: #000000;">&#41;</span>;
coef1<span style="color: #000000;">&#91;</span>C<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;coefficients of 3rd polynomial fit&quot;</span>;
fitx1.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// X column</span>
fitx1 <span style="color: #000080;">=</span> data<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">100</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Use the FitPolynomail class to create a GUI tree &quot;polyGUI&quot;</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>init classname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitPolynomial iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyGUI;
<span style="color: #008000;">// Set the input data</span>
polyGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">X</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;
polyGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">Y</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">3</span><span style="color: #000000;">&#41;</span>;
<span style="color: #008000;">// Set order to 3</span>
polyGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">Order</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;
<span style="color: #008000;">// Run the fitting and get the result to tree &quot;polyOut&quot;</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>run iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyGUI otrresult<span style="color: #000000;">:</span><span style="color: #000080;">=</span>polyOut;
<span style="color: #008000;">// Clean up operation objects after fit</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cleanup;

<span style="color: #008000;">// Get the coefficients from the output tree</span>
coef1<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Intercept</span>.<span style="color: #000080;">Value</span>;
coef1<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">B1</span>.<span style="color: #000080;">Value</span>;
coef1<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">3</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">B2</span>.<span style="color: #000080;">Value</span>;
coef1<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">4</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> polyOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">B3</span>.<span style="color: #000080;">Value</span>;
<span style="color: #008000;">// Generate the fitted Y from X</span>
fity1 <span style="color: #000080;">=</span> poly<span style="color: #000000;">&#40;</span>fitx1, coef1<span style="color: #000000;">&#41;</span>;
fity1<span style="color: #000000;">&#91;</span>C<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;3rd order polynomial fit&quot;</span>;
<span style="color: #008000;">// Make the plot</span>
plotxy <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">3</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Scatter</span>
plotxy fitxy1 <span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;  <span style="color: #008000;">// Line to the same layer</span>
range pp1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// 2nd plot is the new fitted curve</span>
set pp1 <span style="color: #000080;">-</span>c color<span style="color: #000000;">&#40;</span>red<span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Set color to red</span></pre>
<h2><a name="Multiple_Linear_Regression"></a><span class="mw-headline">Multiple Linear Regression</span></h2>
<h3><a name="Composite_Spectrum_Fitting_with_Multiple_Components"></a><span class="mw-headline">Composite Spectrum Fitting with Multiple Components</span></h3>
<p>There is a data for composite spectrum (y), together with two components (x1 and x2). We assume they have the following relationship. 
<img src="../images/Curve_Fitting/math-f7a96cf4fc957b2bf6d90416a6f47f82.png?v=0" title="y = \alpha + \beta_1x_1 + \beta_2x_2" alt="y = \alpha + \beta_1x_1 + \beta_2x_2" class="tex"/>
Then we can perform multiple linear fit for this model by using the <b>fitMr</b> X-Function, so to get the related parameters of this model. That is what this example is going to show.
</p>
<dl><dd><a  class="image"><img alt="Composite Spectrum.png" src="../images/Curve_Fitting/Composite_Spectrum.png?v=31922" width="338"  /></a></dd></dl>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Open sample data</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Composite Spectrum.dat&quot;</span>;
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">&#123;</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">&#125;</span>;  <span style="color: #008000;">// Clean the project to start with empty space</span>
newbook;  <span style="color: #008000;">// Create a new workbook for data</span>
impasc;  <span style="color: #008000;">// Import data</span>
wks.<span style="color: #000080;">addCol</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Add a column for fitted value of dependent</span>
col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">5</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Fitted Composite&quot;</span>;  <span style="color: #008000;">// Long Name</span>

<span style="color: #008000;">// Perform multiple linear fit</span>
<span style="color: #008000;">// col(4) = y, col(2) = x1, col(3) = x2, col(5) = fitted y</span>
<span style="color: #008000;">// Result is stored in tree trMr</span>
fitmr dep<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">4</span><span style="color: #000000;">&#41;</span> indep<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">:</span>col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">3</span><span style="color: #000000;">&#41;</span> mrtree<span style="color: #000000;">:</span><span style="color: #000080;">=</span>trMr odep<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">5</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Plot Composite and Fitted Composite into the same graph, vs Index in col(1)</span>
range rxy <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">4</span><span style="color: #000000;">&#41;</span>, rfitxy <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">5</span><span style="color: #000000;">&#41;</span>;
plotxy rxy <span style="color: #0000dd;">201</span>;  <span style="color: #008000;">// scatter</span>
plotxy rfitxy plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> color<span style="color: #000000;">:</span><span style="color: #000080;">=</span>color<span style="color: #000000;">&#40;</span>red<span style="color: #000000;">&#41;</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>active<span style="color: #000080;">&gt;</span>;  <span style="color: #008000;">// Red line plot</span>

<span style="color: #008000;">// Add label to show the fitting parameters</span>
label <span style="color: #000080;">-</span>s <span style="color: #000080;">-</span>q <span style="color: #0000dd;">2</span> <span style="color: #000080;">-</span>n myLabel1 <span style="color: #ff00ff;">&quot;Fitted Function: y = Alpha + Beta1*x1 + Beta2*x2
Alpha = $(trMr.v1,&#160;%3.2f)
Beta1 = $(trMR.v2,&#160;%.2f)
Beta2 = $(trMr.v3,&#160;%.2f)&quot;</span>;</pre>
<h3><a name="Multiple_Linear_Regression_with_xop_X-Function_and_Get_Result_Tree"></a><span class="mw-headline">Multiple Linear Regression with xop X-Function and Get Result Tree</span></h3>
<p>The expression of 3rd order polynomial fit is <img src="../images/Curve_Fitting/math-3134961dcb0baf5e7f055a8632c8669d.png?v=0" title="y = \alpha + \beta_1x + \beta_2x^2 + \beta_3x^3" alt="y = \alpha + \beta_1x + \beta_2x^2 + \beta_3x^3" class="tex"/>. In this example, we are going to consider <img src="../images/Curve_Fitting/math-9dd4e461268c8034f5c8564e155c67a6.png?v=0" title="x" alt="x" class="tex"/> as <img src="../images/Curve_Fitting/math-aa687da0086c1ea060a8838e24611319.png?v=0" title="x_1" alt="x_1" class="tex"/>, <img src="../images/Curve_Fitting/math-32f5240d0dbf2ccbe75ef7f8ef2015e0.png?v=0" title="x^2" alt="x^2" class="tex"/> as <img src="../images/Curve_Fitting/math-8732099f74d777a67257cb2f04ead3d8.png?v=0" title="x_2" alt="x_2" class="tex"/>, and <img src="../images/Curve_Fitting/math-8c0fb3b076d9aea142467b34f0f794eb.png?v=0" title="x^3" alt="x^3" class="tex"/> as <img src="../images/Curve_Fitting/math-28c5eac946471f68eefb01f7a53b1844.png?v=0" title="x_3" alt="x_3" class="tex"/>, that is <img src="../images/Curve_Fitting/math-c7d8ab9f725785c7dbd7d3f9d2ee3940.png?v=0" title="y=\alpha+\beta_1x_1+\beta_2x_2+\beta_3x_3" alt="y=\alpha+\beta_1x_1+\beta_2x_2+\beta_3x_3" class="tex"/>, which has 3 independents, then perform multiple linear regression with the <b>xop</b> X-Function, and get the result into a tree. And it will get the same parameter result as 3rd order polynomial fit.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Open sample data</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Polynomial Fit.dat&quot;</span>;
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">&#123;</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">&#125;</span>;  <span style="color: #008000;">// Clean the project to start with empty space</span>
newbook;  <span style="color: #008000;">// Create a new workbook for data</span>
impasc;  <span style="color: #008000;">// Import data</span>
wks.<span style="color: #000080;">nCols</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">7</span>;  <span style="color: #008000;">// Add 4 more columns for generating desired data</span>
col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">4</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// X1</span>
col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">5</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000080;">^</span><span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// X2</span>
col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">6</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000080;">^</span><span style="color: #0000dd;">3</span>;  <span style="color: #008000;">// X3</span>
col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">7</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">3</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Y</span>

<span style="color: #008000;">// Use the MR class to create a GUI tree mrGUI</span>
tree mrGUI;
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>init classname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>MR iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mrGUI;
<span style="color: #008000;">// Set the input data</span>
mrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">X</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">4</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">:</span>col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">6</span><span style="color: #000000;">&#41;</span>;
mrGUI.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">InputData</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">Y</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">7</span><span style="color: #000000;">&#41;</span>;
<span style="color: #008000;">// Run the fitting and get the result to tree mrOut</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>run iotrgui<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mrGUI otrresult<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mrOut;
<span style="color: #008000;">// Clean up operation objects after fit</span>
xop execute<span style="color: #000000;">:</span><span style="color: #000080;">=</span>cleanup;

<span style="color: #008000;">// Output the results</span>
double alpha <span style="color: #000080;">=</span> mrOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Intercept</span>.<span style="color: #000080;">Value</span>;
double beta1 <span style="color: #000080;">=</span> mrOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">D</span>.<span style="color: #000080;">Value</span>;
double beta2 <span style="color: #000080;">=</span> mrOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">E</span>.<span style="color: #000080;">Value</span>;
double beta3 <span style="color: #000080;">=</span> mrOut.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">F</span>.<span style="color: #000080;">Value</span>;
type <span style="color: #ff00ff;">&quot;Alpha = $(alpha)&quot;</span>;
type <span style="color: #ff00ff;">&quot;Beta1 = $(beta1)&quot;</span>;
type <span style="color: #ff00ff;">&quot;Beta2 = $(beta2)&quot;</span>;
type <span style="color: #ff00ff;">&quot;Beta3 = $(beta3)&quot;</span>;
type <span style="color: #ff00ff;">&quot;Expression is:&quot;</span>;
type <span style="color: #ff00ff;">&quot;y = $(alpha,&#160;%4.2f) + $(beta1,&#160;%4.2f)x1 + $(beta2,&#160;%3.2f)x2 + $(beta3,&#160;%.2f)x3&quot;</span>;</pre>
<h2><a name="Nonlinear_Fit"></a><span class="mw-headline">Nonlinear Fit</span></h2>
<p>A new set of X-Functions to control the new Origin 8 NLFit engine were added in SR2.
</p>
<h3><a name="Predicting_Further_Strengthening_of_the_Chinese_Currency"></a><span class="mw-headline">Predicting Further Strengthening of the Chinese Currency</span></h3>
<p>The follow script make use of these new XF, to show how to fit the RMB and USD exchange rate since July 2005 and to extrapolate up to the year 2013.
<font color="red"><b>Following script requires the date format in your OS is MM/dd/yyyy (for example, 7/22/2005)</b></font>
</p>
<dl><dd><a  class="image"><img alt="Chinese Currency.png" src="../images/Curve_Fitting/Chinese_Currency.png?v=31925" width="324"  /></a></dd></dl>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Get the file from SP website</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;%YDEXCHUS.txt&quot;</span>;
if<span style="color: #000000;">&#40;</span>exist<span style="color: #000000;">&#40;</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>  <span style="color: #008000;">// File not yet download, lets try to get it</span>
	string url<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;https://research.stlouisfed.org/fred2/data/DEXCHUS.txt&quot;</span>;
	web2file;
	if<span style="color: #000000;">&#40;</span>exist<span style="color: #000000;">&#40;</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
		type <span style="color: #ff00ff;">&quot;Failed to get &quot;</span> <span style="color: #000080;">+</span> url<span style="color: #000080;">$</span>;
		return <span style="color: #0000dd;">0</span>;
	<span style="color: #000000;">&#125;</span>
<span style="color: #000000;">&#125;</span>
<span style="color: #008000;">// Clean the project to start with empty space</span>
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">&#123;</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">&#125;</span>
newbook sheet<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
impAsc options.<span style="color: #000080;">sparklines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
wks.<span style="color: #000080;">col1</span>.<span style="color: #000080;">setFormat</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">4</span>, <span style="color: #0000dd;">22</span>, yyyy<span style="color: #ff00ff;">'-'</span>MM<span style="color: #ff00ff;">'-'</span>dd<span style="color: #000000;">&#41;</span>;
range dd <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>, val <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;
dd<span style="color: #000000;">&#91;</span>C<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Date&quot;</span>; val<span style="color: #000000;">&#91;</span>C<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;RMB vs USD&quot;</span>;
<span style="color: #008000;">// Clear of the Units and Long Name imported into wrong place</span>
dd<span style="color: #000000;">&#91;</span>U<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;&quot;</span>; val<span style="color: #000000;">&#91;</span>U<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;&quot;</span>;
dd<span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Date&quot;</span>; val<span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Rate&quot;</span>;
dd.<span style="color: #000080;">width</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">9</span>; val.<span style="color: #000080;">width</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">7</span>;
wks.<span style="color: #000080;">labels</span><span style="color: #000000;">&#40;</span>LC<span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Create a new worksheet to hold the estimates from the fitting</span>
newsheet name<span style="color: #000000;">:</span><span style="color: #000080;">=</span>Predict label<span style="color: #000000;">:</span><span style="color: #000080;">=</span>Date<span style="color: #000080;">|</span>Estimate;
range fitx <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>, fity <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>, fitplot <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Save the ranges, including fitplot for later plotting</span>
fitx.<span style="color: #000080;">format</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// Date</span>
fitx <span style="color: #000080;">=</span> data<span style="color: #000000;">&#40;</span>date<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">9</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2005</span><span style="color: #000000;">&#41;</span>, date<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2013</span><span style="color: #000000;">&#41;</span>, <span style="color: #0000dd;">90</span><span style="color: #000000;">&#41;</span>;
fity<span style="color: #000000;">&#91;</span>C<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Result from ExpDecay2 fit&quot;</span>;
page.<span style="color: #000080;">active</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// Switch back to imported data</span>

<span style="color: #008000;">// USD devaluation vs RMB started on July 22, 2005, ended on Jan 1, 2013</span>
d0 <span style="color: #000080;">=</span> date<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">7</span><span style="color: #000080;">/</span><span style="color: #0000dd;">22</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2005</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Save this date</span>
d1 <span style="color: #000080;">=</span> date<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2013</span><span style="color: #000000;">&#41;</span>;
ii <span style="color: #000080;">=</span> list<span style="color: #000000;">&#40;</span>d0, col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Find corresponding row</span>
jj <span style="color: #000080;">=</span> list<span style="color: #000000;">&#40;</span>d1, col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
rate0 <span style="color: #000080;">=</span> col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>ii<span style="color: #000000;">&#93;</span>;  <span style="color: #008000;">// Save this value</span>
rate1 <span style="color: #000080;">=</span> col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>jj<span style="color: #000000;">&#93;</span>;
plotxy <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span><span style="color: #000000;">:</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>jj<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#93;</span> <span style="color: #0000dd;">200</span>;  <span style="color: #008000;">// Plot the data since devaluation</span>
x1 <span style="color: #000080;">=</span> date<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">7</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2005</span><span style="color: #000000;">&#41;</span>; x2 <span style="color: #000080;">=</span> date<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">1</span><span style="color: #000080;">/</span><span style="color: #0000dd;">2013</span><span style="color: #000000;">&#41;</span>; y1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">5</span>;  <span style="color: #008000;">// Set X, Y axis scale</span>

<span style="color: #008000;">// Start the fitting on the graph</span>
nlbegin <span style="color: #0000dd;">1</span> ExpDecay2 tt;
tt.<span style="color: #000080;">x0</span> <span style="color: #000080;">=</span> d0; tt.<span style="color: #000080;">f_x0</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// First fix the x0 value at that initial date</span>
tt.<span style="color: #000080;">y0</span> <span style="color: #000080;">=</span> rate0; tt.<span style="color: #000080;">f_y0</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// Also fix y0</span>
tt.<span style="color: #000080;">A1</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
nlfit <span style="color: #0000dd;">3</span>;  <span style="color: #008000;">// Do only 3 iterations</span>
tt.<span style="color: #000080;">f_x0</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; tt.<span style="color: #000080;">f_y0</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;  <span style="color: #008000;">// Then relax the x0 and y0 to fit with default max iterations</span>
nlfit;
<span style="color: #008000;">// Now we can generate the fit curve</span>
fity <span style="color: #000080;">=</span> fit<span style="color: #000000;">&#40;</span>fitx<span style="color: #000000;">&#41;</span>;
nlend;  <span style="color: #008000;">// All done with fitting, can terminate it now</span>

<span style="color: #008000;">// Add fit curve to this plot as well</span>
<span style="color: #008000;">// Used saved plot range and add to layer 1 without rescale</span>
plotxy fitplot <span style="color: #0000dd;">200</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span> color<span style="color: #000000;">:</span><span style="color: #000080;">=</span>color<span style="color: #000000;">&#40;</span>red<span style="color: #000000;">&#41;</span>;</pre>
<h3><a name="Fit_Multiple_Peaks_with_Replica"></a><span class="mw-headline">Fit Multiple Peaks with Replica</span></h3>
<p>The follow script shows how to fit a dataset, where the baselines has been subtracted, with multiple peaks.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Clear the project to start with empty space</span>
doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">&#123;</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">&#125;</span>

<span style="color: #008000;">// Import sample data into a new workbook</span>
newbook;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Multiple Peaks.dat&quot;</span>;
impAsc;

<span style="color: #008000;">// Do fitting on col(C), we could pick any starting with col(B) in this data</span>
range aa <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">3</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// A(x), C(y)</span>
int nCumFitCol <span style="color: #000080;">=</span> wks.<span style="color: #000080;">nCols</span><span style="color: #000080;">+</span><span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// New column for the fit Y values</span>

<span style="color: #008000;">// For our data, we know to fit 4 gauss peaks, so set replica to 3 (peak number = replica+1)</span>
nlbegin aa gauss tt replica<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>;
nlfit;
range yy <span style="color: #000080;">=</span> nCumFitCol;
yy <span style="color: #000080;">=</span> fit<span style="color: #000000;">&#40;</span>col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Call fit(x) without peak index will generate the cummulative peak</span>
yy<span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Fit Y&quot;</span>;
loop<span style="color: #000000;">&#40;</span>ii, <span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">4</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	range pk <span style="color: #000080;">=</span> wcol<span style="color: #000000;">&#40;</span>nCumFitCol<span style="color: #000080;">+</span>ii<span style="color: #000000;">&#41;</span>;
	pk <span style="color: #000080;">=</span> fit<span style="color: #000000;">&#40;</span>col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>, ii<span style="color: #000000;">&#41;</span>;
	pk<span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Peak$(ii)&quot;</span>;
<span style="color: #000000;">&#125;</span>
nlend;

<span style="color: #008000;">// Plot both src and fit in the new graph</span>
plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#40;</span>A,C<span style="color: #000000;">&#41;</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">201</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span><span style="color: #000000;">&#93;</span>;
plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span>MultiplePeaks<span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">&#40;</span>A,<span style="color: #ff00ff;">&quot;Fit Y&quot;</span><span style="color: #000000;">&#41;</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span>  ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span>Layer1 color<span style="color: #000000;">:</span><span style="color: #000080;">=</span>color<span style="color: #000000;">&#40;</span>red<span style="color: #000000;">&#41;</span>;</pre>
<h3><a name="Global_Fit_with_Parameter_Sharing_on_Plot_Segments"></a><span class="mw-headline">Global Fit with Parameter Sharing on Plot Segments</span></h3>
<p>The following script runs nonlinear fit to 3 exponential decay datasets on their tail segments.
</p>
<pre class="lt" style="font-family:monospace;">doc <span style="color: #000080;">-</span>s; doc <span style="color: #000080;">-</span>n; <span style="color: #000000;">&#123;</span>win <span style="color: #000080;">-</span>cd;<span style="color: #000000;">&#125;</span>  <span style="color: #008000;">// Clean up workspace</span>
newbook sheet<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// Data sheet and fit curve sheet</span>
range ss2 <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span><span style="color: #000080;">!</span>;
ss2.<span style="color: #000080;">name</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Fit Curves&quot;</span>;
ss2.<span style="color: #000080;">nCols</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// x, fity1, 2, 3</span>

<span style="color: #008000;">// Switch back to first worksheet to import data</span>
page.<span style="color: #000080;">active</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Exponential Decay.dat&quot;</span>;
impAsc;
<span style="color: #008000;">// Save the data workbook name</span>
string strData<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>H;
plotxy <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">:</span>end<span style="color: #000000;">&#41;</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span><span style="color: #000000;">&#93;</span>;
x1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; x2 <span style="color: #000080;">=</span> <span style="color: #0000dd;">1.1</span>;
sec <span style="color: #000080;">-</span>p <span style="color: #0000dd;">0.1</span>;  <span style="color: #008000;">// This is needed to allow plot to draw before we can set increment (x3)</span>
x3 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0.2</span>;
sec <span style="color: #000080;">-</span>p <span style="color: #0000dd;">0.1</span>;  <span style="color: #008000;">// More time to refresh to allow subsequent range declaration to work properly</span>
<span style="color: #008000;">// Do fitting from 0.2 sec to the end, so need to first find the row index of 0.2 sec</span>
range p1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// Use first data plot, as all share same X</span>
int i1 <span style="color: #000080;">=</span> xindex<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0.2</span>, p1<span style="color: #000000;">&#41;</span>;
range aa <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span>, <span style="color: #0000dd;">3</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>i1<span style="color: #000000;">&#41;</span><span style="color: #000000;">:</span>end<span style="color: #000000;">&#93;</span>;  <span style="color: #008000;">// Select plot 1, 2, 3</span>

nlbegin aa ExpDec1 tt;
<span style="color: #008000;">// Share t1</span>
tt.<span style="color: #000080;">s_t1</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
nlfit;
<span style="color: #008000;">// Now generate the fit curves and plot them</span>
range fx <span style="color: #000080;">=</span> <span style="color: #000000;">&#91;</span>strData<span style="color: #000080;">$</span><span style="color: #000000;">&#93;</span><span style="color: #0000dd;">2</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span>;
fx <span style="color: #000080;">=</span> data<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">0.02</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Generate the X column for all the fits</span>
for<span style="color: #000000;">&#40;</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ii <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">3</span>; ii<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	range yy <span style="color: #000080;">=</span> <span style="color: #000000;">&#91;</span>strData<span style="color: #000080;">$</span><span style="color: #000000;">&#93;</span><span style="color: #0000dd;">2</span><span style="color: #000080;">!</span>wcol<span style="color: #000000;">&#40;</span>ii<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;
	yy<span style="color: #000000;">&#91;</span>C<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Fit Curve $(ii)&quot;</span>;
	yy <span style="color: #000080;">=</span> fit<span style="color: #000000;">&#40;</span>fx, ii<span style="color: #000000;">&#41;</span>;
	plotxy yy <span style="color: #0000dd;">200</span>, ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span> rescale<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> color<span style="color: #000000;">:</span><span style="color: #000080;">=</span>color<span style="color: #000000;">&#40;</span>red<span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span>
nlend;</pre>
<h3><a name="Creating_Multiple_Simulated_Curves_With_a_User-Defined_Fitting_Function"></a><span class="mw-headline">Creating Multiple Simulated Curves With a User-Defined Fitting Function</span></h3>
<p>This example shows how to use nlfit X-functions to perform simulation of a user-defined fitting function. The fitting function <i>MyFitFunc</i> is assumed to have two parameters named a and b.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Start a new workbook which will have two columns by default</span>
newbook;

<span style="color: #008000;">// Fill first column with desired X values for simulation</span>
col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">=</span> <span style="color: #000000;">&#123;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">:</span><span style="color: #0000dd;">0.1</span><span style="color: #000000;">:</span><span style="color: #0000dd;">4</span><span style="color: #000000;">&#125;</span>;

<span style="color: #008000;">// Leave column 2 blank and initiate fit using your function</span>
nlbegin iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> func<span style="color: #000000;">:</span><span style="color: #000080;">=</span>MyFitFunc nltree<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mytree;

<span style="color: #008000;">// Loop over desired parameter values, change as needed</span>
<span style="color: #008000;">// Here it is assumed the fitting function has two parameters: a and b</span>
for<span style="color: #000000;">&#40;</span>double a <span style="color: #000080;">=</span> <span style="color: #0000dd;">1.0</span>; a <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">3.0</span>; a<span style="color: #000080;">+</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0.5</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	for<span style="color: #000000;">&#40;</span>double b <span style="color: #000080;">=</span> <span style="color: #0000dd;">3.0</span>; b <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">12.0</span>; b<span style="color: #000080;">+</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2.0</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
		type <span style="color: #ff00ff;">&quot;a = $(a), b = $(b)&quot;</span>;
		<span style="color: #008000;">// Add a new column to receive the simulated curve</span>
		wks.<span style="color: #000080;">addCol</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
		int nCol <span style="color: #000080;">=</span> wks.<span style="color: #000080;">nCols</span>;
		<span style="color: #008000;">// Set parameter values to tree</span>
		mytree.<span style="color: #000080;">a</span> <span style="color: #000080;">=</span> a;
		mytree.<span style="color: #000080;">b</span> <span style="color: #000080;">=</span> b;
		<span style="color: #008000;">// Do zero iterations to update fit</span>
		nlfit<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>;
		<span style="color: #008000;">// Use fit() function to generate fit curve to last column using 1st column as X</span>
		wcol<span style="color: #000000;">&#40;</span>nCol<span style="color: #000000;">&#41;</span> <span style="color: #000080;">=</span> fit<span style="color: #000000;">&#40;</span>col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
		<span style="color: #008000;">// Add comment to column with parameter values used</span>
		string str<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;a = $(a), b = $(b)&quot;</span>;
		wcol<span style="color: #000000;">&#40;</span>nCol<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>C<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> str<span style="color: #000080;">$</span>;
	<span style="color: #000000;">&#125;</span>
<span style="color: #000000;">&#125;</span>
<span style="color: #008000;">// End the fitting process</span>
nlend<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Delete 2nd column which is empty, was dummy y, and then plot all columns</span>
delete wcol<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span>;
plotxy <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">:</span>end<span style="color: #000000;">&#41;</span> <span style="color: #0000dd;">200</span>;</pre>
<p>To learn more about how to create a user-defined fitting function, please refer to the <a class="external text" href="../../Tutorial/Tutorial/User_Defined_Fitting_Function_using_OC.html">curve fitting tutorial</a>
</p>
<h3><a name="Fit_Parameter_Rearrangement_in_Post_Fit_Worsksheet_Script"></a><span class="mw-headline">Fit Parameter Rearrangement in Post Fit Worsksheet Script</span></h3>
<p>After a fit is performed, a general report sheet is created that include many output tables, among them a fitting parameters table. The layout of these tables may not be in the form that you would like them to be in, so you may need to rearrange the fit parameters and to have this rearrangement to take place automatically after the fit is recalculated. 
</p><p>The following example shows how you can write script to rearrange the parameters into a new sheet such that each row is for one set of data, with columns arranged as follows:
</p>
<ol><li>Name, the input dataset's long name</li>
<li>P1, the first parameter's value</li>
<li>E1, the first parameter's error</li>
<li>P2, the second parameter's value</li>
<li>E2, the second paremeter's error</li></ol>
<p>and so on. It will also put the reduced chisqr value into the last column. 
</p>
<h4><a name="Worksheet_Script"></a><span class="mw-headline">Worksheet Script</span></h4>
<p>The script should be put into the Worksheet Script dialog and have it run after the Analysis Report sheet is changed.
</p>
<pre class="lt" style="font-family:monospace;">Tree tt;
getnlr tr<span style="color: #000000;">:</span><span style="color: #000080;">=</span>tt iw<span style="color: #000000;">:</span><span style="color: #000080;">=</span>__Report<span style="color: #000080;">$</span> p<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;

int nTotalParamsPerSet <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
for<span style="color: #000000;">&#40;</span>int idx <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; idx <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">0</span>; idx<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	if<span style="color: #000000;">&#40;</span>tt.<span style="color: #000080;">p</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>idx<span style="color: #000000;">&#41;</span> <span style="color: #000080;">!</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span><span style="color: #000080;">/</span><span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>
		nTotalParamsPerSet<span style="color: #000080;">++</span>;
	else
		break;
<span style="color: #000000;">&#125;</span>
nTotalParamsPerSet <span style="color: #000080;">/</span><span style="color: #000080;">=</span> tt.<span style="color: #000080;">nsets</span>;

wks.<span style="color: #000080;">nCols</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;  <span style="color: #008000;">// Clear the worksheet</span>
col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Data&quot;</span>;
wks.<span style="color: #000080;">col1</span>.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;  <span style="color: #008000;">// X column</span>

for<span style="color: #000000;">&#40;</span>int nn <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; nn <span style="color: #000080;">&lt;=</span> nTotalParamsPerSet; nn<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	int nCol <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span>nn<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000080;">*</span><span style="color: #0000dd;">2</span><span style="color: #000080;">+</span><span style="color: #0000dd;">2</span>;
	wcol<span style="color: #000000;">&#40;</span>nCol<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">n</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>nn<span style="color: #000000;">&#41;</span><span style="color: #000080;">$</span>;
	wcol<span style="color: #000000;">&#40;</span>nCol<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">n</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>nn<span style="color: #000000;">&#41;</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;_Error&quot;</span>;
	wks.<span style="color: #000080;">col</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>nCol<span style="color: #000000;">&#41;</span>.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// Y column</span>
	wks.<span style="color: #000080;">col</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>nCol<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;  <span style="color: #008000;">// Y Error</span>
<span style="color: #000000;">&#125;</span>

int nChiSqrCol <span style="color: #000080;">=</span> nTotalParamsPerSet<span style="color: #000080;">*</span><span style="color: #0000dd;">2</span><span style="color: #000080;">+</span><span style="color: #0000dd;">2</span>;
wcol<span style="color: #000000;">&#40;</span>nChiSqrCol<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Reduced Chi-Sqr&quot;</span>;

for<span style="color: #000000;">&#40;</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ii <span style="color: #000080;">&lt;=</span> tt.<span style="color: #000080;">nsets</span>; ii<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>ii<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">Data</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span>.<span style="color: #000080;">Name</span><span style="color: #000080;">$</span>;
	for<span style="color: #000000;">&#40;</span>int jj <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; jj <span style="color: #000080;">&lt;=</span> nTotalParamsPerSet; jj<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
		int nCol <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span>jj<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000080;">*</span><span style="color: #0000dd;">2</span><span style="color: #000080;">+</span><span style="color: #0000dd;">2</span>;
		wcol<span style="color: #000000;">&#40;</span>nCol<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>ii<span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">p</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000080;">*</span>nTotalParamsPerSet<span style="color: #000080;">+</span>jj<span style="color: #000000;">&#41;</span>;
		wcol<span style="color: #000000;">&#40;</span>nCol<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>ii<span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">e</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000080;">*</span>nTotalParamsPerSet<span style="color: #000080;">+</span>jj<span style="color: #000000;">&#41;</span>;
	<span style="color: #000000;">&#125;</span>
	if<span style="color: #000000;">&#40;</span>tt.<span style="color: #000080;">nsets</span> <span style="color: #000080;">==</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>
		wcol<span style="color: #000000;">&#40;</span>nChiSqrCol<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>ii<span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">chisqr</span>;
	else
		wcol<span style="color: #000000;">&#40;</span>nChiSqrCol<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>ii<span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> tt.<span style="color: #000080;">chisqr</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span></pre>
<h4><a name="Setting_up_the_Analysis_Template"></a><span class="mw-headline">Setting up the Analysis Template</span></h4>
<p>To set up the analysis template with this script, you need to do the following:
</p>
<ol><li> Perform the fit as you normally would, accepting default to put report sheets into same book as the input data sheet. You should see a report sheet called FitNL1 created if you have not performed other fits in the same book, as otherwise it might be called FitNL2.</li>
<li> Add a new sheet and give it any name, for example, you can call it FitParams</li>
<li> With this FitParams sheet active, open from the main menu Worksheet-&gt;Worksheet Script dialog</li>
<li> Copy paste the script above into the big edit box in the lower part of the dialog.</li>
<li> Make sure <b>Support Single line statements without ";" termination</b> is unchecked, as this was due to historical reason when we allow user to enter scripts without&#160;; termination</li>
<li> Check the box <b>Upon Changes in Range</b></li>
<li> Enter the range string for the report sheet as <b>FitNL1!</b>, please note that terminating&#160;! is needed to indicate a sheet range such that any change in that sheet will trigger this script to run.</li>
<li> click the <b>Update</b> button to save the script to the FitParams sheet</li></ol>
<p>Now if you put in new data in the original input sheet, the FitParams sheet will update to have the rearranged parameters. To then save this book as Analysis Template:
</p>
<ol><li> Do a Clear Worksheet on the FitParams sheet so you know the current result is deleted.</li>
<li> Click the input data sheet and also do a <b>Clear Worksheet</b> to ensure both the input and the report sheets are all cleaned up.</li>
<li> With the input data sheet active, choose <b>File-&gt;Save Window As</b> from the main menu to save into an ogw file.</li></ol>
<p>Now the Analysis Template is saved and you can easily open it again from <b>File-&gt;Recent Books</b>.
</p>
<h3><a name="Fit_Multiple_Columns_in_a_Worksheet"></a><span class="mw-headline">Fit Multiple Columns in a Worksheet</span></h3>
<p>The following script fits multiple columns in a single worksheet and generates a table of results in a second sheet. This script requires Origin <font color="red">8.1</font> due to the use of <b>Function</b> feature.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Define a function to be used later in the script</span>
function int FitOneData<span style="color: #000000;">&#40;</span>range xyin, string strFunc<span style="color: #000080;">$</span>, ref tree trResults<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	nlbegin iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span>xyin func<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strFunc<span style="color: #000080;">$</span> nltree<span style="color: #000000;">:</span><span style="color: #000080;">=</span>trResults;
	nlfit;
	nlend;
	return trResults.<span style="color: #000080;">niter</span>;
<span style="color: #000000;">&#125;</span>

<span style="color: #008000;">// Import sample data into new worksheet and make it active</span>
newbook;  <span style="color: #008000;">// Newbook default to create one worksheet</span>
range rngSrcWks <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;  <span style="color: #008000;">// Use 1st worksheet as source data</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Multiple Gaussians.dat&quot;</span>;
impAsc;

<span style="color: #008000;">// Multiple Gaussians.dat does not have column name, we will generate some</span>
int ii;
loop<span style="color: #000000;">&#40;</span>ii, <span style="color: #0000dd;">2</span>, rngSrcWks.<span style="color: #000080;">nCols</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	range cc <span style="color: #000080;">=</span> wcol<span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span>;
	cc<span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Sample $(ii-1)&quot;</span>;
<span style="color: #000000;">&#125;</span>
<span style="color: #008000;">// Create a result sheet to collect the fit result</span>
<span style="color: #008000;">// Only to get center and AdjR etc.</span>
newsheet name<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Results&quot;</span> labels<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Name|Center|AdjR|Iterations&quot;</span> active<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
range rName <span style="color: #000080;">=</span> Results<span style="color: #000080;">!</span>col<span style="color: #000000;">&#40;</span>Name<span style="color: #000000;">&#41;</span>;
range rCenter <span style="color: #000080;">=</span> Results<span style="color: #000080;">!</span>col<span style="color: #000000;">&#40;</span>Center<span style="color: #000000;">&#41;</span>;
range rAdjR <span style="color: #000080;">=</span> Results<span style="color: #000080;">!</span>col<span style="color: #000000;">&#40;</span>AdjR<span style="color: #000000;">&#41;</span>;
range rIter <span style="color: #000080;">=</span> Results<span style="color: #000080;">!</span>col<span style="color: #000000;">&#40;</span>Iterations<span style="color: #000000;">&#41;</span>;
loop<span style="color: #000000;">&#40;</span>ii, <span style="color: #0000dd;">2</span>, rngSrcWks.<span style="color: #000080;">nCols</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	int rr <span style="color: #000080;">=</span> ii<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span>;
	range rngInput <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
	tree tr;
	int nn <span style="color: #000080;">=</span> FitOneData<span style="color: #000000;">&#40;</span>rngInput, <span style="color: #ff00ff;">&quot;gauss&quot;</span>, tr<span style="color: #000000;">&#41;</span>;
	<span style="color: #008000;">// Put result to worksheet</span>
	rName<span style="color: #000000;">&#91;</span>rr<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> rngInput<span style="color: #000000;">&#91;</span>L<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span>;
	rCenter<span style="color: #000000;">&#91;</span>rr<span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> tr.<span style="color: #000080;">xc</span>;
	rAdjR<span style="color: #000000;">&#91;</span>rr<span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> tr.<span style="color: #000080;">adjr</span>;
	rIter<span style="color: #000000;">&#91;</span>rr<span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> nn;
<span style="color: #000000;">&#125;</span></pre>
<h3><a name="Change_Parameters_of_an_Existing_Operation"></a><span class="mw-headline">Change Parameters of an Existing Operation</span></h3>
<p>If you have an Analysis Template and you want to change some parameter within the stored operation object, you can do that with the <i>op_change</i> X-Function which allows you to get and set the tree stored in the object.
</p><p><br />
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Load analysis template</span>
string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Single Peak Fit.ogw&quot;</span>;
doc <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>path<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Partial import of data</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\Gaussian.dat&quot;</span>;
impAsc 	options.<span style="color: #000080;">partImp</span>.<span style="color: #000080;">partial</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>
		options.<span style="color: #000080;">partImp</span>.<span style="color: #000080;">firstCol</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>
		options.<span style="color: #000080;">partImp</span>.<span style="color: #000080;">lastCol</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>
		orng<span style="color: #000000;">:</span><span style="color: #000080;">=</span>Data<span style="color: #000080;">!</span>;

<span style="color: #008000;">// Get the opeation tree</span>
op_change ir<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitNL1<span style="color: #000080;">!</span> tr<span style="color: #000000;">:</span><span style="color: #000080;">=</span>tr;

<span style="color: #008000;">// Set y0 as fixed at zero</span>
tr.<span style="color: #000080;">FitWorkArea</span>.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Fixed</span><span style="color: #000000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
tr.<span style="color: #000080;">FitWorkArea</span>.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Values</span><span style="color: #000000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;

<span style="color: #008000;">// Set xc as fixed and rounded to nearest integer</span>
tr.<span style="color: #000080;">FitWorkArea</span>.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Fixed</span><span style="color: #000000;">&#91;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
tr.<span style="color: #000080;">FitWorkArea</span>.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Values</span><span style="color: #000000;">&#91;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> nint<span style="color: #000000;">&#40;</span>tr.<span style="color: #000080;">FitWorkArea</span>.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Values</span><span style="color: #000000;">&#91;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Add Fixed column to Parameters table</span>
tr.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">Quantities</span>.<span style="color: #000080;">Parameters</span>.<span style="color: #000080;">Fix</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;

<span style="color: #008000;">// Include R value in Statistics table</span>
tr.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">Quantities</span>.<span style="color: #000080;">Statistics</span>.<span style="color: #000080;">Rvalue</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;

<span style="color: #008000;">// Remove the ANOVA table</span>
tr.<span style="color: #000080;">GUI</span>.<span style="color: #000080;">Quantities</span>.<span style="color: #000080;">ANOVAtable</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;

<span style="color: #008000;">// Put the tree back and run the update</span>
op_change ir<span style="color: #000000;">:</span><span style="color: #000080;">=</span>FitNL1<span style="color: #000080;">!</span> tr<span style="color: #000000;">:</span><span style="color: #000080;">=</span>tr op<span style="color: #000000;">:</span><span style="color: #000080;">=</span>run;</pre>






