<h1 class="firstHeading">3.7.5.7 DB</h1><p class='urlname' style='display: none'>DB-obj</p>
<p><b>LabTalk Object Type:</b> 
</p>
<dl><dd><a href="../../LabTalk/LabTalk/External_Objects.html" title="LabTalk:External Objects">External Object</a></dd></dl>
<table class="noborder">
	<tr>
	<td style="vertical-align:top" width="60"><img src="../images/DB_(object)/Alert_icon.png?v=0" width="57"  border="0" /></td><td><p>This object is obsolete and exists only for backward compatibility. Please see the <a class="external text" href="../../XFunction/X-Function/DbEdit.html"><b>dbEdit</b></a>, <a class="external text" href="../../XFunction/X-Function/DbImport.html"><b>dbImport</b></a>, <a class="external text" href="../../XFunction/X-Function/DbInfo.html"><b>dbInfo</b></a> and <a class="external text" href="../../XFunction/X-Function/DbPreview.html"><b>dbPreview</b></a> X-Functions.
</p>
	</td>
	</tr>
	</table>
<p>Origin provides a DLL named odbc9.dll/odbc9_64.dll that allows you to create an ODBC command object whose properties and methods connect Origin to Microsoft's ODBC interface.  You can create a command object named db using the following LabTalk script:  <br />
</p><p><code>dll -a db odbc;</code> &#160;&#160;&#160;&#160;&#160;only available for 32-bit Origin. <br />
</p><p>The command object <b>db</b> can now be used as an Origin object with the following properties and methods.
</p>
<h2><a name="Properties:"></a><span class="mw-headline"><font color="chocolate">Properties:</font></span></h2>
<table class="simple">
<tr>
<th width="110">Property
</th>
<th width="70">Access
</th>
<th width="540">Description
</th></tr>
<tr>
<td> <b>db.autosetcol</b>
</td>
<td> Read/write<br />numeric
</td>
<td>
<p>This option automatically determines whether the worksheet column type and name can be changed or not.  The value of this property can be 1 for true, and 0 for false.  This affects each column in the worksheet, and if enabled, the <b>db.read()</b> method will set the column type as well as the column name.  If disabled, the read operation will return an error if the column type in the worksheet is not consistent with the column type in the database.  (Used by the<b> db.read()</b> method only.)
</p>
</td></tr>
<tr>
<td> <b>db.c1</b>
</td>
<td> Read/write<br />numeric
</td>
<td>
<p>Column number of <i>wksname</i> to send data to.
</p>
</td></tr>
<tr>
<td> <b>db.dbc1</b>
</td>
<td> Read/write<br />numeric
</td>
<td>
<p>Column number in the database table to begin reading.  By default, the value of this parameter is 1 (see <b>db.read.mode</b>).
</p>
</td></tr>
<tr>
<td> <b>db.dbc2</b>
</td>
<td> Read/write<br />numeric
</td>
<td>
<p>Column number in the database table to end reading (see <b>db.read.mode</b>).
</p>
</td></tr>
<tr>
<td> <b>db.dbcolcount</b>
</td>
<td> Read only<br />numeric
</td>
<td>
<p>The total number of columns in a particular table from a particular data source.
</p>
</td></tr>
<tr>
<td> <b>db.dbcolname$</b>
</td>
<td> Read/write<br />string
</td>
<td>
<p>Name of the column in the database table (see<b> db.readcol</b>).
</p>
</td></tr>
<tr>
<td> <b>db.dbcolnamelist$</b>
</td>
<td> Read/write<br />string
</td>
<td>
<p>All the column names in a particular database table.
</p>
</td></tr>
<tr>
<td> <b>db.dbpath$</b>
</td>
<td> Read/write<br />string
</td>
<td>
<p>Drive and path to data source.
</p>
</td></tr>
<tr>
<td> <b>db.dbpwd$</b>
</td>
<td> Read/write<br />string
</td>
<td>
<p>Database password for the user ID.
</p>
</td></tr>
<tr>
<td> <b>db.dbr1</b>
</td>
<td> Read/write<br />numeric
</td>
<td>
<p>Row number in the database table to begin reading.  By default, the value of this parameter is 0&#160;: read the data in the database table from row 1 (see <b>db.readrow</b>).
</p>
</td></tr>
<tr>
<td> <b>db.dbr2</b>
</td>
<td> Read/write<br />numeric
</td>
<td>
<p>Row number in the database table to end reading.  If not specified, <b>db.readrow</b> will return an error message (see <b>db.readrow</b>).
</p>
</td></tr>
<tr>
<td> <b>db.dbsource$</b>
</td>
<td> Read/write<br />string
</td>
<td>
<p>Name of the data source.  This data source name should first be defined by using the ODBC Administrator.  If the name is empty or there is no source with this name, an error message is sent to the users.
</p>
</td></tr>
<tr>
<td> <b>db.dbsourcecount</b>
</td>
<td> Read only<br />numeric
</td>
<td>
<p>The total number of data sources in the user's computer.  
</p>
</td></tr>
<tr>
<td> <b>db.dbsourcelist$</b>
</td>
<td> Read only<br />string
</td>
<td>
<p>All the data source names in the user's computer.  This means all the data source names in the ODBC.INI file.  
</p>
</td></tr>
<tr>
<td> <b>db.dbsql$</b>
</td>
<td> Read/write<br />string
</td>
<td>
<p>SQL SELECT statement.
</p>
</td></tr>
<tr>
<td> <b>db.dbtable$</b>
</td>
<td> Read/write<br />string
</td>
<td>
<p>Name of the table in the database.  If the table name is empty or there is no such table in the database, an error message is sent to the users.
</p>
</td></tr>
<tr>
<td> <b>db.dbtablecount</b>
</td>
<td> Read only<br />numeric
</td>
<td>
<p>The total number of the tables in a particular data source. 
</p>
</td></tr>
<tr>
<td> <b>db.dbtablelist$</b>
</td>
<td> Read only<br />string
</td>
<td>
<p>All the table names in a particular data source.  
</p>
</td></tr>
<tr>
<td> <b>db.dbuid$</b>
</td>
<td> Read/write<br />string
</td>
<td>
<p>Database user ID.
</p>
</td></tr>
<tr>
<td> <b>db.getcolinfo.name$</b>
</td>
<td> Read only<br />string
</td>
<td>
<p>The column name in a table.   
</p>
</td></tr>
<tr>
<td> <b>db.getcolinfo.type</b>
</td>
<td> Read only<br />numeric
</td>
<td>
<p>The column type: 0 for numeric, 1 for text.  
</p>
</td></tr>
<tr>
<td> <b>db.r1</b>
</td>
<td> Read/write<br />numeric
</td>
<td>
<p>Row number of wksname to send data to.
</p>
</td></tr>
<tr>
<td> <b>db.read.autoaddcol</b>
</td>
<td> Read/write<br />numeric
</td>
<td>
<p>This option will determine whether the worksheet column can be added or not.  The value of this property can be 1 for true, 0 for false.  If enabled, the <b>db.read()</b> method will automatically add columns and the new columns will automatically set as the correct type and name corresponding to the database table column type and name.  If disabled, and the total number of columns in the table is larger than in the worksheet, the read operation will return an error.  (Used by the <b>db.read()</b> method only.) 
</p>
</td></tr>
<tr>
<td> <b>db.read.mode</b>
</td>
<td> Read/write<br />numeric
</td>
<td>
<p>This property is only for the <b>db.read()</b> method.  Define mode as follows:  <b>mode</b> = 0  default, read the entire database; <b>mode</b> = 1, read a range of the database as specified by <b>dbc1</b> and <b>dbc2</b> (see <b>db.read(<i>mode</i>)</b>).
</p>
</td></tr>
<tr>
<td> <b>db.sqlcomment$</b>
</td>
<td> Read/write<br />string
</td>
<td>
<p>Holds any comments or description.
</p>
</td></tr>
<tr>
<td> <b>db.tabletype$</b>
</td>
<td> Read/write<br />string
</td>
<td>
<p>"Table" or "View". 
</p>
</td></tr>
<tr>
<td> <b>db.wksname$</b>
</td>
<td> Read/write<br />string
</td>
<td>
<p>Name of the worksheet to receive the data.
</p>
</td></tr></table>
<h2><a name="Methods:"></a><span class="mw-headline"><font color="chocolate">Methods:</font></span></h2>
<table class="simple">
<tr>
<th width="180">Method
</th>
<th> Description
</th></tr>
<tr>
<td> <b>db.addsource()</b>
</td>
<td>
<p>Add the data source through the ODBC administrator.  Open a dialog box from which the user can add one data source.
</p>
</td></tr>
<tr>
<td> <b>db.close()</b>
</td>
<td>
<p>Close a database which has been opened (see <b>db.open()</b>).
</p>
</td></tr>
<tr>
<td> <b>db.editsql()</b>
</td>
<td>
<p>Open the ODBC Dialog dialog box with the Data Base and Select Case tabs.  If the data source is valid it should be listed in the Data Source list box.  If the table is valid for the source it should be listed in the Table list box.  Upon user confirmation, convert the spreadsheet display as well as the table name and database name into an SQL string to store in <b>db.dbsql$.</b>
</p>
</td></tr>
<tr>
<td> <b>db.getcolinfo(<i>colNumber</i>)</b>
</td>
<td>
<p>Get one column's information and set the information to <b>db.getcolinfo.name$</b> and <b>db.getcolinfo.type</b>.  Input the column number.
</p>
</td></tr>
<tr>
<td> <b>db.getcolslist()</b>
</td>
<td>
<p>Set <b>db.dbcolcount</b> and fill <b>db.dbcolnamelist$.</b>
</p>
</td></tr>
<tr>
<td> <b>db.getsourcelist()</b>
</td>
<td>
<p>Set <b>db.dbsourcecount</b> and fill <b>db.dbsourcelist$</b>.
</p>
</td></tr>
<tr>
<td><b> db.gettablelist()</b>
</td>
<td>
<p>Set <b>db.dbtablecount</b> and fill <b>db.dbtablelist$.</b>  (This closes the database; if you want to get table information, reopen the database.)
</p>
</td></tr>
<tr>
<td><b> db.loadsql([#])</b>
</td>
<td>
<p>Gets the comment, data source name, table name, and SQL SELECT statement from an SQL text object&#160;: SQL1, SQL2, etc.  The first line of an SQL text object is a comment.  The second line is the name of the ODBC data source.  The third line is the name of the table.  The fourth line is either TABLE or VIEW.  The fifth and subsequent lines are for the SELECT statement.  The number argument is optional - the default is 1.  Return 0 for OK (i.e. the data source is valid, the table exists within the source and the SQL syntax is proper for this combination) and 1 if an error occurs.
</p>
</td></tr>
<tr>
<td> <b>db.open()</b>
</td>
<td>
<p>Open a database as specified in <b>db.dbsource$</b>. 
</p>
</td></tr>
<tr>
<td> <b>db.read(mode)</b>
</td>
<td>
<p>The argument 'mode' can be set with <b>db.read.mode</b> if it is not specified in <b>db.read()</b> as an argument.  When specified as an argument, <b>db.read.mode</b> is ignored and uses the specified argument instead.  (To set the read column range of a database table, see <b>db.read.mode</b>.)
</p>
</td></tr>
<tr>
<td><b> db.readcol()</b>
</td>
<td>
<p>Read the data in the database for the specified column name.  If the column name is empty or the column name is not correct, return an error message.  (See <b>db.readrow()</b> for the <b>db.autosetcol</b> option - <b>db.dbc1</b> and <b>db.dbc2</b> should be 0).
</p>
</td></tr>
<tr>
<td> <b>db.readrow()</b>
</td>
<td>
<p>Read the data in the table from <b>db.dbr1</b> to <b>db.dbr2</b>.  If <b>db.dbr2</b> is not specified, return an error message.  Whether the column type and name in the worksheet can be set or not is determined by the <b>db.autosetcol</b> option.
</p>
</td></tr>
<tr>
<td> <b>db.reset()</b>
</td>
<td>
<p>Resets the <b>db</b> object properties.  
</p>
</td></tr>
<tr>
<td> <b>db.savesql([#])</b>
</td>
<td>
<p>Sets the <b>db.comment$</b>, data source name, table name, and <b>db.dbsql$</b> to an SQL text object&#160;: SQL1, SQL2, etc.  The first line of an SQL text object is a comment.  The second line is the name of the ODBC data source.  The third line is the name of the table.  The number argument is optional - the default is 1.  Return 0 for OK and 1 if an error occurs.
</p>
</td></tr></table>
<h2><a name="Examples:"></a><span class="mw-headline"><font color="chocolate">Examples:</font></span></h2>
<p>You can use LabTalk script along with SQL commands to import data from a data source without selecting the Data: Import from File:ODBC menu command.  SQL (Structured Query Language) is a standardized language that has evolved for accessing data from a variety of databases.  In this section, we will describe only a small subset of SQL for the purposes of importing data from a database into an Origin worksheet.  The basic SQL commands and syntax that we need to understand are shown in the following example of an SQL query statement:
</p>
<pre class="lt" style="font-family:monospace;">SELECT column list FROM table name
WHERE  <span style="color: #ff00ff;">&quot;columnname1&quot;</span><span style="color: #000080;">&gt;</span><span style="color: #0000dd;">20</span>  AND  <span style="color: #ff00ff;">&quot;columnname1&quot;</span> <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">40</span> 
AND  <span style="color: #ff00ff;">&quot;columnname2&quot;</span> <span style="color: #000080;">=</span> String  
OR  <span style="color: #ff00ff;">&quot;columnname3&quot;</span> <span style="color: #000080;">&lt;&gt;</span> <span style="color: #0000dd;">20</span> ###
ORDER BY <span style="color: #ff00ff;">&quot;columnname1&quot;</span> DESC</pre>
<p>For example, suppose you have a data source named ProjectData with a table named SalesTable and columns named State, City, Sales, and Balance.  Then the following SQL query:
</p>
<pre class="lt" style="font-family:monospace;"> 
SELECT <span style="color: #ff00ff;">&quot;State&quot;</span>, <span style="color: #ff00ff;">&quot;Sales&quot;</span>, <span style="color: #ff00ff;">&quot;Balance&quot;</span> FROM SalesTable
WHERE  <span style="color: #ff00ff;">&quot;Sales&quot;</span> <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">20</span>  AND  <span style="color: #ff00ff;">&quot;Sales&quot;</span> <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">40</span> AND  <span style="color: #ff00ff;">&quot;STATE&quot;</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Texas&quot;</span> 
OR  <span style="color: #ff00ff;">&quot;Balance&quot;</span> <span style="color: #000080;">&lt;&gt;</span> <span style="color: #0000dd;">0</span> 
ORDER BY <span style="color: #ff00ff;">&quot;Sales&quot;</span> DESC</pre>
<p>selects data from columns State, Sales and Balance (but not City) from the table named SalesTable satisfying Sales between 20 and 40 (including 40), State equal to Texas and Balance not equal to 0.  
</p><p>Finally, order the selection from the largest Sales value to the smallest (DESC means descending order).
</p>
<ul><li>To select all the columns of the table, use an asterisk * as in SELECT * FROM SalesTable.</li></ul>
<ul><li>To select ascending order, omit the word DESC.</li></ul>
<ul><li>To select the original order in the data table, omit the entire ORDER BY command.</li></ul>
<p>Once a data source, data table, and an SQL selection are decided upon, you can use LabTalk commands to import the selected data.  The following example illustrates this procedure.
</p><p>In Step 1 of the example code, a Label Object named sql2 is made whose label message is the following:
</p>
<pre class="lt" style="font-family:monospace;"> 
nwind_mdb
Order Details
SELECT <span style="color: #000080;">*</span> FROM <span style="color: #ff00ff;">&quot;Order Details&quot;</span>
WHERE <span style="color: #ff00ff;">&quot;UnitPrice&quot;</span> <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">20</span> AND <span style="color: #ff00ff;">&quot;UnitPrice&quot;</span> <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">30</span> AND 
<span style="color: #ff00ff;">&quot;Quantity&quot;</span> <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">30</span>
ORDER BY <span style="color: #ff00ff;">&quot;ProductID&quot;</span> DESC</pre>
<p>The first two lines are the name of the data source and the name of the data table, respectively.  Use Origin's Data Base tab to assign or determine data sources and tables.  The remaining lines comprise the SQL query statement, which can be any number of lines.  You can use label names sql1, sql2, etc. but not arbitrary names.  This is because the method <b>loadsql(#)</b> loads the label message of the label named sql#.  Also, avoid sql1 because sql1 is the default label name used by the Select Case tab to store your selection and query.  Instead, use sql2 etc. when writing script.
</p><p>In Step 2 of the example code, an ODBC command object named db is created using the LabTalk command:
</p>
<pre class="lt" style="font-family:monospace;">dll <span style="color: #000080;">-</span>a db odbc;</pre>
<p>This allows the <b>db</b> object to access the functions in odbc9.dll/odbc9_64.dll as properties and methods.   
</p><p>In Step 3, the <b>db</b> object's methods and properties are used to import data according to the information in the label message sql2.
</p><p>Step 4 writes some information to the Script window.
</p><p>Example LabTalk Script Code to Import a Data Source Table or View into an Origin Worksheet with a specified SQL Statement:
</p><p><br />
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// LabTalk script begins here:</span>
<span style="color: #008000;">// Step 1. Create a non-visible Label object called SQL2 </span>
<span style="color: #008000;">// with the message: (substitute your query)</span>
<span style="color: #008000;">// SQL2 </span>
<span style="color: #008000;">// nwind_mdb</span>
<span style="color: #008000;">// Order Details</span>
<span style="color: #008000;">// SELECT * FROM &quot;Order Details&quot;</span>
<span style="color: #008000;">// WHERE &quot;UnitPrice&quot; &gt; 20 AND &quot;UnitPrice&quot; &lt; 30 AND </span>
<span style="color: #008000;">// &quot;Quantity&quot; &lt; 30</span>
<span style="color: #008000;">// ORDER BY &quot;ProductID&quot; DESC</span>
<span style="color: #008000;">// label -n name message.  creates a Label object.</span>
label <span style="color: #000080;">-</span>n SQL2  <span style="color: #008000;">//SQL2 Statement</span>
nwind_mdb
Order Details
TABLE
SELECT <span style="color: #000080;">*</span> FROM <span style="color: #ff00ff;">&quot;Order Details&quot;</span>
WHERE <span style="color: #ff00ff;">&quot;UnitPrice&quot;</span> <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">20</span> AND <span style="color: #ff00ff;">&quot;UnitPrice&quot;</span> <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">30</span> AND <span style="color: #ff00ff;">&quot;Quantity&quot;</span> <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">30</span>
ORDER BY <span style="color: #ff00ff;">&quot;ProductID&quot;</span> DESC
;
SQL2.<span style="color: #000080;">show</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;  <span style="color: #008000;">// Clear Visible check box in Label Control box.</span>
<span style="color: #008000;">// Step 2. Create an odbc9.dll/odbc9_64.dll command object called db.</span>
dll <span style="color: #000080;">-</span>a db odbc;
db.<span style="color: #000080;">loadsql</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Load the message of sql2 label.</span>
<span style="color: #008000;">// Step 3. Now import into specified worksheet</span>
repeat wks.<span style="color: #000080;">ncols</span> <span style="color: #000000;">&#123;</span>del col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#125;</span>;  <span style="color: #008000;">// empty active worksheet</span>
db.<span style="color: #000080;">wksname</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>H;  <span style="color: #008000;">//&#160;%H is active wks</span>
db.<span style="color: #000080;">open</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
db.<span style="color: #000080;">autosetcol</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
db.<span style="color: #000080;">read</span>.<span style="color: #000080;">autoaddcol</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
db.<span style="color: #000080;">read</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>;
db.<span style="color: #000080;">close</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
<span style="color: #008000;">// Step 4. Show SQL query in Script window for verification.</span>
type <span style="color: #000080;">-</span>a Data has been imported according to the SQL query<span style="color: #000000;">:</span>;
<span style="color: #000080;">%</span>A <span style="color: #000080;">=</span> sql2.<span style="color: #000080;">text</span><span style="color: #000080;">$</span>;
<span style="color: #000080;">%</span>A <span style="color: #000080;">=</span>&#160;;
<span style="color: #008000;">// sql2.show = 1.  make visible</span>
type <span style="color: #000080;">-</span>a Data Source, Table<span style="color: #000080;">/</span>View and SQL Query<span style="color: #000000;">:</span>;
<span style="color: #000080;">%</span>A <span style="color: #000080;">=</span> sql2.<span style="color: #000080;">text</span><span style="color: #000080;">$</span>;
<span style="color: #000080;">%</span>A <span style="color: #000080;">=</span>&#160;;
type <span style="color: #000080;">-</span>a Origin Worksheet Name<span style="color: #000000;">:</span>;
<span style="color: #000080;">%</span>B <span style="color: #000080;">=</span> db.<span style="color: #000080;">wksname</span><span style="color: #000080;">$</span>;
<span style="color: #000080;">%</span>B <span style="color: #000080;">=</span>&#160;;
<span style="color: #008000;">// End of LabTalk Script</span></pre>


