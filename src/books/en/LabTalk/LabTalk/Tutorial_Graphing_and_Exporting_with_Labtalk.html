<h1 class="firstHeading">5.7 Graphing and Exporting with LabTalk</h1><p class='urlname' style='display: none'>Tutorial-Graphing-and-Exporting-with-LT</p>
<p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Summary"><span class="tocnumber">1</span> <span class="toctext">Summary</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#What_You_Will_Learn"><span class="tocnumber">2</span> <span class="toctext">What You Will Learn</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Steps"><span class="tocnumber">3</span> <span class="toctext">Steps</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Create_Graphs"><span class="tocnumber">3.1</span> <span class="toctext">Create Graphs</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Customize_Graphs"><span class="tocnumber">3.2</span> <span class="toctext">Customize Graphs</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Export_Graphs"><span class="tocnumber">3.3</span> <span class="toctext">Export Graphs</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><a name="Summary"></a><span class="mw-headline">Summary</span></h2>
<p>There are many commands, objects and x-functions in LabTalk, that can be used to create and customize 2D or 3D graphs and export them either as image or video files.
</p>
<h2><a name="What_You_Will_Learn"></a><span class="mw-headline">What You Will Learn</span></h2>
<p>This tutorial will show you how to use LabTalk script to:
</p>
<ul><li>Create 2D graph</li>
<li>Create 3D graph</li>
<li>Customize axes and data plots in a graph</li>
<li>Export a graph as image file</li>
<li>Export a combination of several graphs as a video</li></ul>
<p>As written, the scripts are designed to be executed sequentially within each example.
</p>
<h2><a name="Steps"></a><span class="mw-headline">Steps</span></h2>
<h3><a name="Create_Graphs"></a><span class="mw-headline">Create Graphs</span></h3>
<p><b>2D Graphs</b>
</p>
<ol>
<li>Run the script below to create a new workbook named <b>Graph2D</b> and import the <b>Waterfall.dat</b> file under <i>&lt;Origin EXE Folder&gt;\Samples\Graphing\</i> using an import filter <b>waterfall.oif</b>. The <a class="external text" href="../../XFunction/X-Function/ImpFile.html">ImpFile</a> x-function is used in this case.</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Create a newbook and name it Graph2D (both long and short name)</span>
newbook name<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Graph2D&quot;</span> option<span style="color: #000000;">:</span><span style="color: #000080;">=</span>lsname;
<span style="color: #008000;">// Define the file name and filter name</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Graphing\Waterfall.dat&quot;</span>;
string filtername<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;waterfall.oif&quot;</span>;  
<span style="color: #008000;">// Use the impfile x-function to import the specified file with the import filter</span>
impfile fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fname<span style="color: #000080;">$</span> filtername<span style="color: #000000;">:</span><span style="color: #000080;">=</span>filtername<span style="color: #000080;">$</span> location<span style="color: #000000;">:</span><span style="color: #000080;">=</span>data orng<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span>Graph2D<span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;</pre>
<li>Create a line and symbol plot using 1st column as X and 2nd column as Y of the imported data in workbook <b>Graph2D</b>, using the <a class="external text" href="../../XFunction/X-Function/Plotxy.html">plotxy</a> x-function.
</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Generate a line and symbol XY plot with user defined R G B color</span>
plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span>Graph2D<span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">202</span> color<span style="color: #000000;">:</span><span style="color: #000080;">=</span>color<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">255</span>,<span style="color: #0000dd;">0</span>,<span style="color: #0000dd;">255</span><span style="color: #000000;">&#41;</span>;
<span style="color: #008000;">// Use string register to get the short name of the graph you just created</span>
<span style="color: #000080;">%</span>A <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>H;</pre>
<li>Add another data plot to the graph you just created, but this time specify the layer to plot into.</li>
<pre class="lt" style="font-family:monospace;">plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span>Graph2D<span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">126</span><span style="color: #000000;">&#41;</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">202</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">%</span>A<span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;</pre>
<li>Create another graph using the built-in template <b>doubleY</b>.</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Define a range for the source data worksheet</span>
range rr <span style="color: #000080;">=</span> <span style="color: #000000;">&#91;</span>Graph2D<span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;
<span style="color: #008000;">// Plot a line+symbol graph into the first (active) layer of the Graph using built-in template '''doubleY''', with 1st column as X and 2nd column as Y</span>
plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>rr<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">202</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">&lt;</span>new template<span style="color: #000000;">:</span><span style="color: #000080;">=</span>doubleY<span style="color: #000080;">&gt;</span><span style="color: #000000;">&#93;</span>;
<span style="color: #008000;">// Add a line plot into the 2nd layer of the graph, with 1st column as X, 126th column as Y</span>
plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>rr<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">126</span><span style="color: #000000;">&#41;</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span><span style="color: #000080;">!</span>;
<span style="color: #008000;">//Retrieve the name of the new graph and store it in the string variable str1</span>
string str1<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> page.<span style="color: #000080;">name</span><span style="color: #000080;">$</span>;</pre>
</li>
</ol>
<p><b>3D Graphs</b>
</p>
<ol>
<li>Use the following script to import the file <b>XYZ Random Gaussian.dat</b> under the path <i>&lt;Origin EXE&gt;\Samples\Matrix Conversion and Gridding\</i>.</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Create a new workbook</span>
newbook;
<span style="color: #008000;">// Specify the filename</span>
string str2<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Samples\Matrix Conversion and Gridding\XYZ Random Gaussian.dat&quot;</span>;
<span style="color: #008000;">// Include the file path</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> str2<span style="color: #000080;">$</span>;
<span style="color: #008000;">// Import using the impASC X-Function</span>
impASC fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fname<span style="color: #000080;">$</span>;
<span style="color: #008000;">//Use a string register to get the workbook name</span>
<span style="color: #000080;">%</span>B <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>H;</pre>
<li>Set the third column to be Z column using the <a href="../../LabTalk/LabTalk/Wks.Col_(object)&amp;action=edit&amp;redlink=1.html" class="new" title="LabTalk:Wks.Col (object) (page does not exist)">wks.col object</a>.</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Set the type of the third column to be Z using the stored string register variable</span>
<span style="color: #000080;">%</span>B<span style="color: #000080;">!</span>wks.<span style="color: #000080;">col3</span>.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">6</span>;</pre>
<li>Use the <a class="external text" href="../../XFunction/X-Function/Plotxyz.html">plotxyz</a> x-function to create a 3D colormap surface plot.</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Make our data worksheet active</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span>B;
<span style="color: #008000;">// Create a 3D Colormap Surface plot from the selected worksheet data</span>
plotxyz iz<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">103</span> ogl<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>new template<span style="color: #000000;">:</span><span style="color: #000080;">=</span>glcmap<span style="color: #000080;">&gt;</span>;
<span style="color: #008000;">//Get the graph window name to the string variable str3</span>
string str3<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> page.<span style="color: #000080;">name</span><span style="color: #000080;">$</span>;</pre>
</ol>
<p><b>Note:</b> You can also use the <a href="../../LabTalk/LabTalk/Worksheet_(command)&amp;action=edit&amp;redlink=1.html" class="new" title="LabTalk:Worksheet (command) (page does not exist)">worksheet -p command</a> to create both 2D and 3D graphs, provided you use the <a href="../../LabTalk/LabTalk/Worksheet_(command)&amp;action=edit&amp;redlink=1.html" class="new" title="LabTalk:Worksheet (command) (page does not exist)">worksheet -s</a> command to select desired input data range first.
</p>
<h3><a name="Customize_Graphs"></a><span class="mw-headline">Customize Graphs</span></h3>
<p>A graph window is comprised of a visual page, with an associated <a href="../../LabTalk/LabTalk/Page_(object).html" title="LabTalk:Page (object)">Page object</a>. Each graph page contains at least one visual layer, with an associated <a href="../../LabTalk/LabTalk/Layer_(object).html" title="LabTalk:Layer (object)">layer object</a>. The graph layer contains a set of X Y axes with associated <a href="../../LabTalk/LabTalk/Layer.Axis_(object).html" title="LabTalk:Layer.Axis (object)">layer.x</a> and <a href="../../LabTalk/LabTalk/Layer.Axis_(object).html" title="LabTalk:Layer.Axis (object)">layer.y</a> objects, which are sub-objects of the layer object. With LabTalk access to these objects, you will be able to control page, layer and axes properties.
</p><p>To customize the data plot, you can use the <a href="../../LabTalk/Category/Set_(command).html" title="Category:Set (command)">set</a> command. You will also find the <a href="../../LabTalk/LabTalk/Label_(command).html" title="LabTalk:Label (command)">label</a> command useful when you need to customize text objects on a graph.
</p><p>In addition, there are several x-functions to <a href="../../LabTalk/Script/LabTalk-Supported_X-Functions.html#Graph_Manipulation" title="Script:LabTalk-Supported X-Functions">manipulate a graph</a>.
</p><p>We will continue using the project file from the previous section:
</p>
<ol>
<li>
Run the following script to set the axis type of the first graph we created.
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//Activate the graph window</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span>A;
<span style="color: #008000;">//Change the Y axis type to be log10 and its from value to be 0.003</span>
layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;
layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">from</span> <span style="color: #000080;">=</span> .003;
<span style="color: #008000;">//Change the Y axis title to be &quot;Amplitude&quot;</span>
label <span style="color: #000080;">-</span>yl Amplitude;
<span style="color: #008000;">//Show top X and right Y axes</span>
layer.<span style="color: #000080;">x</span>.<span style="color: #000080;">showAxes</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;
layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">showAxes</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;
<span style="color: #008000;">//Show major grid as dash for X axis</span>
layer.<span style="color: #000080;">x</span>.<span style="color: #000080;">showGrids</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
layer.<span style="color: #000080;">x</span>.<span style="color: #000080;">grid</span>.<span style="color: #000080;">majorType</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;</pre>
<li>
Then use the set command to customize the second data plot.
</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//Make sure the graph window we first created is active</span>
<span style="color: #008000;">//If it's already active, you do not need to run the following line</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span>A;
<span style="color: #008000;">//Activate the second data plot.</span>
layer.<span style="color: #000080;">plot</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;
<span style="color: #008000;">//Set symbol shape to be Cross(X)</span>
set <span style="color: #000080;">%</span>C <span style="color: #000080;">-</span>k <span style="color: #0000dd;">7</span>;
<span style="color: #008000;">//Set the plot line color to be blue</span>
set <span style="color: #000080;">%</span>C <span style="color: #000080;">-</span>cl <span style="color: #0000dd;">4</span>;
<span style="color: #008000;">//Set the symbol edge color to be olive </span>
set <span style="color: #000080;">%</span>C <span style="color: #000080;">-</span>cse <span style="color: #0000dd;">12</span>;</pre>
<li>
Now run this script to customize the double Y plot
</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//declare range for first dataplot in layer 2 of the double Y plot</span>
range r2 <span style="color: #000080;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>str1<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#93;</span><span style="color: #0000dd;">2</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span>;
<span style="color: #008000;">//set line to dash</span>
set r2 <span style="color: #000080;">-</span>d <span style="color: #0000dd;">1</span>;
<span style="color: #008000;">//Activate the graph window of Double Y plot to view the change</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>str1<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span>;</pre>
<li>
Use the <a class="external text" href="../../XFunction/X-Function/Legendupdate.html">legendupdate</a> x function to update the legend of the double Y plot.
</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//Pre define the worksheet range of source data</span>
range rw<span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span>Graph2D<span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;
<span style="color: #008000;">//Make sure the graph window we first created is active</span>
<span style="color: #008000;">//If it's already active, you do not need to run the following line</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>str1<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span>;
<span style="color: #008000;">//Update Legend with legendupdate x-function</span>
<span style="color: #008000;">//Legend will be name + value of the first user defined parameter</span>
<span style="color: #008000;">//@LD1 means the first user-defined parameter</span>
legendupdate mode<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">7</span> custom<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;%(rw.UserParam1$)-@LD1&quot;</span>;</pre>
<li>Use the <a href="../../LabTalk/LabTalk/Layer_(command)&amp;action=edit&amp;redlink=1.html" class="new" title="LabTalk:Layer (command) (page does not exist)">layer -3d r</a> command to rotate the 3D graph.</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//Active the graph window for the 3D plot we just created</span>
win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>str3<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span>;
<span style="color: #008000;">//Rotate around vertical direction by 90 degree.</span>
layer <span style="color: #000080;">-</span>3d r V <span style="color: #0000dd;">90</span>;
<span style="color: #008000;">//You need to refresh to view the customized graph</span>
doc <span style="color: #000080;">-</span>uw;</pre>
</ol>
<h3><a name="Export_Graphs"></a><span class="mw-headline">Export Graphs</span></h3>
<p><b>Export as Image</b>
</p><p>You can export one or more graphs to image file(s) by calling the <a class="external text" href="../../XFunction/X-Function/ExpGraph.html">expGraph</a> x-function. To control export setting of images, you can use the <a class="external text" href="../../UserGuide/UserGuide/The_Export_Graph_Dialog_Box.html#tr1">tr1</a> or <a class="external text" href="../../UserGuide/UserGuide/The_Export_Graph_Dialog_Box.html#tr2">tr2</a> tree.
</p>
<ul>
<li>
Use the following script to export all graph in current project as tip image to the user files folder (path stored in the&#160;%Y string register), and set width to be 600 pixel, DPI resolution to 100 and compression method to LZW. The exported file names will be defined as a combination of graph window long name and the system date by then:
</li>
<pre class="lt" style="font-family:monospace;">doc <span style="color: #000080;">-</span>e P
<span style="color: #000000;">&#123;</span>
expGraph type<span style="color: #000000;">:</span><span style="color: #000080;">=</span>pdf filename<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;&lt;long name&gt;-$(System.Date(),D11)&quot;</span> path<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span>Y
     tr.<span style="color: #000080;">Margin</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> 
     tr1.<span style="color: #000080;">Unit</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> 
     tr1.<span style="color: #000080;">Width</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">600</span> 
     tr2.<span style="color: #000080;">TIF</span>.<span style="color: #000080;">DotsPerInch</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">100</span>
     tr2.<span style="color: #000080;">TIF</span>.<span style="color: #000080;">Compression</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span>LZW;
<span style="color: #000000;">&#125;</span></pre>
</ul>
<table class="noborder"><tr>
	<td style="vertical-align:top" width="60"><img src="../images/Tutorial_Graphing_and_Exporting_with_Labtalk/Tip_icon.png?v=0" width="57"  border="0" /></td><td><p>To simplify the script writing, you can open the <b>expGraph</b> dialog (<b>File:Export Graphs</b>), change setting in the dialog, and click the triangle button next to the <b>Dialog Theme</b> and choose <b>Generate Script</b> to generate labTalk script with the same setting.
</p></td></tr></table>
<p><b>Export as Video</b>
</p><p>You can use the <a href="../../LabTalk/LabTalk/Vw_(object).html" title="LabTalk:Vw (object)">vw object</a> to export graphs as a video.
</p>
<ul>
<li>
Run the following script to export a video showing the change of spectrum shape with increasing excitation wavelength. The data is from the <b>Graph2D</b> workbook.
</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//Define the compression method of MPEG4</span>
int codec <span style="color: #000080;">=</span> vw.<span style="color: #000080;">FourCC</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">'F'</span>,<span style="color: #ff00ff;">'M'</span>,<span style="color: #ff00ff;">'P'</span>,<span style="color: #ff00ff;">'4'</span><span style="color: #000000;">&#41;</span>; 
<span style="color: #008000;">//Check whether this compression method is supported</span>
<span style="color: #008000;">//If not supported, no compression will be used.</span>
if<span style="color: #000000;">&#40;</span>vw.<span style="color: #000080;">IsCodecInstalled</span><span style="color: #000000;">&#40;</span>codec<span style="color: #000000;">&#41;</span> <span style="color: #000080;">==</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span> 
codec <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; 
 
<span style="color: #008000;">//Define the file name of the video as ''&lt;User Files Folder&gt;\test.avi''</span>
<span style="color: #008000;">//Use the string register&#160;%Z to store the file path and name</span>
<span style="color: #000080;">%</span>Z <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>Ytest.<span style="color: #000080;">avi</span>;
<span style="color: #008000;">// Create video writer. (fileName, codec, framesPerSec, width, height)</span>
int err <span style="color: #000080;">=</span> vw.<span style="color: #000080;">Create</span><span style="color: #000000;">&#40;</span><span style="color: #000080;">%</span>Z, codec, <span style="color: #0000dd;">8</span>, <span style="color: #0000dd;">1024</span>, <span style="color: #0000dd;">768</span><span style="color: #000000;">&#41;</span>;
if<span style="color: #000000;">&#40;</span> <span style="color: #0000dd;">0</span> <span style="color: #000080;">==</span> err <span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
       <span style="color: #008000;">//Define a range for source data worksheet</span>
        win <span style="color: #000080;">-</span>a Graph2D;
        range rw1 <span style="color: #000080;">=</span> <span style="color: #000000;">&#91;</span>Graph2D<span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>;
       <span style="color: #008000;">//Create the very first graph to start with</span>
        plotxy iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>rw1<span style="color: #000000;">&#41;</span><span style="color: #0000dd;">2</span> plot<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span>;
       <span style="color: #008000;">//Customize the Y axis scale and increment</span>
        layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">to</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3250</span>;
        layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">inc</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">500</span>;
        <span style="color: #008000;">//Update legend</span>
        legendupdate mode<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">7</span> custom<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;%(rw1.UserParam1$)-@LD1&quot;</span>;
        <span style="color: #008000;">// Place legend</span>
        legend.<span style="color: #000080;">y</span> <span style="color: #000080;">=</span> layer.<span style="color: #000080;">y</span>.<span style="color: #000080;">to</span>;
        legend.<span style="color: #000080;">x</span> <span style="color: #000080;">=</span> layer.<span style="color: #000080;">x</span>.<span style="color: #000080;">to</span> <span style="color: #000080;">-</span> legend.<span style="color: #000080;">dx</span> <span style="color: #000080;">/</span> <span style="color: #0000dd;">2</span>;
        <span style="color: #008000;">//Use the following loop to replace the plot data in the graph</span>
        <span style="color: #008000;">//Add each graph to be a frame in the video </span>
	for<span style="color: #000000;">&#40;</span>int a<span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>; a<span style="color: #000080;">&lt;=</span>rw1.<span style="color: #000080;">nCols</span>; a<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span>
	<span style="color: #000000;">&#123;</span>
               <span style="color: #008000;">//Define the range of current displayed dataset</span>
               range ra <span style="color: #000080;">=</span> <span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>rw1<span style="color: #000000;">&#41;</span>col<span style="color: #000000;">&#40;</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>a<span style="color: #000080;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
               <span style="color: #008000;">//Define the range of new dataset</span>
                range rb <span style="color: #000080;">=</span> <span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>rw1<span style="color: #000000;">&#41;</span>col<span style="color: #000000;">&#40;</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>a<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
                <span style="color: #008000;">//Clear the current data plot</span>
                layer <span style="color: #000080;">-</span>e ra;
               <span style="color: #008000;">//Add the new dataset to the graph</span>
                layer <span style="color: #000080;">-</span>i rb;
               <span style="color: #008000;">//Change the Y axis title</span>
                label <span style="color: #000080;">-</span>yl Amplitude;
               <span style="color: #008000;">//Refresh the graph</span>
              doc <span style="color: #000080;">-</span>uw;
	 <span style="color: #008000;">//Wait for graph window to redraw.</span>
	<span style="color: #008000;">//This allows watching the animation while creating the video file.</span>
	sec <span style="color: #000080;">-</span>pw <span style="color: #000080;">%</span>h;
	<span style="color: #008000;">// Write each graph to video as 2 frames.</span>
	err <span style="color: #000080;">=</span> vw.<span style="color: #000080;">WriteGraph</span><span style="color: #000000;">&#40;</span><span style="color: #000080;">%</span>h,<span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span>;
	if<span style="color: #000000;">&#40;</span> err <span style="color: #000000;">&#41;</span>
                    break;
	<span style="color: #000000;">&#125;</span>
 
	<span style="color: #008000;">//Release the video writer.</span>
	vw.<span style="color: #000080;">Release</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
 
	if<span style="color: #000000;">&#40;</span> err <span style="color: #000000;">&#41;</span>
		type <span style="color: #ff00ff;">&quot;WriteGraph error $(err)&quot;</span>;
<span style="color: #000000;">&#125;</span>
else
	type <span style="color: #ff00ff;">&quot;VideoWriter Create error $(err).&quot;</span>;</pre>
</ul>


