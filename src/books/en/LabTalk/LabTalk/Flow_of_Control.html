<h1 class="firstHeading">2.3.1.4 Conditional and Loop Structures</h1><p class='urlname' style='display: none'>Flow-of-Control</p>
<p><span class="OIndex" style="display:none">Flow of Control</span>The structure of the LabTalk language is similar to C. LabTalk supports:
</p>
<ul><li> Loops, which allow the program to repetitively perform a set of actions.</li>
<li> Decision structures, which allow the program to perform different sets of actions depending on the circumstances.</li></ul>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Loop_Structures"><span class="tocnumber">1</span> <span class="toctext">Loop Structures</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Repeat"><span class="tocnumber">1.1</span> <span class="toctext">Repeat</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Loop"><span class="tocnumber">1.2</span> <span class="toctext">Loop</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Doc_-e"><span class="tocnumber">1.3</span> <span class="toctext">Doc -e</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#For"><span class="tocnumber">1.4</span> <span class="toctext">For</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Decision_Structures"><span class="tocnumber">2</span> <span class="toctext">Decision Structures</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#If.2C_If-Else"><span class="tocnumber">2.1</span> <span class="toctext">If, If-Else</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Switch"><span class="tocnumber">2.2</span> <span class="toctext">Switch</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Break_and_Progress_Bars"><span class="tocnumber">2.3</span> <span class="toctext">Break and Progress Bars</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Exit"><span class="tocnumber">2.4</span> <span class="toctext">Exit</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Continue"><span class="tocnumber">2.5</span> <span class="toctext">Continue</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#Sections_in_a_Script_File"><span class="tocnumber">3</span> <span class="toctext">Sections in a Script File</span></a></li>
</ul>
</div>

<h2><a name="Loop_Structures"></a><span class="mw-headline">Loop Structures</span></h2>
<p>All LabTalk loops take a script as an argument.  These scripts are executed repetitively under specified circumstances. LabTalk provides four loop commands: 
</p>
<table class="simple">
<tr>
<th> Command
</th>
<th> Syntax
</th></tr>
<tr>
<td> repeat
</td>
<td> repeat value {<i>script</i>};
</td></tr>
<tr>
<td> loop
</td>
<td> loop (variable, startVal, endVal) {<i>script</i>};
</td></tr>
<tr>
<td> doc -e
</td>
<td> doc -e object {<i>script</i>};
</td></tr>
<tr>
<td> for
</td>
<td> for (expression1; expression2; expression3) {<i>script</i>};
</td></tr></table>
<p>The LabTalk for-loop is similar to the for loop in other languages.  The repeat, loop, and doc -e loops are less familiar, but are easy to use.
</p>
<h3><a name="Repeat"></a><span class="mw-headline">Repeat</span></h3>
<p>The <b><span class="OIndex">repeat</span></b> loop is used when a set of actions must be repeated without any alterations. 
</p><p>Syntax:  <b>repeat <i>value</i> {<i>script</i>};</b>
</p><p>Execute <i>script</i> the number of times specified by <i>value</i>, or until an error occurs, or until the <i><a href="../../LabTalk/LabTalk/Break_(command).html" title="LabTalk:Break (command)">break</a></i> command is executed. 
</p><p>For example, the following script types the string three times:
</p>
<pre class="lt" style="font-family:monospace;">repeat <span style="color: #0000dd;">3</span> <span style="color: #000000;">&#123;</span> type <span style="color: #ff00ff;">&quot;line of output&quot;</span>; <span style="color: #000000;">&#125;</span>;</pre>
<h3><a name="Loop"></a><span class="mw-headline">Loop</span></h3>
<p>The <b><span class="OIndex">loop</span></b> loop is used when a single variable is being incremented with each successive loop. 
</p><p>Syntax: <b>loop (<i>variable</i>, <i>startVal</i>, <i>endVal</i>) {<i>script</i>};</b>
</p><p>A simple increment loop structure. Initializes <i>variable</i> with the value of <i>starVal</i>. Executes <i>script</i>. Increments <i>variable</i> and tests if it is greater than <i>endVal</i>. If it is not, executes <i>script</i> and continues to loop.
</p><p>For example, the following script outputs numbers from 1 to 4:
</p>
<pre class="lt" style="font-family:monospace;">loop <span style="color: #000000;">&#40;</span>ii, <span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">4</span><span style="color: #000000;">&#41;</span>  <span style="color: #000000;">&#123;</span>type <span style="color: #ff00ff;">&quot;$(ii)&quot;</span>;<span style="color: #000000;">&#125;</span>;</pre>
<p><b>Note</b>: The <b>loop</b> command provides faster looping through a block of script than does the <b>for</b> command. The enhanced speed is a result of not having to parse out a LabTalk expression for the condition required to stop the loop.
</p>
<h3><a name="Doc_-e"></a><span class="mw-headline">Doc -e</span></h3>
<p>The <a href="../../LabTalk/LabTalk/Document_(command)&amp;action=edit&amp;redlink=1.html" class="new" title="LabTalk:Document (command) (page does not exist)"><span class="OIndex">doc -e</span></a> loop is used when a script is being executed to affect objects of a specific type, such as graph windows.  The <b>doc -e</b> loop tells Origin to execute the script for each instance of the specified object type.
</p><p>Syntax: <b>doc -e <i>object</i> {<i>script</i>};</b>
</p><p>The different object types are listed in the <a href="../../LabTalk/LabTalk/Document_(command)&amp;action=edit&amp;redlink=1.html" class="new" title="LabTalk:Document (command) (page does not exist)">document command</a>.
</p><p>For example, the following script prints the windows title of all graph windows in the project:
</p>
<pre class="lt" style="font-family:monospace;">doc <span style="color: #000080;">-</span>e P <span style="color: #000000;">&#123;</span><span style="color: #000080;">%</span>H<span style="color: #000080;">=</span><span style="color: #000000;">&#125;</span></pre>
<h3><a name="For"></a><span class="mw-headline">For</span></h3>
<p>The <b><span class="OIndex">for</span></b> loop is used for all other situations. 
</p><p>Syntax: <b>for (<i>expression1</i>; <i>expression2</i>; <i>expression3</i>) {<i>script</i>};</b>
</p><p>In the <b>for</b> statement, <i>expression1</i> is evaluated. This specifies initialization for the loop.  Second, <i>expression2</i> is evaluated and if true (non-zero), the <i>script</i> is executed. Third, <b>expression3</b>, often incrementing of a counter, is executed. The process repeats at the second step. The loop terminates when <i>expression2</i> is found to be false (zero).  Any expression can consist of multiple statements, each separated by a comma.
</p><p>For example, the following script output numbers from 1 to 4:
</p>
<pre class="lt" style="font-family:monospace;">for<span style="color: #000000;">&#40;</span>ii<span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; ii<span style="color: #000080;">&lt;=</span><span style="color: #0000dd;">4</span>; ii<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span>  
<span style="color: #000000;">&#123;</span>
   type <span style="color: #ff00ff;">&quot;$(ii)&quot;</span>;
<span style="color: #000000;">&#125;</span></pre>
<p><b>Note</b>: The <b>loop</b> command provides faster looping through a block of script.
</p>
<h2><a name="Decision_Structures"></a><span class="mw-headline">Decision Structures</span></h2>
<p><span class="OIndex">Decision structure</span>s allow the program to perform different sets of actions depending on the circumstances.  LabTalk provides three decision-making structures:  if, if-else, and switch.
</p>
<ul><li> The <b>if</b> command is used when a script should be executed in a particular situation.</li>
<li> The <span class="OIndex">if-else</span><span class="OIndex HasShownIndex" style="display:none">If</span> command is used when one script must be executed if a condition is true (non-zero), while another script is executed if the condition is false (zero).</li>
<li> The <b>switch</b> command is used when more than two possibilities are included in a script.</li></ul>
<h3><a name="If.2C_If-Else"></a><span class="mw-headline">If, If-Else</span></h3>
<p>Syntax: 
</p>
<ol><li> <b>if (<i>testCondition</i>) <i>sentence1</i>; [else <i>sentence2</i>;]</b></li>
<li> <b>if (<i>testCondition</i>) {<i>script1</i>} [else {<i>script2</i>}]</b></li></ol>
<p>Evaluate <i>testCondition</i> and if true, execute <i>script1</i>. Expressions without conditional operators are considered true if the result of the expression is non-zero. 
</p><p>If the optional <b>else</b> is present and <i>testCondition</i> is false (zero), then execute <i>script2</i>. There should be a space after the else. Strings should be quoted and string comparisons are <b>not</b> case sensitive.
</p><p>Single statement script arguments should end with a semicolon. Multiple statement script arguments must be surrounded by braces {}. Each statement within the braces should end with a semicolon. It is not necessary to follow the final brace of a script with a semicolon.
</p><p>For example, the following script opens a message box displaying "Yes!":
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #000080;">%</span>M <span style="color: #000080;">=</span> test;
if <span style="color: #000000;">&#40;</span><span style="color: #000080;">%</span>M <span style="color: #000080;">==</span> <span style="color: #ff00ff;">&quot;TEST&quot;</span><span style="color: #000000;">&#41;</span>  type <span style="color: #000080;">-</span>b <span style="color: #ff00ff;">&quot;Yes!&quot;</span>;
else type <span style="color: #000080;">-</span>b <span style="color: #ff00ff;">&quot;No!&quot;</span>;</pre>
<p>The next script finds the first point in column A that is greater than -1.95:
</p>
<pre class="lt" style="font-family:monospace;">newbook;
col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000080;">=</span>data<span style="color: #000000;">&#40;</span><span style="color: #000080;">-</span><span style="color: #0000dd;">2</span>,<span style="color: #0000dd;">2</span>,<span style="color: #0000dd;">0.01</span><span style="color: #000000;">&#41;</span>;
val <span style="color: #000080;">=</span> <span style="color: #000080;">-</span><span style="color: #0000dd;">1.95</span>;
get col<span style="color: #000000;">&#40;</span>A<span style="color: #000000;">&#41;</span> <span style="color: #000080;">-</span>e numpoints;
for<span style="color: #000000;">&#40;</span>ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>&#160;; ii <span style="color: #000080;">&lt;=</span> numpoints&#160;; ii<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
   <span style="color: #008000;">// This will terminate the loop early if true</span>
   if <span style="color: #000000;">&#40;</span>Col<span style="color: #000000;">&#40;</span>A<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>ii<span style="color: #000000;">&#93;</span> <span style="color: #000080;">&gt;</span> val<span style="color: #000000;">&#41;</span>  break;
<span style="color: #000000;">&#125;</span>
if<span style="color: #000000;">&#40;</span>ii <span style="color: #000080;">&gt;</span> numpoints <span style="color: #000080;">-</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>
   ty <span style="color: #000080;">-</span>b No number exceeds <span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>val<span style="color: #000000;">&#41;</span>;
else
   type <span style="color: #000080;">-</span>b The index number of first value <span style="color: #000080;">&gt;</span> <span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>val<span style="color: #000000;">&#41;</span> is <span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span>
The value is <span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>col<span style="color: #000000;">&#40;</span>a<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span>ii<span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span>;</pre>
<p>It is possible to test more than one condition with a single <b>if</b> statement, for instance:
</p>
<pre class="lt" style="font-family:monospace;">if<span style="color: #000000;">&#40;</span>a<span style="color: #000080;">&gt;</span><span style="color: #0000dd;">1</span> <span style="color: #000080;">&amp;&amp;</span> a<span style="color: #000080;">&lt;</span><span style="color: #0000dd;">3</span><span style="color: #000000;">&#41;</span> b<span style="color: #000080;">+</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// If true, increment b by 1</span></pre>
<p>The &amp;&amp;<span class="OIndex" style="display:none">and operator</span> (logical And) operator is one of several <a href="../../LabTalk/LabTalk/Operators.html#Logical_and_Relational_Operators" title="LabTalk:Operators">logical operators</a> supported in LabTalk.
</p>
<h3><a name="Switch"></a><span class="mw-headline">Switch</span></h3>
<p>The <span class="OIndex">switch</span> command is used when more than two possibilities are included in a script. For example, the following script returns b:
</p>
<pre class="lt" style="font-family:monospace;">ii<span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>;
switch <span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
     case <span style="color: #0000dd;">1</span><span style="color: #000000;">:</span>
         type <span style="color: #ff00ff;">&quot;a&quot;</span>; 
         break;
     case <span style="color: #0000dd;">2</span><span style="color: #000000;">:</span>
         type <span style="color: #ff00ff;">&quot;b&quot;</span>; 
         break;
     case <span style="color: #0000dd;">3</span><span style="color: #000000;">:</span>
         type <span style="color: #ff00ff;">&quot;c&quot;</span>; 
         break;
     default<span style="color: #000000;">:</span>
         type <span style="color: #ff00ff;">&quot;none&quot;</span>; 
         break;
<span style="color: #000000;">&#125;</span></pre>
<h3><a name="Break_and_Progress_Bars"></a><span class="mw-headline">Break and Progress Bars</span></h3>
<p>LabTalk provides a <a href="../../LabTalk/LabTalk/Break_(command).html" title="LabTalk:Break (command)"><span class="OIndex">break</span></a> command.  When executed, this causes an exit from the loop and, optionally, the script. This is often used with a decision structure inside a loop. It is used to protect against conditions which would invalidate the loop test conditions. The break command can be used to display a progress status dialog box (progress bar) to show the current progress through the loop.
</p>
<h3><a name="Exit"></a><span class="mw-headline">Exit</span></h3>
<p>The <span class="OIndex">exit</span> command prompts an exit from Origin unless a flag is previously set to prevent the exit.
</p>
<h3><a name="Continue"></a><span class="mw-headline">Continue</span></h3>
<p>The <span class="OIndex">continue</span> command can be used within loops. When executed, the remainder of the loop is ignored and the interpreter jumps to the next iteration of the loop. This is often used with a decision structure inside a loop and can exclude illegal values from being processed by the loop script.
</p><p>For example, in the following for loop, continue skips the type statement when ii is less than zero.
</p>
<pre class="lt" style="font-family:monospace;">for <span style="color: #000000;">&#40;</span>ii <span style="color: #000080;">=</span> <span style="color: #000080;">-</span><span style="color: #0000dd;">10</span>; ii <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">10</span>; ii <span style="color: #000080;">+</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span> 
<span style="color: #000000;">&#123;</span>
   if <span style="color: #000000;">&#40;</span>ii <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>
     continue;

   type <span style="color: #ff00ff;">&quot;$(sqrt(ii))&quot;</span>;
<span style="color: #000000;">&#125;</span></pre>
<h2><a name="Sections_in_a_Script_File"></a><span class="mw-headline">Sections in a Script File</span></h2>
<p>In addition to entering the script in the Label Control dialog, you can also save it as an <a href="../../LabTalk/Script/From_Files.html#The_OGS_File_Extension" title="Script:From Files">Origin Script (OGS) file</a>. An Origin script file is an ASCII text file which consists of a series of one or more LabTalk statements.  Often, you can divide the statements into sections. A <a href="../../LabTalk/Script/From_Files.html#Sections_in_an_OGS_File" title="Script:From Files"><span class="OIndex">section</span></a> is declared by a section name surrounded by square brackets on its own line of text:
</p><p>[<i>SectionName</i>]
</p><p>Scripts under a section declaration belong to that section until another section declaration is met.  A framework for a script with sections will look like the following:
</p>
<pre class="lt" style="font-family:monospace;">...
<span style="color: #000080;">Scripts</span>;
...
<span style="color: #000000;">&#91;</span>Section <span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span>
...
<span style="color: #000080;">Scripts</span>;
...
<span style="color: #000000;">&#91;</span>Section <span style="color: #0000dd;">2</span><span style="color: #000000;">&#93;</span>
...
<span style="color: #000080;">Scripts</span>;
...</pre>
<p>Scripts will be run in sequence until a new section flag is encountered, a return statement is executed or an error occurs. To run a script in sections, you should use the 
</p><p><a href="../../LabTalk/LabTalk/Run_(object).html#Methods:" title="LabTalk:Run (object)">run.section(<i>FileName</i>, <i>SectionName</i>)</a>
</p><p>command. When filename is not included, the current running script file is assumed, for example:
</p><p>run.section(, Init)
</p><p>The following script illustrates how to call sections in an OGS file:
</p>
<pre class="lt" style="font-family:monospace;">type <span style="color: #ff00ff;">&quot;Hello, we will run section 2&quot;</span>;
run.<span style="color: #000080;">section</span><span style="color: #000000;">&#40;</span>, section2<span style="color: #000000;">&#41;</span>;

<span style="color: #000000;">&#91;</span>section1<span style="color: #000000;">&#93;</span>
type <span style="color: #ff00ff;">&quot;This is section 1, End the script.&quot;</span>;

<span style="color: #000000;">&#91;</span>section2<span style="color: #000000;">&#93;</span>
type <span style="color: #ff00ff;">&quot;This is section 2, run section 1.&quot;</span>;
run.<span style="color: #000080;">section</span><span style="color: #000000;">&#40;</span>, section1<span style="color: #000000;">&#41;</span>;</pre>
<p>To run the script, you can save it to your Origin user folder as test.ogs, and type the following in the command window:
</p>
<pre class="lt" style="font-family:monospace;">run.<span style="color: #000080;">section</span><span style="color: #000000;">&#40;</span>test<span style="color: #000000;">&#41;</span>;</pre>
<p>If code in a section could cause an error condition which would prematurely terminate a section, you can use a variable to test for that case, as in:
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #000000;">&#91;</span>Test<span style="color: #000000;">&#93;</span>
SectionPassed <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
<span style="color: #008000;">// Here is where code that could fail can be run</span>
...
<span style="color: #000080;">SectionPassed</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;</pre>
<p>If the code failed, then SectionPassed will still have a value of 0. If the code succeeded, then SectionPassed will have a value of 1.
</p>





