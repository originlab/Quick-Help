<h1 class="firstHeading">5.5 Use X-Function in LabTalk</h1><p class='urlname' style='display: none'>Tutorial-XF</p>
<p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Summary"><span class="tocnumber">1</span> <span class="toctext">Summary</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#What_You_Will_Learn"><span class="tocnumber">2</span> <span class="toctext">What You Will Learn</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Steps"><span class="tocnumber">3</span> <span class="toctext">Steps</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Call_X-Function"><span class="tocnumber">3.1</span> <span class="toctext">Call X-Function</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Generate_Script_from_X-Function_Dialog"><span class="tocnumber">3.2</span> <span class="toctext">Generate Script from X-Function Dialog</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Call_X-Functions_with_Options_Tree"><span class="tocnumber">3.3</span> <span class="toctext">Call X-Functions with Options Tree</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Call_X-Function_Operation"><span class="tocnumber">3.4</span> <span class="toctext">Call X-Function Operation</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Change_Parameter_of_the_X-Function_and_Recalculate"><span class="tocnumber">3.5</span> <span class="toctext">Change Parameter of the X-Function and Recalculate</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Get_Results_from_X-Functions"><span class="tocnumber">3.6</span> <span class="toctext">Get Results from X-Functions</span></a>
<ul>
<li class="toclevel-3 tocsection-10"><a href="#Get_result_from_auto_generate_object"><span class="tocnumber">3.6.1</span> <span class="toctext">Get result from auto generate object</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#Put_Result_to_a_Tree_Object"><span class="tocnumber">3.6.2</span> <span class="toctext">Put Result to a Tree Object</span></a></li>
<li class="toclevel-3 tocsection-12"><a href="#Put_Result_to_a_Worksheet"><span class="tocnumber">3.6.3</span> <span class="toctext">Put Result to a Worksheet</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

<h2><a name="Summary"></a><span class="mw-headline">Summary</span></h2>
<p>X-Functions provide a uniform way to access many of Origin's capabilities from your LabTalk scripts. 
</p><p>The syntax to call an X-Function is:
</p><p><b>xFunctionName [argument1:=&lt;<i>range</i>,<i>name</i> or <i>value</i>&gt; argument2:=&lt;<i>range</i>,<i>name</i> or <i>value</i>&gt; ... ][ -switch];</b>
</p><p>Option switches allow you to access alternate modes of executing X-functions from your scripts, such as use the <b>-h</b> switch to access its help file to output arguments and definitions:
</p><p><b>xFunctionName -h;</b>
</p><p>X-Function operations are often associated with an option tree, which is accessible with the <b>op_change</b> X-Function. It is possible to use this <b>op_change</b> X-Function to make changes to some arguments and re-execute the X-Function operation.
</p><p>If an X-Function generates report data, you can get the data and put it to a specific worksheet/column or a tree variable.
</p>
<h2><a name="What_You_Will_Learn"></a><span class="mw-headline">What You Will Learn</span></h2>
<p>This tutorial will show you how to:
</p>
<ul><li>call X-Function with LabTalk script</li>
<li>generate script from dialog settings</li>
<li>manipulate tree node options for X-Function</li>
<li>get the operation tree, change settings and run X-Function again with new settings</li>
<li>send result data to tree variable or worksheet/column</li>
<li>use switch options when accessing X-Function</li></ul>
<h2><a name="Steps"></a><span class="mw-headline">Steps</span></h2>
<h3><a name="Call_X-Function"></a><span class="mw-headline">Call X-Function</span></h3>
<ol>
<li>Launch Origin and start with a new empty OPJ file. In Script window, call the X-Function <a class="external text" href="../../XFunction/X-Function/Newbook.html">newbook</a> to create a new workbook.</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//Create a new workbook with long name &quot;Curves&quot;, short name saved to string variable bkn$</span>
newbook name<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Curves&quot;</span> result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>bkn<span style="color: #000080;">$</span>;
<span style="color: #008000;">//Check the string variable value</span>
bkn<span style="color: #000080;">$</span><span style="color: #000080;">=</span>;</pre>
</ol>
<table class="noborder"><tr>
	<td style="vertical-align:top" width="60"><img src="../images/Tutorial_X-Function/Tip_icon.png?v=0" width="57"  border="0" /></td><td><p>Two ways to get the x-function help
</p>
<ul><li> <b>&lt;xfunctionname&gt; -h</b> will dump help in the Script window. E.g. <b>newbook -h</b></li>
<li> <b>help &lt;xfunctionname&gt;</b> will open the corresponding help page, e.g. <b>help newbook</b></li></ul>
</td></tr></table>
<h3><a name="Generate_Script_from_X-Function_Dialog"></a><span class="mw-headline">Generate Script from X-Function Dialog</span></h3>
<p>Generate Script context menu in X-Function dialog provides a GUI way to set input, output and parameters and generate corresponding script.
</p>
<ol>
<li>In Script window, run namebook function with -d switch
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//newbook -d also works</span>
newbook name<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Curves&quot;</span> result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>bkn<span style="color: #000080;">$</span> <span style="color: #000080;">-</span>d;</pre>
<li>In the x-Function that opens, set <b>Number of Sheets</b> to 5. 
<li>Click the triangle button next to the <b>Dialog Theme</b>, choose <b>Generate Script</b> in the fly-out menu, the LabTalk script for this operation will be typed to the script window for future use</li>
<pre class="lt" style="font-family:monospace;">newbook name<span style="color: #000000;">:</span><span style="color: #000080;">=</span>Summary sheet<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">5</span> result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>bkn<span style="color: #000080;">$</span>;</pre>
<li>Cancel the X-Function dialog.
</ol>
<h3><a name="Call_X-Functions_with_Options_Tree"></a><span class="mw-headline">Call X-Functions with Options Tree</span></h3>
<p>Some X-Function may have many parameters and related parameters are put in tree, e.g. <a class="external text" href="../../XFunction/X-Function/ImpASC.html">ImpASC</a> X-Function.
</p>
<ol>
<li>Run the following script to open the <b>impASC</b> X-Function dialog
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//-d is the switch to open the x-function dialog</span>
impASC <span style="color: #000080;">-</span>d;</pre>
<li>Browse to select the file <b>Polynomial Fit.dat</b> under <i>&lt;Origin Exe Folder&gt;\Samples\Curve Fitting\</i> path
<li>Under the <b>Import Options</b> tree node, select <b>No</b> for <b>Add Sparklines</b>, and uncheck <b>Rename Sheet with (Partial) Filename</b>, <b>Rename Book with (Partial) Filename</b> and <b>Append Filename to Workbook Comment</b>.
<li>Click the triangle button next to the <b>Dialog Theme</b>, choose <b>Generate Script</b> in the fly-out menu, the LabTalk script for this operation will be typed to the script window.
<li>Click <b>Cancel</b> to exit the <b>ImpASC</b> dialog, and the script should be dumped in Script Window. 
<li>We write it into multi-lines so user can see how the settings are set in <b>Options</b> tree and subnode <b>names</b>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//Note: the file path may differ from your Origin EXE path</span>

impASC fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;C:\Program Files\OriginLab\Origin2023\Samples\Curve Fitting\Polynomial Fit.dat&quot;</span> 
options.<span style="color: #000080;">Sparklines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> 
options.<span style="color: #000080;">names</span>.<span style="color: #000080;">FNameToSht</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> 
options.<span style="color: #000080;">names</span>.<span style="color: #000080;">FNameToBk</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>
options.<span style="color: #000080;">names</span>.<span style="color: #000080;">FNameToBkComm</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;</pre>
<li>If it's a one line script. Just put cursor on the line and press <b>Enter</b> to execute it. If it's in multiple lines, highlight them and press <b>Enter</b> to execute it. The "options" in the script above is a tree variable, which is used to set and store parameters for this X-Function.</li>
</ol>
<h3><a name="Call_X-Function_Operation"></a><span class="mw-headline">Call X-Function Operation</span></h3>
<p>Some X-Function does operation (e.g. fitting, statistics, data handling) on Origin objects (e.g. column, sheet, plot) and generates some output in other Origin objects, E.g. the <a class="external text" href="../../XFunction/X-Function/Fitpoly.html">fitpoly</a> X-Function will do polynomial fit on XY range and put coefficients and fitted curve in other columns. 
</p><p>For such X-Functions, use -r switch to set the recalculation mode. Auto will auto trigger recalculation if input changes, while Manual will not trigger recalculation till user triggers it manually.
</p>
<ol>
<li> Run the following script to do 2nd order polynomial fit on XY data in 1st two columns in book named bkn$. Use -r 1 tswitch to set the operation's recalculation mode to "Auto"
<pre class="lt" style="font-family:monospace;">fitpoly iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>bkn<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#93;</span><span style="color: #000080;">!</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span> polyorder<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> 
        coef<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>new<span style="color: #000080;">&gt;</span> oy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">&lt;</span>Input<span style="color: #000080;">&gt;</span><span style="color: #000000;">&#93;</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span><span style="color: #000080;">!</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span> 
        AdjRSq<span style="color: #000000;">:</span><span style="color: #000080;">=</span>arsq RSqCOD<span style="color: #000000;">:</span><span style="color: #000080;">=</span>rsq <span style="color: #000080;">-</span>r <span style="color: #0000dd;">1</span>;
arsq<span style="color: #000080;">=</span>; <span style="color: #008000;">//output AdjRSq value</span>
rsq<span style="color: #000080;">=</span>; <span style="color: #008000;">//output RSqCOD value</span></pre>
<li>Sheet2 is created with XY value of fitted curve. Polynormial Coefficients are output to column D on Sheet1.
<li>There are green locks on output which indicate it's an output of an operation. Mouse over the green lock to see operation info (fitpoly). 
</ol>
<h3><a name="Change_Parameter_of_the_X-Function_and_Recalculate"></a><span class="mw-headline">Change Parameter of the X-Function and Recalculate</span></h3>
<ol>
<li>Make Sheet2 active. Create a range variable which is output of the operation.
<pre class="lt" style="font-family:monospace;">range r1 <span style="color: #000080;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>bkn<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#93;</span><span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>page.<span style="color: #000080;">active</span><span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span><span style="color: #000080;">!</span>col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">//column A of Sheet2</span></pre>
<li>Use <a class="external text" href="../../XFunction/X-Function/Op_change.html">op_change</a> X-Function to get the operation setting to a tree variable mytree.
<pre class="lt" style="font-family:monospace;">op_change ir<span style="color: #000000;">:</span><span style="color: #000080;">=</span>r1 tr<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mytree;</pre>
<li>Output the mytree contents.</li>
<pre class="lt" style="font-family:monospace;">mytree.<span style="color: #000080;">=</span>;</pre>
<li>You can now change operation settings using the <b>mytree</b> variable.</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//Change the input data</span>
mytree.<span style="color: #000080;">xfGetN</span>.<span style="color: #000080;">iy</span>.<span style="color: #000080;">Range1</span>.<span style="color: #000080;">Y</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;[%(bkn$)]1!C&quot;</span>;
<span style="color: #008000;">//Change the polynomial order</span>
mytree.<span style="color: #000080;">xfGetN</span>.<span style="color: #000080;">polyorder</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;</pre>
<li>You can run the script "mytree.=;" again to check the modified settings.</li>
<li>Now execute the operation again with the modified settings.</li>
<pre class="lt" style="font-family:monospace;">op_change ir<span style="color: #000000;">:</span><span style="color: #000080;">=</span>r1 tr<span style="color: #000000;">:</span><span style="color: #000080;">=</span>mytree op<span style="color: #000000;">:</span><span style="color: #000080;">=</span>run;</pre>
</ol>
<h3><a name="Get_Results_from_X-Functions"></a><span class="mw-headline">Get Results from X-Functions</span></h3>
<p>You can get report data from an X-Function operation and send it to a specific book/sheet/column location, or a tree variable.
</p>
<h4><a name="Get_result_from_auto_generate_object"></a><span class="mw-headline">Get result from auto generate object</span></h4>
<p>Some X-Functions auto generate an output object same name as the xfunction. E.g. <b><a class="external text" href="../../XFunction/X-Function/Stats.html">stats</a></b>, <b><a class="external text" href="../../XFunction/X-Function/FitLR.html">fitLR</a></b>, <b><a class="external text" href="../../XFunction/X-Function/Fitpoly.html">fitPoly</a></b>, and <b><a class="external text" href="../../XFunction/X-Function/FitMR.html">fitMR</a></b>, etc.
</p>
<ol>
<li> Run the following script to view fitpoly object
<pre class="lt" style="font-family:monospace;">fitpoly.<span style="color: #000080;">=</span>;
range rStats<span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>; <span style="color: #008000;">//set range variable rStats to 3rd column in active sheet</span>
rStats<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span><span style="color: #000080;">=</span>fitpoly.<span style="color: #000080;">N</span>; 
rStats<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#93;</span><span style="color: #000080;">=</span>fitpoly.<span style="color: #000080;">AdjRSq</span>;
rStats<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">3</span><span style="color: #000000;">&#93;</span><span style="color: #000080;">=</span>fitpoly.<span style="color: #000080;">RSqCOD</span>;</pre>
<li> N, AdjRSq, RSqCOD will be put to the cells in 3rd column
<li> Run the following script to get basic statics of a column
<pre class="lt" style="font-family:monospace;"> 
stats <span style="color: #000000;">&#91;</span><span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>bkn<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>C; <span style="color: #008000;">//do statistics on column C of 1st sheet in workbook named bkn$</span>
stats.<span style="color: #000080;">=</span>; <span style="color: #008000;">//check all properties of the created stats object</span></pre> 
</ol>
<h4><a name="Put_Result_to_a_Tree_Object"></a><span class="mw-headline">Put Result to a Tree Object</span></h4>
<ol>
<li>Create a new worksheet with the <a class="external text" href="../../XFunction/X-Function/Newsheet.html">newsheet</a> X-Function.</li>
<pre class="lt" style="font-family:monospace;">newsheet;
<span style="color: #008000;">//Get the sheet name in string register&#160;%B</span>
<span style="color: #000080;">%</span>B <span style="color: #000080;">=</span> page.<span style="color: #000080;">active</span><span style="color: #000080;">$</span>;</pre>
<li>Fill in some data in column A.</li>
<pre class="lt" style="font-family:monospace;">col<span style="color: #000000;">&#40;</span>A<span style="color: #000000;">&#41;</span> <span style="color: #000080;">=</span> <span style="color: #000000;">&#123;</span><span style="color: #0000dd;">13.2</span>, <span style="color: #0000dd;">14.1</span>, <span style="color: #0000dd;">11.7</span>, <span style="color: #0000dd;">23.9</span>, <span style="color: #0000dd;">10.3</span><span style="color: #000000;">&#125;</span>;</pre>
<li>Use the <a class="external text" href="../../XFunction/X-Function/Grubbs.html">grubbs</a> X-Function to detect if there is an outlier in column A.</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//Output the report data into tree variable tr</span>
<span style="color: #008000;">//If tr does not exist yet, it will be created</span>
grubbs ix<span style="color: #000000;">:</span><span style="color: #000080;">=</span>col<span style="color: #000000;">&#40;</span>A<span style="color: #000000;">&#41;</span> rt<span style="color: #000000;">:</span><span style="color: #000080;">=</span>tr;</pre> 
<li>Use the following script to  get the tree structure and values.</li>
<pre class="lt" style="font-family:monospace;">tr.<span style="color: #000080;">=</span>;</pre>
<li>Get result values from tree variable and pass to double or string variables.</li>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//Get the row index for suspected outlier</span>
double rindex <span style="color: #000080;">=</span> tr.<span style="color: #000080;">Stats</span>.<span style="color: #000080;">Stats</span>.<span style="color: #000080;">C2</span>;
<span style="color: #008000;">//Get the conclusion string</span>
string conclusion<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> tr.<span style="color: #000080;">Stats</span>.<span style="color: #000080;">Footer</span><span style="color: #000080;">$</span>;
<span style="color: #008000;">//Display the conclusion sentence right to the data cell of the suspected outlier</span>
col<span style="color: #000000;">&#40;</span>B<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>rindex<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span> <span style="color: #000080;">=</span> conclusion<span style="color: #000080;">$</span>;
<span style="color: #008000;">//Change column width to display all texts</span>
wks.<span style="color: #000080;">col2</span>.<span style="color: #000080;">width</span><span style="color: #000080;">=</span><span style="color: #0000dd;">40</span>;</pre>
</ol>
<h4><a name="Put_Result_to_a_Worksheet"></a><span class="mw-headline">Put Result to a Worksheet</span></h4>
<p>Run the grubbs x function again, but this time send the report data to a specified worksheet <b>Result</b>.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//Create the new worksheet &quot;Result&quot;</span>
newsheet name<span style="color: #000000;">:</span><span style="color: #000080;">=</span>Result;
<span style="color: #008000;">//Send the report data to the Result worksheet</span>
grubbs ix<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">%</span>H<span style="color: #000000;">&#93;</span><span style="color: #000080;">%</span>B<span style="color: #000080;">!</span>col<span style="color: #000000;">&#40;</span>A<span style="color: #000000;">&#41;</span> rt<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">&lt;</span>Input<span style="color: #000080;">&gt;</span><span style="color: #000000;">&#93;</span>Result<span style="color: #000080;">!</span>; 
<span style="color: #008000;">//Note: the above newsheet script isn't necessary since if sheet with name Result doesn't exist, </span>
<span style="color: #008000;">//it will be created automatically.</span></pre>  
<table class="noborder"><tr>
	<td style="vertical-align:top" width="60"><img src="../images/Tutorial_X-Function/Tip_icon.png?v=0" width="57"  border="0" /></td><td><p>To get report tree of nonlinear curve fit (<a class="external text" href="../../XFunction/X-Function/Nlbegin.html">nlbegin</a>/<a class="external text" href="../../XFunction/X-Function/Nlfit.html">nlfit</a>/<a class="external text" href="../../XFunction/X-Function/Nlend.html">nlend</a> X-Functions), you may also use the X-Function <a class="external text" href="../../XFunction/X-Function/Getnlr.html">getnlr</a>.
</p></td></tr></table>
<p><br />
</p>

