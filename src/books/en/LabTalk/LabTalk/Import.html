<h1 class="firstHeading">4.3.1 General Importing Examples</h1><p class='urlname' style='display: none'>general-Import</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Using_X-Functions_to_Import_Data"><span class="tocnumber">1</span> <span class="toctext">Using X-Functions to Import Data</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#X-Function_Themes"><span class="tocnumber">1.1</span> <span class="toctext">X-Function Themes</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3"><a href="#ASCII_Import"><span class="tocnumber">2</span> <span class="toctext">ASCII Import</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Controlling_Header_and_Long_Name"><span class="tocnumber">2.1</span> <span class="toctext">Controlling Header and Long Name</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Partial_Import"><span class="tocnumber">2.2</span> <span class="toctext">Partial Import</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Delimiters_and_Numeric_Separators"><span class="tocnumber">2.3</span> <span class="toctext">Delimiters and Numeric Separators</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Import_Mode"><span class="tocnumber">2.4</span> <span class="toctext">Import Mode</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Importing_Multiple_Files"><span class="tocnumber">2.5</span> <span class="toctext">Importing Multiple Files</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#After_Import_Convert_Worksheet_to_Matrix"><span class="tocnumber">2.6</span> <span class="toctext">After Import Convert Worksheet to Matrix</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#Import_Filters"><span class="tocnumber">3</span> <span class="toctext">Import Filters</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#impFile_X-Function_with_Sample_Filter"><span class="tocnumber">3.1</span> <span class="toctext">impFile X-Function with Sample Filter</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#Internet_Data_Access"><span class="tocnumber">4</span> <span class="toctext">Internet Data Access</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#Import_A_Web_ASCII_File_Into_A_Worksheet"><span class="tocnumber">4.1</span> <span class="toctext">Import A Web ASCII File Into A Worksheet</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Import_A_Web_Image_Into_A_New_Matrix"><span class="tocnumber">4.2</span> <span class="toctext">Import A Web Image Into A New Matrix</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-15"><a href="#Database_Access"><span class="tocnumber">5</span> <span class="toctext">Database Access</span></a>
<ul>
<li class="toclevel-2 tocsection-16"><a href="#Import_from_Included_Sample_Access_Database"><span class="tocnumber">5.1</span> <span class="toctext">Import from Included Sample Access Database</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-17"><a href="#Instrument_Data_Import"><span class="tocnumber">6</span> <span class="toctext">Instrument Data Import</span></a>
<ul>
<li class="toclevel-2 tocsection-18"><a href="#Importing_and_Plotting_Multiple_SPC_Files"><span class="tocnumber">6.1</span> <span class="toctext">Importing and Plotting Multiple SPC Files</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-19"><a href="#Specify_Channel_Names_for_Import"><span class="tocnumber">7</span> <span class="toctext">Specify Channel Names for Import</span></a></li>
<li class="toclevel-1 tocsection-20"><a href="#Image_Files"><span class="tocnumber">8</span> <span class="toctext">Image Files</span></a>
<ul>
<li class="toclevel-2 tocsection-21"><a href="#Import_Images"><span class="tocnumber">8.1</span> <span class="toctext">Import Images</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="#Convert_Imported_Image_into_Data"><span class="tocnumber">8.2</span> <span class="toctext">Convert Imported Image into Data</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-23"><a href="#Text_Files"><span class="tocnumber">9</span> <span class="toctext">Text Files</span></a>
<ul>
<li class="toclevel-2 tocsection-24"><a href="#Open_a_Text_File_Into_a_Notes_Window"><span class="tocnumber">9.1</span> <span class="toctext">Open a Text File Into a Notes Window</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-25"><a href="#Import_Video"><span class="tocnumber">10</span> <span class="toctext">Import Video</span></a></li>
<li class="toclevel-1 tocsection-26"><a href="#Reimport"><span class="tocnumber">11</span> <span class="toctext">Reimport</span></a>
<ul>
<li class="toclevel-2 tocsection-27"><a href="#Using_Reimport_to_Bring_back_all_Data"><span class="tocnumber">11.1</span> <span class="toctext">Using Reimport to Bring back all Data</span></a></li>
<li class="toclevel-2 tocsection-28"><a href="#Watching_for_a_File_change_for_reimport"><span class="tocnumber">11.2</span> <span class="toctext">Watching for a File change for reimport</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><a name="Using_X-Functions_to_Import_Data"></a><span class="mw-headline">Using X-Functions to Import Data</span></h2>
<p>Origin provides a collection of X-Functions for importing data of various file formats including ASCII, CSV, Excel, National Instruments DIAdem, pCLAMP and more. The X-Function for each file format provides options relevant to the format, in addition to common settings such as setting the name of the target book or sheet to be the name of the imported file.
</p><p>All X-Functions pertaining to importing have names that start with the letters <b>imp</b>. Detailed inforamtion on these X-Functions can be found <a class="external text" href="../../XFunction/Category/Import_and_Export.html">here</a>
</p><p>Users can write their own import routines in the form of X-Functions. If the name of the user-created X-Function begins with <b>imp</b> and it is placed in the <b>\X-Functions\Import and Export</b> subfolder of the EXE, UFF or Group paths, then such functions will appear in the <b>Data: Import from File</b> menu
</p><p>All import functions and file system browser functions (<b>dlgfile</b> and <b>findfiles</b>) share a common parameter&#160;: <b>fname</b>. <b>fname</b> is a string variable which can hold a single file name and path or a list of files.
The import functions automatically handle multiple files. Each function varies in its default handling of multiple files, creating either new Books, new Sheets or new Columns for additional files. This handling can be overridden by options in the import functions.
</p>
<h3><a name="X-Function_Themes"></a><span class="mw-headline">X-Function Themes</span></h3>
<p>When using the import related X-Functions from GUI, user can save custom settings to a theme file on disk. Such theme files have file extension of .OIS and are saved in the <b>\Themes\AnalysisAndReportTable</b> subfolder of the User Files Folder (UFF). Such theme files can then be accessed using the <b>-t</b> <a href="../../LabTalk/LabTalk/X-Function_Execution_Options.html" title="LabTalk:X-Function Execution Options">option switch</a> for the corresponding X-function, to perform the import using the settings saved in the file.
</p><p><b>Example:</b>
</p>
<pre class="lt" style="font-family:monospace;">string fn<span style="color: #000080;">$</span><span style="color: #000080;">=</span>system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Spectroscopy\HiddenPeaks.dat&quot;</span>; 
<span style="color: #008000;">// Following assumes that a theme file named &quot;My Theme.OIS&quot; exists </span>
impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fn<span style="color: #000080;">$</span> <span style="color: #000080;">-</span>t <span style="color: #ff00ff;">&quot;My Theme&quot;</span>;</pre>
<h2><a name="ASCII_Import"></a><span class="mw-headline">ASCII Import</span></h2>
<h3><a name="Controlling_Header_and_Long_Name"></a><span class="mw-headline">Controlling Header and Long Name</span></h3>
<p>Get the US GDP data from Fed website and import by skipping the header block. The header is then put back to Comments cell of the first column.
</p>
<pre class="lt" style="font-family:monospace;">string fname<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;%YUSGDP.txt&quot;</span>;
url<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;https://research.stlouisfed.org/fred2/data/GDP.txt&quot;</span>;
web2file;
if<span style="color: #000000;">&#40;</span> exist<span style="color: #000000;">&#40;</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	type <span style="color: #ff00ff;">&quot;failed to get &quot;</span> <span style="color: #000080;">+</span> url<span style="color: #000080;">$</span>;
	return <span style="color: #0000dd;">0</span>;
<span style="color: #000000;">&#125;</span>
<span style="color: #008000;">//clean the project to start with empty space</span>
doc <span style="color: #000080;">-</span>s;doc <span style="color: #000080;">-</span>n;<span style="color: #000000;">&#123;</span>win <span style="color: #000080;">-</span>cd<span style="color: #000000;">&#125;</span>;
newbook s<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
<span style="color: #008000;">// specify file header structure to import</span>
impASC options.<span style="color: #000080;">sparklines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> 
options.<span style="color: #000080;">FileStruct</span>.<span style="color: #000080;">DateFormat</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;yyyy'-'MM'-'dd&quot;</span>
options.<span style="color: #000080;">Hdr</span>.<span style="color: #000080;">MainHdrLns</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">19</span>
options.<span style="color: #000080;">Hdr</span>.<span style="color: #000080;">AutoSubHdr</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>
options.<span style="color: #000080;">Hdr</span>.<span style="color: #000080;">SubHdrLns</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>
options.<span style="color: #000080;">Hdr</span>.<span style="color: #000080;">Units</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
<span style="color: #008000;">// header string is saved to a system string variable __HEADER, we will </span>
<span style="color: #008000;">// put this into 1st col's comments</span>
range aa<span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
aa<span style="color: #000000;">&#91;</span>C<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span><span style="color: #000080;">=</span>__HEADER<span style="color: #000080;">$</span>;

wks.<span style="color: #000080;">labels</span><span style="color: #000000;">&#40;</span>LC<span style="color: #000000;">&#41;</span>;<span style="color: #008000;">//show Long Name and Comments</span></pre>
<h3><a name="Partial_Import"></a><span class="mw-headline">Partial Import</span></h3>
<p>The options tree for the <b>impASC</b> X-Function provides access to Name options and Partial Import options.
In this example, we use a dialog to gather our file names, then import a portion of each file (10 rows) and do a statistical test of the column 3 data. If the data meets our criteria, we import the whole file, otherwise we skip it. 
</p><p>The Filenames of the successfully imported files are stored in the Comments of the Workbook.
If you try this code with the twelve STEP##.DAT files found in the Samples\Curve Fitting folder, the code will reject seven files and import five.
</p>
<pre class="lt" style="font-family:monospace;">newbook;
dlgfile gr<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">*</span>.<span style="color: #000080;">dat</span> mu<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
string file<span style="color: #000080;">$</span>;
loop<span style="color: #000000;">&#40;</span>ii,<span style="color: #0000dd;">1</span>,fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">&#40;</span>CRLF<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
    file<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetToken</span><span style="color: #000000;">&#40;</span>ii,CRLF<span style="color: #000000;">&#41;</span><span style="color: #000080;">$</span>;
    impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>file<span style="color: #000080;">$</span>
           options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">AutoNames</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>
           options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToSht</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>
           options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToBk</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>
           options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToBkComm</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>
           options.<span style="color: #000080;">PartImp</span>.<span style="color: #000080;">Partial</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>
           options.<span style="color: #000080;">PartImp</span>.<span style="color: #000080;">LastRow</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">10</span>;
    stats <span style="color: #0000dd;">3</span>;
    wclear msg<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
    if<span style="color: #000000;">&#40;</span> stats.<span style="color: #000080;">mean</span> <span style="color: #000080;">&gt;</span> .01 <span style="color: #000080;">&amp;&amp;</span> stats.<span style="color: #000080;">mean</span> <span style="color: #000080;">&lt;</span> .4 <span style="color: #000000;">&#41;</span>
    <span style="color: #000000;">&#123;</span>
        impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>file<span style="color: #000080;">$</span>
               options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">AutoNames</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>
               options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToSht</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>
               options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToBk</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>
               options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToBkComm</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>
               options.<span style="color: #000080;">PartImp</span>.<span style="color: #000080;">Partial</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
        if<span style="color: #000000;">&#40;</span> ii <span style="color: #000080;">!</span><span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">&#40;</span>CRLF<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span> newsheet;
    <span style="color: #000000;">&#125;</span>
    else
    <span style="color: #000000;">&#123;</span>
        type Skipping <span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>file<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span>;
        if<span style="color: #000000;">&#40;</span> ii <span style="color: #000080;">==</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">&#40;</span>CRLF<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span> layer <span style="color: #000080;">-</span>d;
    <span style="color: #000000;">&#125;</span>
<span style="color: #000000;">&#125;</span></pre>
<p><br />
</p>
<h3><a name="Delimiters_and_Numeric_Separators"></a><span class="mw-headline">Delimiters and Numeric Separators</span></h3>
<p>The options tree for the <b>impASC</b> X-Function provides access to Delimiter and Numeric Separator options.  These two options are in the FileStruct node of the options tree.
</p><p>The <b>options.FileStruct.Delimiter</b> option can be one of the following values:
</p>
<ul><li> 0 = Unknown</li>
<li> 1 = Comma</li>
<li> 2 = Tab</li>
<li> 3 = Tab/Space</li>
<li> 4 = Semicolon</li>
<li> 5 = Other (Set the options.FileStruct.OtherDelimiter option to the character)</li>
<li> 7 = Space</li></ul>
<p>The <b>options.FileStruct.NumericSeparator</b> option can be one of the following values:
</p>
<ul><li> 0 = 1,000.00</li>
<li> 1 = 1.000,00</li>
<li> 2 = 1 000,00</li>
<li> 3 = 1'000.00</li></ul>
<p>The following is a simple tab delimited data file for use in the example that follows it.
</p>
<pre>
1	1,010.00	1,240.00
2	3,020.01	2,562.01
3	4,030.00	3,680.00
4	6,040.01	4,002.01
5	7,050.00	5,440.00
6	7,060.01	6,002.01
7	8,982.99	3,456.23
</pre>
<p>Before executing the following example save the sample data above to C:\tempData.txt or change the file name in the example to refer to one of your data files using the same file format.
</p>
<pre class="lt" style="font-family:monospace;">impASC fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>c<span style="color: #000000;">:</span>\tempData.<span style="color: #000080;">txt</span>
	options.<span style="color: #000080;">FileStruct</span>.<span style="color: #000080;">Delimiter</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span>
	options.<span style="color: #000080;">FileStruct</span>.<span style="color: #000080;">NumericSeparator</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;</pre>
<p>The next example will demonstrate how to use the Other Delimiter option.  If the sample data above was delimited with the pipe, or vertical bar, character then you would set <b>options.FileStruct.Delimiter</b> to 5 and then set <b>options.FileStruct.OtherDelimiter</b> to "|".
</p>
<pre class="lt" style="font-family:monospace;">impASC fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>d<span style="color: #000000;">:</span>\tempData.<span style="color: #000080;">txt</span>
	options.<span style="color: #000080;">FileStruct</span>.<span style="color: #000080;">Delimiter</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">5</span>
	options.<span style="color: #000080;">FileStruct</span>.<span style="color: #000080;">OtherDelimiter</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;|&quot;</span>
	options.<span style="color: #000080;">FileStruct</span>.<span style="color: #000080;">NumericSeparator</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;</pre>
<h3><a name="Import_Mode"></a><span class="mw-headline">Import Mode</span></h3>
<p>This example makes use of many advanced options of the impAsc X-Function.
It imports a file to a new book, which will be renamed by the options of impasc.
</p>
<pre class="lt" style="font-family:monospace;">string fn<span style="color: #000080;">$</span><span style="color: #000080;">=</span>system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Spectroscopy\HiddenPeaks.dat&quot;</span>; 
impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fn<span style="color: #000080;">$</span> 
options.<span style="color: #000080;">ImpMode</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>                        <span style="color: #008000; font-style: regular;">/* start with a new book */</span>
options.<span style="color: #000080;">Sparklines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>                     <span style="color: #008000; font-style: regular;">/* turn off sparklines */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">AutoNames</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>                <span style="color: #008000; font-style: regular;">/* turn off auto rename */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToSht</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>               <span style="color: #008000; font-style: regular;">/* rename sheet to file name */</span>
options.<span style="color: #000080;">Miscellaneous</span>.<span style="color: #000080;">LeadingZeros</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;    <span style="color: #008000; font-style: regular;">/* remove leading zeros */</span></pre>
<h3><a name="Importing_Multiple_Files"></a><span class="mw-headline">Importing Multiple Files</span></h3>
<p><b>Example 1</b>
</p><p>This example shows how to import multiple data files in the specified path to an Origin workbook and start new sheets for each file.
</p>
<pre class="lt" style="font-family:monospace;">string fns, path<span style="color: #000080;">$</span><span style="color: #000080;">=</span>system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Curve Fitting\&quot;</span>; 
<span style="color: #008000;">// findFiles will default to get from path$</span>
findfiles fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fns<span style="color: #000080;">$</span> ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;step1*.dat&quot;</span>;
int n <span style="color: #000080;">=</span> fns.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">&#40;</span>CRLF<span style="color: #000000;">&#41;</span>;
string bkName<span style="color: #000080;">$</span>;
newbook s<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>bkName<span style="color: #000080;">$</span>;
impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fns<span style="color: #000080;">$</span>  
options.<span style="color: #000080;">ImpMode</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">4</span>     		    <span style="color: #008000; font-style: regular;">/* start with new sheet */</span>
options.<span style="color: #000080;">Sparklines</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> 		    <span style="color: #008000; font-style: regular;">/* add sparklines if &lt; 50 */</span>
options.<span style="color: #000080;">Cols</span>.<span style="color: #000080;">NumCols</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>  	    <span style="color: #008000; font-style: regular;">/* only import the first 3 columns */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">AutoNames</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> 	    <span style="color: #008000; font-style: regular;">/* turn off auto rename */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToBk</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>          <span style="color: #008000; font-style: regular;">/* do not rename the workbook */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToSht</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>         <span style="color: #008000; font-style: regular;">/* rename sheet to file name */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToShtFrom</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">4</span>     <span style="color: #008000; font-style: regular;">/* trim file name from 4th letter */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToBkComm</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>      <span style="color: #008000; font-style: regular;">/* add file name to book comment */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FNameToColComm</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>     <span style="color: #008000; font-style: regular;">/* and to columns comments */</span>
options.<span style="color: #000080;">Names</span>.<span style="color: #000080;">FPathToComm</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>        <span style="color: #008000; font-style: regular;">/* include file path to comments */</span>
orng<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span>bkName<span style="color: #000080;">$</span><span style="color: #000000;">&#93;</span>A1<span style="color: #000080;">!</span>A<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">:</span>C<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">&#93;</span>&#160;;</pre>
<p><b>Example 2</b>
</p><p>This example shows how to find all files with similar name sample*.csv in all subfolders and recursive folders and import into Origin worksheet, append as new rows for each file.
</p>
<pre class="lt" style="font-family:monospace;">newbook test;
dlgPath;<span style="color: #008000;">// Open dialog to navigate to main folder</span>
type <span style="color: #000080;">-</span>a <span style="color: #ff00ff;">&quot;You have choosen &quot;</span> <span style="color: #000080;">+</span> path<span style="color: #000080;">$</span>;

findfolders addpath<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;

if<span style="color: #000000;">&#40;</span>folder.<span style="color: #000080;">GetLength</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">&lt;</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>
	<span style="color: #000000;">&#123;</span>
		type <span style="color: #ff00ff;">&quot;No subfolders found&quot;</span>;
		break <span style="color: #0000dd;">1</span>;
	<span style="color: #000000;">&#125;</span>
else
	<span style="color: #000000;">&#123;</span>
		int nn <span style="color: #000080;">=</span> folder.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">&#40;</span>CRLF<span style="color: #000000;">&#41;</span>;
		type <span style="color: #ff00ff;">&quot;$(nn) subfolders found&quot;</span>;
		
		string strTemp<span style="color: #000080;">$</span>;
		for<span style="color: #000000;">&#40;</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ii <span style="color: #000080;">&lt;=</span>nn; ii<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span> <span style="color: #008000;">// Run for each found folder</span>
		<span style="color: #000000;">&#123;</span>
			strTemp<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> folder.<span style="color: #000080;">GetToken</span><span style="color: #000000;">&#40;</span>ii, CRLF<span style="color: #000000;">&#41;</span><span style="color: #000080;">$</span>;
			findFiles path<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strTemp<span style="color: #000080;">$</span> ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;sample*.csv&quot;</span> fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>results;
			int mm <span style="color: #000080;">=</span> results.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">&#40;</span>CRLF<span style="color: #000000;">&#41;</span>;
			type <span style="color: #ff00ff;">&quot;A Total of $(mm) files found&quot;</span>;
			impasc fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>results<span style="color: #000080;">$</span> menu<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> options.<span style="color: #000080;">Impmode</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> Options.<span style="color: #000080;">Hdr</span>.<span style="color: #000080;">SNames</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;
		<span style="color: #000000;">&#125;</span>
	<span style="color: #000000;">&#125;</span></pre>
<h3><a name="After_Import_Convert_Worksheet_to_Matrix"></a><span class="mw-headline">After Import Convert Worksheet to Matrix</span></h3>
<p>The first line generates a file dialog to let you select an ASCII file and import data into a Worksheet.
The second line directly converts from Worksheet to Matrix and sets the Matrix XY coordinates.
The options for the conversion are such that the X-Function expects linearly increasing Y values in the first column and linearly increasing X values in the first row.
</p><p>(Note that 'matrix_data_with_xy.txt' in the Samples\Import and Export\ folder fulfills these requirements.)
</p><p><b>Example:</b>
</p>
<pre class="lt" style="font-family:monospace;">dlgfile g<span style="color: #000000;">:</span><span style="color: #000080;">=</span>ascii;
impAsc;
w2m xy<span style="color: #000000;">:</span><span style="color: #000080;">=</span>xcol xlabel<span style="color: #000000;">:</span><span style="color: #000080;">=</span>row1 ycol<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;</pre>
<h2><a name="Import_Filters"></a><span class="mw-headline">Import Filters</span></h2>
<p>Custom importing of ASCII files and simple binary files can be performed using the <b>Import Wizard</b> GUI tool. This tool allows extraction of variables from file name and header, and further customization of the import including running a script segment at the end of the import, which can be used to perform post processing of imported data. All settings in the GUI can be saved as an <b>Import Filter File</b> to disk. Such files have extension of <b>.OIF</b> and can be saved in multiple locations.
</p><p>Once an import wizard filter file has been created, the impfile X-Function can be used to access the filter, to perform custom importing using the settings saved in the filter file.
</p><p><b>Example:</b>
</p>
<pre class="lt" style="font-family:monospace;">string fname<span style="color: #000080;">$</span>, path<span style="color: #000080;">$</span>, filtername<span style="color: #000080;">$</span>;
<span style="color: #008000;">// point to file path</span>
path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Import and Export\&quot;</span>;
findfiles ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;S*.dat&quot;</span>;   <span style="color: #008000;">// find files that match specification</span>
<span style="color: #008000;">// point to Import Wizard filter file</span>
filtername<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Import and Export\
VarsFromFileNameAndHeader.oif&quot;</span>;
impfile location<span style="color: #000000;">:</span><span style="color: #000080;">=</span>data;    <span style="color: #008000;">// import all files using filter</span></pre>
<h3><a name="impFile_X-Function_with_Sample_Filter"></a><span class="mw-headline">impFile X-Function with Sample Filter</span></h3>
<p>This example imports a series of data files into the project using a given file filter.
For each data file, a new sub-folder will be created in the project.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Point to where the data files are</span>
string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Signal Processing\&quot;</span>;
<span style="color: #008000;">// Find all files with wild card</span>
findfiles ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;TR*.dat&quot;</span>;
int numFiles <span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">&#40;</span>LF<span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Loop over all files</span>
int nFirst <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
for<span style="color: #000000;">&#40;</span>int ifile <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ifile <span style="color: #000080;">&lt;=</span> numFiles; ifile<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	string filepath<span style="color: #000080;">$</span>, filename<span style="color: #000080;">$</span>;
	
	<span style="color: #008000;">// Get next file name</span>
	filepath<span style="color: #000080;">$</span><span style="color: #000080;">=</span>fname.<span style="color: #000080;">gettoken</span><span style="color: #000000;">&#40;</span>ifile,LF<span style="color: #000000;">&#41;</span><span style="color: #000080;">$</span>;
	<span style="color: #008000;">// Parse out just file name without path and without extension</span>
	filename<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> filepath.<span style="color: #000080;">GetFileName</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000080;">$</span>;
	
	<span style="color: #008000;">// Make a new PE subfolder using the file name and set it active</span>
	pe_mkdir filename<span style="color: #000080;">$</span> cd<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
	
	<span style="color: #008000;">// Add a new book and import data file</span>
	<span style="color: #008000;">// Filter for file exists in data folder</span>
	<span style="color: #008000;">// The filter does some post processing of the data by creating</span>
	<span style="color: #008000;">// frequency column and setting values etc.</span>
	newbook;
	<span style="color: #008000;">// Note how variable names can be truncated to unique characters</span>
	impfile fn<span style="color: #000000;">:</span><span style="color: #000080;">=</span>filepath<span style="color: #000080;">$</span> fi<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;TR Data Files.oif&quot;</span> l<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
	<span style="color: #008000;">// Set PE folder to previous level and go to next file</span>
	pe_cd ..;
<span style="color: #000000;">&#125;</span></pre>
<p><br />
This example imports single or multiple files into the project using a given import filter.  The filter has the setting 
</p><p>saved to determine whether each file is imported as a new sheet or new book.  Before you run the code, you need to 
</p><p>create a filter file and save it to the same folder where the data is.  It is then just two lines of code to bring in 
</p><p>data.  The code below uses two X-Functions:  dlgFile and impFile
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Open a dialog for the user to select one or more files</span>
dlgfile group<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">*</span>.<span style="color: #000080;">csv</span> multi<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
<span style="color: #008000;">// The filter file, myFilter.oif needs to be in the same folder as the data</span>
impFile filtername<span style="color: #000000;">:</span><span style="color: #000080;">=</span>myFilter.<span style="color: #000080;">oif</span> location<span style="color: #000000;">:</span><span style="color: #000080;">=</span>data;</pre>
<h2><a name="Internet_Data_Access"></a><span class="mw-headline">Internet Data Access</span></h2>
<p>A new X-Function web2file was added that allows getting text file off the internet.
</p>
<h3><a name="Import_A_Web_ASCII_File_Into_A_Worksheet"></a><span class="mw-headline">Import A Web ASCII File Into A Worksheet</span></h3>
<p>The following example downloads a file from the internet using http and place it in the UFF and then import that into the active sheet.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Copy web file to local file.</span>
string fname<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;%Y_tmp_webdata.txt&quot;</span>;
string url<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;http://hadobs.metoffice.com/hadcrut3/diagnostics/global/nh+sh/annual&quot;</span>;
web2file;
if<span style="color: #000000;">&#40;</span> exist<span style="color: #000000;">&#40;</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">0</span> <span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
  impASC;
  del <span style="color: #000080;">-</span>f <span style="color: #ff00ff;">&quot;%(fname$)&quot;</span>; <span style="color: #008000;">// remove file once done.</span>
<span style="color: #000000;">&#125;</span>
else
  ty <span style="color: #ff00ff;">&quot;Failed to copy web file to local file.&quot;</span>;</pre>
<h3><a name="Import_A_Web_Image_Into_A_New_Matrix"></a><span class="mw-headline">Import A Web Image Into A New Matrix</span></h3>
<p>The following example downloads the OriginLab logo image from the OriginLab website and places it in the UFF and then 
</p><p>imports that image into a new matrix sheet.
</p>
<pre class="lt" style="font-family:monospace;">string fname<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;%Y_tmp_logo.png&quot;</span>;
string url<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;https://www.originlab.com/images/header_logo.png&quot;</span>;
web2file;
if<span style="color: #000000;">&#40;</span> exist<span style="color: #000000;">&#40;</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">0</span> <span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
  win <span style="color: #000080;">-</span>t matrix;
  impImage;
  del <span style="color: #000080;">-</span>f <span style="color: #ff00ff;">&quot;%(fname$)&quot;</span>; <span style="color: #008000;">// remove file once done.</span>
<span style="color: #000000;">&#125;</span>
else
  ty <span style="color: #ff00ff;">&quot;Failed to copy web file to local file.&quot;</span>;</pre>
<h2><a name="Database_Access"></a><span class="mw-headline">Database Access</span></h2>
<h3><a name="Import_from_Included_Sample_Access_Database"></a><span class="mw-headline">Import from Included Sample Access Database</span></h3>
<p>We have included a small Access database in the Samples folder called stars.mdb and the following code shows how to control the database access X-Functions to import into active worksheet. Please read the <a class="external text" href="../../XFunction/X-Function/DbEdit.html">dbEdit</a> X-Function for more information.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Construct the connection string. </span>
<span style="color: #008000;">// Please use the Query Builder dialog to construct your connection string</span>
string strdb<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span>
		<span style="color: #ff00ff;">&quot;Samples\Import and Export\stars.mdb&quot;</span>;

string strConn<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Provider=Microsoft.ACE.OLEDB.12.0;
                Data Source=%(strdb$); User ID=; Password=;&quot;</span>;

<span style="color: #008000;">// The SQL</span>
string strSQL<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;SELECT Stars.Index, Stars.Name, Stars.LightYears, Stars.Magnitude
		FROM Stars
		WHERE Stars.LightYears&lt;=100
		ORDER BY Stars.Magnitude, Stars.LightYears&quot;</span>;

<span style="color: #008000;">// Connect database and submit the SQL</span>
dbEdit change conn<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strConn<span style="color: #000080;">$</span> sql<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strSQL<span style="color: #000080;">$</span>;
<span style="color: #008000;">// Import data</span>
dbImport;
<span style="color: #008000;">// Disconnect the database</span>
dbEdit remove;</pre>
<h2><a name="Instrument_Data_Import"></a><span class="mw-headline">Instrument Data Import</span></h2>
<h3><a name="Importing_and_Plotting_Multiple_SPC_Files"></a><span class="mw-headline">Importing and Plotting Multiple SPC Files</span></h3>
<p>The following example shows how to import multiple SPC files into separate sheets of a new book and plot all datasets 
</p><p>into a new graph. The code also shows how to customize the legends on these graphs.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Use new open dialog X-Function</span>
dlgfile m<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> g<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">*</span>.<span style="color: #000080;">spc</span>;                              <span style="color: #008000;">// Specify multiple files from group of *.SPC</span>
int count <span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">&#40;</span>CRLF<span style="color: #000000;">&#41;</span>;               <span style="color: #008000;">// How many files?</span>
newbook;                                            <span style="color: #008000;">// Create a new book</span>
loop<span style="color: #000000;">&#40;</span>ii,<span style="color: #0000dd;">1</span>,count<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
	string strFile<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetToken</span><span style="color: #000000;">&#40;</span>ii,CRLF<span style="color: #000000;">&#41;</span><span style="color: #000080;">$</span>; <span style="color: #008000;">// Next filename</span>
	impSPC f<span style="color: #000000;">:</span><span style="color: #000080;">=</span>strFile<span style="color: #000080;">$</span>;                         <span style="color: #008000;">// Import</span>
        <span style="color: #000080;">%</span>N <span style="color: #000080;">=</span> <span style="color: #000080;">%</span>H;                                    <span style="color: #008000;">// Remember it's name for later use</span>
	range ss <span style="color: #000080;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000080;">%</span>H<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span><span style="color: #000080;">!</span>;                      <span style="color: #008000;">// The Sheet Range can access sheet properties</span>
	                                            <span style="color: #008000;">// More than one column, assume first is X</span>
	if<span style="color: #000000;">&#40;</span>ss.<span style="color: #000080;">col2</span>.<span style="color: #000080;">nrows</span> <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>
		                                    <span style="color: #008000;">// Plot</span>
		plotxy <span style="color: #000000;">&#91;</span><span style="color: #000080;">%</span>H<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span><span style="color: #000080;">!</span><span style="color: #0000dd;">2</span><span style="color: #000000;">:</span>end p<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span> o<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span><span style="color: #000000;">&#93;</span>;
                                                    <span style="color: #008000;">// If one column, assume it's a Y</span>
	else
		                                    <span style="color: #008000;">// Plot</span>
		plotxy <span style="color: #000000;">&#91;</span><span style="color: #000080;">%</span>H<span style="color: #000000;">&#93;</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span> p<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span> o<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span><span style="color: #000080;">&lt;</span>new<span style="color: #000080;">&gt;</span><span style="color: #000000;">&#93;</span>;
	legendupdate u<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> m<span style="color: #000000;">:</span><span style="color: #000080;">=</span>custom c<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;@WS&quot;</span>;       <span style="color: #008000;">// Update the Legend with new options</span>
	win <span style="color: #000080;">-</span>a <span style="color: #000080;">%</span>N; <span style="color: #008000;">// Make the Workbook active</span>
	if <span style="color: #000000;">&#40;</span>ii<span style="color: #000080;">&lt;</span>count<span style="color: #000000;">&#41;</span> newsheet;                     <span style="color: #008000;">// Add a sheet if more files</span>
<span style="color: #000000;">&#125;</span></pre>
<h2><a name="Specify_Channel_Names_for_Import"></a><span class="mw-headline">Specify Channel Names for Import</span></h2>
<p class="version" >Minimum Origin Version Required: 9.0 SR0</p>
<p>You can use the <a class="external text" href="../../XFunction/X-Function/ImpFileSel.html">impFileSel</a> x-function to get the channel structure as a tree variable before import, and modify the tree variable to specify channel names for import. This function works with the imppClamp, impMDF, impMatlab, impNITDM, impNIDIAdem and impPrism Import X-Functions.
</p><p>The following example shows how to specify channels when importing multiple pClamp data.
</p>
<pre class="lt" style="font-family:monospace;">newbook;
<span style="color: #008000;">// Set fname string variable so function knows which file to examine</span>
fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Import and Export\pClamp\93310C08.DAT&quot;</span>;
<span style="color: #008000;">// Use the x-function to store the file structure in the Labtalk tree variable &quot;tt&quot;</span>
impFileSel xfname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>imppClamp trFiles<span style="color: #000000;">:</span><span style="color: #000080;">=</span>tt;
<span style="color: #008000;">// View the channel names and labels for each channel</span>
<span style="color: #008000;">//@tnd=2;</span>
<span style="color: #008000;">//tt.=;</span>
<span style="color: #008000;">// Change the file structure by excluding the first channel.</span>
<span style="color: #008000;">// &quot;ChannelName1&quot; is the channel name for the first channel.</span>
<span style="color: #008000;">// Changing the value to 0 will block the import of this channel</span>
<span style="color: #008000;">// The default value of 1 allows import</span>
for<span style="color: #000000;">&#40;</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ii<span style="color: #000080;">&lt;=</span><span style="color: #0000dd;">2</span>; ii<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	if <span style="color: #000000;">&#40;</span>ii <span style="color: #000080;">==</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>
	continue;
	tt.<span style="color: #000080;">Channels</span>.<span style="color: #000080;">ChannelName</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>ii<span style="color: #000000;">&#41;</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
<span style="color: #000000;">&#125;</span>
<span style="color: #008000;">// Chosse two files include 93310C08.DAT and 93311C01.DAT</span>
folderpath<span style="color: #000080;">$</span><span style="color: #000080;">=</span>system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Import and Export\pClamp&quot;</span>;
dlgfile group<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;9331*C0*.dat&quot;</span> multi<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> init<span style="color: #000000;">:</span><span style="color: #000080;">=</span>folderpath<span style="color: #000080;">$</span>;
int numFiles <span style="color: #000080;">=</span> fname.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">&#40;</span>LF<span style="color: #000000;">&#41;</span>;
<span style="color: #008000;">// Loop over all files</span>
int nFirst <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
for<span style="color: #000000;">&#40;</span>int ifile <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ifile <span style="color: #000080;">&lt;=</span> numFiles; ifile<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	string filepath<span style="color: #000080;">$</span>, filename<span style="color: #000080;">$</span>;
	<span style="color: #008000;">// Get next file name</span>
	filepath<span style="color: #000080;">$</span><span style="color: #000080;">=</span>fname.<span style="color: #000080;">gettoken</span><span style="color: #000000;">&#40;</span>ifile,LF<span style="color: #000000;">&#41;</span><span style="color: #000080;">$</span>;
	newbook;
	<span style="color: #008000;">// Import with the modified file structure</span>
	imppClamp fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>filepath<span style="color: #000080;">$</span> trFiles<span style="color: #000000;">:</span><span style="color: #000080;">=</span>tt;
<span style="color: #000000;">&#125;</span>;</pre>
<h2><a name="Image_Files"></a><span class="mw-headline">Image Files</span></h2>
<h3><a name="Import_Images"></a><span class="mw-headline">Import Images</span></h3>
<p><a class="external text" href="../../XFunction/X-Function/ImpImage.html">ImpImage</a> can import image format files to Origin.
</p><p>It supports multiple files importing. By default, multiple images will be appended to the target Page by creating new Layers. And each MatrixLayers' will be rename to the file name.
</p><p><b>Example1:</b>
</p><p>This example imports a series of TIF Images to a new Matrixbook.
</p>
<pre class="lt" style="font-family:monospace;">newbook mat<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
string fns, path<span style="color: #000080;">$</span><span style="color: #000080;">=</span>system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span><span style="color: #ff00ff;">&quot;Samples\Image Processing and Analysis\&quot;</span>;
findfiles fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fns<span style="color: #000080;">$</span> ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;myocyte*.tif&quot;</span>; <span style="color: #008000;">// findFiles will default to get from path$</span>
int n <span style="color: #000080;">=</span> fns.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">&#40;</span>CRLF<span style="color: #000000;">&#41;</span>;
impimage options.<span style="color: #000080;">Mode</span><span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">4</span> fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fns<span style="color: #000080;">$</span></pre>
<p><b>Example2:</b>
</p><p>This exmaple imports a folder of JPG images to different Matrixbooks.
</p>
<pre class="lt" style="font-family:monospace;">string fns, path<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;C:\Documents and Settings\All Users\Documents\My Pictures\Sample Pictures\&quot;</span>;
findfiles fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fns<span style="color: #000080;">$</span> ext<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;*.jpg&quot;</span>; <span style="color: #008000;">// findFiles will default to get from path$</span>
int n <span style="color: #000080;">=</span> fns.<span style="color: #000080;">GetNumTokens</span><span style="color: #000000;">&#40;</span>CRLF<span style="color: #000000;">&#41;</span>;
string bkName<span style="color: #000080;">$</span>;
string fname<span style="color: #000080;">$</span>;
for<span style="color: #000000;">&#40;</span>int ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; ii<span style="color: #000080;">&lt;=</span>n; ii<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
    fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> fns.<span style="color: #000080;">GetToken</span><span style="color: #000000;">&#40;</span>ii, CRLF<span style="color: #000000;">&#41;</span><span style="color: #000080;">$</span>;
    <span style="color: #008000;">// Create a new matrix page</span>
    newbook s<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span> mat<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>bkName<span style="color: #000080;">$</span>;
    <span style="color: #008000;">// Import image to the first layer of the matrix page,</span>
    <span style="color: #008000;">// Default file name is fname$ </span>
    impimage orng<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span>bkName<span style="color: #000080;">$</span><span style="color: #000000;">&#93;</span>msheet1;
<span style="color: #000000;">&#125;</span></pre>
<h3><a name="Convert_Imported_Image_into_Data"></a><span class="mw-headline">Convert Imported Image into Data</span></h3>
<p>This example imports a bitmap and conver the image into a byte matrix so you can do further processing:
</p>
<pre class="lt" style="font-family:monospace;">dlgfile g<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000080;">*</span>.<span style="color: #000080;">bmp</span>;      <span style="color: #008000;">// Opens dialog to select a file and put into fname$</span>
newbook m<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;          <span style="color: #008000;">// Create a new matrixbook</span>
impImage;              <span style="color: #008000;">// Import image into active matrixbook using fname$</span>
img2m o<span style="color: #000000;">:</span><span style="color: #000080;">=&lt;</span>input<span style="color: #000080;">&gt;</span> t<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">// Convert image into byte data</span></pre>
<h2><a name="Text_Files"></a><span class="mw-headline">Text Files</span></h2>
<h3><a name="Open_a_Text_File_Into_a_Notes_Window"></a><span class="mw-headline">Open a Text File Into a Notes Window</span></h3>
<dl><dd><font color="navy"><i>open -n fileName [winName]</i></font></dd></dl>
<p>This script will open an ASCII file to a notes window. If the winName is not specified, a new note window will be created.
</p><p><b>Example:</b>
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #000080;">%</span>b <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Import and Export\ASCII simple.dat&quot;</span>;
open <span style="color: #000080;">-</span>n <span style="color: #ff00ff;">&quot;%b&quot;</span>;</pre>
<h2><a name="Import_Video"></a><span class="mw-headline">Import Video</span></h2>
<p class="version" >Minimum Origin Version Required: 9.1 SR2</p>
<p>This example will create a new matrixbook and load frames from a user specified video file into multiple matrix objects in the active sheet.
</p><p>You can easily modify the code for your own file, as well as to specify either to load specific number of frames, or by an increment in time.
</p>
<pre class="lt" style="font-family:monospace;">string vfilename<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;d:\test.avi&quot;</span>;
<span style="color: #008000;">//If set ByCount to 0 then read by increment</span>
<span style="color: #008000;">//1 will read TotalFrames to the end</span>
int ByCount <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; 
int TotalFrames <span style="color: #000080;">=</span> <span style="color: #0000dd;">100</span>;
double StepSize <span style="color: #000080;">=</span> <span style="color: #0000dd;">15</span>; <span style="color: #008000;">// Seconds</span>
 
<span style="color: #008000;">// Create a new matrixbook.</span>
string matbk<span style="color: #000080;">$</span>;
newbook mat<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span> result<span style="color: #000000;">:</span><span style="color: #000080;">=</span>matbk<span style="color: #000080;">$</span>;
int skip;

<span style="color: #008000;">// Open the video file.</span>
int err <span style="color: #000080;">=</span> vr.<span style="color: #000080;">Open</span><span style="color: #000000;">&#40;</span><span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>vfilename<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
if<span style="color: #000000;">&#40;</span> <span style="color: #0000dd;">0</span> <span style="color: #000080;">==</span> err <span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	if<span style="color: #000000;">&#40;</span> ByCount <span style="color: #000000;">&#41;</span> <span style="color: #008000;">// Read TotalFrames frames to the end by skipping.</span>
	<span style="color: #000000;">&#123;</span>
		skip <span style="color: #000080;">=</span> vr.<span style="color: #000080;">FrameCount</span><span style="color: #000080;">/</span>TotalFrames;
                type <span style="color: #ff00ff;">&quot;Read total of $(TotalFrames) frames, 
Skip every $(skip) frames or $(skip/vr.FPS) sec. 
File has $(vr.FrameCount) frames&quot;</span>;
	<span style="color: #000000;">&#125;</span>
	else <span style="color: #008000;">// Read 1 frame then skip  StepSize sec.</span>
	<span style="color: #000000;">&#123;</span>
		skip <span style="color: #000080;">=</span> StepSize <span style="color: #000080;">*</span> vr.<span style="color: #000080;">FPS</span>;
		type <span style="color: #ff00ff;">&quot;Read total of $(TotalFrames) frames, 
Skip every $(skip) frames or $(StepSize) sec. 
File has $(vr.FrameCount) frames&quot;</span>;
	<span style="color: #000000;">&#125;</span>
 
	<span style="color: #008000;">// Read from current pos (beginning) </span>
        <span style="color: #008000;">// to the end of the file (frameCount=0) into matrix.</span>
	vr.<span style="color: #000080;">ReadFrames</span><span style="color: #000000;">&#40;</span><span style="color: #000080;">%</span>h, TotalFrames, skip<span style="color: #000000;">&#41;</span>;
	vr.<span style="color: #000080;">Close</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;<span style="color: #008000;">// Close the video file.</span>
<span style="color: #000000;">&#125;</span>
 
page.<span style="color: #000080;">cntrl</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">// Image view mode.</span>
matrix <span style="color: #000080;">-</span>it <span style="color: #0000dd;">1</span>; <span style="color: #008000;">// Show thumbnails.</span></pre>
<p><br />
</p>
<h2><a name="Reimport"></a><span class="mw-headline">Reimport</span></h2>
<h3><a name="Using_Reimport_to_Bring_back_all_Data"></a><span class="mw-headline">Using Reimport to Bring back all Data</span></h3>
<p>This example brings back all data that was last imported into the active workbook.
To try this, use "Data: Import from File: multiple ASCII" and bring in some data to a workbook.
Be sure to use Show Options and set the Import Mode to 'Start New Sheets'.
Use the Worksheet&#160;: Clear Worksheet menu option on each sheet.
Run the following script:
</p>
<pre class="lt" style="font-family:monospace;">loop <span style="color: #000000;">&#40;</span>i, <span style="color: #0000dd;">1</span>, page.<span style="color: #000080;">nlayers</span><span style="color: #000000;">&#41;</span> 
<span style="color: #000000;">&#123;</span>	<span style="color: #008000;">// loop over all sheets in the book</span>
	page.<span style="color: #000080;">active</span> <span style="color: #000080;">=</span> i; <span style="color: #008000;">// active sheet</span>
	reimport;        <span style="color: #008000;">// reimport to bring back data in active sheet</span>
<span style="color: #000000;">&#125;</span></pre>
<h3><a name="Watching_for_a_File_change_for_reimport"></a><span class="mw-headline">Watching for a File change for reimport</span></h3>
<p>This example imports a file then watches for changes to that file to reimport. The script makes use of a programmable macro named <i><b>timerproc</b></i> which can be set to run at specified intervals.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Bring in some data and plot it</span>
string fname<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> D<span style="color: #000000;">:</span>\Sample.<span style="color: #000080;">dat</span>;
impasc;
range raIn <span style="color: #000080;">=</span> <span style="color: #000080;">!</span>; <span style="color: #008000;">// For reimport</span>
plotxy <span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>,<span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span> <span style="color: #0000dd;">202</span>;
double olddate <span style="color: #000080;">=</span> exist<span style="color: #000000;">&#40;</span><span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span>,<span style="color: #0000dd;">5</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">// Note the file date-time</span>

<span style="color: #008000;">// Now program the macro to reimport if file changes</span>
def timerproc
<span style="color: #000000;">&#123;</span>
    double newdate <span style="color: #000080;">=</span> exist<span style="color: #000000;">&#40;</span><span style="color: #000080;">%</span><span style="color: #000000;">&#40;</span>fname<span style="color: #000080;">$</span><span style="color: #000000;">&#41;</span>,<span style="color: #0000dd;">5</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">// Current file date-time</span>
    if<span style="color: #000000;">&#40;</span>newdate <span style="color: #000080;">!</span><span style="color: #000080;">=</span> olddate<span style="color: #000000;">&#41;</span>
    <span style="color: #000000;">&#123;</span>
        reimport or<span style="color: #000000;">:</span><span style="color: #000080;">=</span>raIn; <span style="color: #008000;">// reimport if the file has changed</span>
        olddate <span style="color: #000080;">=</span> newdate;
        layer <span style="color: #000080;">-</span>a; <span style="color: #008000;">// Update the graph (assumed active)</span>
    <span style="color: #000000;">&#125;</span>
    else ty Nothing new ...; <span style="color: #008000;">// Delete this line if not needed</span>
<span style="color: #000000;">&#125;</span>

<span style="color: #008000;">// And start the timer to watch the file</span>
timer <span style="color: #0000dd;">1800</span>; <span style="color: #008000;">// Run timerproc every 1800 seconds (every 30 minutes)</span></pre>
<p>Should you have to stop the process, execute this command:
</p>
<pre class="lt" style="font-family:monospace;">timer <span style="color: #000080;">-</span>k;</pre>






