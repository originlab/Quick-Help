<h1 class="firstHeading">2.15 Working with Excel</h1><p class='urlname' style='display: none'>Working-with-Excel</p>
<p>Origin can use Excel Workbooks directly within the Origin Workspace. The Excel Workbooks can be stored within the project or linked to an external Excel file (*.xls, *.xlsx). An external Excel Workbook which was opened in Origin can be converted to internal, and an Excel Workbook created within Origin can be saved to an external Excel file.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Open_Excel_Workbook"><span class="tocnumber">1</span> <span class="toctext">Open Excel Workbook</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Internal_Excel_Workbook"><span class="tocnumber">1.1</span> <span class="toctext">Internal Excel Workbook</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#External_Excel_Workbook"><span class="tocnumber">1.2</span> <span class="toctext">External Excel Workbook</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Save_Excel_Workbook"><span class="tocnumber">2</span> <span class="toctext">Save Excel Workbook</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Internal_Excel_Workbook_2"><span class="tocnumber">2.1</span> <span class="toctext">Internal Excel Workbook</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#External_Excel_Workbook_2"><span class="tocnumber">2.2</span> <span class="toctext">External Excel Workbook</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Update_Origin_When_Excel_Workbook_Changes"><span class="tocnumber">3</span> <span class="toctext">Update Origin When Excel Workbook Changes</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Connect_Excel_Workbook"><span class="tocnumber">4</span> <span class="toctext">Connect Excel Workbook</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Run_Excel_Macro"><span class="tocnumber">5</span> <span class="toctext">Run Excel Macro</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#Invoke_Visual_Basic_Function"><span class="tocnumber">6</span> <span class="toctext">Invoke Visual Basic Function</span></a></li>
</ul>
</div>

<h2><a name="Open_Excel_Workbook"></a><span class="mw-headline">Open Excel Workbook</span></h2>
<h3><a name="Internal_Excel_Workbook"></a><span class="mw-headline">Internal Excel Workbook</span></h3>
<p>To create a new Excel Workbook within Origin ..
</p>
<pre class="lt" style="font-family:monospace;">window <span style="color: #000080;">-</span>tx;</pre>
<p>The titlebar will include the text <b>[Internal]</b> to indicate the Excel Workbook will be saved in the Origin Project file.
</p>
<h3><a name="External_Excel_Workbook"></a><span class="mw-headline">External Excel Workbook</span></h3>
<p>To open an external Excel file ..
</p>
<pre class="lt" style="font-family:monospace;">document <span style="color: #000080;">-</span>append D<span style="color: #000000;">:</span>\Test1.<span style="color: #000080;">xls</span>;</pre>
<p>The titlebar will include the file path and name to indicate the Excel file is saved external to the Origin Project file.
</p>
<h2><a name="Save_Excel_Workbook"></a><span class="mw-headline">Save Excel Workbook</span></h2>
<h3><a name="Internal_Excel_Workbook_2"></a><span class="mw-headline">Internal Excel Workbook</span></h3>
<p>Though the internal Excel workbook can be saved automatically with Origin project, you can save this internal Excel Workbook as an external file at which point it becomes a linked external file instead.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// The Excel window must be active. win -o can temporarily make it active</span>
window <span style="color: #000080;">-</span>o Book5 <span style="color: #000000;">&#123;</span>
    <span style="color: #008000;">// You must include the file path and the .xls extension</span>
    save <span style="color: #000080;">-</span>i D<span style="color: #000000;">:</span>\Test2.<span style="color: #000080;">xls</span>;
<span style="color: #000000;">&#125;</span></pre>
<h3><a name="External_Excel_Workbook_2"></a><span class="mw-headline">External Excel Workbook</span></h3>
<p>You can re-save an external Excel Workbook to a new location creating a new file and link leaving the original file on disk ..
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Assume the Excel Workbook is active</span>
<span style="color: #008000;">//&#160;%X holds the path of an opened Origin Project file</span>
save <span style="color: #000080;">-</span>i <span style="color: #000080;">%</span>XNewBook.<span style="color: #000080;">xls</span>;</pre>
<h2><a name="Update_Origin_When_Excel_Workbook_Changes"></a><span class="mw-headline">Update Origin When Excel Workbook Changes</span></h2>
<p>When you type or paste data into an Excel workbook sheet, you can update Origin by <code>set -ui</code>. For example:
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//Select File: New: Excel from Origin menu</span>
<span style="color: #008000;">//Enter 123 in Row1 ColumnA in Excel worksheet</span>
set Book2 <span style="color: #000080;">-</span>ui; <span style="color: #008000;">// Update Origin</span>
col<span style="color: #000000;">&#40;</span>A<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span><span style="color: #000080;">=</span>; <span style="color: #008000;">//Get value in Row1 ColumnA</span></pre>
<table class="noborder"><tr>
	<td style="vertical-align:top" width="60"><img src="../images/LT_Working_with_Excel/Tip_icon.png?v=0" width="57"  border="0" /></td><td><p>In Origin's GUI, you can also update Origin by right clicking on the title bar or Excel workbook and then selecting <a class="external text" href="../../UserGuide/UserGuide/Working_with_Microsoft_Excel.html#Working_with_Excel_Books_inside_Origin"><b>Update Origin...</b></a> in the context menu.
</p></td></tr></table>
<h2><a name="Connect_Excel_Workbook"></a><span class="mw-headline">Connect Excel Workbook</span></h2>
<p>If you want to link Excel files to Origin project, you can use the Microsoft DDE protocol by dde command. For example:
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">// Before running  the following example,  launch Excel workbook manually or use the run -e command.</span>
dde <span style="color: #000080;">-</span>c Excel<span style="color: #000080;">|</span><span style="color: #000000;">&#91;</span>Test1.<span style="color: #000080;">xls</span><span style="color: #000000;">&#93;</span>Sheet1 id; <span style="color: #008000;">//Connect to Excel worksheet [Test1.xls]Sheet1</span>
if<span style="color: #000000;">&#40;</span>id<span style="color: #000080;">&gt;=</span><span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span> <span style="color: #008000;">//Check if the connection is successful</span>
<span style="color: #000000;">&#123;</span>
        <span style="color: #008000;">// Send data in columns A through F and rows 12 through 25 </span>
        <span style="color: #008000;">// of Excel worksheet to Origin worksheet and start from column 1 and row 1.</span>
        dde <span style="color: #000080;">-</span>rc id R2C1<span style="color: #000000;">:</span>R11C2 <span style="color: #000000;">&#91;</span>Book1<span style="color: #000000;">&#93;</span>Sheet1<span style="color: #000080;">!</span>R1C1; 
<span style="color: #000000;">&#125;</span>
dde <span style="color: #000080;">-</span>d id; <span style="color: #008000;">//Disconnect</span></pre>
<p>See also <a href="../../LabTalk/LabTalk/DDE_(command).html" title="LabTalk:DDE (command)">dde</a> command.
</p>
<h2><a name="Run_Excel_Macro"></a><span class="mw-headline">Run Excel Macro</span></h2>
<p>Origin uses an excel object method <code>excel.run</code>to run Excel macros from Origin.
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//SheetName is the name of the Excel worksheet containing the macro</span>
<span style="color: #008000;">//No more than five arguments</span>
excel.<span style="color: #000080;">run</span><span style="color: #000000;">&#40;</span>SheetName.<span style="color: #000080;">MacroName</span>, Arg1, Arg2, Arg3..., Arg5<span style="color: #000000;">&#41;</span>;</pre>
<p>Or
</p>
<pre class="lt" style="font-family:monospace;">excel.<span style="color: #000080;">run</span><span style="color: #000000;">&#40;</span>ModuleName.<span style="color: #000080;">MacroName</span>,Arg1, Arg2, Arg3..., Arg5<span style="color: #000000;">&#41;</span>;</pre>
<p>You may need to select and activate a range for running Excel Macro, try the method <code>excel.runrange</code> of excel object. For example:
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//It will activate Sheet2 of the (active) Excel workbook </span>
<span style="color: #008000;">//and select columns A through F and rows 12 through 25. </span>
excel.<span style="color: #000080;">runRange</span><span style="color: #000000;">&#40;</span>Sheet2,A12<span style="color: #000000;">:</span>F25<span style="color: #000000;">&#41;</span>;</pre>
<p>See also <a href="../../LabTalk/LabTalk/Excel_(object).html" title="LabTalk:Excel (object)">excel object</a>
</p>
<h2><a name="Invoke_Visual_Basic_Function"></a><span class="mw-headline">Invoke Visual Basic Function</span></h2>
<p>In Origin, the excel object also provides script access for invoking Visual Basic application functions. Similar to running excel macro in Origin, you can invoke Visual Basic function by:
</p>
<pre class="lt" style="font-family:monospace;">Excel.<span style="color: #000080;">Run</span><span style="color: #000000;">&#40;</span>FunctionName, Arg1, Arg2,..., Arg5<span style="color: #000000;">&#41;</span></pre>
<p>For example, there is a Visual Basic function as below:
</p>
<pre class="lt" style="font-family:monospace;">Sub Hello<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
   MsgBox <span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Hello, world!&quot;</span><span style="color: #000000;">&#41;</span>
End Sub</pre>
<p>You can invoke this function by:
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000;">//Keep the workbook containing the function above active</span>
excel.<span style="color: #000080;">run</span><span style="color: #000000;">&#40;</span>Hello<span style="color: #000000;">&#41;</span>; <span style="color: #008000;">//A message box will show up</span></pre>
<p>See also <a href="../../LabTalk/LabTalk/Excel_(object).html" title="LabTalk:Excel (object)">excel object</a>
</p>

