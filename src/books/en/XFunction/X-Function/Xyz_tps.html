<h1 class="firstHeading">2.2.1.11 xyz_tps</h1><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Brief_Information"><span class="tocnumber">1</span> <span class="toctext">Brief Information</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Command_Line_Usage"><span class="tocnumber">2</span> <span class="toctext">Command Line Usage</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#X-Function_Execution_Options"><span class="tocnumber">3</span> <span class="toctext">X-Function Execution Options</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Variables"><span class="tocnumber">4</span> <span class="toctext">Variables</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Description"><span class="tocnumber">5</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Examples"><span class="tocnumber">6</span> <span class="toctext">Examples</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Algorithm"><span class="tocnumber">7</span> <span class="toctext">Algorithm</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#References"><span class="tocnumber">8</span> <span class="toctext">References</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Related_X-Functions"><span class="tocnumber">9</span> <span class="toctext">Related X-Functions</span></a></li>
</ul>
</div>

<h2><a name="Brief_Information"></a><span class="mw-headline">Brief Information</span></h2>
<p>Convert XYZ data to matrix using Thin Plate Spline gridding
</p>
<h2><a name="Command_Line_Usage"></a><span class="mw-headline">Command Line Usage</span></h2>
<p><code>
1. xyz_tps iz:=Col(3);
</p><p>2. xyz_tps iz:=Col(3) rows:=20 cols:=20;
</p><p>3. xyz_tps iz:=Col(3) s:=0.8;
</p><p>4. xyz_renka iz:=Col(3) om:=[MBook]MSheet!Mat(1);
</code>
</p>
<h2><a name="X-Function_Execution_Options"></a><span class="mw-headline">X-Function Execution Options</span></h2>
<p><a class="external text" href="../../LabTalk/LabTalk/X-Function_Execution_Options.html">Please refer to the page for additional option switches when accessing the x-function from script</a>
</p>
<h2><a name="Variables"></a><span class="mw-headline">Variables</span></h2>
<table class="xfvar">
<tr>
<th width="8%">Display<br />Name
</th>
<th width="8%">Variable<br />Name
</th>
<th width="8%">I/O<br />and<br />Type
</th>
<th width="8%">Default<br />Value
</th>
<th>Description
</th></tr>
<tr>
<td>Input
</td>
<td>iz
</td>
<td>
<p>Input
</p><p>XYZRange
</p>
</td>
<td> <center></center>
</td>
<td>
<p>Specifies the input XYZ range.
</p>
</td></tr>
<tr>
<td>Rows
</td>
<td>rows
</td>
<td>
<p>Input
</p><p>int
</p>
</td>
<td> <center>35</center>
</td>
<td>
<p>Rows in the output matrix.
</p>
</td></tr>
<tr>
<td>Columns
</td>
<td>cols
</td>
<td>
<p>Input
</p><p>int
</p>
</td>
<td> <center>35</center>
</td>
<td>
<p>Columns in the output matrix.
</p>
</td></tr>
<tr>
<td>Smoothing
</td>
<td>s
</td>
<td>
<p>Input
</p><p>double
</p>
</td>
<td> <center>0.5</center>
</td>
<td>
<p>This is a non-negative value that specifies the extent to which the gridding surface will depart from the input data point. If the factor is zero, there will be no smoothing process and the interpolation surface will pass though all data points. A positive factor will make the surface smoother, but too large a factor will not preserve all the information of the original data.
</p>
</td></tr>
<tr>
<td>Outlier
</td>
<td>outlier
</td>
<td>
<p>Input
</p><p>int
</p>
</td>
<td> <center>extrap</center>
</td>
<td>
<p>If the input data are irregular and do not completely fill a matrix by interpolation, this is a place to specify values for outlying points (see below)
<br />
Option list:
</p>
<ul><li><i>extrap:Extrapolate</i>
<dl><dd>Fills outliers with extrapolated-points based on the TPS algorithm (this is the default selection)</dd></dl></li>
<li><i>missing:Missing Values</i>
<dl><dd>Fills outliers with missing values</dd></dl></li>
<li><i>zero:Zero</i>
<dl><dd>Fills outliers with zeros</dd></dl></li>
<li><i>min:Mimimum</i>
<dl><dd>Fills outliers with the minimum value of the Z range</dd></dl></li>
<li><i>max:Maximum</i>
<dl><dd>Fills outliers with the maximum value of the Z range</dd></dl></li>
<li><i>mean:Mean</i>
<dl><dd>Fills outliers with the mean value of the Z range</dd></dl></li>
<li><i>custom:Custom Value</i>
<dl><dd>Fills outliers with a custom value.</dd></dl></li></ul>
</td></tr>
<tr>
<td>Outside
</td>
<td>outside_val
</td>
<td>
<p>Input
</p><p>double
</p>
</td>
<td> <center>100</center>
</td>
<td>
<p>Specifies a custom value with which to fill the outliers of the results matrix. The user may specify a custom value only when the "Custom Value" option in the outlier field is selected.
</p>
</td></tr>
<tr>
<td>Tolerance
</td>
<td>tolerance
</td>
<td>
<p>Input
</p><p>double
</p>
</td>
<td> <center>5E-3</center>
</td>
<td>
<p>Specifies the tolerance when determining whether or not the perimeter of input data is rectangular. This variable is not available when the "Extrapolate" option in outlier field is selected.
</p>
</td></tr>
<tr>
<td>Output Matrix
</td>
<td>om
</td>
<td>
<p>Output
</p><p>MatrixObject
</p>
</td>
<td> <center>&lt;new&gt;</center>
</td>
<td>
<p>This is a place to configure the destination and format of output results, including name of the matrix worksheet.
See the syntax <a class="external text" href="../../XFunction/X-Function/Output_Notations.html">here</a>.
</p>
</td></tr>
<tr>
<td>Regularization
</td>
<td>r
</td>
<td>
<p>Output
</p><p>double
</p>
</td>
<td> <center>&lt;unassigned&gt;</center>
</td>
<td>
<p>The regularization parameter, which functions as the "weight" of bending energy. This parameter is proportional to the smoothing factor and takes effect only when smoothing factor is not zero. This is a parameter that is calculated based on the inputted smoothing factor.
</p><p><br />
</p>
</td></tr></table>
<h2><a name="Description"></a><span class="mw-headline">Description</span></h2>
<p>This function provides a method for random matrix conversion based on Thin Plate spline (TPS) algorithm, which can also be found in the XYZ Gridding dialog box.
</p><p>TPS is a physical interpolation method. To generate gridding data, this method assumes that all the data points are distributed on a thin, elastic plate, or spline. The plate is constrained not to move at the grid points. The spline forms a 2-dimensional surface by spanning the grid points. The surface is deformed between the points to form a likely fit to the data. The best results are generally found by minimizing the so-called "bending energy function" of the spline.
</p><p>The TPS method is suitable for 2D interpolation of locally flat surface.
</p>
<h2><a name="Examples"></a><span class="mw-headline">Examples</span></h2>
<ul><li> To run from the Command window</li></ul>
<ol><li>  Import the file \<i>Samples</i>\<i>Matrix Conversion and Gridding</i>\ <i>XYZ Random Gaussian.dat</i>.</li>
<li>  Type the command, <code>xyz_tps iz:=Col(3) rows:=50 cols:=50 </code> and press Enter:</li></ol>
<p>The matrix is graphed in a new window by image mode:
</p>
<dl><dd><a  class="image"><img alt="Xyz tps help English files image002.jpg" src="../images/Xyz_tps/Xyz_tps_help_English_files_image002.jpg?v=615" width="279"  /></a></dd></dl>
<ul><li> Code Sample</li></ul>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000; font-style: regular;">/*
This example shows how convert random worksheet data into matrix by TPS gridding method.
The sample data is exe_path\Samples\Matrix Conversion and Gridding\XYZ Random Gaussian.dat
1. Load data to a new created workbook.
2. Random xyz gridding by TPS method.
3. Plot a mesh graph.
*/</span>
<span style="color: #008000;">// Get sample data</span>
fn<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Matrix Conversion and Gridding\XYZ Random Gaussian.dat&quot;</span>;
newbook;
impASC fn<span style="color: #000080;">$</span>;
<span style="color: #008000;">// Set the third column as Z column</span>
wks.<span style="color: #000080;">col3</span>.<span style="color: #000080;">type</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">6</span>;

<span style="color: #008000;">// Convert worksheet data into matrix by TPS gridding method</span>
xyz_tps <span style="color: #0000dd;">3</span> s<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;

<span style="color: #008000;">// Plot </span>
worksheet <span style="color: #000080;">-</span>p <span style="color: #0000dd;">242</span> mesh;</pre>
<h2><a name="Algorithm"></a><span class="mw-headline">Algorithm</span></h2>
<p>The Thin Plate spline (TPS) algorithm is an interpolation scheme for scatter-data. The TPS process is analogous to fixing a thin, elastic "spline"(or surface) at the grid points, and lifting the surface through all the data points. The TPS algorithm builds a function that both captures all the data points and minimizes the so-called "bending energy function."
</p><p>The bending energy function is defined as:
</p><p><a  class="image"><img alt="Xyz tps help English files image004.gif" src="../images/Xyz_tps/Xyz_tps_help_English_files_image004.gif?v=616" width="197"  /></a>.
</p><p>And the minimizing function is of the form
</p><p><a  class="image"><img alt="Xyz tps help English files image006.gif" src="../images/Xyz_tps/Xyz_tps_help_English_files_image006.gif?v=617" width="329"  /></a>,
</p><p>where <a  class="image"><img alt="Xyz tps help English files image008.gif" src="../images/Xyz_tps/Xyz_tps_help_English_files_image008.gif?v=618" width="113"  /></a>, and <a  class="image"><img alt="Xyz tps help English files image010.gif" src="../images/Xyz_tps/Xyz_tps_help_English_files_image010.gif?v=619" width="24"  /></a> indicates the magnitude of a vector.
</p><p>The regularization parameter functions as the "weight" of the bending energy. A regularization parameter close to zero matches all data points closely, but creates a rough surface for noisy data. A larger regularization parameter smoothes data much more, but fits individual data points less strictly. Therefore, the regularization parameter indicates the strictness of interpolation requirements. This parameter is calculated based on the inputted Smoothing factor.
</p><p>If we denote XYZ data points by <img src="../images/Xyz_tps/math-d55665493aed4845a1e8a39fe34cdb67.png?v=0" title="x_i, y_i, z_i, i = 1, 2, ... N" alt="x_i, y_i, z_i, i = 1, 2, ... N" class="tex"/>, then
</p><p><a  class="image"><img alt="Xyz tps help English files image012.gif" src="../images/Xyz_tps/Xyz_tps_help_English_files_image012.gif?v=620" width="349"  /></a>
</p><p>To find the minimum bending energy, more arithmetic transformations are required. Users who are interested in the algorithm details are encouraged to read the references for more information.
</p>
<h2><a name="References"></a><span class="mw-headline">References</span></h2>
<p>[1].  Bookstein, F. L. "Principal Warps: Thin Plate Splines and the Decomposition of Deformations." <i>IEEE Trans. Pattern Anal. Mach. Intell</i>. 11, 567-585 (1989)
</p><p>[2].  Craven, P. and Wahba, G. <i>"Smoothing Noisy Data with spline Functions"</i>. Numer. Math 31, 377-403 (1979).
</p><p>[3].  Donato, Gianluca and Serge Belongie, <i>"Approximation Methods for Thin Plate spline Mappings and Principal Warps"</i> 2002.
</p>
<h2><a name="Related_X-Functions"></a><span class="mw-headline">Related X-Functions</span></h2>
<p><a href="../../XFunction/X-Function/Xyz_regular.html" title="X-Function:Xyz regular">xyz_regular</a>, <a href="../../XFunction/X-Function/Xyz_renka.html" title="X-Function:Xyz renka">xyz_renka</a>, <a href="../../XFunction/X-Function/Xyz_renka_nag.html" title="X-Function:Xyz renka nag">xyz_renka_nag</a>, <a href="../../XFunction/X-Function/Xyz_shep.html" title="X-Function:Xyz shep">xyz_shep</a>, <a href="../../XFunction/X-Function/Xyz_shep_nag.html" title="X-Function:Xyz shep nag">xyz_shep_nag</a>, <a href="../../XFunction/X-Function/Xyz_sparse.html" title="X-Function:Xyz sparse">xyz_sparse</a>
</p>
<hr class='keywordshr'><p><span class='keywords'>Keywords:</span><span class='keywordsInput'>worksheet, TPS</span></p>






