<h1 class="firstHeading">2.11.14 fft_filters</h1><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Menu_Information"><span class="tocnumber">1</span> <span class="toctext">Menu Information</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Brief_Information"><span class="tocnumber">2</span> <span class="toctext">Brief Information</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Command_Line_Usage"><span class="tocnumber">3</span> <span class="toctext">Command Line Usage</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#X-Function_Execution_Options"><span class="tocnumber">4</span> <span class="toctext">X-Function Execution Options</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Variables"><span class="tocnumber">5</span> <span class="toctext">Variables</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Description"><span class="tocnumber">6</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Examples"><span class="tocnumber">7</span> <span class="toctext">Examples</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Algorithm"><span class="tocnumber">8</span> <span class="toctext">Algorithm</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Related_X-Functions"><span class="tocnumber">9</span> <span class="toctext">Related X-Functions</span></a></li>
</ul>
</div>

<h2><a name="Menu_Information"></a><span class="mw-headline">Menu Information</span></h2>
<p>Analysis: Signal Processing: FFT Filters
</p>
<h2><a name="Brief_Information"></a><span class="mw-headline">Brief Information</span></h2>
<p>Perform FFT Filtering
</p>
<h2><a name="Command_Line_Usage"></a><span class="mw-headline">Command Line Usage</span></h2>
<p><code>
1. fft_filters Col(2) cutoff:=5; 
</p><p>2. fft_filters Col(2) filter:=bandpass Freq1:=3 Freq2:=3.6; 
</p><p>3. fft_filters Col(2) filter:=threshold threshold:=1; 
</p><p>4. fft_filters Col(2) filter:=bandblock Freq1:=1.1 Freq2:=1.3 oy:= (Col(3), Col(4));
</code>
</p>
<h2><a name="X-Function_Execution_Options"></a><span class="mw-headline">X-Function Execution Options</span></h2>
<p><a class="external text" href="../../LabTalk/LabTalk/X-Function_Execution_Options.html">Please refer to the page for additional option switches when accessing the x-function from script</a>
</p>
<h2><a name="Variables"></a><span class="mw-headline">Variables</span></h2>
<table class="xfvar">
<tr>
<th width="8%">Display<br />Name
</th>
<th width="8%">Variable<br />Name
</th>
<th width="8%">I/O<br />and<br />Type
</th>
<th width="8%">Default<br />Value
</th>
<th>Description
</th></tr>
<tr>
<td>Input
</td>
<td>iy
</td>
<td>
<p>Input
</p><p>XYRange
</p>
</td>
<td> <center>&lt;active&gt;</center>
</td>
<td>
<p>Specifies the input range
</p>
</td></tr>
<tr>
<td>Filter Type
</td>
<td>filter
</td>
<td>
<p>Input
</p><p>int
</p>
</td>
<td> <center>Low Pass</center>
</td>
<td>
<p>Specifies the type of the filter
</p><p>Option list
</p>
<ul><li><i>low:Low Pass</i>
<dl><dd>Allows only low frequency components to pass</dd></dl></li>
<li><i>high:High Pass</i>
<dl><dd>Allows only high frequency components to pass</dd></dl></li>
<li><i>bandpass:Band Pass</i>
<dl><dd>Allow only frequency components within a specified range to pass</dd></dl></li>
<li><i>bandblock:Band Block</i>
<dl><dd>Allow only frequency components outside a specified range to pass</dd></dl></li>
<li><i>threshold:Threshold</i>
<dl><dd>Allow only frequency components whose amplitudes are larger than the threshold to pass</dd></dl></li>
<li><i>lowpp :</i>
<dl><dd>This is a parabolic low-pass filter.</dd></dl></li></ul>
</td></tr>
<tr>
<td>Lower Cutoff Frequency
</td>
<td>freq1
</td>
<td>
<p>Input
</p><p>double
</p>
</td>
<td> <center>0</center>
</td>
<td>
<p>This option is available only when the filter type is band pass or band block. It specifies the lower cutoff frequency.
</p>
</td></tr>
<tr>
<td>Upper Cutoff Frequency
</td>
<td>freq2
</td>
<td>
<p>Input
</p><p>double
</p>
</td>
<td> <center>-1</center>
</td>
<td>
<p>This option is available only when the filter type is band pass or band block. It specifies the upper cutoff frequency. 
</p>
</td></tr>
<tr>
<td>Cutoff Frequency
</td>
<td>cutoff
</td>
<td>
<p>Input
</p><p>double
</p>
</td>
<td> <center>0</center>
</td>
<td>
<p>This option is available only when the filter type is low pass or high pass. It specifies the cutoff frequency. If no cutoff frequency is specified ("Auto"), an arbitrary cutoff of 25% and 75% of the frequency range of raw data, is used.
</p>
</td></tr>
<tr>
<td>Pass Frequency
</td>
<td>pass
</td>
<td>
<p>Input
</p><p>double
</p>
</td>
<td> <center>-1</center>
</td>
<td>
<p>This option is available only when the filter type is Low Pass Parabolic. All frequencies below this value will be kept unchanged after being filtered.
</p>
</td></tr>
<tr>
<td>Stop Frequency
</td>
<td>stop
</td>
<td>
<p>Input
</p><p>double
</p>
</td>
<td> <center>-1</center>
</td>
<td>
<p>This option is available only when the filter type is Low Pass Parabolic. All frequencies above this value will be removed completely.
</p>
</td></tr>
<tr>
<td>Threshold
</td>
<td>threshold
</td>
<td>
<p>Input
</p><p>double
</p>
</td>
<td> <center>-1</center>
</td>
<td>
<p>This option is available only when the filter type is threshold. It specifies the amplitude threshold.
</p>
</td></tr>
<tr>
<td>Keep DC Offset
</td>
<td>offset
</td>
<td>
<p>Input
</p><p>int
</p>
</td>
<td> <center>1</center>
</td>
<td>
<p>This option is available only when the filter type is high pass, band pass or band block. If this option is checked, the DC offset will remain unchanged during the filtering.
</p>
</td></tr>
<tr>
<td>Output
</td>
<td>oy
</td>
<td>
<p>Output
</p><p>XYRange
</p>
</td>
<td> <center>&lt;new&gt;</center>
</td>
<td>
<p>Specifies the output
</p><p>See the syntax <a class="external text" href="../../XFunction/X-Function/Output_Notations.html">here</a>.
</p>
</td></tr></table>
<h2><a name="Description"></a><span class="mw-headline">Description</span></h2>
<p>Filtering is a process of selecting frequency components from a signal. A FFT filter performs filtering by using Fourier transforms to analyze the frequency components in the input signal.
</p><p>There are six types of filters available in this function: low-pass, high-pass, band-pass, band-block, low-pass parabolic and threshold. The first four types are actually ideal filters. The low-pass filters block all frequency components above the cutoff frequency, allowing only the low frequency components to pass. High-pass filters are just the opposite: they block frequency components that are below the cutoff frequency. Band-pass filters only allow frequencies within a specific range determined by the lower and upper cutoff frequencies to pass the filters, while band-block filters remove all frequencies within the chosen range. The low-pass parabolic filter is different from the ideal low-pass filter in that its window function does not jump abruptly at the cut-off frequency. Between the pass frequency and the stop frequency, the window function used to select the frequencies looks like a parabolic curve. On the other hand, you can choose to use the threshold filter, which removes frequencies whose amplitudes are below a specific threshold value.
</p><p>The dialog of this function allows you to see the real-time preview of the filtered signal when you change the variables. The cutoff frequencies, pass frequency, stop frequency or the threshold can be selected by dragging the lines on the preview pane.
</p>
<h2><a name="Examples"></a><span class="mw-headline">Examples</span></h2>
<ul><li>  To perform low pass filtering using cutoff frequency as 3, to XY data in columns 2 of the active worksheet, use the script command:</li></ul>
<dl><dd><code>fft_filters iy:=col(2) cutoff:=3</code></dd></dl>
<ul><li>  To perform fft_filtering to data using a pre-saved theme file, save your preferences in the fft_filter dialog, and then execute it by typing the script command as follows, using your own saved-theme title:</li></ul>
<dl><dd><code>fft_filters -t "my fft filter theme.oth"</code></dd></dl>
<ul><li> Code Sample</li></ul>
<pre class="lt" style="font-family:monospace;"><span style="color: #008000; font-style: regular;">/*
This script remove the high frequency part of a section of sound. 
The sample data is located in exe_path\Samples\Signal Processing\.
1. Import a wav file to a new book.
2. Perform low-pass filters on the data to remove the high frequency part of the sound.
3. Export the data to a new wav file.
*/</span>
<span style="color: #008000;">// Import the wav file</span>
fnin<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Signal Processing\sample.wav&quot;</span>;
fnout<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> system.<span style="color: #000080;">path</span>.<span style="color: #000080;">program</span><span style="color: #000080;">$</span> <span style="color: #000080;">+</span> <span style="color: #ff00ff;">&quot;Samples\Signal Processing\Low-pass sample.wav&quot;</span>;
newbook s<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
newsheet col<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
impWav fnin<span style="color: #000080;">$</span>;
string bkn<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span>H;

<span style="color: #008000;">// Remove the high frequency part</span>
fft_filters <span style="color: #000000;">&#91;</span>bkn<span style="color: #000080;">$</span><span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span>col<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span> cutoff<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2000</span> oy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#40;</span><span style="color: #000080;">&lt;</span>input<span style="color: #000080;">&gt;</span>,<span style="color: #000080;">&lt;</span>new name<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Low Frequency of the Sound&quot;</span><span style="color: #000080;">&gt;</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Set the new wav column's format to be short(2) type for later export</span>
wks.<span style="color: #000080;">col2</span>.<span style="color: #000080;">format</span><span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>;
wks.<span style="color: #000080;">col2</span>.<span style="color: #000080;">numerictype</span><span style="color: #000080;">=</span><span style="color: #0000dd;">3</span>;
<span style="color: #008000;">// Export to a new wav file;</span>
expWav iw<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#91;</span>bkn<span style="color: #000080;">$</span><span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span> left<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">2</span> fname<span style="color: #000000;">:</span><span style="color: #000080;">=</span>fnout<span style="color: #000080;">$</span>;</pre>
<h2><a name="Algorithm"></a><span class="mw-headline">Algorithm</span></h2>
<p>The Fourier transform of the input signal is first computed. Then for low pass, high pass, band pass, band block and low pass parabolic filters, a window (determined by the filter type) is used to multiply the Fourier transform. If 1 is chosen for the variable <i>Keep DC Offset,</i> the first point of the window will be set as 1. For threshold filter, the power of every frequency component is examined. If it is not larger than the threshold, the corresponding frequency component will be discarded. After the altering of the frequencies, a backward or inverse Fourier transform is applied to gain the filtered signal.
</p><p><b>Window for low pass filter:</b>
</p>
<dl><dd><a  class="image"><img alt="Fft filters help English files image004.gif" src="../images/Fft_filters/Fft_filters_help_English_files_image004.gif?v=876" width="357"  /></a></dd></dl>
<p>Let <img src="../images/Fft_filters/math-6c0fbf33754e8e6f73e0b1e5c4897d65.png?v=0" title="f_c" alt="f_c" class="tex"/> be the cut-off frequency. The window function can be expressed by:
</p><p><img src="../images/Fft_filters/math-d88a4f86f56eff94c8292a5be83f19f9.png?v=0" title="w(f) = &#10;\begin{cases} &#10;  1, &amp; \mbox{if }f  \le f_{c} \\&#10;  0, &amp; \mbox{if }f  &gt; f_{c}&#10;\end{cases}" alt="w(f) = &#10;\begin{cases} &#10;  1, &amp; \mbox{if }f  \le f_{c} \\&#10;  0, &amp; \mbox{if }f  &gt; f_{c}&#10;\end{cases}" class="tex"/>
</p><p><b>Window for high pass filter:</b>
</p>
<dl><dd><a  class="image"><img alt="Fft filters help English files image006.gif" src="../images/Fft_filters/Fft_filters_help_English_files_image006.gif?v=877" width="357"  /></a></dd></dl>
<p>Let <img src="../images/Fft_filters/math-6c0fbf33754e8e6f73e0b1e5c4897d65.png?v=0" title="f_c" alt="f_c" class="tex"/> be the cut-off frequency. The window function can be expressed by:
</p><p><img src="../images/Fft_filters/math-9d226188ed4e5418f145e0f5773fd5c4.png?v=0" title="w(f) = &#10;\begin{cases} &#10;  0, &amp; \mbox{if }f  \le f_{c} \\&#10;  1, &amp; \mbox{if }f  &gt; f_{c}&#10;\end{cases}" alt="w(f) = &#10;\begin{cases} &#10;  0, &amp; \mbox{if }f  \le f_{c} \\&#10;  1, &amp; \mbox{if }f  &gt; f_{c}&#10;\end{cases}" class="tex"/>
</p><p><b>Window for band pass filter:</b>
</p>
<dl><dd><a  class="image"><img alt="Fft filters help English files image008.gif" src="../images/Fft_filters/Fft_filters_help_English_files_image008.gif?v=878" width="380"  /></a></dd></dl>
<p>Let <img src="../images/Fft_filters/math-58a56dc7d0dd273906d1e95071f345c6.png?v=0" title="f_{c1}" alt="f_{c1}" class="tex"/> be the lower cutoff frequency and <img src="../images/Fft_filters/math-e5a6df4280ea7f67d5fc3589598d96dc.png?v=0" title="f_{c2}" alt="f_{c2}" class="tex"/> be the upper cutoff frequency. The window function can be expressed by:
<img src="../images/Fft_filters/math-b62adef8bc8c22943a346ecb2c60369d.png?v=0" title="w(f) = &#10;\begin{cases} &#10;  1, &amp; \mbox{if } f_{c1} &lt; f &lt; f_{c2} \\&#10;  0, &amp; \mbox{otherwise }&#10;\end{cases}" alt="w(f) = &#10;\begin{cases} &#10;  1, &amp; \mbox{if } f_{c1} &lt; f &lt; f_{c2} \\&#10;  0, &amp; \mbox{otherwise }&#10;\end{cases}" class="tex"/>
</p><p><b>Window for band block filter</b>
</p>
<dl><dd><a  class="image"><img alt="Fft filters help English files image010.gif" src="../images/Fft_filters/Fft_filters_help_English_files_image010.gif?v=879" width="380"  /></a></dd></dl>
<p>Let <img src="../images/Fft_filters/math-58a56dc7d0dd273906d1e95071f345c6.png?v=0" title="f_{c1}" alt="f_{c1}" class="tex"/> be the lower cutoff frequency and <img src="../images/Fft_filters/math-e5a6df4280ea7f67d5fc3589598d96dc.png?v=0" title="f_{c2}" alt="f_{c2}" class="tex"/> be the upper cutoff frequency. The window function can be expressed by:
<img src="../images/Fft_filters/math-0907ab31730983ea691feb9ec4d95227.png?v=0" title="w(f) = &#10;\begin{cases} &#10;  0, &amp; \mbox{if } f_{c1} &lt; f &lt; f_{c2} \\&#10;  1, &amp; \mbox{otherwise }&#10;\end{cases}" alt="w(f) = &#10;\begin{cases} &#10;  0, &amp; \mbox{if } f_{c1} &lt; f &lt; f_{c2} \\&#10;  1, &amp; \mbox{otherwise }&#10;\end{cases}" class="tex"/>
</p><p><b>Window for low-pass parabolic filter</b>
</p>
<dl><dd><a  class="image"><img alt="Low pass parabolic filter.PNG" src="../images/Fft_filters/Low_pass_parabolic_filter.PNG?v=5202" width="305"  /></a></dd></dl>
<p>Let <img src="../images/Fft_filters/math-58a56dc7d0dd273906d1e95071f345c6.png?v=0" title="f_{c1}" alt="f_{c1}" class="tex"/> be the pass frequency and <img src="../images/Fft_filters/math-e5a6df4280ea7f67d5fc3589598d96dc.png?v=0" title="f_{c2}" alt="f_{c2}" class="tex"/> be the stop frequency. The window function can be expressed by:
<img src="../images/Fft_filters/math-5ac2efa0521869609a2a6ffaf34eb551.png?v=0" title="w(f) = &#10;\begin{cases} &#10;  1, &amp; \mbox{if }f \le f_{c1} \\&#10;  1-\frac{(f-f_{c1})^2}{(f_{c2}-f_{c1})^2}, &amp; \mbox{if } f_{c1} &lt; f &lt; f_{c2} \\&#10;  0, &amp; \mbox{if }f \ge f_{c2}&#10;\end{cases}" alt="w(f) = &#10;\begin{cases} &#10;  1, &amp; \mbox{if }f \le f_{c1} \\&#10;  1-\frac{(f-f_{c1})^2}{(f_{c2}-f_{c1})^2}, &amp; \mbox{if } f_{c1} &lt; f &lt; f_{c2} \\&#10;  0, &amp; \mbox{if }f \ge f_{c2}&#10;\end{cases}" class="tex"/>
</p>
<h2><a name="Related_X-Functions"></a><span class="mw-headline">Related X-Functions</span></h2>
<p><a href="../../XFunction/X-Function/Fft1.html" title="X-Function:Fft1">fft1</a>, <a href="../../XFunction/X-Function/Ifft1.html" title="X-Function:Ifft1">ifft1</a>
</p>
<hr class='keywordshr'><p><span class='keywords'>Keywords:</span><span class='keywordsInput'>fourier, fft, window, band, block, threshold</span></p>






