<h1 class="firstHeading">3.1 Construct Controls on X-Function GUI</h1><p><span class="OIndex" style="display:none">X-Function, Construct Controls on Dialog</span>
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Summary"><span class="tocnumber">1</span> <span class="toctext">Summary</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#You_will_learn"><span class="tocnumber">2</span> <span class="toctext">You will learn</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Steps"><span class="tocnumber">3</span> <span class="toctext">Steps</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Run_the_X-Function"><span class="tocnumber">4</span> <span class="toctext">Run the X-Function</span></a></li>
</ul>
</div>

<h2><a name="Summary"></a><span class="mw-headline">Summary</span></h2>
<p>This example demonstrates how to construct controls in an X-Function GetN dialog by TreeNode variable. This mechanism is used to avoid adding controls by multiple variables.
This is an example X-Function dialog:
</p><p><a  class="image"><img alt="OCguide xf example make tree.png" src="../images/Construct_Controls_on_X-Function_GUI/OCguide_xf_example_make_tree.png?v=77126" width="264"  /></a>
</p>
<h2><a name="You_will_learn"></a><span class="mw-headline">You will learn</span></h2>
<ol><li> How to create different controls by make_tree.</li>
<li> How to update a GUI on a specified control event.</li>
<li> How to check and ask for valid input.</li></ol>
<h2><a name="Steps"></a><span class="mw-headline">Steps</span></h2>
<ol start="1">
<li>
Select <b>Tools: X-Function Builder</b> to open the X-Function Builder dialog, select <b>File: New X-Function Wizard</b> to create an X-Function with only one Input Variable named <b>GUI</b> of TreeNode type, and save it as gui_controls.oxf.
</li>
<li>Open the X-Function in Code Builder, and add the following code into the <i>gui_controls_make_tree</i> function.
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span> <span style="color: #000000;">strcmp</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;GUI&quot;</span>, lpcszVarName<span style="color: #000000;">&#41;</span> <span style="color: #000080;">==</span> <span style="color: #0000dd;">0</span> <span style="color: #000000;">&#41;</span> <span style="color: #008000;">// check variable by name</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #008000;">// ID should be unique</span>
	<span style="color: #0000ff;">int</span> nBranchID <span style="color: #000080;">=</span> 0x0001;
	<span style="color: #0000ff;">int</span> nUserID <span style="color: #000080;">=</span> GET_USER_DATAID<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">//NodeID to enable Theme support</span>
	
	GETN_USE<span style="color: #000000;">&#40;</span>tr<span style="color: #000000;">&#41;</span>	<span style="color: #008000;">//use this node as current node</span>
	
	<span style="color: #008000;">//begin of sub branch</span>
	GETN_BEGIN_BRANCH<span style="color: #000000;">&#40;</span>UserInfo, <span style="color: #ff00ff;">&quot;User Information&quot;</span><span style="color: #000000;">&#41;</span>	GETN_ID<span style="color: #000000;">&#40;</span>nBranchID<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>
		<span style="color: #008000;">// string edit box</span>
		GETN_STR<span style="color: #000000;">&#40;</span>UserName, <span style="color: #ff00ff;">&quot;Name&quot;</span>, <span style="color: #ff00ff;">&quot;Unknown&quot;</span><span style="color: #000000;">&#41;</span> GETN_ID<span style="color: #000000;">&#40;</span>nUserID<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>
		
		<span style="color: #008000;">// pass word edit box</span>
		GETN_PASSWORD<span style="color: #000000;">&#40;</span>Password, <span style="color: #ff00ff;">&quot;Password&quot;</span>, <span style="color: #ff00ff;">&quot;&quot;</span><span style="color: #000000;">&#41;</span> GETN_ID<span style="color: #000000;">&#40;</span>nUserID<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>
	GETN_END_BRANCH<span style="color: #000000;">&#40;</span>UserInfo<span style="color: #000000;">&#41;</span> <span style="color: #008000;">//end of sub branch</span>
	
	<span style="color: #008000;">//begin of sub branch</span>
	GETN_BEGIN_BRANCH<span style="color: #000000;">&#40;</span>Detail, <span style="color: #ff00ff;">&quot;Details&quot;</span><span style="color: #000000;">&#41;</span> GETN_ID<span style="color: #000000;">&#40;</span>nBranchID<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>	
		<span style="color: #008000;">// editable drop-down list</span>
		GETN_STRLIST<span style="color: #000000;">&#40;</span>Language, <span style="color: #ff00ff;">&quot;Language&quot;</span>, <span style="color: #ff00ff;">&quot;English&quot;</span>, <span style="color: #ff00ff;">&quot;|English|German&quot;</span><span style="color: #000000;">&#41;</span> 
		GETN_ID<span style="color: #000000;">&#40;</span>nUserID<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>
		
		<span style="color: #008000;">// radio buttons</span>
		GETN_BEGIN_BRANCH<span style="color: #000000;">&#40;</span>lGender, <span style="color: #ff00ff;">&quot;Gender&quot;</span><span style="color: #000000;">&#41;</span> GETN_ID<span style="color: #000000;">&#40;</span>nBranchID<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>
			GETN_RADIO_INDEX<span style="color: #000000;">&#40;</span>Gender, <span style="color: #0000dd;">0</span>, <span style="color: #ff00ff;">&quot;Male|Female&quot;</span><span style="color: #000000;">&#41;</span> GETN_ID<span style="color: #000000;">&#40;</span>nUserID<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>				
			<span style="color: #008000;">// the format of radio buttons	</span>
			GETN_OPTION_DISPLAY_FORMAT<span style="color: #000000;">&#40;</span>DISPLAY_EDITOR_LEFT<span style="color: #000000;">&#41;</span> 			
		GETN_END_BRANCH<span style="color: #000000;">&#40;</span>lGender<span style="color: #000000;">&#41;</span>
		
		<span style="color: #008000;">//numeric edit box, age must be Integer, so use format &quot;%d&quot;</span>
		GETN_NUM<span style="color: #000000;">&#40;</span>Age, <span style="color: #ff00ff;">&quot;Age&quot;</span>, <span style="color: #0000dd;">18</span><span style="color: #000000;">&#41;</span> GETN_OPTION_NUM_FORMAT<span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;%d&quot;</span><span style="color: #000000;">&#41;</span>
		GETN_ID<span style="color: #000000;">&#40;</span>nUserID<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>
		
		<span style="color: #008000;">//check box with event handling function</span>
		GETN_CHECK<span style="color: #000000;">&#40;</span>iEmail, <span style="color: #ff00ff;">&quot;Have Email&quot;</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>	GETN_ID<span style="color: #000000;">&#40;</span>nUserID<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span><span style="color: #008000;">//check box</span>
			GETN_OPTION_EVENT<span style="color: #000000;">&#40;</span>_show_email<span style="color: #000000;">&#41;</span> <span style="color: #008000;">//event of iEmail checkbox</span>
		
		<span style="color: #008000;">// string edit box</span>
		GETN_STR<span style="color: #000000;">&#40;</span>Email, <span style="color: #ff00ff;">&quot;Email&quot;</span>, <span style="color: #ff00ff;">&quot;&quot;</span><span style="color: #000000;">&#41;</span> GETN_ID<span style="color: #000000;">&#40;</span>nUserID<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>		
	GETN_END_BRANCH<span style="color: #000000;">&#40;</span>Detail<span style="color: #000000;">&#41;</span> <span style="color: #008000;">//end of sub branch</span>
<span style="color: #000000;">&#125;</span></pre>
</li>
<li>
Add the following event handling functions after the line <i>//put your own support static functions here</i>.
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">bool</span> _show_email<span style="color: #000000;">&#40;</span>TreeNode<span style="color: #000040;">&amp;</span> tr, <span style="color: #0000ff;">int</span> nRow, <span style="color: #0000ff;">int</span> nType, Dialog<span style="color: #000040;">&amp;</span> Dlg<span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	TreeNode trDetail <span style="color: #000080;">=</span> tr.<span style="color: #000000;">GUI</span>.<span style="color: #000000;">Detail</span>;
	<span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span> <span style="color: #000040;">!</span>trDetail <span style="color: #000000;">&#41;</span>
		<span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span>;
	<span style="color: #0000ff;">int</span> nShow <span style="color: #000080;">=</span> trDetail.<span style="color: #000000;">iEmail</span>.<span style="color: #000000;">nVal</span>;
	<span style="color: #008000;">//if check, show, else hide.</span>
	trDetail.<span style="color: #000000;">Email</span>.<span style="color: #000000;">Show</span> <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span>nShow <span style="color: #000080;">==</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span>;
<span style="color: #000000;">&#125;</span>

<span style="color: #0000ff;">static</span> <span style="color: #0000ff;">bool</span> _check_email<span style="color: #000000;">&#40;</span>LPCSTR lpcszEmail<span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	string strEmail<span style="color: #000000;">&#40;</span>lpcszEmail<span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span> strEmail.<span style="color: #000000;">Count</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">'@'</span><span style="color: #000000;">&#41;</span> <span style="color: #000040;">!</span><span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span> <span style="color: #000000;">&#41;</span> 
		<span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span>; <span style="color: #008000;">//should contains '@' and only one.</span>
	<span style="color: #0000ff;">int</span> nSep <span style="color: #000080;">=</span> strEmail.<span style="color: #000000;">Find</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">'@'</span><span style="color: #000000;">&#41;</span>;
	string strLeft <span style="color: #000080;">=</span> strEmail.<span style="color: #000000;">Left</span><span style="color: #000000;">&#40;</span>nSep<span style="color: #000000;">&#41;</span>;
	string strRight <span style="color: #000080;">=</span> strEmail.<span style="color: #000000;">Right</span><span style="color: #000000;">&#40;</span>strEmail.<span style="color: #000000;">GetLength</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000040;">-</span> nSep <span style="color: #000040;">-</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span> strLeft.<span style="color: #000000;">GetLength</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">==</span> <span style="color: #0000dd;">0</span> <span style="color: #000000;">&#41;</span>
		<span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span>;
	<span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span> strRight.<span style="color: #000000;">GetLength</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">==</span> <span style="color: #0000dd;">0</span> <span style="color: #000000;">&#41;</span>
		<span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span>;
	LPCSTR lpcszInvalid <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;~!#$%^&amp;*()+ -=|<span style="color: #666666; font-weight: bold;">\\</span>/&gt;&lt;,`&quot;</span>;
	<span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span> strEmail.<span style="color: #000000;">FindOneOf</span><span style="color: #000000;">&#40;</span>lpcszInvalid<span style="color: #000000;">&#41;</span> <span style="color: #000080;">&gt;=</span> <span style="color: #0000dd;">0</span> <span style="color: #000000;">&#41;</span>
		<span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span>;
	<span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span>;
<span style="color: #000000;">&#125;</span></pre>
</li>
<li>
Add error checking code into the <i>gui_controls_event1</i> function.
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span> <span style="color: #000000;">strcmp</span><span style="color: #000000;">&#40;</span>lpcszNodeName, <span style="color: #ff00ff;">&quot;Email&quot;</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">==</span> <span style="color: #0000dd;">0</span> <span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
    string strVal <span style="color: #000080;">=</span> trGetN.<span style="color: #000000;">GUI</span>.<span style="color: #000000;">Detail</span>.<span style="color: #000000;">Email</span>.<span style="color: #000000;">strVal</span>;
    <span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span> <span style="color: #000040;">!</span>_check_email<span style="color: #000000;">&#40;</span>strVal<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span>
    <span style="color: #000000;">&#123;</span>
        strErrMsg <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Invalid Email Address! Please correct it&quot;</span>;
        <span style="color: #008000;">//disable OK button, should not continue when there is error.</span>
        bOKEnable <span style="color: #000080;">=</span> <span style="color: #0000ff;">false</span>;
    <span style="color: #000000;">&#125;</span>
<span style="color: #000000;">&#125;</span></pre>
</li>
<li><span class="OIndex" style="display:none">X-Function, Update Control Value on Dialog</span>Change the return value from <i>return false</i> (default) to <i>return true</i> to force a GUI change.</li>
<li>
In the X-Function body, we just print out the user settings by tree. Click the Compile button <a  class="image"><img alt="Ocguide XF Compile Button.PNG" src="../images/Construct_Controls_on_X-Function_GUI/Ocguide_XF_Compile_Button.PNG?v=77099" width="92"  /></a> to compile and save changes.
<pre class="oc" style="font-family:monospace;">out_tree<span style="color: #000000;">&#40;</span>GUI<span style="color: #000000;">&#41;</span>;</pre>
</li>
</ol>
<h2><a name="Run_the_X-Function"></a><span class="mw-headline">Run the X-Function</span></h2>
<ol><li>Run the <i>gui_controls -d</i> command in the Script Window. </li>
<li>Click the Have Email check box on the dialog, and an email edit box will display. </li>
<li>If you input an invalid email address to the email edit box, for example, type in <i>abc</i>, an error message will show on the bottom of the dialog and the OK button will be disabled. </li>
<li>Click OK.  The setting tree will be outputted to the Script Window.</li></ol>






