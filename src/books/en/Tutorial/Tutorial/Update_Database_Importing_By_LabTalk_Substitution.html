<h1 class="firstHeading">9.3.4 Update Database Importing By LabTalk Substitution</h1><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Summary"><span class="tocnumber">1</span> <span class="toctext">Summary</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#What_you_will_learn"><span class="tocnumber">2</span> <span class="toctext">What you will learn</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Steps"><span class="tocnumber">3</span> <span class="toctext">Steps</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Import_Data_from_Database"><span class="tocnumber">3.1</span> <span class="toctext">Import Data from Database</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Plot_a_Column_Graph"><span class="tocnumber">3.2</span> <span class="toctext">Plot a Column Graph</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Update_Database_Importing_By_LabTalk_Substitution"><span class="tocnumber">3.3</span> <span class="toctext">Update Database Importing By LabTalk Substitution</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><a name="Summary"></a><span class="mw-headline">Summary</span></h2>
<table class="noborder">
	<tr>
	<td style="vertical-align:top" width="60"><img src="../images/Update_Database_Importing_By_LabTalk_Substitution/Alert_icon.png?v=0" width="57"  border="0" /></td><td><p>The database used in this tutorial has been set up on Microsoft Azure. 
</p>
	</td>
	</tr>
	</table>
<p>This tutorial shows how to import data from database into Origin worksheet with defined LabTalk variable in SQL and plot a column graph from the imported data. Then modify the LabTalk variable and reimport database. 
</p><p>The procedure is  based on Origin 2023b.
</p>
<h2><a name="What_you_will_learn"></a><span class="mw-headline">What you will learn</span></h2>
<p>This tutorial will show you how to:
</p>
<ul><li> Import data using SQL Editor.</li>
<li> Use LabTalk substitution in SQL statement.</li>
<li> Make column plot.</li>
<li> Update database importing by LabTalk substitution.</li></ul>
<h2><a name="Steps"></a><span class="mw-headline">Steps</span></h2>
<h3><a name="Import_Data_from_Database"></a><span class="mw-headline">Import Data from Database</span></h3>
<ol>
<li> Start a new project. Choose <b>Data: Connect to Database: New...</b> menu or click clicking the <b>Open SQL Editor</b> button on the <b>Database Access</b> toolbar.
<dl><dd><a  class="image"><img alt="ImportDataDatabase 1.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/ImportDataDatabase_1.png?v=28304" width="257"  /></a></li></dd></dl>
<li> Choose <b>Connection ctring</b> radio button and click OK. Paste the Connection String below.
<pre class="sql" style="font-family:monospace;">Driver<span style="color: #66cc66;">=</span><span style="color: #66cc66;">&#123;</span><span style="color: #993333; font-weight: bold;">SQL</span> Server<span style="color: #66cc66;">&#125;</span>; Server<span style="color: #66cc66;">=</span>olab<span style="color: #66cc66;">.</span><span style="color: #993333; font-weight: bold;">DATABASE</span><span style="color: #66cc66;">.</span>windows<span style="color: #66cc66;">.</span>net; Port<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1433</span>; 
<span style="color: #993333; font-weight: bold;">DATABASE</span><span style="color: #66cc66;">=</span>sample1; Uid<span style="color: #66cc66;">=</span>Olabts; Pwd<span style="color: #66cc66;">=</span>Origin2023;</pre>
<p>If you are using ODBC Drive 18 for SQL Server, use
</p>
<pre class="sql" style="font-family:monospace;">Driver<span style="color: #66cc66;">=</span><span style="color: #66cc66;">&#123;</span>ODBC Driver <span style="color: #cc66cc;">18</span> <span style="color: #993333; font-weight: bold;">FOR</span> <span style="color: #993333; font-weight: bold;">SQL</span> Server<span style="color: #66cc66;">&#125;</span>; Server<span style="color: #66cc66;">=</span>olab<span style="color: #66cc66;">.</span><span style="color: #993333; font-weight: bold;">DATABASE</span><span style="color: #66cc66;">.</span>windows<span style="color: #66cc66;">.</span>net; Port<span style="color: #66cc66;">=</span><span style="color: #cc66cc;">1433</span>; 
<span style="color: #993333; font-weight: bold;">DATABASE</span><span style="color: #66cc66;">=</span>sample1; Uid<span style="color: #66cc66;">=</span>Olabts; Pwd<span style="color: #66cc66;">=</span>Origin2023;</pre>
</li>
<li>Click the <b>OK</b> button to connection to the database.</li>
<li>Copy and paste the following query into the SQL Editor text box. The query shows total sale of each product by specified <b>company</b> name.
<pre class="sql" style="font-family:monospace;"><span style="color: #993333; font-weight: bold;">SELECT</span> SalesLT<span style="color: #66cc66;">.</span>ProductCategory<span style="color: #66cc66;">.</span>Name <span style="color: #993333; font-weight: bold;">AS</span> ProductName<span style="color: #66cc66;">,</span> 
<span style="color: #993333; font-weight: bold;">SUM</span><span style="color: #66cc66;">&#40;</span>SalesLT<span style="color: #66cc66;">.</span>SalesOrderDetail<span style="color: #66cc66;">.</span>LineTotal<span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">AS</span> <span style="color: #ff0000;">'%(company$)'</span>
<span style="color: #993333; font-weight: bold;">FROM</span> SalesLT<span style="color: #66cc66;">.</span>SalesOrderDetail 
<span style="color: #993333; font-weight: bold;">INNER</span> <span style="color: #993333; font-weight: bold;">JOIN</span> SalesLT<span style="color: #66cc66;">.</span>Product
<span style="color: #993333; font-weight: bold;">ON</span> SalesLT<span style="color: #66cc66;">.</span>Product<span style="color: #66cc66;">.</span>ProductID<span style="color: #66cc66;">=</span>SalesLT<span style="color: #66cc66;">.</span>SalesOrderDetail<span style="color: #66cc66;">.</span>ProductID
<span style="color: #993333; font-weight: bold;">INNER</span> <span style="color: #993333; font-weight: bold;">JOIN</span> SalesLT<span style="color: #66cc66;">.</span>SalesOrderHeader 
<span style="color: #993333; font-weight: bold;">ON</span> SalesLT<span style="color: #66cc66;">.</span>SalesOrderHeader<span style="color: #66cc66;">.</span>SalesOrderID <span style="color: #66cc66;">=</span>SalesLT<span style="color: #66cc66;">.</span>SalesOrderDetail<span style="color: #66cc66;">.</span>SalesOrderID 
<span style="color: #993333; font-weight: bold;">INNER</span> <span style="color: #993333; font-weight: bold;">JOIN</span> SalesLT<span style="color: #66cc66;">.</span>ProductCategory 
<span style="color: #993333; font-weight: bold;">ON</span> SalesLT<span style="color: #66cc66;">.</span>Product<span style="color: #66cc66;">.</span>ProductCategoryID  <span style="color: #66cc66;">=</span> SalesLT<span style="color: #66cc66;">.</span>ProductCategory<span style="color: #66cc66;">.</span>ProductCategoryID 
<span style="color: #993333; font-weight: bold;">INNER</span> <span style="color: #993333; font-weight: bold;">JOIN</span> SalesLT<span style="color: #66cc66;">.</span>Customer 
<span style="color: #993333; font-weight: bold;">ON</span> SalesLT<span style="color: #66cc66;">.</span>Customer<span style="color: #66cc66;">.</span>CustomerID <span style="color: #66cc66;">=</span> SalesLT<span style="color: #66cc66;">.</span>SalesOrderHeader<span style="color: #66cc66;">.</span>CustomerID 
<span style="color: #993333; font-weight: bold;">WHERE</span> SalesLT<span style="color: #66cc66;">.</span>Customer<span style="color: #66cc66;">.</span>CompanyName <span style="color: #993333; font-weight: bold;">LIKE</span> <span style="color: #ff0000;">'%(company$)'</span>
<span style="color: #993333; font-weight: bold;">GROUP</span> <span style="color: #993333; font-weight: bold;">BY</span> SalesLT<span style="color: #66cc66;">.</span>ProductCategory<span style="color: #66cc66;">.</span>Name</pre> 
<li>To add a Labtalk string variable company, select <b>Query: LabTalk...</b> to open the <b>LabTalk Support Setting</b> dialog.
<dl><dd><a  class="image"><img alt="Db LT Script1.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/Db_LT_Script1.png?v=72167" width="532"  /></a></dd></dl>
<li>Check the <b>Enable LabTalk (%,$) substitution</b> checkbox.
<li> Type the script below to define a LabTalk string variable <b>company</b>.  <pre class="lt" style="font-family:monospace;">string company<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Professional Sales and Service&quot;</span>;</pre> in the <b>Before Query Script</b> box. Click <b>OK</b>.<br />
<dl><dd><a  class="image"><img alt="ImportDB for LT sub company.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/ImportDB_for_LT_sub_company.png?v=72318" width="522"  /></a></dd></dl>
<li>Click the <a  class="image"><img alt="Db editor labtalk.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/Db_editor_labtalk.png?v=32572" width="23"  /></a> button to preview the SQL query string with LabTalk variable substituted in the SQL Editor box.<br /> 
<dl><dd><a  class="image"><img alt="ImportDB for LT sub company SQL.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/ImportDB_for_LT_sub_company_SQL.png?v=72294" width="718"  /></a></dd></dl>
<li> Click the <b>OK</b> button to import data to workbook. By default the SQL is saved together with worksheet. </li>
<li> The icon on the top left of the workbook indicates the sheet contains an SQL query.
<dl><dd><a  class="image"><img alt="ImportDB for LT sub company1 imported.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/ImportDB_for_LT_sub_company1_imported.png?v=72288" width="363"  /></a></li></dd></dl>
</ol>
<h3><a name="Plot_a_Column_Graph"></a><span class="mw-headline">Plot a Column Graph</span></h3>
<ol>
<li> Highlight column B and plot a column graph.
<li> Turn on frame and grid. Turn off ticks and remove axis title. Rotate tick labels.
<li> Click in white area within layer frame to select the layer and click Auto Rescale mini toolbar button so axis will auto rescale if new data comes in.
<dl><dd><a  class="image"><img alt="Axis auto rescale.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/Axis_auto_rescale.png?v=72299" width="346"  /></a></dd></dl>
<li> Click close upper edge of white space on graph and choose <b>Add Page title</b> mini toolbar button.
<dl><dd><a  class="image"><img alt="Add page title mt.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/Add_page_title_mt.png?v=72297" width="386"  /></a></dd></dl>
<li> Enter <b>%(1,@LA)</b>. This is the substitution to show 1st plot's column long name. 
<li> Click on <b>%(1, @LA)</b> and click the <b>Link to Substitution</b> mini toolbar button to turn it on. 
<dl><dd><a  class="image"><img alt="Add page title link to substitution.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/Add_page_title_link_to_substitution.png?v=72298" width="346"  /></a></dd></dl>
<li> The long name of column B will be used as page title. We will get this final graph.
<dl><dd><a  class="image"><img alt="ImportDB for LT sub colum graph1.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/ImportDB_for_LT_sub_colum_graph1.png?v=72300" width="636"  /></a></dd></dl>
</ol>
<h3><a name="Update_Database_Importing_By_LabTalk_Substitution"></a><span class="mw-headline">Update Database Importing By LabTalk Substitution</span></h3>
<p>There may be multiple places in SQL with company info. The benefit of using LabTalk variable is that user only needs to change variable in <b>LabTalk Support Settings</b> dialog. All places with such variable will be substituted on execution. <br />
</p>
<ol>
<li>Activate the worksheet with data from database above. Click <b>Open SQL Editor</b> button <a  class="image"><img alt="Button db Create.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/Button_db_Create.png?v=10828" width="24"  /></a> and SQL Editor opens again, with the saved settings.
<li> Select menu <b>Query: LabTalk</b> to open <b>LabTalk Support Settings</b> dialog. Now, change to  
<pre class="lt" style="font-family:monospace;">string company<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Riding Cycles&quot;</span>;</pre>
<dl><dd><a  class="image"><img alt="ImportDB for LT sub company2.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/ImportDB_for_LT_sub_company2.png?v=72317" width="522"  /></a></dd></dl>
<li> Click OK to go back to SQL Editor. Click OK to import to workbook. Graph will auto update.
<dl><dd><a  class="image"><img alt="ImportDB for LT sub colum graph2.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/ImportDB_for_LT_sub_colum_graph2.png?v=72303" width="776"  /></a></dd></dl>
</ol>
<p>But you will need to open the SQL Editor dialog everytime to change the variable values which is not convenient. A nicer way is to modify the LabTalk Support Settings<b> to use global variables. Then we can modify the global variables outside SQL Editor and reimport. </b>
</p>
<ol>
<li> Let's activate worksheet again and click <a  class="image"><img alt="Button db Create.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/Button_db_Create.png?v=10828" width="24"  /></a> to open <b>SQL Editor</b>. 
<li> Choose <b>Query: LabTalk...</b> menu and modify the LabTalk Support Settings as follows. 
<pre class="lt" style="font-family:monospace;">string company<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;&quot;</span>;  <span style="color: #008000;">// For the first company substitution</span>

if<span style="color: #000000;">&#40;</span>exist<span style="color: #000000;">&#40;</span>thecompany<span style="color: #000080;">$</span>, <span style="color: #0000dd;">18</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">==</span> <span style="color: #0000dd;">18</span><span style="color: #000000;">&#41;</span>  <span style="color: #008000;">// if thecompany$ exists</span>
<span style="color: #000000;">&#123;</span>
	company<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> thecompany<span style="color: #000080;">$</span>;  <span style="color: #008000;">// if yes, assign to company$</span>
<span style="color: #000000;">&#125;</span>
else
<span style="color: #000000;">&#123;</span>
	company<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Professional Sales and Service&quot;</span>;  <span style="color: #008000;">// if no, use &quot;Professional Sales and Service&quot; as company$</span>
<span style="color: #000000;">&#125;</span></pre>
<dl><dd><a  class="image"><img alt="ImportDB for LT sub global.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/ImportDB_for_LT_sub_global.png?v=72320" width="521"  /></a></dd></dl>
</li> Click <b>OK</b> button to close the <b>SQL Editor dialog.</b>
<li> Make sure the worksheet with database is the active window.
<li> Select <b>Window: Script Window</b> menu to open Script Window. 
<li> Paste the following into Script window. Highlight all and pressENTER keyboard to run the commands.
<pre class="lt" style="font-family:monospace;">string thecompany<span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #ff00ff;">&quot;Action Bicycle Specialists&quot;</span>; <span style="color: #008000;">//define global string variable thecompany$</span>
dbimport; <span style="color: #008000;">//import data from database</span></pre>
<li> The data in worksheet and graph are updated. 
<dl><dd><a  class="image"><img alt="ImportDB for LT sub company3.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/ImportDB_for_LT_sub_company3.png?v=72321" width="793"  /></a></dd></dl>
</ol>
<p>Note: 
</p>
<ol><li> "global" means the LabTalk variables can be "seen" and used by SQL Editor for the substitutions. Variables created without declaration (only allowed for types double, string, and dataset), e.g. e.g. <i>name$="Smith"</i> become Project variables and are saved with the Origin Project file.</li>
<li> The last <i>dbimport</i> LabTalk command is the same as clicking the  <b>Import data </b> button <a  class="image"><img alt="Button db Import Data.png" src="../images/Update_Database_Importing_By_LabTalk_Substitution/Button_db_Import_Data.png?v=10831" width="25"  /></a> on <b>Database Access</b> toolbar.</li>
<li> Use <i>string company$ = "%%Supplies";</i> to find companies ending with <b>Supplies</b>. After substitution, the SQL will be like <b>WHERE SalesLT.Customer.CompanyName LIKE '%Supplies'</b></li></ol>


