<h1 class="firstHeading">4.4.2 Use Script to Search for Baseline Anchor Points in Peak Analyzer</h1><p class='urlname' style='display: none'>Use-Script-Anchors</p>
<p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Summary"><span class="tocnumber">1</span> <span class="toctext">Summary</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#What_you_will_learn"><span class="tocnumber">2</span> <span class="toctext">What you will learn</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Steps"><span class="tocnumber">3</span> <span class="toctext">Steps</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Create_baseline_with_User-Defined_Scripts"><span class="tocnumber">3.1</span> <span class="toctext">Create baseline with User-Defined Scripts</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><a name="Summary"></a><span class="mw-headline">Summary</span></h2>
<p>In OriginPro, the <b>Peak Analyzer</b> is capable of creating and subtracting baseline. You can create a baseline by finding baseline anchor points first and then connect those anchor points either by interpolation or by fitting. To search for those baseline anchor points, you can either use built-in methods or define the search method on your own using LabTalk scripts.
</p>
<h2><a name="What_you_will_learn"></a><span class="mw-headline">What you will learn</span></h2>
<ul><li>How to create baseline with user-defined scripts</li>
<li>How to integrate peaks from user-defined baseline</li></ul>
<h2><a name="Steps"></a><span class="mw-headline">Steps</span></h2>
<h3><a name="Create_baseline_with_User-Defined_Scripts"></a><span class="mw-headline">Create baseline with User-Defined Scripts</span></h3>
<ol><li>Start a <b>New Workbook</b> and import the <i>&lt;Origin EXE Folder&gt;\Samples\Spectroscopy\Chromatography\Liquid chromatogram.dat</i>. Highlight the second column. In the main menu, select <b>Analysis: Peaks and Baseline: Peak Analyzer</b> to open the dialog of the <b>Peak Analyzer</b>.</li>
<li>Make sure <b>Goal</b> is selected as <b>Integrate Peaks</b> and click <b>Next</b> button to go to <b>Baseline Mode</b> page.</li>
<li>Select <b>Baseline Mode</b> as <b>User Defined</b> and continue to select <b>Anchor Points Finding Method</b> under <b>Baseline Anchor Points</b> node as <b>Use Script to Search</b>.</li>
<li>Enter <i>apt_x</i> and <i>apt_y</i> in <b>X=</b> and <b>Y=</b> edit boxes, respectively. Then paste the scripts shown below into <b>Before Formula Script</b> box. Click <b>Find</b> button will run the scripts and the detected baseline anchor points will display on the preview window.</li></ol>
<dl><dd><a  class="image"><img alt="UseScriptToSearch.png" src="../images/Use_Script_to_Search_Baseline_Anchor_Points_in_Peak_Analyzer/600px-UseScriptToSearch.png?v=45947" width="600"   /></a></dd></dl>
<pre class="lt" style="font-family:monospace;">Dataset dspos;
pkfind iy<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #000000;">&#40;</span>dsx, dsy<span style="color: #000000;">&#41;</span> dir<span style="color: #000000;">:</span><span style="color: #000080;">=</span>p npts<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">5</span> value<span style="color: #000000;">:</span><span style="color: #000080;">=</span><span style="color: #0000dd;">200</span> ocenter<span style="color: #000000;">:</span><span style="color: #000080;">=</span>dspos; <span style="color: #008000;">// Find major peak positions</span>
int npk<span style="color: #000080;">=</span>dspos.<span style="color: #000080;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">// Get major peak numbers</span>
 <span style="color: #008000;">// Create datasets to store anchor points</span>
int nn <span style="color: #000080;">=</span> dsx.<span style="color: #000080;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">// Get source X size</span>
dataset apt_x, apt_y;<span style="color: #008000;">// Create datasets to store anchor points</span>
apt_x.<span style="color: #000080;">SetSize</span><span style="color: #000000;">&#40;</span>npk<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">// Set anchor points number</span>
apt_y.<span style="color: #000080;">SetSize</span><span style="color: #000000;">&#40;</span>npk<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;
apt_x<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> dsx<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span>; <span style="color: #008000;">// Set 1st data point as 1st anchor point</span>
apt_y<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> dsy<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span>; 
apt_x<span style="color: #000000;">&#91;</span>npk<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> dsx<span style="color: #000000;">&#91;</span>nn<span style="color: #000000;">&#93;</span>; <span style="color: #008000;">// Set last data point as last anchor point</span>
apt_y<span style="color: #000000;">&#91;</span>npk<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> dsy<span style="color: #000000;">&#91;</span>nn<span style="color: #000000;">&#93;</span>; 
for <span style="color: #000000;">&#40;</span>ii<span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; ii<span style="color: #000080;">&lt;=</span>npk; ii<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span> 
<span style="color: #000000;">&#123;</span>
int istart <span style="color: #000080;">=</span> dspos<span style="color: #000000;">&#91;</span>ii<span style="color: #000000;">&#93;</span>; <span style="color: #008000;">// Get row index of ii-th peak</span>
int iend <span style="color: #000080;">=</span> dspos<span style="color: #000000;">&#91;</span>ii<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span>; <span style="color: #008000;">// Get row index of the next peak</span>
range rtemp <span style="color: #000080;">=</span> <span style="color: #000000;">&#91;</span>??<span style="color: #000000;">&#93;</span><span style="color: #000080;">!</span>dsy<span style="color: #000000;">&#91;</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>istart<span style="color: #000000;">&#41;</span><span style="color: #000000;">:</span><span style="color: #000080;">$</span><span style="color: #000000;">&#40;</span>iend<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#93;</span>; <span style="color: #008000;">// Declare the range and point to the loose dataset</span>
limit rtemp; <span style="color: #008000;">// Get stats of the subrange</span>
int ind <span style="color: #000080;">=</span> limit.<span style="color: #000080;">imin</span>; <span style="color: #008000;">// Get min Y row index</span>
apt_y<span style="color: #000000;">&#91;</span>ii<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span><span style="color: #000080;">=</span>limit.<span style="color: #000080;">ymin</span>; <span style="color: #008000;">// Get min Y between two peaks as anchor point</span>
apt_x<span style="color: #000000;">&#91;</span>ii<span style="color: #000080;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span><span style="color: #000080;">=</span>dsx<span style="color: #000000;">&#91;</span>ind<span style="color: #000000;">&#93;</span>; 
<span style="color: #000000;">&#125;</span>;</pre>
<p>The script will firstly find all major peak positions and then treat the minimum between every two adjacent peaks as one baseline anchor point, then add the first and last data points as two baseline anchor points.
</p><p><font color="red">Note:</font> You can still uncheck <b>Enable Auto Find</b> checkbox and then use <b>Add</b> or <b>Modify/Del</b> to add or remove baseline anchor points.
</p><p><br />
5. Click <b>Next</b> button to go to <b>Create Baseline</b> page, make sure <b>Connect by</b> is selected as <b>Interpolation</b> and the <b>Interpolation Method</b> is <b>Line</b>. Then click <b>Finish</b> to obtain integration areas for each peak.
</p>





