<h1 class="firstHeading">3 Advanced Topics in App Development</h1><p><br />
Topics discussed on this page assume that you have previously read <a href="../../AppDev/AppDev/Introduction.html" title="AppDev:Introduction">App Development</a> and <a href="../../AppDev/AppDev/App_Distribution.html" title="AppDev:App Distribution">Distributing an App</a>. If not, those pages should be read before hand in order to better understand what is discussed below.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Adding_a_Toolbar_to_an_App"><span class="tocnumber">1</span> <span class="toctext">Adding a Toolbar to an App</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Including_Sample_Files_with_an_App"><span class="tocnumber">2</span> <span class="toctext">Including Sample Files with an App</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Calling_Python_Functions_in_Apps"><span class="tocnumber">3</span> <span class="toctext">Calling Python Functions in Apps</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Install_Python_Packages_During_App_Installation"><span class="tocnumber">3.1</span> <span class="toctext">Install Python Packages During App Installation</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#Checking_for_Installation_of_R"><span class="tocnumber">4</span> <span class="toctext">Checking for Installation of R</span></a></li>
</ul>
</div>

<h2><a name="Adding_a_Toolbar_to_an_App"></a><span class="mw-headline">Adding a Toolbar to an App</span></h2>
<p>Adding a toolbar to an App so that it displays the toolbar when the App icon is clicked is not difficult.
</p><p>As a first step, create a bitmap file (*.BMP) for the buttons using an appropriate image editor. Each individual button must occupy 16x16px. So, if there are to be 3 buttons, the total image size must be 16px tall by 48px wide. Save the *.BMP file to the folder for the App. <i>Note: it must be saved as 16 Color (4-bit).</i> Here is an example of a bitmap file:
</p>
<dl><dd><a  class="image"><img alt="AppExampleBMPFile1.png" src="../images/Advanced_Topics_App_Development/AppExampleBMPFile1.png?v=50230" width="50"  /></a></dd></dl>
<p>Next, a LabTalk script file (*.OGS) must be created and saved in the folder for the App (perhaps "lauch.ogs" would be a good name). In the file, add one section per button. These sections will contain the code to run when the relevant button is clicked in the toolbar. For example:
</p>
<dl><dd><a  class="image"><img alt="AppButtonsOGS2.png" src="../images/Advanced_Topics_App_Development/AppButtonsOGS2.png?v=50225" width="800"  /></a></dd></dl>
<p>The next step is to create a <b>Button Group</b> in Origin. From the <b>View</b> menu, select <b>Toolbars...</b> In the <b>Customize</b> dialog, navigate to the <b>Button Groups</b> tab. At the bottom of the dialog, click the <b>New...</b> button. In the <b>Create Button Group</b> dialog, specify the button <b>Group Name</b> <i>(it is usually a good idea is to name it the same as your toolbar bitmap file)</i>, <b>Number of Buttons</b>, and select the toolbar <b>Bitmap</b> file previously created . Then click the <b>OK</b> button.
</p>
<dl><dd><a  class="image"><img alt="AppsButtonGroup1a.png" src="../images/Advanced_Topics_App_Development/AppsButtonGroup1a.png?v=50227" width="696"  /></a></dd></dl>
<p>You will then be prompted to save an *.INI file named after your Button Group. This file must be saved to the folder for the App.
</p><p>Still in the <b>Button Groups</b> tab of the <b>Customize</b> dialog, scroll down the list of <b>Groups</b> until you get to the one that was just created. Select it and the toolbar bitmap image will be displayed to the right. Click on the first button in the image and then click the <b>Settings...</b> button below. In the <b>Button Settings</b> dialog, specify the <b>File Name</b> by browsing to the *.OGS file previously created. Then specify the <b>Section Name</b> in the file to be called when the relevant button is clicked. <b>Tool Tip Text</b> and <b>Status Bar</b> text can also be specified along with which <b>Window</b> type will enable the relevant toolbar button. <i>The other settings are discussed <a class="external text" href="http://originlab.com/doc/Origin-Help/ButtonSetting-Dialog" target="_blank">here</a>.</i>
</p>
<dl><dd><a  class="image"><img alt="AppsButtonGroup2.png" src="../images/Advanced_Topics_App_Development/AppsButtonGroup2.png?v=50228" width="823"  /></a></dd></dl>
<p>Simply repeat the above process until all of the buttons have been configured. At this point, the *.INI file will have been automatically updated and you can delete the Button Group by selecting it from the Groups list and clicking the <b>Delete</b> button at the bottom of the dialog. Shut down and restart Origin to completely clear the Button Group from memory. <i>Note: in the future, the App will recreate the Button Group automatically as it is needed.</i>
</p><p>The Button Group may be edited (including adding and deleting buttons) in the future by simply opening the <b>Customize</b> dialog, navigating to the <b>Button Groups</b> tab, and clicking the <b>Add...</b> button. After selecting the *.INI file for the Button Group from the folder for the App, follow the aforementioned steps to make changes including deleting the Button Group afterwards. <i>Note: you may have to restart Origin to see the changes in the toolbar for the App.</i>
</p><p>The final step in adding a toolbar to an App takes place in the App packaging stage. Prior to packaging, make sure the files have been have been added to the App folder in the Code Builder Workspace. In the <b>Package Manager</b>, enter <code>@@TB</code> into the <b>Launch Script</b> control. Then uncheck <b>Toolbar</b> and  
<b>Create Toolbar</b> controls. Lastly, for <b>Button Group File</b>, enter the path to the *.INI file in the App folder. The path should be relative to the "%LocalAppData%\OriginLab\Apps" folder. For example, if the App is named "CD Test App" and the *.INI file named "CDTestApp.ini", the path would be "CD Test App\CDTestApp.ini". For example:
</p>
<dl><dd><a  class="image"><img alt="AoppsPackMan5.png" src="../images/Advanced_Topics_App_Development/AoppsPackMan5.png?v=50222" width="531"  /></a></dd></dl>
<h2><a name="Including_Sample_Files_with_an_App"></a><span class="mw-headline">Including Sample Files with an App</span></h2>
<p>Sample files (projects, data for import, etc) can easily be distributed with an App. To do so, simply create a subfolder named "Samples" (plural) in the folder for the App and place the files in that folder. Prior to packaging the App, make sure the sample files have been added to the App folder in the Code Builder Workspace.
</p><p><b>Important: Any sample files you intend to include in your App must NOT be opened in Origin when you are creating the OPX file or they will not be included!</b>
</p><p>Then after the App is installed, Origin will look for the "Samples" folder and if it is found in the folder for the App, an entry entitled "Show Sample Folder" will be added to the context menu for the App icon. Selecting this entry will open the Samples folder in a Windows File Explorer window.
</p>
<h2><a name="Calling_Python_Functions_in_Apps"></a><span class="mw-headline">Calling Python Functions in Apps</span></h2>
<p>Please refer to this <a href="../../AppDev/AppDev/Introduction.html" title="AppDev:Introduction">page</a> for the basic steps of making an app in Origin.
</p><p>Starting from Origin 2021, Python function can be called directly from <a href="../../OriginC/OriginC/Calling_Python_Functions_from_OriginC.html" title="OriginC:Calling Python Functions from OriginC">Origin C</a> or from <a class="external text" href="http://wikis/ltwiki/index.php?title=Category/LT_Working_with_Python" target="_blank">Labtalk Script</a>. 
</p><p>To call Python function from Origin C code in the app, place the <b>origin.py</b> file in the app folder. Then call Python function using the syntax
</p>
<pre class="oc" style="font-family:monospace;">Python.<span style="color: #000000;">function_name</span><span style="color: #000000;">&#40;</span>arg1, arg2...<span style="color: #000000;">&#41;</span></pre>
<p>or to return multiple variables
</p>
<pre class="oc" style="font-family:monospace;">Python.<span style="color: #000000;">function_name</span><span style="color: #000000;">&#40;</span>arg1, arg2..., <span style="color: #000040;">&amp;</span> ret1, <span style="color: #000040;">&amp;</span> ret2...<span style="color: #000000;">&#41;</span></pre>
<p>where <b>function_name</b> is the name of the function defined in <b>origin.py</b>.
</p><p>If Python function is called from Labtalk script in the app, place a .py file under the app folder. Then call Python function using the syntax
</p>
<pre class="lt" style="font-family:monospace;">Python.<span style="color: #000080;">LTwd</span><span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span>@ATestApp\;
Python.<span style="color: #000080;">LTwf</span><span style="color: #000080;">$</span><span style="color: #000080;">=</span>myfunc.<span style="color: #000080;">py</span>;
py.<span style="color: #000080;">function_name</span><span style="color: #000000;">&#40;</span>arg1, arg2...<span style="color: #000000;">&#41;</span></pre>
<p>and to return multiple variables
</p>
<pre class="lt" style="font-family:monospace;">Python.<span style="color: #000080;">LTwd</span><span style="color: #000080;">$</span><span style="color: #000080;">=</span><span style="color: #000080;">%</span>@ATestApp\;
Python.<span style="color: #000080;">LTwf</span><span style="color: #000080;">$</span><span style="color: #000080;">=</span>myfunc.<span style="color: #000080;">py</span>;
<span style="color: #000000;">&#40;</span>ret1, ret2...<span style="color: #000000;">&#41;</span> <span style="color: #000080;">=</span> py.<span style="color: #000080;">function_name</span><span style="color: #000000;">&#40;</span>arg1, arg2...<span style="color: #000000;">&#41;</span></pre>
<p>where <b>myfunc</b> is the .py file name and <b>function_name</b> is the name of the function defined in <b>myfunc.py</b>.
</p>
<h3><a name="Install_Python_Packages_During_App_Installation"></a><span class="mw-headline">Install Python Packages During App Installation</span></h3>
<p>Considering there are cases Python module needs to be imported in the .py file, Origin App should have the ability to check and install necessary modules during its installation. This can be done in the <a href="../../AppDev/AppDev/Introduction.html#Packaging_and_Installing_an_App_for_the_First_Time" title="AppDev:Introduction">OPX packaging</a> dialog. Add a line of Labtalk Command in <b>Labtalk Script: Before Installation</b> entry so that before the app is installed, it checks and installs the specified module(s).
</p>
<pre class="oc" style="font-family:monospace;"> <span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span>Python.<span style="color: #000000;">chk</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;sklearn&quot;</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">&gt;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>type <span style="color: #000040;">-</span>b <span style="color: #ff00ff;">&quot;The required Python module is not installed properly&quot;</span>; <span style="color: #0000ff;">break</span> <span style="color: #0000dd;">1</span>;<span style="color: #000000;">&#125;</span>;</pre>
<p><a  class="image"><img alt="CheckPackageInstall1.png" src="../images/Advanced_Topics_App_Development/CheckPackageInstall1.png?v=53136" width="805"  /></a>
</p>
<h2><a name="Checking_for_Installation_of_R"></a><span class="mw-headline">Checking for Installation of R</span></h2>
<p>There is a LabTalk method for checking for the R package before App installation. Add the following to the Package Manager <b>Labtalk Script: Before Installation</b> section:
</p>
<pre class="lt" style="font-family:monospace;">IsApplicationInstalled<span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;R&quot;</span><span style="color: #000000;">&#41;</span><span style="color: #000080;">=</span>;</pre>






