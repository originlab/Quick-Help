<h1 class="firstHeading">1.18.1.4.3 Graph Preview Dialog</h1><p><span class="OIndex" style="display:none">Graph Preview Dialog</span>
This section shows how to create custom dialog with a graph preview.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Prepare_Dialog_Resource"><span class="tocnumber">1</span> <span class="toctext">Prepare Dialog Resource</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Prepare_Source_File"><span class="tocnumber">2</span> <span class="toctext">Prepare Source File</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Including_Needed_Headers"><span class="tocnumber">3</span> <span class="toctext">Including Needed Headers</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Adding_User_Defined_Preview_ClassClasses.2C_User_Defined"><span class="tocnumber">4</span> <span class="toctext">Adding User Defined Preview Class<span class="OIndex" style="display:none">Classes, User Defined</span></span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Adding_Dialog_Class"><span class="tocnumber">5</span> <span class="toctext">Adding Dialog Class</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Open_the_Dialog"><span class="tocnumber">6</span> <span class="toctext">Open the Dialog</span></a></li>
</ul>
</div>

<h2><a name="Prepare_Dialog_Resource"></a><span class="mw-headline">Prepare Dialog Resource</span></h2>
<p>We first need a dialog resource containing a static control, in which the preview graph will nest. Here we will use a built-in resource, IDD_SAMPLE_SPLITTER_DLG, in <i>OriginC\Originlab\ODlg8.dll</i>.
</p>
<h2><a name="Prepare_Source_File"></a><span class="mw-headline">Prepare Source File</span></h2>
<p>In Code Builder, click New button<a  class="image"><img alt="Newfile button.png" src="../images/Graph_Preview_Dialog/Newfile_button.png?v=22495" width="23"  /></a>, type file name, and set Location as the same path of the above dialog resource dll oDlg8.dll - Origin install path <i>OriginC\Originlab</i> subfolder.
</p>
<h2><a name="Including_Needed_Headers"></a><span class="mw-headline">Including Needed Headers</span></h2>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">//These headers contain declarations of dialog and controls</span>
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>..\Originlab\DialogEx.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>..\Originlab\GraphPageControl.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span></pre>
<h2><a name="Adding_User_Defined_Preview_ClassClasses.2C_User_Defined"></a><span class="mw-headline">Adding User Defined Preview Class<span class="OIndex" style="display:none">Classes, User Defined</span></span></h2>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">//forbid some action on preview graph</span>
<span style="color: #0000ff;">#define</span> PREVIEW_NOCLICK_BITS <span style="color: #000000;">&#40;</span>NOCLICK_DATA_PLOT<span style="color: #000040;">|</span>NOCLICK_LAYER<span style="color: #000040;">|</span>NOCLICK_LAYERICON<span style="color: #000000;">&#41;</span>

<span style="color: #0000ff;">#define</span> PREVIEW_TEMPLATE    <span style="color: #ff00ff;">&quot;Origin&quot;</span> <span style="color: #008000;">//preview graph template</span>

<span style="color: #0000ff;">class</span>   MyPreviewCtrl
<span style="color: #000000;">&#123;</span>
<span style="color: #0000ff;">public</span><span style="color: #000000;">:</span>
    MyPreviewCtrl<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#123;</span><span style="color: #000000;">&#125;</span>
    ~MyPreviewCtrl<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
    <span style="color: #000000;">&#123;</span>
        <span style="color: #008000;">//destroy temporary books when dialog closed.</span>
        <span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span> m_wksPreview.<span style="color: #000000;">IsValid</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span>
            m_wksPreview.<span style="color: #000000;">Destroy</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
    <span style="color: #000000;">&#125;</span>
    
    <span style="color: #0000ff;">void</span>    Init<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">int</span> nCtrlID, WndContainer<span style="color: #000040;">&amp;</span> wndParent<span style="color: #000000;">&#41;</span>
    <span style="color: #000000;">&#123;</span>
        <span style="color: #008000;">//create preview graph control</span>
        Control ctrl <span style="color: #000080;">=</span> wndParent.<span style="color: #000000;">GetDlgItem</span><span style="color: #000000;">&#40;</span>nCtrlID<span style="color: #000000;">&#41;</span>;
        GraphControl gCtrl;
        gCtrl.<span style="color: #000000;">CreateControl</span><span style="color: #000000;">&#40;</span>ctrl.<span style="color: #000000;">GetSafeHwnd</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
        gCtrl.<span style="color: #000000;">Visible</span> <span style="color: #000080;">=</span> <span style="color: #0000ff;">true</span>;
        
        GraphPageControl gpCtrl;
        gpCtrl.<span style="color: #000000;">Create</span><span style="color: #000000;">&#40;</span>gCtrl, PREVIEW_NOCLICK_BITS, PREVIEW_TEMPLATE<span style="color: #000000;">&#41;</span>;
        GraphPage gpPreview;
        gpPreview <span style="color: #000080;">=</span> gpCtrl.<span style="color: #000000;">GetPage</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
        gpPreview.<span style="color: #000000;">Rename</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;MyPreview&quot;</span><span style="color: #000000;">&#41;</span>;
        m_glPreview <span style="color: #000080;">=</span> gpPreview.<span style="color: #000000;">Layers</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">//first layer</span>
        
        <span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span> <span style="color: #000040;">!</span>m_wksPreview <span style="color: #000000;">&#41;</span>
        <span style="color: #000000;">&#123;</span>
            <span style="color: #008000;">//temporary worksheet to hold preview data.</span>
            m_wksPreview.<span style="color: #000000;">Create</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Origin&quot;</span>, CREATE_TEMP<span style="color: #000000;">&#41;</span>;
            m_wksPreview.<span style="color: #000000;">SetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">//two columns</span>
            
            <span style="color: #008000;">//long name will be displayed as axis title</span>
            Column colX<span style="color: #000000;">&#40;</span>m_wksPreview, <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>;
            colX.<span style="color: #000000;">SetLongName</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Preview X&quot;</span><span style="color: #000000;">&#41;</span>;
            Column colY<span style="color: #000000;">&#40;</span>m_wksPreview, <span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;
            colY.<span style="color: #000000;">SetLongName</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Preview Y&quot;</span><span style="color: #000000;">&#41;</span>;
            
            <span style="color: #008000;">//prepare datarange</span>
            DataRange drPrev;
            drPrev.<span style="color: #000000;">Add</span><span style="color: #000000;">&#40;</span>m_wksPreview, <span style="color: #0000dd;">0</span>, <span style="color: #ff00ff;">&quot;X&quot;</span><span style="color: #000000;">&#41;</span>;
            drPrev.<span style="color: #000000;">Add</span><span style="color: #000000;">&#40;</span>m_wksPreview, <span style="color: #0000dd;">1</span>, <span style="color: #ff00ff;">&quot;Y&quot;</span><span style="color: #000000;">&#41;</span>;
            
            <span style="color: #008000;">//plot preview curve, although it has no points now.</span>
            <span style="color: #0000ff;">int</span> nPlot <span style="color: #000080;">=</span> m_glPreview.<span style="color: #000000;">AddPlot</span><span style="color: #000000;">&#40;</span>drPrev, IDM_PLOT_LINE<span style="color: #000000;">&#41;</span>;
            DataPlot dp <span style="color: #000080;">=</span> m_glPreview.<span style="color: #000000;">DataPlots</span><span style="color: #000000;">&#40;</span>nPlot<span style="color: #000000;">&#41;</span>;
            <span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span> dp <span style="color: #000000;">&#41;</span> <span style="color: #008000;">//set preview curve color</span>
                dp.<span style="color: #000000;">SetColor</span><span style="color: #000000;">&#40;</span>SYSCOLOR_RED<span style="color: #000000;">&#41;</span>;
        <span style="color: #000000;">&#125;</span>
    <span style="color: #000000;">&#125;</span>
    
    <span style="color: #008000;">//update preview curve with external data.</span>
    <span style="color: #0000ff;">void</span>    Update<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">const</span> vector<span style="color: #000040;">&amp;</span> vX, <span style="color: #0000ff;">const</span> vector<span style="color: #000040;">&amp;</span> vY<span style="color: #000000;">&#41;</span>
    <span style="color: #000000;">&#123;</span>
        <span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span> m_wksPreview.<span style="color: #000000;">IsValid</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span>
        <span style="color: #000000;">&#123;</span>
            Dataset dsX<span style="color: #000000;">&#40;</span>m_wksPreview, <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>;
            Dataset dsY<span style="color: #000000;">&#40;</span>m_wksPreview, <span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;
            <span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span> <span style="color: #000040;">!</span>dsX.<span style="color: #000000;">IsValid</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000040;">||</span> <span style="color: #000040;">!</span>dsY.<span style="color: #000000;">IsValid</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span>
                <span style="color: #0000ff;">return</span>; <span style="color: #008000;">//no columns for preview</span>
            
            <span style="color: #008000;">//update source data will also update preview graph.</span>
            dsX <span style="color: #000080;">=</span> vX;
            dsY <span style="color: #000080;">=</span> vY;
            <span style="color: #008000;">//rescale graph for better view.</span>
            m_glPreview.<span style="color: #000000;">Rescale</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
        <span style="color: #000000;">&#125;</span>
    <span style="color: #000000;">&#125;</span>
    
<span style="color: #0000ff;">private</span><span style="color: #000000;">:</span>
    <span style="color: #008000;">//preview graph on dialog</span>
    GraphLayer  m_glPreview;
    
    <span style="color: #008000;">//temporary worksheet to put preview data.</span>
    Worksheet   m_wksPreview;
<span style="color: #000000;">&#125;</span>;</pre>
<h2><a name="Adding_Dialog_Class"></a><span class="mw-headline">Adding Dialog Class</span></h2>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">class</span>   MyGraphPreviewDlg <span style="color: #000000;">:</span> <span style="color: #0000ff;">public</span> MultiPaneDlg
<span style="color: #000000;">&#123;</span>
<span style="color: #0000ff;">public</span><span style="color: #000000;">:</span>
    <span style="color: #008000;">//dialog resource ID and the DLL containing it.</span>
    MyGraphPreviewDlg<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">:</span> MultiPaneDlg<span style="color: #000000;">&#40;</span>IDD_SAMPLE_SPLITTER_DLG, 
        GetAppPath<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">TRUE</span><span style="color: #000000;">&#41;</span> <span style="color: #000040;">+</span> <span style="color: #ff00ff;">&quot;OriginC<span style="color: #666666; font-weight: bold;">\\</span>Originlab<span style="color: #666666; font-weight: bold;">\\</span>ODlg8&quot;</span><span style="color: #000000;">&#41;</span>
    <span style="color: #000000;">&#123;</span>
    <span style="color: #000000;">&#125;</span>
    
    ~MyGraphPreviewDlg<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
    <span style="color: #000000;">&#123;</span>
    <span style="color: #000000;">&#125;</span>
    
    <span style="color: #0000ff;">int</span>     DoModalEx<span style="color: #000000;">&#40;</span>HWND hParent <span style="color: #000080;">=</span> <span style="color: #0000ff;">NULL</span><span style="color: #000000;">&#41;</span>
    <span style="color: #000000;">&#123;</span>
        InitMsgMap<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
        
        <span style="color: #008000;">//show dialog until user closes it.</span>
        <span style="color: #0000ff;">return</span> DoModal<span style="color: #000000;">&#40;</span>hParent, DLG_NO_DEFAULT_REPOSITION<span style="color: #000000;">&#41;</span>;
    <span style="color: #000000;">&#125;</span>     
    
<span style="color: #0000ff;">protected</span><span style="color: #000000;">:</span>
EVENTS_BEGIN
	ON_INIT<span style="color: #000000;">&#40;</span>OnInitDialog<span style="color: #000000;">&#41;</span> 
	ON_BN_CLICKED<span style="color: #000000;">&#40;</span>IDC_LOAD, OnDraw<span style="color: #000000;">&#41;</span>
EVENTS_END

    <span style="color: #008000;">//message handler of dialog events</span>
    <span style="color: #0000ff;">BOOL</span>    OnInitDialog<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
    <span style="color: #0000ff;">BOOL</span>    OnDraw<span style="color: #000000;">&#40;</span>Control ctrl<span style="color: #000000;">&#41;</span>;
    
<span style="color: #0000ff;">private</span><span style="color: #000000;">:</span>
    <span style="color: #008000;">//member stands for the preview control</span>
    MyPreviewCtrl       m_Preview;
<span style="color: #000000;">&#125;</span>;

<span style="color: #0000ff;">BOOL</span> MyGraphPreviewDlg<span style="color: #000000;">::</span><span style="color: #000000;">OnInitDialog</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	m_Preview.<span style="color: #000000;">Init</span><span style="color: #000000;">&#40;</span>IDC_FB_BOX, <span style="color: #000040;">*</span><span style="color: #0000ff;">this</span><span style="color: #000000;">&#41;</span>;
	Button btn <span style="color: #000080;">=</span> GetItem<span style="color: #000000;">&#40;</span>IDC_LOAD<span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> btn <span style="color: #000000;">&#41;</span>
		btn.<span style="color: #000000;">Text</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;Draw&quot;</span>;
	<span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span>;
<span style="color: #000000;">&#125;</span>

<span style="color: #0000ff;">BOOL</span> MyGraphPreviewDlg<span style="color: #000000;">::</span><span style="color: #000000;">OnDraw</span><span style="color: #000000;">&#40;</span>Control ctrl<span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	vector vecX, vecY;
	vecX.<span style="color: #000000;">Data</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">10.0</span>, <span style="color: #0000dd;">0.5</span><span style="color: #000000;">&#41;</span>;
	vecY.<span style="color: #000000;">SetSize</span><span style="color: #000000;">&#40;</span>vecX.<span style="color: #000000;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;	
	<span style="color: #0000ff;">for</span><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">int</span> ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; ii <span style="color: #000080;">&lt;</span> vecX.<span style="color: #000000;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; <span style="color: #000040;">++</span>ii<span style="color: #000000;">&#41;</span>
		vecY<span style="color: #000000;">&#91;</span>ii<span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> rnd<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
	
	m_Preview.<span style="color: #000000;">Update</span><span style="color: #000000;">&#40;</span>vecX, vecY<span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span>;
<span style="color: #000000;">&#125;</span></pre>
<h2><a name="Open_the_Dialog"></a><span class="mw-headline">Open the Dialog</span></h2>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">void</span> open_preview_dlg<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	MyGraphPreviewDlg dlg;
	dlg.<span style="color: #000000;">DoModalEx</span><span style="color: #000000;">&#40;</span>GetWindow<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">return</span>;
<span style="color: #000000;">&#125;</span></pre>
<p>Execute the function above, and click the <b>Draw</b> button.  You will notice the preview be updated.
</p>





