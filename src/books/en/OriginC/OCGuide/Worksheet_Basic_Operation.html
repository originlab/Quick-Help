<h1 class="firstHeading">1.6.3.1 Worksheet Basic Operation</h1><p>The basic worksheet operations include  adding worksheet to workbook, activating a worksheet, getting and setting worksheet properties, deleting worksheet, etc. Some practical examples are provided below.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Add_New_Worksheet"><span class="tocnumber">1</span> <span class="toctext">Add New Worksheet</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Activate_a_Worksheet"><span class="tocnumber">2</span> <span class="toctext">Activate a Worksheet</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Delete_Worksheet"><span class="tocnumber">3</span> <span class="toctext">Delete Worksheet</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Access_Worksheets_in_WorkbookWorkbook.2C_Get_One_SheetWorkbook.2C_Get_Name"><span class="tocnumber">4</span> <span class="toctext">Access Worksheets in Workbook<span class="OIndex" style="display:none">Workbook, Get One Sheet</span><span class="OIndex" style="display:none">Workbook, Get Name</span></span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Reorder_Worksheets"><span class="tocnumber">5</span> <span class="toctext">Reorder Worksheets</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Copy_Worksheet"><span class="tocnumber">6</span> <span class="toctext">Copy Worksheet</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Format_a_Worksheet"><span class="tocnumber">7</span> <span class="toctext">Format a Worksheet</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Merge_CellsWorksheet.2C_Merge_Cells"><span class="tocnumber">8</span> <span class="toctext">Merge Cells<span class="OIndex" style="display:none">Worksheet, Merge Cells</span></span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Read_Only_Cells"><span class="tocnumber">9</span> <span class="toctext">Read Only Cells</span></a></li>
</ul>
</div>

<h2><a name="Add_New_Worksheet"></a><span class="mw-headline">Add New Worksheet</span></h2>
<p><span class="OIndex" style="display:none">Workbook, Add One Sheet</span><span class="OIndex" style="display:none">Workbook, Activate a Sheet</span>Add a worksheet to a workbook using the <a href="../../OriginC/OriginC/Page-AddLayer.html" title="OriginC:Page-AddLayer">AddLayer</a> method.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Access the workbook named &quot;Book1&quot;</span>
WorksheetPage wksPage<span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Book1&quot;</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Add a new sheet to the workbook</span>
<span style="color: #0000ff;">int</span> index <span style="color: #000080;">=</span> wksPage.<span style="color: #000000;">AddLayer</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;New Sheet&quot;</span><span style="color: #000000;">&#41;</span>; 

<span style="color: #008000;">// Access the new worksheet</span>
Worksheet wksNew <span style="color: #000080;">=</span> wksPage.<span style="color: #000000;">Layers</span><span style="color: #000000;">&#40;</span>index<span style="color: #000000;">&#41;</span>;</pre>
<h2><a name="Activate_a_Worksheet"></a><span class="mw-headline">Activate a Worksheet</span></h2>
<p><span class="OIndex" style="display:none">Active Worksheet</span><span class="OIndex" style="display:none">Active Window</span><span class="OIndex" style="display:none">Active Workbook</span><span class="OIndex" style="display:none">Active Matrixbook</span><span class="OIndex" style="display:none">Active Column</span><a href="../../OriginC/Category/Workbooks.html" title="Category:Workbooks">Workbook</a> is an Origin object that contains worksheets. To make a worksheet in workbook to be activated, the function <a href="../../OriginC/OriginC/Set_active_layer_(global_function).html" title="OriginC:Set active layer (global function)">set_active_layer</a> can be used.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Access a worksheet by full name</span>
Worksheet wks<span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;[Book1]Sheet1&quot;</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Set this worksheet to be active</span>
set_active_layer<span style="color: #000000;">&#40;</span>wks<span style="color: #000000;">&#41;</span>;</pre>
<h2><a name="Delete_Worksheet"></a><span class="mw-headline">Delete Worksheet</span></h2>
<p><span class="OIndex" style="display:none">Delete Worksheet</span>
<span class="OIndex" style="display:none">Workbook, Delete One Sheet</span>Use the <a href="../../OriginC/OriginC/OriginObject-Destroy.html" title="OriginC:OriginObject-Destroy">Destroy</a> method to delete a worksheet.
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> wks <span style="color: #000000;">&#41;</span> <span style="color: #008000;">// If the active layer is a worksheet</span>
    wks.<span style="color: #000000;">Destroy</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">// Delete the worksheet</span></pre>
<h2><a name="Access_Worksheets_in_WorkbookWorkbook.2C_Get_One_SheetWorkbook.2C_Get_Name"></a><span class="mw-headline">Access Worksheets in Workbook<span class="OIndex" style="display:none">Workbook, Get One Sheet</span><span class="OIndex" style="display:none">Workbook, Get Name</span></span></h2>
<p>There are two ways to access a worksheet by its name.  You can pass the layer's full name to the constructor or to the Attach method.  The layer's full name contains the page name in square brackets followed by the layer name.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Assume wksPage is a valid WorksheetPage holding the sheet we want to access.</span>
string strFullName <span style="color: #000080;">=</span> okutil_make_book_sheet_string<span style="color: #000000;">&#40;</span>wksPage.<span style="color: #000000;">GetName</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, <span style="color: #ff00ff;">&quot;Sheet1&quot;</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// If book and sheet name are known, the string can be constructed manually.</span>
string strFullName <span style="color: #000080;">=</span> okutil_make_book_sheet_string<span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Book5&quot;</span>, <span style="color: #ff00ff;">&quot;Sheet1&quot;</span><span style="color: #000000;">&#41;</span>;</pre>
<p>With the full layer name we can now access the worksheet.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Construct a new Worksheet instance and attach it to the named sheet.</span>
Worksheet wks1<span style="color: #000000;">&#40;</span>strFullName<span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Attach an existing Worksheet instance to the named sheet.</span>
wks2.<span style="color: #000000;">Attach</span><span style="color: #000000;">&#40;</span>strFullName<span style="color: #000000;">&#41;</span>;</pre>
<p><span class="OIndex" style="display:none">Worksheet, Get Sheet Name</span>A workbook contains a collection of worksheets.  You can loop through all the worksheets in a specified workbook using the <b>foreach</b> statement.
</p>
<pre class="oc" style="font-family:monospace;">WorksheetPage wksPage<span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Book1&quot;</span><span style="color: #000000;">&#41;</span>;
foreach<span style="color: #000000;">&#40;</span>Layer wks in wksPage.<span style="color: #000000;">Layers</span><span style="color: #000000;">&#41;</span>
    out_str<span style="color: #000000;">&#40;</span>wks.<span style="color: #000000;">GetName</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</pre>
<p>You can also access a specified worksheet by its name or index.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">//assume there are at least two worksheets on the page Book1,</span>
<span style="color: #008000;">//and they are named Sheet1 and Sheet2 separately.</span>
WorksheetPage wksPage<span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Book1&quot;</span><span style="color: #000000;">&#41;</span>;
Worksheet wksFirst <span style="color: #000080;">=</span> wksPage.<span style="color: #000000;">Layers</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">//by index</span>
Worksheet wksSecond <span style="color: #000080;">=</span> wksPage.<span style="color: #000000;">Layers</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Sheet2&quot;</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">//by name</span></pre>
<h2><a name="Reorder_Worksheets"></a><span class="mw-headline">Reorder Worksheets</span></h2>
<p><span class="OIndex" style="display:none">Workbook, Reorder Sheets</span><span class="OIndex" style="display:none">Workbook, Get Page from Layer</span>The <a href="../../OriginC/OriginC/Worksheet-Reorder.html" title="OriginC:Worksheet-Reorder">Reorder</a> method allows you to change the position of a worksheet in a workbook.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// This example assumes the active workbook contains two sheets</span>

<span style="color: #008000;">// Get the active page from the active layer</span>
WorksheetPage wksPage;
Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> wks <span style="color: #000000;">&#41;</span>
    wksPage <span style="color: #000080;">=</span> wks.<span style="color: #000000;">GetPage</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Move the 2nd worksheet to the 1st position</span>
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> wksPage.<span style="color: #000000;">Reorder</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span>
    out_str<span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Reorder sheets successfully&quot;</span><span style="color: #000000;">&#41;</span>;</pre>
<h2><a name="Copy_Worksheet"></a><span class="mw-headline">Copy Worksheet</span></h2>
<p><span class="OIndex" style="display:none">Worksheet, Copy</span><span class="OIndex" style="display:none">Matrix Sheet, Copy</span><span class="OIndex" style="display:none">Graph Layer, Copy</span><span class="OIndex" style="display:none">Worksheet, Merge All Sheets</span>The <a href="../../OriginC/OriginC/Page-AddLayer.html" title="OriginC:Page-AddLayer">AddLayer</a> method is used to copy a layer from one page to another, and can be used with GraphPage, WorksheetPage or MatrixPage. 
</p><p>The following example shows how to drag all worksheets from the active folder to merge into the active workbook.
</p>
<pre class="oc" style="font-family:monospace;">WorksheetPage wksPageDest <span style="color: #000080;">=</span> Project.<span style="color: #000000;">Pages</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> <span style="color: #000040;">!</span>wksPageDest <span style="color: #000000;">&#41;</span> <span style="color: #008000;">// no active window or active window is not a worksheet</span>
	<span style="color: #0000ff;">return</span>; 

<span style="color: #0000ff;">bool</span> bKeepSourceLayer <span style="color: #000080;">=</span> <span style="color: #0000ff;">false</span>; <span style="color: #008000;">// delete source layer after copying</span>
Folder fld <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveFolder</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; 
foreach<span style="color: #000000;">&#40;</span>PageBase pb in fld.<span style="color: #000000;">Pages</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
    WorksheetPage wbSource<span style="color: #000000;">&#40;</span>pb<span style="color: #000000;">&#41;</span>;
    <span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span><span style="color: #000040;">!</span>wbSource<span style="color: #000000;">&#41;</span>
        <span style="color: #0000ff;">continue</span>;<span style="color: #008000;">//not a workbook</span>
    
    <span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span>wbSource.<span style="color: #000000;">GetName</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">==</span> wksPageDest.<span style="color: #000000;">GetName</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>
        <span style="color: #0000ff;">continue</span>;<span style="color: #008000;">//skip our destination book</span>
    
    <span style="color: #008000;">// copy worksheet to destination book and delete it from source book</span>
    foreach<span style="color: #000000;">&#40;</span>Layer lay in wbSource.<span style="color: #000000;">Layers</span><span style="color: #000000;">&#41;</span>
    <span style="color: #000000;">&#123;</span>
        Worksheet wks <span style="color: #000080;">=</span> lay;
        wksPageDest.<span style="color: #000000;">AddLayer</span><span style="color: #000000;">&#40;</span>wks, <span style="color: #0000dd;">0</span>, bKeepSourceLayer<span style="color: #000000;">&#41;</span>;
    <span style="color: #000000;">&#125;</span>
    wbSource.<span style="color: #000000;">Destroy</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;<span style="color: #008000;">// destroy the empty workbook</span>
<span style="color: #000000;">&#125;</span></pre>
<h2><a name="Format_a_Worksheet"></a><span class="mw-headline">Format a Worksheet</span></h2>
<p><span class="OIndex" style="display:none">Worksheet, Set Format on the Specific Range</span><span class="OIndex" style="display:none">Worksheet, Fill Color</span><span class="OIndex" style="display:none">Worksheet, Text Font</span><span class="OIndex" style="display:none">Worksheet, Text Color</span><span class="OIndex" style="display:none">Worksheet, Alignment</span>A worksheet can be formatted programmatically using a theme tree.  The example below demonstrates obtaining and saving an existing theme tree:
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// get format tree from worksheet</span>
Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;

Tree tr;	
tr <span style="color: #000080;">=</span> wks.<span style="color: #000000;">GetFormat</span><span style="color: #000000;">&#40;</span>FPB_ALL, FOB_ALL, <span style="color: #0000ff;">TRUE</span>, <span style="color: #0000ff;">TRUE</span><span style="color: #000000;">&#41;</span>;	
out_tree<span style="color: #000000;">&#40;</span>tr<span style="color: #000000;">&#41;</span>; <span style="color: #008000;">// Output tree to Script window</span></pre>
<p><span class="OIndex" style="display:none">Worksheet, Put Text to Cell</span>Or, you may construct a theme tree as in the following three steps.  First, create a worksheet and insert some data:
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Create worksheet</span>
Worksheet wks;
wks.<span style="color: #000000;">Create</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Origin&quot;</span><span style="color: #000000;">&#41;</span>;	
wks.<span style="color: #000000;">SetCell</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, <span style="color: #ff00ff;">&quot;abc&quot;</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">// Put text to (0, 0) cell</span>

<span style="color: #008000;">// Establish data range to apply formatting:</span>
DataRange dr;
<span style="color: #0000ff;">int</span> r1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>, c1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>, r2 <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>, c2 <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;	
dr.<span style="color: #000000;">Add</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Range1&quot;</span>, wks, r1, c1, r2, c2<span style="color: #000000;">&#41;</span>;</pre>
<p>Second, construct the tree using the range information and provide values for desired properties:  
</p>
<pre class="oc" style="font-family:monospace;">Tree tr;

<span style="color: #008000;">// Fill color</span>
tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">CommonStyle</span>.<span style="color: #000000;">Fill</span>.<span style="color: #000000;">FillColor</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> SYSCOLOR_LTCYAN; 

<span style="color: #008000;">// Alignment of text in cell, 2 for center</span>
tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">CommonStyle</span>.<span style="color: #000000;">Alignment</span>.<span style="color: #000000;">Horizontal</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;

<span style="color: #008000;">// The font size of text</span>
tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">CommonStyle</span>.<span style="color: #000000;">Font</span>.<span style="color: #000000;">Size</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">11</span>;

<span style="color: #008000;">// The color of text</span>
tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">CommonStyle</span>.<span style="color: #000000;">Color</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> SYSCOLOR_BLUE;</pre>
<p>Third, apply the formatting to the data range:
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Apply the format to the specified data range</span>
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> <span style="color: #0000dd;">0</span> <span style="color: #000080;">==</span> dr.<span style="color: #000000;">UpdateThemeIDs</span><span style="color: #000000;">&#40;</span>tr.<span style="color: #000000;">Root</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span> <span style="color: #008000;">// Returns 0 for no error</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #0000ff;">bool</span> bRet <span style="color: #000080;">=</span> dr.<span style="color: #000000;">ApplyFormat</span><span style="color: #000000;">&#40;</span>tr, <span style="color: #0000ff;">true</span>, <span style="color: #0000ff;">true</span><span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span></pre>
<h2><a name="Merge_CellsWorksheet.2C_Merge_Cells"></a><span class="mw-headline">Merge Cells<span class="OIndex" style="display:none">Worksheet, Merge Cells</span></span></h2>
<p>We can use Origin C code to <a href="../../OriginC/OriginC/Grid-MergeCells.html" title="OriginC:Grid-MergeCells">merge Worksheet cells</a> with the specified range. The selected range can be data area or column label area. If you want to merge label cells, just change <i>bLabels</i> to <b>true</b> in the following code.
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks;
wks.<span style="color: #000000;">Create</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Origin&quot;</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">//Define a Grid and attach it to the worksheet</span>
Grid gg;
gg.<span style="color: #000000;">Attach</span><span style="color: #000000;">&#40;</span>wks<span style="color: #000000;">&#41;</span>; 

<span style="color: #008000;">// to merge the first two rows in two columns</span>
ORANGE rng;
rng.<span style="color: #000000;">r1</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
rng.<span style="color: #000000;">c1</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
rng.<span style="color: #000000;">r2</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
rng.<span style="color: #000000;">c2</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;

<span style="color: #0000ff;">bool</span> bLabels <span style="color: #000080;">=</span> <span style="color: #0000ff;">false</span>;
<span style="color: #0000ff;">bool</span> bRet <span style="color: #000080;">=</span> gg.<span style="color: #000000;">MergeCells</span><span style="color: #000000;">&#40;</span>rng, bLabels<span style="color: #000000;">&#41;</span>;

<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> bRet <span style="color: #000000;">&#41;</span>
	<span style="color: #000000;">printf</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Successfully merged cells in&#160;%s!<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span>, wks.<span style="color: #000000;">GetName</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
<span style="color: #0000ff;">else</span>
	<span style="color: #000000;">printf</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Failed to merge cells in&#160;%s!<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span>, wks.<span style="color: #000000;">GetName</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;</pre>
<h2><a name="Read_Only_Cells"></a><span class="mw-headline">Read Only Cells</span></h2>
<p>If you don't want the contents in a cell of worksheet to be changed, you can set the cells to be read-only by using theme tree. 
</p><p>The example below shows how to set the data cells in worksheet to be read-only, and then change the second data cell in column 1 to be editable.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Create a worksheet by using default template (Origin)</span>
<span style="color: #008000;">// so to make sure that Long Name, Units, and Comments rows are shown</span>
Worksheet wks;
wks.<span style="color: #000000;">Create</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Origin&quot;</span><span style="color: #000000;">&#41;</span>;

Tree tr;
tr <span style="color: #000080;">=</span> wks.<span style="color: #000000;">GetFormat</span><span style="color: #000000;">&#40;</span>FPB_ALL, FOB_ALL, <span style="color: #0000ff;">true</span>, <span style="color: #0000ff;">true</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Get theme tree of worksheet</span>

<span style="color: #008000;">// Start to get the specific tree node from the theme tree</span>
<span style="color: #008000;">// to set the read-only format for the data cells</span>
string strName <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;ogData&quot;</span>;  <span style="color: #008000;">// Use to get the node with the desired format</span>
TreeNode trGrid, trNameStyles;
trGrid <span style="color: #000080;">=</span> tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">Grid</span>;  <span style="color: #008000;">// Get Grid node</span>
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span><span style="color: #000040;">!</span>trGrid.<span style="color: #000000;">IsValid</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>
	<span style="color: #0000ff;">return</span>;

<span style="color: #008000;">// Read-only format is under some child node of this node</span>
trNameStyles <span style="color: #000080;">=</span> trGrid.<span style="color: #000000;">NameStyles</span>;  
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span><span style="color: #000040;">!</span>trNameStyles.<span style="color: #000000;">IsValid</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>
	<span style="color: #0000ff;">return</span>;

TreeNode trNameStyle;
<span style="color: #0000ff;">bool</span> bRet <span style="color: #000080;">=</span> <span style="color: #0000ff;">false</span>;
<span style="color: #008000;">// Loop all children nodes to find out the desired tree node</span>
foreach<span style="color: #000000;">&#40;</span>trNameStyle in trNameStyles.<span style="color: #000000;">Children</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #008000;">// Find the node with &quot;ogData&quot;</span>
	<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span> <span style="color: #000080;">==</span> trNameStyle.<span style="color: #000000;">Name</span>.<span style="color: #000000;">strVal</span>.<span style="color: #000000;">Compare</span><span style="color: #000000;">&#40;</span>strName<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>  
	<span style="color: #000000;">&#123;</span>
		bRet <span style="color: #000080;">=</span> <span style="color: #0000ff;">true</span>;
		<span style="color: #0000ff;">break</span>;
	<span style="color: #000000;">&#125;</span>
<span style="color: #000000;">&#125;</span>
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span><span style="color: #000040;">!</span>bRet<span style="color: #000000;">&#41;</span>
	<span style="color: #0000ff;">return</span>;

trNameStyle.<span style="color: #000000;">Style</span>.<span style="color: #000000;">ReadOnly</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  <span style="color: #008000;">// Set all data cells to be read-only</span>

<span style="color: #008000;">// Start to get/create the specific tree node from the theme tree</span>
<span style="color: #008000;">// to cancel the read-only format for the specified data cell</span>
TreeNode trRangeStyles;
trRangeStyles <span style="color: #000080;">=</span> trGrid.<span style="color: #000000;">RangeStyles</span>;  <span style="color: #008000;">// Get RangeStyles node from Grid node</span>
TreeNode trRangeStyle;
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span><span style="color: #000040;">!</span>trRangeStyles.<span style="color: #000000;">IsValid</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>  <span style="color: #008000;">// If RangeStyles node does not exist yet</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #008000;">// Create RangeStyles node</span>
	trRangeStyles <span style="color: #000080;">=</span> trGrid.<span style="color: #000000;">AddNode</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;RangeStyles&quot;</span><span style="color: #000000;">&#41;</span>;
	<span style="color: #008000;">// And create a sub node named RangeStyle1</span>
	trRangeStyle <span style="color: #000080;">=</span> trRangeStyles.<span style="color: #000000;">AddNode</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;RangeStyle1&quot;</span><span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span>
<span style="color: #0000ff;">else</span>  <span style="color: #008000;">// If RangeStyles node already exist</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #008000;">// Find how many children nodes</span>
	<span style="color: #0000ff;">int</span> tagNum <span style="color: #000080;">=</span> trRangeStyles.<span style="color: #000000;">Children</span>.<span style="color: #000000;">Count</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
	<span style="color: #008000;">// And create a sub node name RangeStyle#, # = tagNum+1</span>
	trRangeStyle <span style="color: #000080;">=</span> trRangeStyles.<span style="color: #000000;">AddNode</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;RangeStyle&quot;</span><span style="color: #000040;">+</span><span style="color: #000000;">&#40;</span>tagNum<span style="color: #000040;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span>
<span style="color: #008000;">// Define the range for setting, here range is just one cell</span>
<span style="color: #008000;">// Left cell of the range, start from 1</span>
trRangeStyle.<span style="color: #000000;">Left</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;  
<span style="color: #008000;">// Top cell of the range, start from 5, including label rows</span>
<span style="color: #008000;">// there are 4 label rows, then 5 means the first data cell</span>
trRangeStyle.<span style="color: #000000;">Top</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">5</span>;  
<span style="color: #008000;">// Just one cell, so right of the range is the same with left</span>
trRangeStyle.<span style="color: #000000;">Right</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
<span style="color: #008000;">// Just one cell, so bottom of the range is the same with top</span>
trRangeStyle.<span style="color: #000000;">Bottom</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">5</span>;
trRangeStyle.<span style="color: #000000;">Style</span>.<span style="color: #000000;">ReadOnly</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;  <span style="color: #008000;">// Set read-only to 0 to cancel it</span>

<span style="color: #008000;">// Apply the setting format to worksheet</span>
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span> <span style="color: #000080;">==</span> wks.<span style="color: #000000;">UpdateThemeIDs</span><span style="color: #000000;">&#40;</span>tr.<span style="color: #000000;">Root</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #0000ff;">bool</span> bb <span style="color: #000080;">=</span> wks.<span style="color: #000000;">ApplyFormat</span><span style="color: #000000;">&#40;</span>tr, <span style="color: #0000ff;">true</span>, <span style="color: #0000ff;">true</span><span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span>bb<span style="color: #000000;">&#41;</span>
	<span style="color: #000000;">&#123;</span>
		<span style="color: #000000;">printf</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Cell 1 in column 1 is editable.<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span><span style="color: #000000;">&#41;</span>;
	<span style="color: #000000;">&#125;</span>
<span style="color: #000000;">&#125;</span></pre>
<p>It is also able to set the Read-Only format for the cells in label rows. We can just make some simple changes on the code above. For example, we are going to make the Comments row to be read-only except the one in column 2, then the corresponding changes are like below.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000; font-style: regular;">/* Comment out the line below in the above code
string strName = &quot;ogData&quot;;
*/</span>
<span style="color: #008000;">// This line is for the Data, just change it for Comments, as following</span>
string strName <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;ogComment&quot;</span>;

<span style="color: #008000; font-style: regular;">/* Comment out the following 4 lines in the above code
trRangeStyle.Left.nVal = 1; 
trRangeStyle.Top.nVal = 5;
trRangeStyle.Right.nVal = 1;
trRangeStyle.Bottom.nVal = 5;
*/</span>
<span style="color: #008000;">// These 4 lines are used to set for the second data </span>
<span style="color: #008000;">// cell (assume 3 label rows displayed in worksheet)</span>
<span style="color: #008000;">// Now we need to set for the Comments cell, </span>
<span style="color: #008000;">// assume the Comments row is the third row, </span>
<span style="color: #008000;">// and is for column 2, but not column 1 anymore, then</span>
trRangeStyle.<span style="color: #000000;">Left</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> 
trRangeStyle.<span style="color: #000000;">Right</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// Column 2</span>
<span style="color: #008000;">// Comments row (the third row displayed in worksheet)</span>
trRangeStyle.<span style="color: #000000;">Top</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> 
trRangeStyle.<span style="color: #000000;">Bottom</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;</pre>






