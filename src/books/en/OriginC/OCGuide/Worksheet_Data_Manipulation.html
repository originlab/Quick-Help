<h1 class="firstHeading">1.6.3.2 Worksheet Data Manipulation</h1><p>In this section we present examples of how to manipulate worksheet data by Origin C.
<span class="OIndex" style="display:none">worksheet</span>
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Get_Worksheet_SelectionWorksheet.2C_Get_SelectionWorksheet.2C_Get_Data_from_Specified_Data_Range"><span class="tocnumber">1</span> <span class="toctext">Get Worksheet Selection<span class="OIndex" style="display:none">Worksheet, Get Selection</span><span class="OIndex" style="display:none">Worksheet, Get Data from Specified Data Range</span></span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Set_Display_Range_in_WorksheetWorksheet.2C_Set_Display_Range"><span class="tocnumber">2</span> <span class="toctext">Set Display Range in Worksheet<span class="OIndex" style="display:none">Worksheet, Set Display Range</span></span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Put_Large_Dataset_to_WorksheetWorksheet.2C_Put_Large_Dataset_toWorksheet.2C_Delete_All_ColumnsColumn.2C_Access_Data_Buffer"><span class="tocnumber">3</span> <span class="toctext">Put Large Dataset to Worksheet<span class="OIndex" style="display:none">Worksheet, Put Large Dataset to</span><span class="OIndex" style="display:none">Worksheet, Delete All Columns</span><span class="OIndex" style="display:none">Column, Access Data Buffer</span></span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Access_Embedded_Graph_in_a_WorksheetWorksheet.2C_Embedded_Graph"><span class="tocnumber">4</span> <span class="toctext">Access Embedded Graph in a Worksheet<span class="OIndex" style="display:none">Worksheet, Embedded Graph</span></span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Sort_Worksheet_DataWorksheet.2C_Sorting_Data"><span class="tocnumber">5</span> <span class="toctext">Sort Worksheet Data<span class="OIndex" style="display:none">Worksheet, Sorting Data</span></span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Mask_Worksheet_DataWorksheet.2C_Masking_DataWorksheet.2C_Find_Data"><span class="tocnumber">6</span> <span class="toctext">Mask Worksheet Data<span class="OIndex" style="display:none">Worksheet, Masking Data</span><span class="OIndex" style="display:none">Worksheet, Find Data</span></span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Set_Size"><span class="tocnumber">7</span> <span class="toctext">Set Size</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Reduce_Worksheet_Data"><span class="tocnumber">8</span> <span class="toctext">Reduce Worksheet Data</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Extract_Data_from_Worksheet_with_LT_ConditionWorksheet.2C_Extract_Data"><span class="tocnumber">9</span> <span class="toctext">Extract Data from Worksheet with LT Condition<span class="OIndex" style="display:none">Worksheet, Extract Data</span></span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#Compare_Data_in_Two_WorksheetsWorksheet.2C_Compare_Data"><span class="tocnumber">10</span> <span class="toctext">Compare Data in Two Worksheets<span class="OIndex" style="display:none">Worksheet, Compare Data</span></span></a></li>
</ul>
</div>

<h2><a name="Get_Worksheet_SelectionWorksheet.2C_Get_SelectionWorksheet.2C_Get_Data_from_Specified_Data_Range"></a><span class="mw-headline">Get Worksheet Selection<span class="OIndex" style="display:none">Worksheet, Get Selection</span><span class="OIndex" style="display:none">Worksheet, Get Data from Specified Data Range</span></span></h2>
<p><a href="../../OriginC/OriginC/Worksheet-GetSelectedRange.html" title="OriginC:Worksheet-GetSelectedRange">Worksheet::GetSelectedRange</a> can be used to get one or multiple selected data ranges from a worksheet. The following code shows how to get data from one column by worksheet selection. This function returns range type, like one column, one row, whole worksheet, etc.
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;

<span style="color: #0000ff;">int</span> r1, c1, r2, c2;
<span style="color: #0000ff;">int</span> nRet <span style="color: #000080;">=</span> wks.<span style="color: #000000;">GetSelectedRange</span><span style="color: #000000;">&#40;</span>r1, c1, r2, c2<span style="color: #000000;">&#41;</span>;

<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> WKS_SEL_ONE_COL <span style="color: #000040;">&amp;</span> nRet <span style="color: #000000;">&#41;</span> <span style="color: #008000;">// exactly one column selected</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #008000;">// construct a data range object by selection</span>
	DataRange dr;
	dr.<span style="color: #000000;">Add</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;X&quot;</span>, wks, r1, c1, r2, c2<span style="color: #000000;">&#41;</span>;
	
	<span style="color: #008000;">// get data from the selected column</span>
	vector vData;
	dr.<span style="color: #000000;">GetData</span><span style="color: #000000;">&#40;</span><span style="color: #000040;">&amp;</span>vData, <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span></pre>
<h2><a name="Set_Display_Range_in_WorksheetWorksheet.2C_Set_Display_Range"></a><span class="mw-headline">Set Display Range in Worksheet<span class="OIndex" style="display:none">Worksheet, Set Display Range</span></span></h2>
<p>If you want to set a display range in a Worksheet, you can use <a href="../../OriginC/OriginC/Worksheet-SetBounds.html" title="OriginC:Worksheet-SetBounds">Worksheet::SetBounds</a>, and it is the same as using the Set As Begin/End menu. 
</p><p>The following code shows how to set a beginning and end for all columns in the current worksheet window.
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// the beginning and end of rows	</span>
<span style="color: #0000ff;">int</span> begin <span style="color: #000080;">=</span> <span style="color: #0000dd;">9</span>, end <span style="color: #000080;">=</span> <span style="color: #0000dd;">19</span>;

<span style="color: #008000;">// set beginning and end for all columns</span>
<span style="color: #0000ff;">int</span> c1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>, c2 <span style="color: #000080;">=</span> <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">// -1 means end</span>

wks.<span style="color: #000000;">SetBounds</span><span style="color: #000000;">&#40;</span>begin, c1, end, c2<span style="color: #000000;">&#41;</span>;</pre>
<h2><a name="Put_Large_Dataset_to_WorksheetWorksheet.2C_Put_Large_Dataset_toWorksheet.2C_Delete_All_ColumnsColumn.2C_Access_Data_Buffer"></a><span class="mw-headline">Put Large Dataset to Worksheet<span class="OIndex" style="display:none">Worksheet, Put Large Dataset to</span><span class="OIndex" style="display:none">Worksheet, Delete All Columns</span><span class="OIndex" style="display:none">Column, Access Data Buffer</span></span></h2>
<p>In order to keep an Origin C function running efficiently when working with a large data set (e.g. 1000 columns) in a worksheet, use the steps below.
</p>
<ul><li> Prepare the columns and rows before putting data into the worksheet. </li>
<li> Use <a href="../../OriginC/OriginC/Worksheet-SetSize.html" title="OriginC:Worksheet-SetSize">Worksheet::SetSize</a>, don't use <a href="../../OriginC/OriginC/Worksheet-AddCol.html" title="OriginC:Worksheet-AddCol">Worksheet::AddCol</a> to set the size.</li>
<li> Set the size on an empty worksheet, meaning no columns and rows, since otherwise Origin will need to check the short names of the existing columns to avoid duplicate names when adding new columns, and this could cost you lots of time.  You can use while( wks.DeleteCol(0) ); to remove all columns to make an empty Worksheet.</li>
<li> Put data into worksheet columns by buffer, <a href="../../OriginC/OriginC/DataObject-GetInternalDataBuffer.html" title="OriginC:DataObject-GetInternalDataBuffer">DataObject::GetInternalDataBuffer</a>.</li>
<li> <span class="OIndex" style="display:none">Improve OC Execution Speed</span>Keep Code Builder closed when running functions to improve the speed of execution.</li></ul>
<p>See the following example codes:
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// prepare worksheet size</span>
Worksheet wks;
wks.<span style="color: #000000;">Create</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Origin&quot;</span><span style="color: #000000;">&#41;</span>;
<span style="color: #0000ff;">while</span><span style="color: #000000;">&#40;</span> wks.<span style="color: #000000;">DeleteCol</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span>; 
<span style="color: #0000ff;">int</span> rows <span style="color: #000080;">=</span> <span style="color: #0000dd;">100</span>, cols <span style="color: #000080;">=</span> <span style="color: #0000dd;">1000</span>;
wks.<span style="color: #000000;">SetSize</span><span style="color: #000000;">&#40;</span>rows, cols<span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// put data set into worksheet columns one by one</span>
foreach<span style="color: #000000;">&#40;</span>Column col in wks.<span style="color: #000000;">Columns</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
    col.<span style="color: #000000;">SetFormat</span><span style="color: #000000;">&#40;</span>OKCOLTYPE_NUMERIC<span style="color: #000000;">&#41;</span>;
    col.<span style="color: #000000;">SetInternalData</span><span style="color: #000000;">&#40;</span>FSI_SHORT<span style="color: #000000;">&#41;</span>;
    col.<span style="color: #000000;">SetUpperBound</span><span style="color: #000000;">&#40;</span>rows<span style="color: #000040;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;<span style="color: #008000;">//index of last row, 0 offset</span>
    
    <span style="color: #0000ff;">int</span>     nElementSize;
    uint    nNum;
    LPVOID  pData <span style="color: #000080;">=</span> col.<span style="color: #000000;">GetInternalDataBuffer</span><span style="color: #000000;">&#40;</span><span style="color: #000040;">&amp;</span>nElementSize, <span style="color: #000040;">&amp;</span>nNum<span style="color: #000000;">&#41;</span>;        
    <span style="color: #0000ff;">short</span><span style="color: #000040;">*</span> psBuff <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span><span style="color: #0000ff;">short</span><span style="color: #000040;">*</span><span style="color: #000000;">&#41;</span>pData;
    
    <span style="color: #008000;">// OC loop is still slow, but you might pass this pointer to your DLL</span>
    <span style="color: #008000;">// for much faster manipulation, here we just show that the pointer works</span>
    <span style="color: #0000ff;">for</span><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">int</span> ii <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; ii <span style="color: #000080;">&lt;</span> rows; ii<span style="color: #000040;">++</span>, psBuff<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>
    <span style="color: #000000;">&#123;</span>
        <span style="color: #000040;">*</span>psBuff <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span>ii<span style="color: #000040;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span> <span style="color: #000040;">*</span> <span style="color: #000000;">&#40;</span>col.<span style="color: #000000;">GetIndex</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000040;">+</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;
    <span style="color: #000000;">&#125;</span>
    col.<span style="color: #000000;">ReleaseBuffer</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">// do NOT forget to call this</span>
<span style="color: #000000;">&#125;</span></pre>
<h2><a name="Access_Embedded_Graph_in_a_WorksheetWorksheet.2C_Embedded_Graph"></a><span class="mw-headline">Access Embedded Graph in a Worksheet<span class="OIndex" style="display:none">Worksheet, Embedded Graph</span></span></h2>
<p>Create a new graph and a new worksheet, and then embed the graph within one of the worksheet's cells:
</p>
<pre class="oc" style="font-family:monospace;">GraphPage gp;
gp.<span style="color: #000000;">Create</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Origin&quot;</span><span style="color: #000000;">&#41;</span>;

Worksheet wks;
wks.<span style="color: #000000;">Create</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;

<span style="color: #0000ff;">int</span> nOptions <span style="color: #000080;">=</span> EMBEDGRAPH_KEEP_ASPECT_RATIO <span style="color: #000040;">|</span> EMBEDGRAPH_HIDE_LEGENDS;

<span style="color: #008000;">// Put the graph in worksheet cell (0, 0)</span>
wks.<span style="color: #000000;">EmbedGraph</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, gp, nOptions<span style="color: #000000;">&#41;</span>;</pre>
<p>Access a graph that is embedded within a worksheet; by name or by index:
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Get embedded graph from active worksheet</span>
Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;

GraphPage gp;
gp <span style="color: #000080;">=</span> wks.<span style="color: #000000;">EmbeddedPages</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">// Get embedded graph page by index</span>

gp <span style="color: #000080;">=</span> wks.<span style="color: #000000;">EmbeddedPages</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Graph1&quot;</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">// Get embedded graph page by name</span></pre>
<h2><a name="Sort_Worksheet_DataWorksheet.2C_Sorting_Data"></a><span class="mw-headline">Sort Worksheet Data<span class="OIndex" style="display:none">Worksheet, Sorting Data</span></span></h2>
<p>Perform a row-wise sort of column data with the <b>Sort</b> method.  For sorting a single column, use the <a href="../../OriginC/OriginC/Vectorbase-Sort.html" title="OriginC:Vectorbase-Sort">vectorbase::Sort</a> method:
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Sort column</span>
<span style="color: #008000;">// Before running, please keep active worksheet with two columns fill with data.</span>
<span style="color: #008000;">// For example, import \Samples\Mathematics\Sine Curve.dat to worksheet.</span>
Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
Column colY<span style="color: #000000;">&#40;</span>wks, <span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>; <span style="color: #008000;">// Y column</span>

<span style="color: #008000;">// After sort, the original relation for (x, y) will be broken.</span>
vectorbase<span style="color: #000040;">&amp;</span> vec <span style="color: #000080;">=</span> colY.<span style="color: #000000;">GetDataObject</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
vec.<span style="color: #000000;">Sort</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</pre>
<p>To sort all columns in a worksheet, use the <a href="../../OriginC/OriginC/Worksheet-Sort.html" title="OriginC:Worksheet-Sort">Worksheet::Sort</a> method:
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Sort worksheet</span>
<span style="color: #008000;">// Before running, please keep active worksheet with two columns fill with data.</span>
<span style="color: #008000;">// For example, import \Samples\Mathematics\Sine Curve.dat to worksheet.</span>
Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
 
<span style="color: #0000ff;">int</span> nCol <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>; <span style="color: #008000;">// Ascending sort all worksheet data on the second column</span>
<span style="color: #0000ff;">BOOL</span> bIsAscending <span style="color: #000080;">=</span> <span style="color: #0000ff;">true</span>;
<span style="color: #0000ff;">BOOL</span> bMissingValuesSmall <span style="color: #000080;">=</span> <span style="color: #0000ff;">TRUE</span>; <span style="color: #008000;">// Treat missing value as smallest</span>
<span style="color: #0000ff;">int</span> r1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>, c1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>, r2 <span style="color: #000080;">=</span> <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>, c2 <span style="color: #000080;">=</span> <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">// -1 means end for r2 and c2</span>
 
<span style="color: #008000;">// After sort, each (x, y) still keep the original relation</span>
wks.<span style="color: #000000;">Sort</span><span style="color: #000000;">&#40;</span>nCol, bIsAscending, bMissingValuesSmall, r1, c1, r2, c2<span style="color: #000000;">&#41;</span>;</pre>
<h2><a name="Mask_Worksheet_DataWorksheet.2C_Masking_DataWorksheet.2C_Find_Data"></a><span class="mw-headline">Mask Worksheet Data<span class="OIndex" style="display:none">Worksheet, Masking Data</span><span class="OIndex" style="display:none">Worksheet, Find Data</span></span></h2>
<p>The following code shows how to set a mask on the rows of data that are less than or equal to 0 for the specified column.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">int</span> nCol <span style="color: #000080;">=</span> <span style="color: #0000dd;">1</span>;
Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
Column col<span style="color: #000000;">&#40;</span>wks, nCol<span style="color: #000000;">&#41;</span>;
vector vData <span style="color: #000080;">=</span> col.<span style="color: #000000;">GetDataObject</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// to find all less than and equal 0 and return row index</span>
vector<span style="color: #000080;">&lt;</span>uint<span style="color: #000080;">&gt;</span> vnRowIndex;
vData.<span style="color: #000000;">Find</span><span style="color: #000000;">&#40;</span>MATREPL_TEST_LESSTHAN <span style="color: #000040;">|</span> MATREPL_TEST_EQUAL, <span style="color: #0000dd;">0</span>, vnRowIndex<span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// construct a range including multiple subranges added by row and column index</span>
DataRange dr;
<span style="color: #0000ff;">for</span><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">int</span> nn <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; nn <span style="color: #000080;">&lt;</span> vnRowIndex.<span style="color: #000000;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; nn<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #0000ff;">int</span> r1, c1, r2, c2;
	r1 <span style="color: #000080;">=</span> r2 <span style="color: #000080;">=</span> vnRowIndex<span style="color: #000000;">&#91;</span>nn<span style="color: #000000;">&#93;</span>;
	c1 <span style="color: #000080;">=</span> c2 <span style="color: #000080;">=</span> nCol;
	dr.<span style="color: #000000;">Add</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;X&quot;</span>, wks, r1, c1, r2, c2<span style="color: #000000;">&#41;</span>; 		
<span style="color: #000000;">&#125;</span>

<span style="color: #008000;">// set mask on data range</span>
dr.<span style="color: #000000;">SetMask</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;</pre>
<h2><a name="Set_Size"></a><span class="mw-headline">Set Size</span></h2>
<p>The <a href="../../OriginC/OriginC/Worksheet-SetSize.html" title="OriginC:Worksheet-SetSize">Worksheet::SetSize</a> method is used to set the number of rows and columns in a worksheet.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Set the number of rows and columns, and data will be kept.</span>
<span style="color: #008000;">// If want to add a lots of columns and rows at once time, better use SetSize</span>
<span style="color: #0000ff;">int</span> nNumRows <span style="color: #000080;">=</span> <span style="color: #0000dd;">100</span>;
<span style="color: #0000ff;">int</span> nNumCols <span style="color: #000080;">=</span> <span style="color: #0000dd;">20</span>;
wks.<span style="color: #000000;">SetSize</span><span style="color: #000000;">&#40;</span>nNumRows, nNumCols<span style="color: #000000;">&#41;</span>; 
<span style="color: #008000;">// If want to change the number of rows but keep the number of columns,</span>
<span style="color: #008000;">// can use -1 replace. For example:</span>
wks.<span style="color: #000000;">SetSize</span><span style="color: #000000;">&#40;</span>nNumRows, <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>; 
<span style="color: #008000;">// The same usage also used to change column number and keep row number.</span></pre>
<h2><a name="Reduce_Worksheet_Data"></a><span class="mw-headline">Reduce Worksheet Data</span></h2>
<p><span class="OIndex" style="display:none">Reduce Worksheet Data</span><span class="OIndex" style="display:none">worksheet, reduce data</span>
Origin C provides some functions for reducing XY data in worksheet, such as <a href="../../OriginC/OriginC/Ocmath_reducexy_fixing_increbin_(global_function).html" title="OriginC:Ocmath reducexy fixing increbin (global function)">ocmath_reducexy_fixing_increbin</a> for reducing XY data by X increment, <a href="../../OriginC/OriginC/Ocmath_reducexy_n_groups_(global_function).html" title="OriginC:Ocmath reducexy n groups (global function)">ocmath_reducexy_n_groups</a> for reducing XY data by number of groups, <a href="../../OriginC/OriginC/Ocmath_reducexy_n_points_(global_function).html" title="OriginC:Ocmath reducexy n points (global function)">ocmath_reducexy_n_points</a> for reducing XY data by every N points, etc. The following is an example to show how to reduce XY data by every N points.
</p>
<pre class="oc" style="font-family:monospace;">Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Get active worksheet</span>
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span><span style="color: #000040;">!</span>wks<span style="color: #000000;">&#41;</span> 
<span style="color: #000000;">&#123;</span>
	<span style="color: #0000ff;">return</span>;
<span style="color: #000000;">&#125;</span>
Column colX<span style="color: #000000;">&#40;</span>wks, <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// First column in worksheet</span>
Column colY<span style="color: #000000;">&#40;</span>wks, <span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Second column in worksheet</span>
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span>colX <span style="color: #000040;">&amp;&amp;</span> colY<span style="color: #000000;">&#41;</span> 
<span style="color: #000000;">&#123;</span> 
	vectorbase <span style="color: #000040;">&amp;</span>vbInterY <span style="color: #000080;">=</span> colY.<span style="color: #000000;">GetDataObject</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Get Y column data</span>
	vector vY <span style="color: #000080;">=</span> vbInterY;
	vector vReduced<span style="color: #000000;">&#40;</span>vY.<span style="color: #000000;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">int</span> nPoints <span style="color: #000080;">=</span> <span style="color: #0000dd;">3</span>;
	<span style="color: #008000;">// Reduce every 3 points, and result is the mean of every 3 points</span>
	<span style="color: #0000ff;">int</span> nNewSize <span style="color: #000080;">=</span> ocmath_reducexy_n_points<span style="color: #000000;">&#40;</span>vY, vReduced, vY.<span style="color: #000000;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, 
		nPoints, REDUCE_XY_STATS_MEAN<span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">int</span> iReduced <span style="color: #000080;">=</span> wks.<span style="color: #000000;">AddCol</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Reduced&quot;</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Add a new column for result</span>
	Column colReduced<span style="color: #000000;">&#40;</span>wks, iReduced<span style="color: #000000;">&#41;</span>;
	vectorbase <span style="color: #000040;">&amp;</span>vbReduced <span style="color: #000080;">=</span> colReduced.<span style="color: #000000;">GetDataObject</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
	vbReduced <span style="color: #000080;">=</span> vReduced;
<span style="color: #000000;">&#125;</span></pre>
<h2><a name="Extract_Data_from_Worksheet_with_LT_ConditionWorksheet.2C_Extract_Data"></a><span class="mw-headline">Extract Data from Worksheet with LT Condition<span class="OIndex" style="display:none">Worksheet, Extract Data</span></span></h2>
<p>Select worksheet data using the <a href="../../OriginC/OriginC/Worksheet-SelectRows.html" title="OriginC:Worksheet-SelectRows">Worksheet::SelectRows</a> method.  Rows can be selected across many columns.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Select data from a worksheet based on a condition;</span>
<span style="color: #008000;">// put the indices of the selected rows into a vector of type 'uint'.</span>
Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">// Check the worksheet data based on the condition expression and </span>
<span style="color: #008000;">// output the row index into 'vnRowIndices'.</span>
<span style="color: #008000;">// Define Labtalk range objects, 'a' = column 1, 'b' = column 2.    </span>
string strLTRunBeforeloop <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;range a=1; range b=2&quot;</span>; 
string strCondition <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;abs(a) &gt;= 1 &amp;&amp; abs(b) &gt;= 1&quot;</span>;	    
vector<span style="color: #000080;">&lt;</span>uint<span style="color: #000080;">&gt;</span> vnRowIndices; <span style="color: #008000;">// This is output</span>
<span style="color: #0000ff;">int</span> r1 <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>, r2 <span style="color: #000080;">=</span> <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>; <span style="color: #008000;">// The row range, -1 means the last row for r2</span>
 
<span style="color: #008000;">// Optional maximum number of rows to select, -1 indicates no limit</span>
<span style="color: #0000ff;">int</span> nMax <span style="color: #000080;">=</span> <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>;

<span style="color: #0000ff;">int</span> num <span style="color: #000080;">=</span> wks.<span style="color: #000000;">SelectRows</span><span style="color: #000000;">&#40;</span>strCondition, vnRowIndices, r1, r2, nMax, 
		strLTRunBeforeloop<span style="color: #000000;">&#41;</span>;</pre>
<p><span class="OIndex" style="display:none">Worksheet, Highlight Selection</span>There are two ways to highlight the selection.  The first is to highlight the selected indices.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Method 1 of show selection: highlight rows by vnRowIndices</span>
Grid gg;
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> gg.<span style="color: #000000;">Attach</span><span style="color: #000000;">&#40;</span>wks<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #008000;">// convert uint type vector to int type vector	    	</span>
    vector<span style="color: #000080;">&lt;</span><span style="color: #0000ff;">int</span><span style="color: #000080;">&gt;</span> vnRows;
    vnRows <span style="color: #000080;">=</span> vnRowIndices;	        
    
    gg.<span style="color: #000000;">SetSelection</span><span style="color: #000000;">&#40;</span>vnRows<span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span></pre>
<p><span class="OIndex" style="display:none">Worksheet, Set Color for the Selected Range</span>The second method of highlighting a data selection is to prescribe a fill color for the selected rows.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// Method 2 of show selection: fill color on the selected rows by vnRowIndices</span>
DataRange dr;

<span style="color: #008000;">// Construct data ranges by the row indices in vnRowIndices.</span>
<span style="color: #0000ff;">for</span><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">int</span> index<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>; index<span style="color: #000080;">&lt;</span>vnRowIndices.<span style="color: #000000;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>; index<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #008000;">// The following 0(1st col) and -1(last col) for all columns</span>
	<span style="color: #008000;">// &quot;&quot; for range name variable, not specified, default name will be used</span>
	dr.<span style="color: #000000;">Add</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;&quot;</span>, wks, vnRowIndices<span style="color: #000000;">&#91;</span>index<span style="color: #000000;">&#93;</span>, <span style="color: #0000dd;">0</span>, vnRowIndices<span style="color: #000000;">&#91;</span>index<span style="color: #000000;">&#93;</span>, <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span>

Tree tr;
tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">CommonStyle</span>.<span style="color: #000000;">Fill</span>.<span style="color: #000000;">FillColor</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> SYSCOLOR_BLUE; <span style="color: #008000;">// fill color = blue</span>
tr.<span style="color: #000000;">Root</span>.<span style="color: #000000;">CommonStyle</span>.<span style="color: #000000;">Color</span>.<span style="color: #000000;">nVal</span> <span style="color: #000080;">=</span> SYSCOLOR_WHITE; <span style="color: #008000;">// font color = white</span>

<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> <span style="color: #0000dd;">0</span> <span style="color: #000080;">==</span> dr.<span style="color: #000000;">UpdateThemeIDs</span><span style="color: #000000;">&#40;</span>tr.<span style="color: #000000;">Root</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span> <span style="color: #008000;">// Return 0 for no error</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #0000ff;">bool</span> bRet <span style="color: #000080;">=</span> dr.<span style="color: #000000;">ApplyFormat</span><span style="color: #000000;">&#40;</span>tr, <span style="color: #0000ff;">true</span>, <span style="color: #0000ff;">true</span><span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span></pre>
<h2><a name="Compare_Data_in_Two_WorksheetsWorksheet.2C_Compare_Data"></a><span class="mw-headline">Compare Data in Two Worksheets<span class="OIndex" style="display:none">Worksheet, Compare Data</span></span></h2>
<p>It may be useful to compare the number of rows or columns between two worksheets, or compare the data themselves.  Get a row or column count from a worksheet with the <a href="../../OriginC/OriginC/Datasheet-GetNumRows.html" title="OriginC:Datasheet-GetNumRows">Datasheet::GetNumRows</a> and <a href="../../OriginC/OriginC/Datasheet-GetNumCols.html" title="OriginC:Datasheet-GetNumCols">Datasheet::GetNumCols</a> methods.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> wks1.<span style="color: #000000;">GetNumRows</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000040;">!</span><span style="color: #000080;">=</span> wks2.<span style="color: #000000;">GetNumRows</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> 
	<span style="color: #000040;">||</span> wks1.<span style="color: #000000;">GetNumCols</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000040;">!</span><span style="color: #000080;">=</span> wks2.<span style="color: #000000;">GetNumCols</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	out_str<span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;The two worksheets are not the same size&quot;</span><span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">return</span>;
<span style="color: #000000;">&#125;</span></pre>
<p>Another way to perform a similar operation is to copy the data from each worksheet into a vector, and compare the size of the vectors.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// get all data from worksheet 1 columns one by one</span>
vector vec1;
foreach<span style="color: #000000;">&#40;</span>Column col in wks1.<span style="color: #000000;">Columns</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	vector<span style="color: #000040;">&amp;</span> vecCol <span style="color: #000080;">=</span> col.<span style="color: #000000;">GetDataObject</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
	vec1.<span style="color: #000000;">Append</span><span style="color: #000000;">&#40;</span>vecCol<span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span>

<span style="color: #008000;">// get all data from worksheet 2 columns one by one</span>
vector vec2;
foreach<span style="color: #000000;">&#40;</span>col in wks2.<span style="color: #000000;">Columns</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	vector<span style="color: #000040;">&amp;</span> vecCol <span style="color: #000080;">=</span> col.<span style="color: #000000;">GetDataObject</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
	vec2.<span style="color: #000000;">Append</span><span style="color: #000000;">&#40;</span>vecCol<span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span>	

<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> vec1.<span style="color: #000000;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000040;">!</span><span style="color: #000080;">=</span> vec2.<span style="color: #000000;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#41;</span> 
<span style="color: #000000;">&#123;</span>
	out_str<span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;The size of the two data sets is not equal&quot;</span><span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">return</span>;
<span style="color: #000000;">&#125;</span></pre>
<p><span class="OIndex" style="display:none">Data Comparison</span>To compare data elements themselves, use the <a href="../../OriginC/OriginC/Ocmath_compare_data_(global_function).html" title="OriginC:Ocmath compare data (global function)">ocmath_compare_data</a> function on the vectors in the example above.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">bool</span> bIsSame <span style="color: #000080;">=</span> <span style="color: #0000ff;">false</span>;
<span style="color: #0000ff;">double</span> dTolerance <span style="color: #000080;">=</span> 1e<span style="color: #000040;">-</span>10;
ocmath_compare_data<span style="color: #000000;">&#40;</span>vec1.<span style="color: #000000;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>, vec1, vec2, <span style="color: #000040;">&amp;</span>bIsSame, dTolerance<span style="color: #000000;">&#41;</span>;
<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> bIsSame <span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	out_str<span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Data in the two worksheets are the same&quot;</span><span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span></pre>






