<h1 class="firstHeading">1.4.4 Using Compiled Functions</h1><p><br />
<span class="OIndex" style="display:none">Functions, Execution</span>Once Origin C functions have been compiled, linked and loaded, they are ready to be used in Origin.  This means calling the function by its name and providing the necessary arguments from any location in Origin that accepts LabTalk script commands.  Common locations include the script window, the command window, or a custom button in the Origin GUI.  <a class="external text" href="../../LabTalk/Category/LT_Running_Scripts.html">Running Scripts chapter of the LabTalk Scripting Guide</a> details all of the locations in Origin from which script, and therefore Origin C functions, can be used.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Accessing_Origin_C_Functions_from_LabTalk_ScriptFunctions.2C_Calling_Origin_C_Function_from_Script"><span class="tocnumber">1</span> <span class="toctext">Accessing Origin C Functions from LabTalk Script<span class="OIndex" style="display:none">Functions, Calling Origin C Function from Script</span></span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Origin_C_Access_from_LabTalkFunctions.2C_Control_LabTalk_Access"><span class="tocnumber">1.1</span> <span class="toctext">Origin C Access from LabTalk<span class="OIndex" style="display:none">Functions, Control LabTalk Access</span></span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Listing_Functions_that_can_be_Called_from_LabTalkFunctions.2C_List_All_LabTalk_Callable_Origin_C_Functions"><span class="tocnumber">1.2</span> <span class="toctext">Listing Functions that can be Called from LabTalk<span class="OIndex" style="display:none">Functions, List All LabTalk Callable Origin C Functions</span></span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Passing_Arguments_to_Functions"><span class="tocnumber">1.3</span> <span class="toctext">Passing Arguments to Functions</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="#Passing_by_Value"><span class="tocnumber">1.3.1</span> <span class="toctext">Passing by Value</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#Passing_by_Reference"><span class="tocnumber">1.3.2</span> <span class="toctext">Passing by Reference</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-7"><a href="#Precedence_Rules_for_Functions_with_the_Same_NameFunctions.2C_Precedence_Rules_for_the_Same_Name_Functions"><span class="tocnumber">1.4</span> <span class="toctext">Precedence Rules for Functions with the Same Name<span class="OIndex" style="display:none">Functions, Precedence Rules for the Same Name Functions</span></span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#Defining_Functions_for_the_Set_Values_DialogFunctions.2C_Adding_for_Set_Values_Dialog_F.28x.29_menu"><span class="tocnumber">2</span> <span class="toctext">Defining Functions for the Set Values Dialog<span class="OIndex" style="display:none">Functions, Adding for Set Values Dialog F(x) menu</span></span></a></li>
</ul>
</div>

<h2><a name="Accessing_Origin_C_Functions_from_LabTalk_ScriptFunctions.2C_Calling_Origin_C_Function_from_Script"></a><span class="mw-headline">Accessing Origin C Functions from LabTalk Script<span class="OIndex" style="display:none">Functions, Calling Origin C Function from Script</span></span></h2>
<p>Origin C functions can be called from other Origin C functions and from LabTalk scripts.  This section talks about how to control the access to Origin C functions from LabTalk.
</p><p>For information about accessing LabTalk from your Origin C code, refer to the <a href="../../OriginC/Category/Accessing_LabTalk(OC_Guide).html" title="Category:Accessing LabTalk(OC Guide)">Accessing LabTalk</a> chapter.
</p>
<h3><a name="Origin_C_Access_from_LabTalkFunctions.2C_Control_LabTalk_Access"></a><span class="mw-headline">Origin C Access from LabTalk<span class="OIndex" style="display:none">Functions, Control LabTalk Access</span></span></h3>
<p>You can control LabTalk access to your Origin C code by putting a pragma statement in your Origin C code before your function definitions.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">#pragma</span> labtalk<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span> <span style="color: #008000;">// Disable OC functions in LabTalk </span>
<span style="color: #0000ff;">void</span> foo0<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
<span style="color: #000000;">&#125;</span>

<span style="color: #0000ff;">#pragma</span> labtalk<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span> <span style="color: #008000;">// Enable OC functions in LabTalk (default)</span>
<span style="color: #0000ff;">void</span> foo1<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
<span style="color: #000000;">&#125;</span>

<span style="color: #0000ff;">#pragma</span> labtalk<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span> <span style="color: #008000;">// Require '''run -oc''' LabTalk command </span>
<span style="color: #0000ff;">void</span> foo2<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
<span style="color: #000000;">&#125;</span></pre>
<p>The above code prevents foo0 from being called from LabTalk, allows foo1 to be called from LabTalk, and allows foo2 to be called from LabTalk using the <b>run -oc</b> command.  If you were to comment out the second pragma, then both foo0 and foo1 would be prevented from being called from LabTalk. This is because a single pragma statement applies to all functions after the pragma and up to the next pragma or the end of the file.
</p><p>There is also a LabTalk system variable that controls LabTalk access to all Origin C functions.  The variable is <b>@OC</b>, and it defaults to 1, which enables access.  Setting the variable to 0 disables access.
</p>
<h3><a name="Listing_Functions_that_can_be_Called_from_LabTalkFunctions.2C_List_All_LabTalk_Callable_Origin_C_Functions"></a><span class="mw-headline">Listing Functions that can be Called from LabTalk<span class="OIndex" style="display:none">Functions, List All LabTalk Callable Origin C Functions</span></span></h3>
<p>The LabTalk <b>list</b> command can be used to output all the names of Origin C functions that can be called from LabTalk. Options let you modify which type of functions is listed:
</p>
<pre class="lt" style="font-family:monospace;">list f;  <span style="color: #008000;">// List functions callable from LabTalk</span>
list fs; <span style="color: #008000;">// List only those returning a string</span>
list fv; <span style="color: #008000;">// List only those returning a vector</span>
list fn; <span style="color: #008000;">// List only those returning a numeric</span>
list fo; <span style="color: #008000;">// List only those returning void</span></pre>
<p>Note that setting <b>@OC=0</b> will make Origin C functions effectively invisible to LabTalk, such that the <b>list f</b><span class="OIndex" style="display:none">List Labtalk Callable Functions</span> command will give no result.
</p>
<h3><a name="Passing_Arguments_to_Functions"></a><span class="mw-headline">Passing Arguments to Functions</span></h3>
<p><span class="OIndex" style="display:none">Functions, Pass LabTalk Variable to Origin C by Reference</span><span class="OIndex" style="display:none">Functions, Pass LabTalk Variable to Origin C by Value</span>LabTalk script does not support all of the data types used internally by Origin C.  The following table lists the <a class="external text" href="../../LabTalk/LabTalk/Data_Types_and_Variables.html">LabTalk variable types</a> that should be passed (or returned) when calling an Origin C Function with the given argument (or return) type.  The final column indicates whether or not that argument type can be passed by reference.
</p>
<table class="simple">
<tr>
<th> Origin C </th>
<th> LabTalk </th>
<th> Pass By Reference?
</th></tr>
<tr>
<td> int
</td>
<td> int
</td>
<td> Yes
</td></tr>
<tr>
<td> double
</td>
<td> double
</td>
<td> Yes
</td></tr>
<tr>
<td> string
</td>
<td> string
</td>
<td> Yes
</td></tr>
<tr>
<td> bool
</td>
<td> int
</td>
<td> No
</td></tr>
<tr>
<td> matrix
</td>
<td> matrix range
</td>
<td> Yes
</td></tr>
<tr>
<td> vector&lt;int&gt;
</td>
<td> dataset
</td>
<td> Yes
</td></tr>
<tr>
<td> vector&lt;double&gt;
</td>
<td> dataset
</td>
<td> Yes
</td></tr>
<tr>
<td> vector&lt;complex&gt;
</td>
<td> dataset
</td>
<td> No
</td></tr>
<tr>
<td> vector&lt;string&gt;
</td>
<td> dataset, string array*
</td>
<td> No
</td></tr></table>
<p>* string arrays cannot be passed by reference
</p><p><br />
As the table above indicates, arguments of Origin C functions of type <b>string</b>, <b>int</b>, and <b>double</b> may be passed by value or by reference from LabTalk.  Note, however, that the Origin C function must be written for the type of pass being performed.
</p>
<h4><a name="Passing_by_Value"></a><span class="mw-headline">Passing by Value</span></h4>
<p>Below are examples of passing arguments by value from LabTalk to Origin C.  The format for each example is to give the Origin C function declaration line, and then the LabTalk code used to call it.  The Origin C function body is left out since it is unimportant for demonstrating variable passing.  
</p><p>The simple case of a function accepts an argument of type double and returns a double.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">double</span> square<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">double</span> a<span style="color: #000000;">&#41;</span>  <span style="color: #008000;">// Origin C function declaration</span></pre>
<pre class="lt" style="font-family:monospace;">double dd <span style="color: #000080;">=</span> <span style="color: #0000dd;">3.2</span>;         <span style="color: #008000;">// LabTalk function call</span>
double ss <span style="color: #000080;">=</span> square<span style="color: #000000;">&#40;</span>dd<span style="color: #000000;">&#41;</span>;
ss <span style="color: #000080;">=</span>;                    <span style="color: #008000;">// ss = 10.24</span></pre>
<p>Here, an Origin C function that takes a vector argument and returns a vector, is called by LabTalk using data set variables, or ranges that are assigned to data types.
</p>
<pre class="oc" style="font-family:monospace;">vector<span style="color: #000080;">&lt;</span>string<span style="color: #000080;">&gt;</span> PassStrArray<span style="color: #000000;">&#40;</span>vector<span style="color: #000080;">&lt;</span>string<span style="color: #000080;">&gt;</span> strvec<span style="color: #000000;">&#41;</span></pre>
<p>Can be called three ways from LabTalk:
</p>
<pre class="lt" style="font-family:monospace;">dataset dA, dB;
dB <span style="color: #000080;">=</span> Col<span style="color: #000000;">&#40;</span>B<span style="color: #000000;">&#41;</span>;
dA<span style="color: #000080;">=</span>PassStrArray<span style="color: #000000;">&#40;</span>dB<span style="color: #000000;">&#41;</span>;

Col<span style="color: #000000;">&#40;</span>A<span style="color: #000000;">&#41;</span><span style="color: #000080;">=</span>PassStrArray<span style="color: #000000;">&#40;</span>Col<span style="color: #000000;">&#40;</span>B<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>;  <span style="color: #008000;">// Or, use Col directly, Col = dataset</span>

<span style="color: #008000;">// Or, LabTalk ranges may also be used</span>
range ra <span style="color: #000080;">=</span> <span style="color: #000000;">&#91;</span>Book1<span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span>, rb <span style="color: #000080;">=</span> <span style="color: #000000;">&#91;</span>Book1<span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #0000dd;">2</span>;
ra <span style="color: #000080;">=</span> PassStrArray<span style="color: #000000;">&#40;</span>rb<span style="color: #000000;">&#41;</span>;</pre>
<h4><a name="Passing_by_Reference"></a><span class="mw-headline">Passing by Reference</span></h4>
<p>For the Origin C function below, note the ampersand <b>&amp;</b> character in the argument declaration, indicating that the argument will be passed by reference.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">double</span> increment<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">double</span><span style="color: #000040;">&amp;</span> a, <span style="color: #0000ff;">double</span> dStep<span style="color: #000000;">&#41;</span></pre>
<pre class="lt" style="font-family:monospace;">double d <span style="color: #000080;">=</span> <span style="color: #0000dd;">4</span>;
increment<span style="color: #000000;">&#40;</span>d, <span style="color: #0000dd;">6</span><span style="color: #000000;">&#41;</span>;
type <span style="color: #000080;">-</span>a <span style="color: #ff00ff;">&quot;d = $(d)&quot;</span>;  <span style="color: #008000;">// d = 10</span></pre>
<p>The following example demonstrates some arguments being passed by reference and others being passed by value.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">int</span> get_min_max_double_arr<span style="color: #000000;">&#40;</span>vector<span style="color: #000080;">&lt;</span><span style="color: #0000ff;">double</span><span style="color: #000080;">&gt;</span> vd, <span style="color: #0000ff;">double</span><span style="color: #000040;">&amp;</span> min, <span style="color: #0000ff;">double</span><span style="color: #000040;">&amp;</span> max<span style="color: #000000;">&#41;</span></pre>
<pre class="lt" style="font-family:monospace;">dataset ds <span style="color: #000080;">=</span> data<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">2</span>, <span style="color: #0000dd;">30</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span>;
double dMin, dMax;
get_min_max_double_arr<span style="color: #000000;">&#40;</span>ds, dMin, dMax<span style="color: #000000;">&#41;</span>;

<span style="color: #008000;">//Or use a data set from a column; be sure to put data in Col(A)</span>
get_min_max_double_arr<span style="color: #000000;">&#40;</span>Col<span style="color: #000000;">&#40;</span>A<span style="color: #000000;">&#41;</span>, dMin,  dMax<span style="color: #000000;">&#41;</span>;</pre>
<p>The following example shows passing a LabTalk matrix range variable by reference to an Origin C function.
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// set data from vector to matrix</span>
<span style="color: #0000ff;">void</span> set_mat_data<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">const</span> vector<span style="color: #000080;">&lt;</span><span style="color: #0000ff;">double</span><span style="color: #000080;">&gt;</span><span style="color: #000040;">&amp;</span> vd, matrix<span style="color: #000040;">&amp;</span> mat<span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	mat.<span style="color: #000000;">SetSize</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">4</span>,<span style="color: #0000dd;">4</span><span style="color: #000000;">&#41;</span>;
	mat.<span style="color: #000000;">SetByVector</span><span style="color: #000000;">&#40;</span>vd<span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span></pre>
<pre class="lt" style="font-family:monospace;">range mm <span style="color: #000080;">=</span> <span style="color: #000000;">&#91;</span>MBook1<span style="color: #000000;">&#93;</span><span style="color: #0000dd;">1</span><span style="color: #000080;">!</span><span style="color: #0000dd;">1</span>;
dataset ds <span style="color: #000080;">=</span> data<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">30</span>, <span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span>;
set_mat_data<span style="color: #000000;">&#40;</span>ds, mm<span style="color: #000000;">&#41;</span>;</pre>
<h3><a name="Precedence_Rules_for_Functions_with_the_Same_NameFunctions.2C_Precedence_Rules_for_the_Same_Name_Functions"></a><span class="mw-headline">Precedence Rules for Functions with the Same Name<span class="OIndex" style="display:none">Functions, Precedence Rules for the Same Name Functions</span></span></h3>
<p>When a user-defined or global Origin C function has the same name as a built-in LabTalk function, the Origin C function has higher precedence, except when using LabTalk vector notation. 
</p><p><b>Precedence:</b>
</p>
<ol><li> LabTalk Function (vector)</li>
<li> Origin C Function</li>
<li> LabTalk Function (scalar)</li></ol>
<p><br />
Thus, LabTalk functions like Normal and Data (which return a range of values and are thus used in vector notation) would have higher precedence than Origin C functions of the same name. In all other cases, the Origin C function is called.
</p>
<h2><a name="Defining_Functions_for_the_Set_Values_DialogFunctions.2C_Adding_for_Set_Values_Dialog_F.28x.29_menu"></a><span class="mw-headline">Defining Functions for the Set Values Dialog<span class="OIndex" style="display:none">Functions, Adding for Set Values Dialog F(x) menu</span></span></h2>
<p>You may want to define a function using Origin C, that will appear in the <b>Set Values</b> menu of either a column or a matrix.
</p><p>If an Origin C function is built as part of an Origin project---either automatically by being placed in the Project or System folder of Code Builder, or manually by building a function in the User folder---it will be available in the <b>User-Defined</b> section of the <b>F(x)</b> menu in the <b>Set Values</b> dialogs (for both Columns and Matrices).  To assign a function to a different section of the <b>F(x)</b> menu, issue a pragma containing the new section name as part of the function header. For instance, the following code will add function <b>add2num</b> to the Math section and function <b>mean2num</b> to the Statistics section:
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">#pragma</span> labtalk<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>,Math<span style="color: #000000;">&#41;</span>
<span style="color: #0000ff;">double</span> add2num<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">double</span> a, <span style="color: #0000ff;">double</span> b<span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	  <span style="color: #0000ff;">return</span> a <span style="color: #000040;">+</span> b;
<span style="color: #000000;">&#125;</span>

<span style="color: #0000ff;">#pragma</span> labtalk<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>,Statistics<span style="color: #000000;">&#41;</span>
<span style="color: #0000ff;">double</span> mean2num<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">double</span> a, <span style="color: #0000ff;">double</span> b<span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	  <span style="color: #0000ff;">return</span> <span style="color: #000000;">&#40;</span>a <span style="color: #000040;">+</span> b<span style="color: #000000;">&#41;</span><span style="color: #000040;">/</span><span style="color: #0000dd;">2</span>;
<span style="color: #000000;">&#125;</span></pre>
<p>In this way, many functions can be defined in a single source file and, upon building, be immediately available in the desired locations of the <b>F(x)</b> menu.
</p><p>Functions to be added to the <b>F(x)</b> menu must conform to the following additional restrictions:
</p>
<ul><li> The return type of the function cannot be void </li>
<li> The function should not have reference or pointer (&amp;) for argument type</li></ul>






