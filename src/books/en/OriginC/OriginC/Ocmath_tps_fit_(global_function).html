<h1 class="firstHeading">2.1.18.19 ocmath_tps_fit</h1><p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Description"><span class="tocnumber">1</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Syntax"><span class="tocnumber">2</span> <span class="toctext">Syntax</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Parameters"><span class="tocnumber">3</span> <span class="toctext">Parameters</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Return"><span class="tocnumber">4</span> <span class="toctext">Return</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Examples"><span class="tocnumber">5</span> <span class="toctext">Examples</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Remark"><span class="tocnumber">6</span> <span class="toctext">Remark</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#See_Also"><span class="tocnumber">7</span> <span class="toctext">See Also</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Header_to_Include"><span class="tocnumber">8</span> <span class="toctext">Header to Include</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Reference"><span class="tocnumber">9</span> <span class="toctext">Reference</span></a></li>
</ul>
</div>

<h2><a name="Description"></a><span class="mw-headline">Description</span></h2>
<p>This function perform 2D interpolation using thin plate spline method.
</p>
<h2><a name="Syntax"></a><span class="mw-headline">Syntax</span></h2>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">int</span> ocmath_tps_fit<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">int</span> nNode, <span style="color: #0000ff;">const</span> <span style="color: #0000ff;">double</span> <span style="color: #000040;">*</span>x, <span style="color: #0000ff;">const</span> <span style="color: #0000ff;">double</span> <span style="color: #000040;">*</span>y, <span style="color: #0000ff;">const</span> <span style="color: #0000ff;">double</span> <span style="color: #000040;">*</span>z, <span style="color: #0000ff;">double</span> dSmooth, ocmath_strTPS <span style="color: #000040;">*</span>strTPS, <span style="color: #0000ff;">double</span><span style="color: #000040;">*</span> dRegularization<span style="color: #000000;">&#41;</span></pre>
<h2><a name="Parameters"></a><span class="mw-headline">Parameters</span></h2>
<dl><dt> nNode</dt>
<dd>[input] the number of scatters.</dd>
<dt> x</dt>
<dd>[input] the position and the x-coordinates of each points.</dd>
<dt> y</dt>
<dd>[input] the position and the y-coordinates of each points. </dd>
<dt> z</dt>
<dd>[input] the position and the z-coordinates of each points.</dd>
<dt> dSmooth</dt>
<dd> [input] the smooth factor.</dd>
<dt> strTPS</dt>
<dd> [output] contains the interpolation coefficients of the fitting.</dd>
<dt> dRegularization</dt>
<dd> [output] the regularization factor defined by the value of dsmooth.</dd></dl>
<p><br />
</p>
<h2><a name="Return"></a><span class="mw-headline">Return</span></h2>
<p>OE_NOERROR for successful or
</p><p>OE_INVALID_POINT Not enough points (n&lt;3) or all the points are colinear;
</p><p>OE_NULL_POINTER if pointer is null.
</p><p>OE_INVALID_SMOOTH Parameter dSmooth should not be less than zero.
</p>
<h2><a name="Examples"></a><span class="mw-headline">Examples</span></h2>
<p><b>EX1</b>
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>wks2mat.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
<span style="color: #0000ff;">int</span> ocmath_tps_fit_ex1<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #008000;">// tabulated data on a 3x3 regular grid, points of form (x,y,f(x,y))</span>
	<span style="color: #0000ff;">const</span> <span style="color: #0000ff;">int</span> iQuantity <span style="color: #000080;">=</span> <span style="color: #0000dd;">9</span>;
	<span style="color: #0000ff;">double</span> afX<span style="color: #000000;">&#91;</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> <span style="color: #000000;">&#123;</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.5</span>, <span style="color: #0000dd;">1.0</span>,<span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.5</span>, <span style="color: #0000dd;">1.0</span>,<span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.5</span>, <span style="color: #0000dd;">1.0</span><span style="color: #000000;">&#125;</span>;
	<span style="color: #0000ff;">double</span> afY<span style="color: #000000;">&#91;</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> <span style="color: #000000;">&#123;</span><span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>, <span style="color: #0000dd;">0.0</span>,<span style="color: #0000dd;">0.5</span>, <span style="color: #0000dd;">0.5</span>, <span style="color: #0000dd;">0.5</span>,<span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">1.0</span><span style="color: #000000;">&#125;</span>;
	<span style="color: #0000ff;">double</span> afF<span style="color: #000000;">&#91;</span><span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> <span style="color: #000000;">&#123;</span><span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">2.0</span>, <span style="color: #0000dd;">3.0</span>,<span style="color: #0000dd;">3.0</span>, <span style="color: #0000dd;">2.0</span>, <span style="color: #0000dd;">1.0</span>,<span style="color: #0000dd;">1.0</span>, <span style="color: #0000dd;">2.0</span>, <span style="color: #0000dd;">3.0</span><span style="color: #000000;">&#125;</span>;
	
	<span style="color: #008000;">// resample on a 7x7 regular grid</span>
	<span style="color: #0000ff;">const</span> <span style="color: #0000ff;">int</span> iResample <span style="color: #000080;">=</span> <span style="color: #0000dd;">6</span>;
	<span style="color: #0000ff;">const</span> <span style="color: #0000ff;">double</span> fInv <span style="color: #000080;">=</span> <span style="color: #0000dd;">1.0</span><span style="color: #000040;">/</span><span style="color: #000000;">&#40;</span><span style="color: #0000ff;">double</span><span style="color: #000000;">&#41;</span>iResample;
	<span style="color: #0000ff;">int</span> i, j;
	
	<span style="color: #008000;">// no smoothing, exact interpolation at grid points</span>
	ocmath_strTPS strTPS;
	ocmath_tps_initial<span style="color: #000000;">&#40;</span><span style="color: #000040;">&amp;</span>strTPS<span style="color: #000000;">&#41;</span>;
	
	<span style="color: #0000ff;">double</span> dSmooth <span style="color: #000080;">=</span> <span style="color: #0000dd;">0.1</span>;
	<span style="color: #0000ff;">double</span> dReg;
	
	<span style="color: #0000ff;">int</span> nRe <span style="color: #000080;">=</span> ocmath_tps_fit<span style="color: #000000;">&#40;</span>iQuantity, afX, afY, afF, 
					dSmooth, <span style="color: #000040;">&amp;</span>strTPS, <span style="color: #000040;">&amp;</span>dReg<span style="color: #000000;">&#41;</span>;
	
	<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span>nRe<span style="color: #000000;">&#41;</span>
	<span style="color: #000000;">&#123;</span>
		<span style="color: #000000;">printf</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;intp error &#160;%d<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span>, nRe<span style="color: #000000;">&#41;</span>;
		<span style="color: #0000ff;">return</span> <span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>;
	<span style="color: #000000;">&#125;</span>
	<span style="color: #0000ff;">else</span>
	<span style="color: #000000;">&#123;</span>
		<span style="color: #000000;">printf</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;The regularization parameter is&#160;%g<span style="color: #666666; font-weight: bold;">\n</span><span style="color: #666666; font-weight: bold;">\n</span>&quot;</span>,dReg<span style="color: #000000;">&#41;</span>;
	<span style="color: #000000;">&#125;</span>
	
	<span style="color: #008000;">// Output the results</span>
	<span style="color: #000000;">printf</span><span style="color: #000000;">&#40;</span> <span style="color: #ff00ff;">&quot;smooth parameter is&#160;%g<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span>, dSmooth<span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">double</span> x, y, z;
	<span style="color: #0000ff;">for</span> <span style="color: #000000;">&#40;</span>j <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; j <span style="color: #000080;">&lt;=</span> iResample; j<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>
	<span style="color: #000000;">&#123;</span>
		y <span style="color: #000080;">=</span> fInv<span style="color: #000040;">*</span>j;
		<span style="color: #0000ff;">for</span> <span style="color: #000000;">&#40;</span>i <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>; i <span style="color: #000080;">&lt;=</span> iResample; i<span style="color: #000040;">++</span><span style="color: #000000;">&#41;</span>
		<span style="color: #000000;">&#123;</span>
			x <span style="color: #000080;">=</span> fInv<span style="color: #000040;">*</span>i;
			ocmath_tps_eval<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">1</span>, <span style="color: #000040;">&amp;</span>x, <span style="color: #000040;">&amp;</span>y, <span style="color: #000040;">&amp;</span>z, <span style="color: #000040;">&amp;</span>strTPS<span style="color: #000000;">&#41;</span>;
			<span style="color: #000000;">printf</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;%9.6f<span style="color: #666666; font-weight: bold;">\t</span>&quot;</span>, z<span style="color: #000000;">&#41;</span>;
		<span style="color: #000000;">&#125;</span>
		<span style="color: #000000;">printf</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span><span style="color: #000000;">&#41;</span>;
	<span style="color: #000000;">&#125;</span>
	
	ocmath_tps_free<span style="color: #000000;">&#40;</span><span style="color: #000040;">&amp;</span>strTPS<span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span>;
<span style="color: #000000;">&#125;</span></pre>
<p><b>EX2</b>
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">// This example demonstrates the usage of thin plate spline fitting and XY gridding.</span>
<span style="color: #008000;">// To test, create an Origin workshhet with three columns that contain XYZ scatters.</span>
<span style="color: #008000;">// The result will be stored in a newly created Origin matrix window.</span>
<span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>wks2mat.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span>
<span style="color: #0000ff;">void</span> ocmath_tps_fit_ex2<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #0000ff;">int</span> nRows <span style="color: #000080;">=</span> <span style="color: #0000dd;">100</span>;
	<span style="color: #0000ff;">int</span> nCols <span style="color: #000080;">=</span> <span style="color: #0000dd;">100</span>;
	
	Worksheet wks <span style="color: #000080;">=</span> Project.<span style="color: #000000;">ActiveLayer</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
	wks.<span style="color: #000000;">SetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000040;">-</span><span style="color: #0000dd;">1</span>, <span style="color: #0000dd;">3</span><span style="color: #000000;">&#41;</span>;
	Dataset dsX<span style="color: #000000;">&#40;</span>wks, <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>, dsY<span style="color: #000000;">&#40;</span>wks, <span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>, dsZ<span style="color: #000000;">&#40;</span>wks, <span style="color: #0000dd;">2</span><span style="color: #000000;">&#41;</span>;
	
	vector vXsrc<span style="color: #000000;">&#40;</span>dsX<span style="color: #000000;">&#41;</span>, vYsrc<span style="color: #000000;">&#40;</span>dsY<span style="color: #000000;">&#41;</span>, vZsrc<span style="color: #000000;">&#40;</span>dsZ<span style="color: #000000;">&#41;</span>;
	vector vXdest<span style="color: #000000;">&#40;</span>nRows <span style="color: #000040;">*</span> nCols<span style="color: #000000;">&#41;</span>, vYdest<span style="color: #000000;">&#40;</span>nRows <span style="color: #000040;">*</span> nCols<span style="color: #000000;">&#41;</span>, vZdest<span style="color: #000000;">&#40;</span>nRows <span style="color: #000040;">*</span> nCols<span style="color: #000000;">&#41;</span>;
	
	<span style="color: #0000ff;">int</span> nSize <span style="color: #000080;">=</span> vXsrc.<span style="color: #000000;">GetSize</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
	
	<span style="color: #0000ff;">double</span> dXmin, dXmax, dYmin, dYmax;
	vXsrc.<span style="color: #000000;">GetMinMax</span><span style="color: #000000;">&#40;</span>dXmin, dXmax<span style="color: #000000;">&#41;</span>;
	vYsrc.<span style="color: #000000;">GetMinMax</span><span style="color: #000000;">&#40;</span>dYmin, dYmax<span style="color: #000000;">&#41;</span>;
	
	MatrixLayer ml;
	ml.<span style="color: #000000;">Create</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
	MatrixObject mo <span style="color: #000080;">=</span> ml.<span style="color: #000000;">MatrixObjects</span><span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span>;
	
	mo.<span style="color: #000000;">SetNumRows</span><span style="color: #000000;">&#40;</span>nRows<span style="color: #000000;">&#41;</span>;
	mo.<span style="color: #000000;">SetNumCols</span><span style="color: #000000;">&#40;</span>nCols<span style="color: #000000;">&#41;</span>;
	mo.<span style="color: #000000;">SetXY</span><span style="color: #000000;">&#40;</span>dXmin, dYmin, dXmax, dYmax<span style="color: #000000;">&#41;</span>;
	
	Matrix<span style="color: #000040;">&amp;</span> mat <span style="color: #000080;">=</span> mo.<span style="color: #000000;">GetDataObject</span><span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>;
	
	ocmath_strTPS strTPS;
	ocmath_tps_initial<span style="color: #000000;">&#40;</span><span style="color: #000040;">&amp;</span>strTPS<span style="color: #000000;">&#41;</span>;
	
	<span style="color: #0000ff;">double</span> dSmooth <span style="color: #000080;">=</span> <span style="color: #0000dd;">0.0</span>; <span style="color: #008000;">// no smoothing, exact interpolation at grid points</span>
	<span style="color: #0000ff;">double</span> dReg;
	
	<span style="color: #0000ff;">int</span> iRet;
	<span style="color: #008000;">// Initialization</span>
	iRet <span style="color: #000080;">=</span> ocmath_tps_fit<span style="color: #000000;">&#40;</span>nSize, vXsrc, vYsrc, vZsrc, dSmooth, <span style="color: #000040;">&amp;</span>strTPS, <span style="color: #000040;">&amp;</span>dReg<span style="color: #000000;">&#41;</span>;
	
	<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span>iRet<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
		<span style="color: #000000;">printf</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;intp error &#160;%d<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span>, iRet<span style="color: #000000;">&#41;</span>;
		<span style="color: #0000ff;">return</span>;
	<span style="color: #000000;">&#125;</span>
	
	<span style="color: #008000;">// Create XY gridding.</span>
	iRet <span style="color: #000080;">=</span> ocmath_mat_to_regular_xyz<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">NULL</span>, nRows, nCols, dXmin, dXmax, dYmin, dYmax, vXdest, vYdest, <span style="color: #0000ff;">NULL</span><span style="color: #000000;">&#41;</span>;
	
	<span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span>iRet <span style="color: #000080;">&lt;=</span> <span style="color: #0000dd;">0</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span> 
		<span style="color: #000000;">printf</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Failed to create XY gridding!<span style="color: #666666; font-weight: bold;">\n</span>&quot;</span><span style="color: #000000;">&#41;</span>;
		<span style="color: #0000ff;">return</span>;
	<span style="color: #000000;">&#125;</span>
	
	<span style="color: #008000;">// Interpolation</span>
	ocmath_tps_eval<span style="color: #000000;">&#40;</span>nRows <span style="color: #000040;">*</span> nCols, vXdest, vYdest, mat, <span style="color: #000040;">&amp;</span>strTPS<span style="color: #000000;">&#41;</span>;
	
	ocmath_tps_free<span style="color: #000000;">&#40;</span><span style="color: #000040;">&amp;</span>strTPS<span style="color: #000000;">&#41;</span>;
<span style="color: #000000;">&#125;</span></pre>
<h2><a name="Remark"></a><span class="mw-headline">Remark</span></h2>
<h2><a name="See_Also"></a><span class="mw-headline">See Also</span></h2>
<p><a href="../../OriginC/OriginC/Ocmath_tps_eval_(global_function).html" title="OriginC:Ocmath tps eval (global function)">ocmath_tps_eval</a>
</p>
<h2><a name="Header_to_Include"></a><span class="mw-headline">Header to Include</span></h2>
<p>wks2mat.h
</p>
<h2><a name="Reference"></a><span class="mw-headline">Reference</span></h2>






