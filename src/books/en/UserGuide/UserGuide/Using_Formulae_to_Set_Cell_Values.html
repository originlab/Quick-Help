<h1 class="firstHeading">4.6.9 Using a Formula to Set Cell Values</h1><p class='urlname' style='display: none'>Using-Formulae-to-Set-Cell-Values</p>
<p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Cell_Formula"><span class="tocnumber">1</span> <span class="toctext">Cell Formula</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Column_Cell_Reference_Syntaxes"><span class="tocnumber">2</span> <span class="toctext">Column Cell Reference Syntaxes</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Examples"><span class="tocnumber">3</span> <span class="toctext">Examples</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Extending_Formulas_Across_Rows_or_Columns"><span class="tocnumber">4</span> <span class="toctext">Extending Formulas Across Rows or Columns</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Extending_Sheet_Part"><span class="tocnumber">4.1</span> <span class="toctext">Extending Sheet Part</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Extending_Book_Part"><span class="tocnumber">4.2</span> <span class="toctext">Extending Book Part</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Limitations"><span class="tocnumber">5</span> <span class="toctext">Limitations</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Formula_Bar"><span class="tocnumber">6</span> <span class="toctext">Formula Bar</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#User_Parameter_Row_Formula"><span class="tocnumber">7</span> <span class="toctext">User Parameter Row Formula</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#Related_System_Variables"><span class="tocnumber">8</span> <span class="toctext">Related System Variables</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="#See_Also"><span class="tocnumber">9</span> <span class="toctext">See Also</span></a></li>
</ul>
</div>

<h2><a name="Cell_Formula"></a><span class="mw-headline">Cell Formula</span></h2>
<p>Origin supports cell formula in both data cells and user-defined column label cells in worksheet since Origin 2018.
</p>
<ul><li> Start the formula with = sign in cell.</li>
<li> Use Origin's built-in <a class="external text" href="../../LabTalk/Script/LabTalk-Supported_Functions.html">Labtalk functions</a></li>
<li> Access data cell, label cell, column, <a href="../../UserGuide/UserGuide/Named_Range.html" title="UserGuide:Named Range">named range</a>, metadata, <a class="external text" href="../../LabTalk/LabTalk/Data_Types_and_Variables.html#variables">variables</a>, <a class="external text" href="../../LabTalk/LabTalk/Operators.html#Define_a_constant">constants</a>, etc. in calculation</li>
<li> Drag formula to extend it to other cells</li>
<li> Auto adjustment of formula when col/row is inserted or deleted or when it's copied to other location</li></ul>
<dl><dd><a  class="image"><img alt="Cell formula intro.gif" src="../images/Using_Formulae_to_Set_Cell_Values/Cell_formula_intro.gif?v=93086" width="607"  /></a></dd></dl>
<h2><a name="Column_Cell_Reference_Syntaxes"></a><span class="mw-headline">Column Cell Reference Syntaxes</span></h2>
<p><a href="../../UserGuide/UserGuide/Column_Short_Name_Restriction.html" title="UserGuide:Column Short Name Restriction"><b>Spreadsheet Cell Notation (SCN)</b> must be enabled</a> in the workbook so that user can refer column and cell with similar notation as Excel.
</p>
<table class="xfvar">
<tr>
<th width="25%">Column
</th>
<th width="25%">Cell
</th>
<th width="25%">Range
</th>
<th width="25%">Label Row
</th></tr>
<tr valign="top">
<td>
<ul><li> A - column A</li>
<li> This - current column</li></ul>
</td>
<td>
<ul><li> A1, A[1] - column A, row 1</li>
<li> A0 - column A, last row</li>
<li> A[i] - column A, current row</li>
<li> Use <b>This[1], This[i]</b> for rows in current column</li></ul>
</td>
<td>
<ul><li> A1:A10, A[1:10] - column A, row 1-10</li>
<li> A1:B0 - column A row 1 to column B last row</li>
<li> A[i:i+2] - column A, current row to 2 rows after it</li>
<li> This[i-2:i-1] - current column, two rows before current row</li></ul>
</td>
<td>
<ul><li> A[C]$ - column A, string of Comments cell</li>
<li> A[EID]$ - column A, string of user-defined parameter <b>EID</b></li>
<li> A[D1] - column A, value of 1st user-defined parameter</li>
<li> Use <b>This[C]$, This[EID]$, This[D1]</b> for label cell in current column</li></ul>
</td></tr></table>
<table class="noborder"><tr>
	<td style="vertical-align:top" width="60"><img src="../images/Using_Formulae_to_Set_Cell_Values/Tip_icon.png?v=9614" width="57"  border="0" /></td><td><ol><li> Add <b>sheetname!</b>, <b>sheetindex!</b>, <b>[bookname]sheetname!</b> or <b>[bookname]sheetindex!</b> before the column cell reference if data is on different sheet or book</li>
<li> Add <b>$</b> after the column cell reference for string e.g. A1$, A$</li>
<li> For subrange, <b>:</b> must be within the <b>[ ]</b>. So A[1]:A[10] &amp; A[1]:D[10] are not supported Use A[1:10] for same column, or A1:D10 for different columns</li>
<li> Add <b>$</b> before column or row part for absolute reference. See <a href="#Extending_Formulas_Across_Rows_or_Columns">Extending Formulas Across Rows or Columns</a> section below.</li>
<li> Use <b>==</b> to build range string and expression involving range string, if current A1 contains Book name. e.g. <b>=="["+A1$+"]"+"1!C1"</b> will refer to C1 cell of 1st sheet in a specified book in A1. <b>=="1000+["+A1$+"]"+"1!C1*0.3"</b> will will be an expression based on such C1 cell. </li></ol>
</td></tr></table>
<h2><a name="Examples"></a><span class="mw-headline">Examples</span></h2>
<p>The examples only show relative reference. Add <b>$</b> before column or row part for absolute reference. See <a href="#Extending_Formulas_Across_Rows_or_Columns">Extending Formulas Across Rows or Columns</a> section below.
</p>
<table class="simple" style="width: 95%">
<tr>
<th width="30%">Origin
</th>
<th width="30%">Excel
</th>
<th width="55%">Description
</th></tr>
<tr>
<td> <b>=B1 - C1</b>
</td>
<td> <b>=B1-C1</b>
</td>
<td> Difference between B1 and C1.
</td></tr>
<tr>
<td> <b>=B - B0</b>
</td>
<td> N/A
</td>
<td> Difference between the current row of column B and last row of column B.
</td></tr>
<tr>
<td> <b>=B1-mean(B)</b>
</td>
<td> <b>=B1-average(B:B)</b>
</td>
<td> Difference beween B1 and average of column B
</td></tr>
<tr>
<td> <b>=mean(This)</b>
</td>
<td> NA
</td>
<td> Average of current column
</td></tr>
<tr>
<td> <b>=B1$ + C1$</b>
</td>
<td> <b>=B1 &amp; C1</b>
</td>
<td> Concatenate strings in B1 and C1.
</td></tr>
<tr>
<td> <b>=IF(A1&lt;98.6, A1-98.6, NA())</b>
</td>
<td> <b>=IF(A1&lt;98.6, A1-98.6, NA())</b>
</td>
<td> if A1 &lt;= 98.6, return A1-98.6, otherwise return a missing value (see <a class="external text" href="../../LabTalk/LabTalk/NA_(function).html">LabTalk Utility Function, <b>Na()</b></a>).
</td></tr>
<tr>
<td> <b>=col(A)[D1]*A1</b>
</td>
<td> N/A
</td>
<td> The value of column A <a class="external text" href="../../LabTalk/LabTalk/Column_Label_Row_Characters.html">User-parameter 1</a> multiplied by value in column A, row 1
</td></tr>
<tr>
<td> <b>=lookup(This[element]$, [book1]1!1, [book1]1!2)$</b>
</td>
<td> N/A
</td>
<td> Search the value of the <b>element</b> column label in a column and return the value of another column with the same index of the found element. (see the video under section <a href="#User_Parameter_Row_Formula">User Parameter Row</a>)
</td></tr>
<tr>
<td> <b>=page.v1*B1</b>
</td>
<td> N/A
</td>
<td> The value of <a class="external text" href="../../LabTalk/LabTalk/System_Variables.html#V1.E2.80.93V9">system variable v1</a> (stored with page) multiplied by value in column B, row 1
</td></tr>
<tr>
<td><b>=A1-page.info.File1.Info.FileDate</b>
</td>
<td> N/A
</td>
<td> A1 - minus the file date information of the imported file stored in page, suppose A1 is also a date
</td></tr>
<tr>
<td> <b>=date(A1, "dd.MM.yyyy HH:mm:ss.##")</b>
</td>
<td> -- <sup>&#8224;</sup>
</td>
<td> Julian day value of A1 in specified date-time format. Note differences in Origin and Excel behavior.
</td></tr>
<tr>
<td> <b>=total(A[1:3])</b>
</td>
<td> <b>=SUM(A1:A3)</b>
</td>
<td> Sum of A1 to A3.
</td></tr>
<tr>
<td> <b>=Total(wcol(j-1)[1:3])</b>
</td>
<td> <b>N/A</b>
</td>
<td> Sum of row 1 to 3 in the immediate left of current column.
</td></tr>
<tr>
<td> <b>=total(Sheet2!A1:J10)+total(Sheet1!A1:J10)</b>
</td>
<td> <b>=SUM(Sheet2!A1:J10)+SUM(Sheet1!A1:J10)</b>
</td>
<td> Sum of A1 to J10 on both sheet1 and sheet2
</td></tr>
<tr>
<td> <b>=Sheet2!B1 - Sheet3!B1</b>
</td>
<td> <b>=Sheet2!B1 - Sheet3!B1</b>
</td>
<td> Difference of B1 on two sheets
</td></tr>
<tr>
<td> <b>=[Book2]Sheet1!A1 - [Book3]Sheet1!A1</b>
</td>
<td> <b>=[Book2]Sheet1!A1 - [Book3]Sheet1!A1</b>
</td>
<td> Difference between A1 on different books
</td></tr>
<tr>
<td> <b>=[Book2]Sheet1!col(A)[1] - [Book3]Sheet1!col(A)[1]</b>
</td>
<td> N/A
</td>
<td> Difference between A1 on different books with the old col(name)[row] syntax
</td></tr>
<tr>
<td> <b>=[Book1]Sheet1!col(A)[1] + StartTime</b>
</td>
<td> N/A
</td>
<td> Adds the <a href="../../UserGuide/UserGuide/Named_Range.html" title="UserGuide:Named Range">named range</a> "StartTime" value to A1 of sheet1 on Book1
</td></tr>
<tr>
<td> <b>=text(mean(B1:B10),".2")+" ± "+text(stddev(B1:B10),".4")</b>
</td>
<td> <b>=(TEXT(AVERAGE(B1:B10),"0.00") &amp; " ± " &amp; TEXT(STDEV(B1:B10),"0.0000"))</b>
</td>
<td> Calculate mean and standard deviation of a range, then round to specified number of decimal places and convert to text. Concatenate, inserting string " ± " (e.g. 0.56 ± 0.2740).
</td></tr></table>
<h2><a name="Extending_Formulas_Across_Rows_or_Columns"></a><span class="mw-headline">Extending Formulas Across Rows or Columns</span></h2>
<p>Select the cell with formula and mouse over the lower right corner of it, when the cursor becomes a <b>+</b>, drag it to extend down, across or diagonally
</p><p>Column and row reference in formula extends in relative fashion:
</p>
<dl><dd><ul><li> when dragging vertically, only the row part changes</li></ul></dd>
<dd><a  class="image"><img alt="Cell formula relative columnwise.gif" src="../images/Using_Formulae_to_Set_Cell_Values/Cell_formula_relative_columnwise.gif?v=93122" width="618"  /></a>
<ul><li> when dragging horizontally, only the column part changes</li></ul></dd>
<dd><a  class="image"><img alt="Cell formula relative rowwise.gif" src="../images/Using_Formulae_to_Set_Cell_Values/Cell_formula_relative_rowwise.gif?v=93304" width="618"  /></a> 
<ul><li> when dragging diagonally, both part will change</li></ul></dd>
<dd><a  class="image"><img alt="Cell formula diagonal autofill.gif" src="../images/Using_Formulae_to_Set_Cell_Values/Cell_formula_diagonal_autofill.gif?v=93315" width="454"  /></a> </dd></dl>
<p>Place <b>$</b> before the part to make <i>absolute</i> reference. E.g. to fix the row part, add <b>$</b> before row part e.g. <b>B$1</b>. To fix both the column and cell, place a <b>$</b> character before both the column and row parts, e.g. <b>$B$1</b>. 
</p>
<dl><dd><a  class="image"><img alt="Cell formula absolute columnwise.gif" src="../images/Using_Formulae_to_Set_Cell_Values/Cell_formula_absolute_columnwise.gif?v=93125" width="299"  /></a></dd></dl>
<p>Double click the <b>+</b> is also supported. For data area, it will auto fill to bottom of the column. For label area, it will auto fill to the end of the row.
</p>
<dl><dd><a  class="image"><img alt="Cell formula label row autofill.gif" src="../images/Using_Formulae_to_Set_Cell_Values/Cell_formula_label_row_autofill.gif?v=93132" width="635"  /></a></dd></dl>
<p>For row references in square brackets, e.g. <b>sum(A)[1]</b> or <b>A[1]</b>, press <b>Ctrl</b> key when dragging to keep relative reference 
</p><p><br />
</p>
<h3><a name="Extending_Sheet_Part"></a><span class="mw-headline">Extending Sheet Part</span></h3>
<p>Origin doesn't support relative sheet reference when extending formula.
E.g. how to put B1 cell of all <b>Sensor</b> sheets to a new sheet? User may enter <b>=Sensor01!B$1</b> or <b>=1!B$1</b> and then expect to drag the formula to get <b>=Sensor02!B$1</b>, <b>=Sensor03!B$1</b>, ..., or <b>=2!B$1</b>, =<b>3!B$1</b>, ....
</p><p>Workarounds:
</p>
<dl><dd><ul><li> Variable <i>i</i> means row indexing, By putting <i>$(i)</i> before <b>!</b> part, it can be used as sheet indexing
<dl><dd><a  class="image"><img alt="Cell formula relative sheet.gif" src="../images/Using_Formulae_to_Set_Cell_Values/Cell_formula_relative_sheet.gif?v=93157" width="582"  /></a></dd></dl></li>
<li> Put sheet index or name in a column and use <b>==</b> syntax to concatenate it with column and row part to form a complete cell reference
<dl><dd><a  class="image"><img alt="Cell formula relative sheet double equal.gif" src="../images/Using_Formulae_to_Set_Cell_Values/Cell_formula_relative_sheet_double_equal.gif?v=93162" width="582"  /></a></dd></dl></li></ul></dd></dl>
<dl><dd> In the above example, <b>A1$</b> will convert <b>A1</b> contents into a string. <b>"!B1"</b> is a literal string. <b>==A1$+"!B1"</b> will concatenate them into <b>=Sensor01!B1</b> which refers to <b>B1</b> of <b>Sensor01</b> sheet. </dd>
<dd> Note 
<ul><li> The sheet strings will need to be on the same page where you build your auto-adjusting sheet references.</li>
<li> <b>==A1$+"!B1+10"</b> will make an expression Sensor01!B1+10.</li>
<li> If the sheet string contains special characters, such as "-", enclose the sheet name with double quotation marks: <b>==char(34)$+A1$+char(34)$+"!B1+10"</b>.</li></ul></dd></dl>
<h3><a name="Extending_Book_Part"></a><span class="mw-headline">Extending Book Part</span></h3>
<p><b>==</b> syntax also works to concatenate book, sheet, column and row part to form a complete cell reference. 
</p><p>In the following example Book short names are put to column A and how to use cell formula to fill column B with B2 values in each book.
</p><p>In B1 cell, put =="["+A1$+"]"+"Sheet1!B2". Drag the bottom-right corner of B1 cell and drag down to 12th row so B2 in 12
books are filled. 
</p>
<dl><dd><a  class="image"><img alt="Cell formula relative book double quote.png" src="../images/Using_Formulae_to_Set_Cell_Values/Cell_formula_relative_book_double_quote.png?v=94543" width="706"  /></a></dd></dl>
<h2><a name="Limitations"></a><span class="mw-headline">Limitations</span></h2>
<p>Here are some known issues when using cell formula
</p>
<ul><li> Importing an MS Excel file will not bring in your Excel formulas. Only calculated values are imported. See <a href="../../UserGuide/Category/Working_with_Microsoft_Excel.html" title="Category:Working with Microsoft Excel">Working with Microsoft Excel</a>.</li>
<li> Cell formulas are not supported in the built-in column label rows such as <b>Long Name</b>, <b>Units</b>, <b>Comments</b>, etc. They are only supported in <a href="../../UserGuide/UserGuide/Displaying_Supporting_Data_in_Worksheet_Header_Rows.html#User-Defined_Parameters" title="UserGuide:Displaying Supporting Data in Worksheet Header Rows"><b>User-defined Parameter</b> rows</a>.</li>
<li> Variable <i>i</i> and <i>j</i> are used for row and column indexing in Origin (see <a class="external text" href="../../LabTalk/LabTalk/System_Variables.html#X.2C_Y.2C_Z.2C_I.2C_J.2C_E.2C_T.2C_Count">System Variables</a>) so A[i], col(A)[i], wcol(j)[1], wcol(j)[i] are still supported in cell formula but doesn't not work well with extending formula in some cases etc.</li>
<li> wcol(j) refers to jth column may not be reliable since the value of J is undetermined except in a multi-column formula, e.g. it doesn't work when used in function argument to return a string. Try to use <i>This</i> instead when you can.</li>
<li> Extending a cell formula across <i>many</i> rows and columns can strain system resources and may cause Origin to freeze. In many cases, you can accomplish the same task using more easily using <a class="external text" href="../../UserGuide/Category/Using_Formulae_to_Set_or_Transform_Worksheet_Column_Values.html">Set Column Values</a></li></ul>
<h2><a name="Formula_Bar"></a><span class="mw-headline">Formula Bar</span></h2>
<p>The View: Formula Bar introduced in Origin 2021 is an Excel-like bar allowing you to enter or view formula or on cell or column formula/expressions. While it is not necessary to use the Formula Bar to enter cell expressions, it does offer the advantages
</p>
<dl><dd><ul><li> easier way to enter and view long expressions that exceed cell width.</li>
<li> search functions by clicking <a  class="image"><img alt="FB FunSel.png" src="../images/Using_Formulae_to_Set_Cell_Values/FB_FunSel.png?v=86738" width="23"  /></a> button to open the <a href="../../UserGuide/UserGuide/Menu_Options_and_Dialog_Controls.html#Search_and_Insert_Functions" title="UserGuide:Menu Options and Dialog Controls">Search and Insert Functions</a> dialog</li>
<li> interactive range selection in expression by clicking on column heading, cell or drag to select a range. Note: not supported for different book</li>
<li> define a named range by selecting a range and then type name on left side of formula bar</li>
<li> locate a named range by selecting a ranged range on left side of formula bar</li></ul></dd></dl>
<p><a  class="image"><img alt="UG Formula Bar UI.png" src="../images/Using_Formulae_to_Set_Cell_Values/UG_Formula_Bar_UI.png?v=89840" width="790"  /></a>
</p><p><br />
</p><p>Note: Change the font size by changing the value of <a class="external text" href="../../LabTalk/LabTalk/System_Variable_List.html#F.2CG">system variable @FBFS</a> (default is "130").
</p>
<h2><a name="User_Parameter_Row_Formula"></a><span class="mw-headline">User Parameter Row Formula</span></h2>
<p>Beginning with Origin 2019, you can right-click on the column label row headings, <b>Add User Parameters</b> and name and <a href="../../UserGuide/UserGuide/Displaying_Supporting_Data_in_Worksheet_Header_Rows.html#Define_a_Formula_when_you_Add_User_Parameters" title="UserGuide:Displaying Supporting Data in Worksheet Header Rows">define a formula</a> for the entire row. This is handy for calculating key statistics (e.g. mean, std. deviation) for each column of numbers in a worksheet.
</p>
<dl><dd><a  class="image"><img alt="User parameter formula.png" src="../images/Using_Formulae_to_Set_Cell_Values/600px-User_parameter_formula.png?v=82834" width="600"   /></a></dd></dl>
<p>The column formula uses the placeholder "<b>This</b>" as a wildcard reference to each column in the worksheet (see next section). 
</p><p>Once a row formula has been created, you can edit the <b>Name</b> and <b>Formula</b> by right-clicking on your User Parameter row heading and choosing <b>Edit</b> from the shortcut menu. You can edit cell formulas individually by double-clicking directly into a User Parameter row cell.
</p>
<dl><dd><a  class="image"><img alt="HeaderRowLookup1.gif" src="../images/Using_Formulae_to_Set_Cell_Values/HeaderRowLookup1.gif?v=93316" width="912"  /></a></dd></dl>
<table class="noborder"><tr>
	<td style="vertical-align:top" width="60"><img src="../images/Using_Formulae_to_Set_Cell_Values/Tip_icon.png?v=9614" width="57"  border="0" /></td><td><p>You can copy a formula-defined user-parameter row to multiple worksheets by <b>Apply User Parameters to</b> mini toolbar button <a  class="image"><img alt="Popup Apply User Parameters to.png" src="../images/Using_Formulae_to_Set_Cell_Values/Popup_Apply_User_Parameters_to.png?v=94915" width="21"  /></a>. See details <a href="../../UserGuide/UserGuide/Displaying_Supporting_Data_in_Worksheet_Header_Rows.html#Define_a_Formula_when_you_Add_User_Parameters" title="UserGuide:Displaying Supporting Data in Worksheet Header Rows">here</a>.<a  class="image"><img alt="Apply User Parameters to Other Sheets.png" src="../images/Using_Formulae_to_Set_Cell_Values/Apply_User_Parameters_to_Other_Sheets.png?v=94920" width="417"  /></a>
</p></td></tr></table>
<h2><a name="Related_System_Variables"></a><span class="mw-headline">Related System Variables</span></h2>
<ul><li> @esc</li></ul>
<p>Enable or disable worksheet cell formula. 
1 - enable, 0 - disable
</p>
<ul><li> @xlr</li></ul>
<p>Controls use of Excel-style multi-cell references incorporating the colon character ":", in worksheet cell formulas (e.g. "=total(A1:A10)" or "=total(A1:C1)" <br />
1 - enable, 0 - disable
</p><p>Note: Origin-style references such as "=total(A[1:10]) are not affected. However, there is no multi-column support with this notation. For multi-column range specification you must use Excel-style notation (e.g. "=total(A1:D10)").
</p>
<ul><li> @fac</li></ul>
<p>Controls autocomplete support in column formulas (Set Values) and cell formulas<br />
0 - disable for both, 1 - enable for cell formula, 2 - enable for column formula, 3 - enable for both
</p>
<h2><a name="See_Also"></a><span class="mw-headline">See Also</span></h2>
<ul><li> <a class="external text" href="../../UserGuide/UserGuide/Excel_and_Origin_Functions_Comparison.html">Origin &amp; Excel Functions Comparison</a></li>
<li> <a class="external text" href="../../LabTalk/LabTalk/Column_Label_Row_Characters.html">Column Label Row Characters</a> </li>
<li> <a class="external text" href="../../QuickHelp/QuickHelp/Auto_fill_complete_row_column.html">Auto Fill Cells</a></li>
<li> <a class="external text" href="../../LabTalk/LabTalk/Range_Notation.html">Range Notation</a></li>
<li> <a class="external text" href="../../UserGuide/UserGuide/Inserting_Links_into_Worksheet_Cells.html">Insert links from other cells</a></li>
<li> <a class="external text" href="../../LabTalk/Script/LabTalk-Supported_Functions.html#String_Functions">LT Supported String Functions</a> </li>
<li> <a class="external text" href="../../LabTalk/Category/String_and_Characters_(Labtalk).html">Documentation for individual string and character functions</a></li></ul>


