<h1 class="firstHeading">14.2.3 Gridding Methods for Randomly Spaced Data</h1><p class='urlname' style='display: none'>GridMethod-RandomSpaced</p>
<p>When your worksheet data are not regularly spaced in the X and Y dimensions, then you should use one of Origin's 5 gridding methods for <b>random</b> or irregularly-spaced XY data:
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Renka_Cline"><span class="tocnumber">1</span> <span class="toctext">Renka Cline</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Shepard"><span class="tocnumber">2</span> <span class="toctext">Shepard</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Thin_Plate_Spline_.28TPS.29"><span class="tocnumber">3</span> <span class="toctext">Thin Plate Spline (TPS)</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Kriging_Correlation"><span class="tocnumber">4</span> <span class="toctext">Kriging Correlation</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Weighted_Average"><span class="tocnumber">5</span> <span class="toctext">Weighted Average</span></a></li>
</ul>
</div>

<h2><a name="Renka_Cline"></a><span class="mw-headline">Renka Cline</span></h2>
<p>This gridding method is based on the algorithm of Renka and Cline (1984). In sequence, the primary operations are: 
</p>
<ol><li><b>Triangulation</b>.  A triangulation is performed on the XY data.  Triangles are as nearly equiangular as possible.</li>
<li><b>Gradient Estimation</b>.  Estimate a gradient in the XY directions for each node, as the partial derivatives of a quadratic function. </li>
<li><b>Interpolation</b>.  For an arbitrary point <i>P</i>, compute the interpolated value using the data values and gradient estimates at each of the three vertices of the triangle which contains <i>P</i>. </li></ol>
<p>In the case of 200~1000 uniformly distributed data points, the Renka-Cline method is a good choice.
</p>
<h2><a name="Shepard"></a><span class="mw-headline">Shepard</span></h2>
<p>This method implements the modified Shepard gridding method as described by Franke and Nielson. This is a distance-based weighted gridding method which interpolates data by:
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-046a76c7575020226962aafe30d62999.png?v=0" title="F(x,y)=\sum_{i=1}^nF_iW_i(x,y) " alt="F(x,y)=\sum_{i=1}^nF_iW_i(x,y) " class="tex"/>,
</p><p>where <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-a70f2fe89b3d58e24bfe2e43b20f6b1c.png?v=0" title="F_i\,\!" alt="F_i\,\!" class="tex"/> is the underlying function at nodes (<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-d2583020b138319a535bc3c88278ab33.png?v=0" title="x_i\,\!" alt="x_i\,\!" class="tex"/>, <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f3c2749e4798fa8385fdc00a0aa7bea4.png?v=0" title="y_i\,\!" alt="y_i\,\!" class="tex"/>), and <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-4f155925eba0ec05988f496352de5c92.png?v=0" title="W_i(x, y)\,\!" alt="W_i(x, y)\,\!" class="tex"/> is the weights. To localize the calculation, <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-a70f2fe89b3d58e24bfe2e43b20f6b1c.png?v=0" title="F_i\,\!" alt="F_i\,\!" class="tex"/> and <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-73d0207a12f616a8034bdcea6ef1baef.png?v=0" title="W_i\,\!" alt="W_i\,\!" class="tex"/> are computed from the data points lying within the circle with center (<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-d2583020b138319a535bc3c88278ab33.png?v=0" title="x_i\,\!" alt="x_i\,\!" class="tex"/>, <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f3c2749e4798fa8385fdc00a0aa7bea4.png?v=0" title="y_i\,\!" alt="y_i\,\!" class="tex"/>) of radius <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f4a9da512ddea571833f00f353c5f55e.png?v=0" title="R_q\,\!" alt="R_q\,\!" class="tex"/> and <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png?v=0" title="R_w\,\!" alt="R_w\,\!" class="tex"/>, respectively. 
</p><p>To begin with, the weights are defined as:
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-38c5b98f93592d46af674dc705356f2d.png?v=0" title="w_i(x,y)=\frac{w_i(x,y)}{\sum_{k=1}^nw_k(x,y)}" alt="w_i(x,y)=\frac{w_i(x,y)}{\sum_{k=1}^nw_k(x,y)}" class="tex"/>.
</p><p>For a given radius <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png?v=0" title="R_w\,\!" alt="R_w\,\!" class="tex"/>, the relative weight <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-1e1d2f2f6d95a2f415901e6fab3b635f.png?v=0" title="w_k\,\!" alt="w_k\,\!" class="tex"/> is:
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-0e141a3a2c838ddf192009baaf5116ad.png?v=0" title="w_k=[\frac{(R_w-d_k)_{+}}{R_wd_k}]^2" alt="w_k=[\frac{(R_w-d_k)_{+}}{R_wd_k}]^2" class="tex"/>  for
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-c0d1de70468f4f461eceb23eafebe540.png?v=0" title=" \begin{cases}&#10;R_w-d_k \, if \, d_k&lt;R_w,\\&#10;0      \, if \, d_k\geq R_w,&#10;\end{cases} " alt=" \begin{cases}&#10;R_w-d_k \, if \, d_k&lt;R_w,\\&#10;0      \, if \, d_k\geq R_w,&#10;\end{cases} " class="tex"/>
</p><p>and <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-5a3ba457aaab0599d360b88b190d197b.png?v=0" title="d_k\,\!" alt="d_k\,\!" class="tex"/> is the Euclidean distance between (<i>x, y</i>) and (<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-32c64e570a3b92171cb6bd0c09b98125.png?v=0" title="x_k\,\!" alt="x_k\,\!" class="tex"/>, <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e3670e72563d416ec064b9d1465cdcfb.png?v=0" title="y_k\,\!" alt="y_k\,\!" class="tex"/>):
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-6cd12b96ce8d8fe8981205d56830b561.png?v=0" title="d_k=||(x_k,y_k)-(x,y)||_2\,\!" alt="d_k=||(x_k,y_k)-(x,y)||_2\,\!" class="tex"/>.
</p><p>For any <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png?v=0" title="R_w\,\!" alt="R_w\,\!" class="tex"/> &gt; 0, we have:
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-47517424fc2c0152f170fa76ce90e5d7.png?v=0" title="W_i(x_j,y_j)\,\!" alt="W_i(x_j,y_j)\,\!" class="tex"/>=<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-2bdc297be795bd2217387ddca4de2bb8.png?v=0" title=" \begin{cases}&#10;1,i=j\\&#10;0,otherwise&#10;\end{cases} " alt=" \begin{cases}&#10;1,i=j\\&#10;0,otherwise&#10;\end{cases} " class="tex"/>
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-6bde42bb59761a6d156975da477e3c7f.png?v=0" title="\sum_{k=1}^nW_k(x,y)=1" alt="\sum_{k=1}^nW_k(x,y)=1" class="tex"/>.
</p><p>Subsequently, the nodal function <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-a70f2fe89b3d58e24bfe2e43b20f6b1c.png?v=0" title="F_i\,\!" alt="F_i\,\!" class="tex"/> is replaced by a local approximation function <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-0b6a79d78111f43c7b4f10e424b086c6.png?v=0" title="Q_k\,\!" alt="Q_k\,\!" class="tex"/>:
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-9e8d6a36a765b21fff0bfdfad4dc6f9b.png?v=0" title="Q_k(x,y)=c_{k1}(x-x_k)^2+c_{k2}(x-x_k)(y-y_k)+c_{k3}(y-y_k)^2+c_{k4}(x-x_k)+c_{k5}(y-y_k)+F_k\,\!" alt="Q_k(x,y)=c_{k1}(x-x_k)^2+c_{k2}(x-x_k)(y-y_k)+c_{k3}(y-y_k)^2+c_{k4}(x-x_k)+c_{k5}(y-y_k)+F_k\,\!" class="tex"/>
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-0b6a79d78111f43c7b4f10e424b086c6.png?v=0" title="Q_k\,\!" alt="Q_k\,\!" class="tex"/> is the weighted least-square quadratic fitted function to the data located within <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f4a9da512ddea571833f00f353c5f55e.png?v=0" title="R_q\,\!" alt="R_q\,\!" class="tex"/> of nodal points. So the coefficients minimize:
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-8ab8ecc395dfc1db378345af3deb4929.png?v=0" title="\varepsilon _k=\sum_{i=1,j\neq k}^N\omega _i(x_k,y_k)[c_{k1}(x_i-x_k)^2+\ldots +c_{k5}(y_i-y_k)+F_k-F_i]^2" alt="\varepsilon _k=\sum_{i=1,j\neq k}^N\omega _i(x_k,y_k)[c_{k1}(x_i-x_k)^2+\ldots +c_{k5}(y_i-y_k)+F_k-F_i]^2" class="tex"/>
</p><p>for
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-82914bba8b91c96a6d5fe1c5865f7fe6.png?v=0" title="\omega _i(x,y)=[\frac{(R_q-d_i)_{+}}{R_qd_i}]^2=[\frac{(R_q-||(x_i,y_i)-(x,y)||_2)_{+}}{R_q||(x_i,y_i)-(x,y)||_2}]^2" alt="\omega _i(x,y)=[\frac{(R_q-d_i)_{+}}{R_qd_i}]^2=[\frac{(R_q-||(x_i,y_i)-(x,y)||_2)_{+}}{R_q||(x_i,y_i)-(x,y)||_2}]^2" class="tex"/>.
</p><p>It can be seen above that the interpolation function is a local approximation function and depends on the radius of influence about nodal points, <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f4a9da512ddea571833f00f353c5f55e.png?v=0" title="R_q\,\!" alt="R_q\,\!" class="tex"/> and <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png?v=0" title="R_w\,\!" alt="R_w\,\!" class="tex"/>.  Two integers,<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-b840101c43afb2134744afa5efd1aac0.png?v=0" title=" N_q\,\!" alt=" N_q\,\!" class="tex"/> and <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-585ed64091518f9443b460c06ab9dd5d.png?v=0" title="N_w\,\!" alt="N_w\,\!" class="tex"/> are used to calculate <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f4a9da512ddea571833f00f353c5f55e.png?v=0" title="R_q\,\!" alt="R_q\,\!" class="tex"/> and <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png?v=0" title="R_w\,\!" alt="R_w\,\!" class="tex"/> (these are the parameters <i>q</i> and <i>w</i> of the function, and are referred to as <a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="UserGuide:The XYZ Gridding Dialog Box">the Quadratic Interpolant Locality Factor</a> and <a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="UserGuide:The XYZ Gridding Dialog Box">Weight Function Locality Factor</a>, respectively): (for more information, please see "The XYZ Gridding Dialog Box" later in this section.)
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-4adf5de03f21dc72859d55d561d09e9e.png?v=0" title="R_q=\frac D2\sqrt{\frac{N_q}n}" alt="R_q=\frac D2\sqrt{\frac{N_q}n}" class="tex"/>    and   <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-33cd7fd3e109a8dc3aef57f28cae9bdc.png?v=0" title="R_w=\frac D2\sqrt{\frac{N_w}n}" alt="R_w=\frac D2\sqrt{\frac{N_w}n}" class="tex"/>,
</p><p>where <i>n</i> is the number of data points and <i>D</i> is the maximum distance between any pair of data points.  So <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-d745ee190affc7e9ec213bbf0491db99.png?v=0" title="N_q\,\!" alt="N_q\,\!" class="tex"/> and <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-585ed64091518f9443b460c06ab9dd5d.png?v=0" title="N_w\,\!" alt="N_w\,\!" class="tex"/> can be considered to be the average numbers of data points lying within distances <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f4a9da512ddea571833f00f353c5f55e.png?v=0" title="R_q\,\!" alt="R_q\,\!" class="tex"/> and <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png?v=0" title="R_w\,\!" alt="R_w\,\!" class="tex"/> respectively, of each node.
</p><p>Increasing the values of <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-d745ee190affc7e9ec213bbf0491db99.png?v=0" title="N_q\,\!" alt="N_q\,\!" class="tex"/> and <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-585ed64091518f9443b460c06ab9dd5d.png?v=0" title="N_w\,\!" alt="N_w\,\!" class="tex"/> will make the calculation more global; likewise, decreasing their values will make the calculation more local.   Generally speaking, setting <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-b51dc46717c1ae569afeeee234ebfb97.png?v=0" title="N_q \approx  2N_w" alt="N_q \approx  2N_w" class="tex"/> works well.  By default, <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-002e750f292f49bb2f7a73ff55014761.png?v=0" title="N_q= 18\,\!" alt="N_q= 18\,\!" class="tex"/>, and <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-20e3e4c31d474bb53d9791614e49d54f.png?v=0" title="N_w= 9\,\!" alt="N_w= 9\,\!" class="tex"/>. However, the following constraints must be satisfied: <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-657800af90a95b5de2f6f2e8fef95f20.png?v=0" title="0 &lt; N_w \leq  N_q" alt="0 &lt; N_w \leq  N_q" class="tex"/>.  
</p><p>The <a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html" title="UserGuide:The XYZ Gridding Dialog Box">XYZ Gridding</a> dialog box calls the NAG library to perform the Shepard gridding method.  Origin also provides these X-Function-based Shepard gridding methods: <a class="external text" href="../../XFunction/X-Function/Xyz_shep_nag.html">xyz_shep_nag</a> and <a class="external text" href="../../XFunction/X-Function/Xyz_shep.html">xyz_shep</a>, which implements this method using <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-f4a9da512ddea571833f00f353c5f55e.png?v=0" title="R_q\,\!" alt="R_q\,\!" class="tex"/> and <img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-e37dbd7ccd7df3041a197ebcc1664ac4.png?v=0" title="R_w\,\!" alt="R_w\,\!" class="tex"/>.
</p>
<h2><a name="Thin_Plate_Spline_.28TPS.29"></a><span class="mw-headline">Thin Plate Spline (TPS)</span></h2>
<p>This function provides a method for random matrix conversion based on <b>Thin Plate Spline</b> (TPS) algorithm. Thin Plate Spline is a physical interpolation method.  To generate gridding data, this method assumes that all the data points are distributed on a thin, elastic plate, or spline. The plate is constrained at the grid points and forms a 2-dimensional surface by spanning the grid points.  The surface is deformed between the points to form a likely fit to the data.  The best results are generally found by minimizing the so-called "bending energy function" of the spline.
</p><p>Since this method involves minimizing the bending energy, the less deformation of the plate the better. This calculation is similar to minimum curvature computing.  Surface plots produced by TPS gridding may exhibit a greater degree of smoothness than those produced by other methods, so this method is best suited to interpolation of locally flat surfaces.
</p><p>The mathematical description of the TPS algorithm is, given the bending energy function:
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-07c30f20d63ad99e8f95ba274c88f8d1.png?v=0" title="I=\iint_{R^2}(f_{xx}^2+2f_{xy}^2+f_{yy}^2)dxdy" alt="I=\iint_{R^2}(f_{xx}^2+2f_{xy}^2+f_{yy}^2)dxdy" class="tex"/>,
</p><p>and the minimizing function is:
</p><p><img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-dbf9fb6d39144cdd4eca3dab5b8ed2d3.png?v=0" title="f(x,y)=a_1+a_xx+a_yy+\sum_{i=1}^pw_iU(||(x_i,y_i)-(x,y)||)" alt="f(x,y)=a_1+a_xx+a_yy+\sum_{i=1}^pw_iU(||(x_i,y_i)-(x,y)||)" class="tex"/>,
</p><p>where<img src="../images/Gridding_Methods_for_Randomly_Spaced_Data/math-79150ff3c0545da1261d60ea5774478e.png?v=0" title="U(r)=r^2\log (r^2)\,\!" alt="U(r)=r^2\log (r^2)\,\!" class="tex"/>. 
</p><p>To perform TPS gridding, you need to specify the <a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="UserGuide:The XYZ Gridding Dialog Box">Smoothing</a> parameter, which controls the smoothness of the interpolated surface and the <a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="UserGuide:The XYZ Gridding Dialog Box">Extrapolation</a> parameter, which influences matrix cell values lying outside of the original data range. 
</p><p>For more detailed information on TPS, please see <a href="../../UserGuide/UserGuide/References,_Matrix_Conversion_and_Gridding.html" title="UserGuide:References, Matrix Conversion and Gridding">Donato and Belongie, Approximation Methods for Thin Plate Spline Mappings and Principal Warps</a>.
</p>
<h2><a name="Kriging_Correlation"></a><span class="mw-headline">Kriging Correlation</span></h2>
<p>Kriging -- named for mining engineer D. G. Krige -- is an established geostatistical method for interpolating spatial data. This technique employs a weighted moving average interpolation (extrapolation) method that minimizes the estimated variance of a predicted point (grid nodes) from the weighted average of its neighbors.  The weighted value is determined by the spatial correlation structure of the original data. 
</p><p>This algorithm requires a model of spatial continuity, or dependence.  Typically, we separate the process into two steps:
</p>
<ol><li>We generate semivariograms of the regionalized variables being estimated. Origin calculates the distance information and produces a table of semivariance values stored in a table, and weights the semivariance data. This semivariogram describes the increasing difference or decreasing correlation between samples in the input dataset. </li>
<li>We use this dependence model to calculate the spatial point value of z.</li></ol>
<p>When performing kriging, you can control the process by configuring the following parameters:
</p>
<ul><li><a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="UserGuide:The XYZ Gridding Dialog Box">Smoothing</a>: controls interpolation precision.</li></ul>
<ul><li><a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="UserGuide:The XYZ Gridding Dialog Box">Minimum Points</a>: sets the minimum number of control points needed for calculation of z.</li></ul>
<ul><li><a href="../../UserGuide/UserGuide/The_XYZ_Gridding_Dialog_Box.html#Gridding_Method_and_Parameters" title="UserGuide:The XYZ Gridding Dialog Box">Search Radius</a>: determines the set of nearby control points used in calculation of z.</li></ul>
<p>For more detailed information on kriging, please see <a href="../../UserGuide/UserGuide/References,_Matrix_Conversion_and_Gridding.html" title="UserGuide:References, Matrix Conversion and Gridding">Stein, Interpolation of Spatial Data</a>.
</p>
<h2><a name="Weighted_Average"></a><span class="mw-headline">Weighted Average</span></h2>
<p>The weighted average method is a simple weighted average of the points with the weight equal to 1/r, where r is the distance of each point from the cell within the searching radius.  If there is no value within the search radius, the radius is increased until at least one point is encountered.  Increasing the search radius means that each point is more interrelated to neighboring points, producing a smoother surface that may lose fine details.
</p>





