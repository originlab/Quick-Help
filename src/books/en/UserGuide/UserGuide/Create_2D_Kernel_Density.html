<h1 class="firstHeading">17.2.7 2D Kernel Density</h1><p class='urlname' style='display: none'>Create-2D-Kernel-Density</p>
<p><br />
</p><p>The 2D Kernel Density plot is a smoothed color density representation of the scatterplot, based on kernel density estimation, a nonparametric technique for probability density functions. The goal of density estimation is to take a finite sample of data and to infer the underyling probability density function everywhere, including where no data point are presented. In kernel density estimation, the contribution of each data point is smoothed out from a single point into a region of vicinity. These smoothed density plot shows an average trend for the scatter plot.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Creating_2D_Kernel_Density_Plot"><span class="tocnumber">1</span> <span class="toctext">Creating 2D Kernel Density Plot</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#The_Dialog_of_plot_kde2"><span class="tocnumber">2</span> <span class="toctext">The Dialog of plot_kde2</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Algorithm"><span class="tocnumber">3</span> <span class="toctext">Algorithm</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Density_Calculation_Method"><span class="tocnumber">3.1</span> <span class="toctext">Density Calculation Method</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="#Exact_Estimation"><span class="tocnumber">3.1.1</span> <span class="toctext">Exact Estimation</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#Binned_Approximate_Estimation"><span class="tocnumber">3.1.2</span> <span class="toctext">Binned Approximate Estimation</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-7"><a href="#Bandwidth_Methods"><span class="tocnumber">3.2</span> <span class="toctext">Bandwidth Methods</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="#Bivariate_Kernel_Density_Estimator"><span class="tocnumber">3.2.1</span> <span class="toctext">Bivariate Kernel Density Estimator</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="#Rule_of_Thumb"><span class="tocnumber">3.2.2</span> <span class="toctext">Rule of Thumb</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-10"><a href="#Interpolate_Density_Points"><span class="tocnumber">3.3</span> <span class="toctext">Interpolate Density Points</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><a name="Creating_2D_Kernel_Density_Plot"></a><span class="mw-headline">Creating 2D Kernel Density Plot</span></h2>
<p>To create a 2D Kernel Density plot:
</p>
<ol><li>Highlight one Y column.</li>
<li>Open 2D Kernel Density plot dialog by clicking <b>Plot &gt; Contour: 2D Kernel Density</b>.</li>
<li>In the plot_kde2 dialog box, specify the <i>Method<b> , </b>Number of Grid Points in X/Y<b> and the </b>Number of Points to Display, and <b>Plot Type</b>.</i></li>
<li>Click <b>OK</b> to create a 2D Kernel Density plot.
<dl><dd><a  class="image"><img alt="2D-Kernel.png" src="../images/Create_2D_Kernel_Density/2D-Kernel.png?v=46720" width="452"  /></a></dd></dl></li></ol>
<h2><a name="The_Dialog_of_plot_kde2"></a><span class="mw-headline">The Dialog of plot_kde2</span></h2>
<dl><dd><dl><dd><a  class="image"><img alt="2D Kernel Density dialog.png" src="../images/Create_2D_Kernel_Density/2D_Kernel_Density_dialog.png?v=84099" width="466"  /></a></dd></dl></dd></dl>
<table class="dialogcontroltable">

<tr>
<td>
<p><b>Input Data</b>
</p>
</td>
<td>
<p>Specify the input data.
</p>
</td></tr>
<tr>
<td>
<p><b>Settings</b>
</p>
</td>
<td>
<dl><dd><b>Bandwidth Method</b>
<dl><dd>Specify the bandwidth calculation method of the 2D Kernel Density plot.
<ul><li><b>Bivariate Kernel Density Estimator</b></li>
<li><b>Rules of Thumb</b></li></ul></dd></dl></dd>
<dd><b>Density Method</b>
<dl><dd>Specify a method to calculate the kernel density for defined XY grids.
<ul><li><b>Exact Estimation</b></li></ul>
<dl><dd> Choose the option to calculate density values according to the <a class="external text" href="../../LabTalk/LabTalk/Ks2density_(function).html">Ks2density</a> equation. For a large dataset, computation of the exact computation may require extensive calculation,</dd></dl>
<ul><li><b>Binned Approximate Estimation</b></li></ul>
<dl><dd>  Choose the option to calculate approximation of density values. This option is recommended for a large sample.</dd></dl></dd></dl></dd></dl>
<dl><dd><b>Number of Points to Display</b>
<dl><dd>Specify the first N lowest density points to be superimposed on the density image.</dd></dl></dd></dl>
<dl><dd><b>Interpolate Density Points</b>
<dl><dd> Specify the calculation method to decide which points to superimposed on the density image (see details in below <a href="#Interpolate_Density_Points">Algorithm section</a>). Usually if the number of source data is large (ie. &gt;50000), we strongly recommend to select this option to improve the speed. </dd></dl></dd></dl>
<dl><dd><b>Number of Grid Points in X/Y</b>
<dl><dd>Specify the number of equally spaced grid points for the density estimation.</dd></dl></dd>
<dd><b>Number of Points to Display</b>
<dl><dd>Specify the first N lowest density points to be superimposed on the density image when the checkbox of <b>All</b> is unchecked. Otherwise, it will display all points when the <b>All</b> checkbox is selected by default.</dd></dl></dd>
<dd><b>Grid Range</b>
<dl><dd>As an interim step, a matrix of gridded values is generated from the X/Y data and the kernel density plot is created from the matrix values. By default, the <b>Grid Range</b> registers the minimum and maximum X and Y values in that matrix. Clear the <b>Auto</b> box to enter a value manually.
<ul><li><b>X Minimum</b></li>
<li><b>X Maximum</b></li>
<li><b>Y Minimum</b></li>
<li><b>Y Maximum</b></li></ul></dd></dl></dd>
<dd><b>Plot Type</b>
<dl><dd>Specify the plot type.
<ul><li><b>Contour</b></li></ul>
<dl><dd>Use the density matrix to plot contour</dd></dl></dd></dl></dd></dl>
<dl><dd><dl><dd><ul><li><b>Image</b></li></ul>
<dl><dd>Use the density matrix to make an image plot</dd></dl></dd></dl></dd></dl>
</td></tr>
<tr>
<td>
<p><b>Density Estimation data</b>
</p>
</td>
<td>
<p>This determines where the calculated data for the graph is stored.
</p>
</td></tr>
<tr>
<td>
<p><b>Displaying Data</b>
</p>
</td>
<td>
<p>This determines where the data of the displayed scatter plot is stored. Only available when <b>Number of Points to Display</b> is not 0.
</p>
</td></tr></table>
<h2><a name="Algorithm"></a><span class="mw-headline">Algorithm</span></h2>
<p>Kernel density estimation is a nonparametric technique to estimate density of scatter points. The goal of density estimation is to estimate underlying probability density function everywhere, including where no data are observed, from the existing scatter points. A kernel function is created with the datum at its center â€“ this ensures that the kernel is symmetric about the datum. Kernel density estimation smooths the contribution of data points to give overall picture of the density of data points. 
</p>
<dl><dd><a  class="image"><img alt="Density grids.png" src="../images/Create_2D_Kernel_Density/Density_grids.png?v=83987" width="360"  /></a></dd></dl>
<h4><a name="Density_Calculation_Method"></a><span class="mw-headline">Density Calculation Method</span></h4>
<p>Specify a method to calculate the kernel density for defined xy grids.
</p>
<h5><a name="Exact_Estimation"></a><span class="mw-headline">Exact Estimation</span></h5>
<p>Density values are calculated based on the equation below
</p><p><img src="../images/Create_2D_Kernel_Density/math-ca8f0550c764c6ca39d8c58ad1acbded.png?v=0" title="f(x,y,\text{vX},\text{vY},w_x,w_y) = \frac{1}{n} \sum_{i=1}^{n} \frac{1}{ 2\pi w_x w_y }  \exp \left(-\frac{(x-\text{vX}_i)^2}{2w_x ^2} - \frac{(y-\text{vY}_i)^2}{2w_y^2} \right)" alt="f(x,y,\text{vX},\text{vY},w_x,w_y) = \frac{1}{n} \sum_{i=1}^{n} \frac{1}{ 2\pi w_x w_y }  \exp \left(-\frac{(x-\text{vX}_i)^2}{2w_x ^2} - \frac{(y-\text{vY}_i)^2}{2w_y^2} \right)" class="tex"/>
</p><p>where <i>n</i> is the number of elements in vector vX or vY, <img src="../images/Create_2D_Kernel_Density/math-d42590de7df507482af1323d9ced6ebd.png?v=0" title="\text{vX}_i" alt="\text{vX}_i" class="tex"/> is <i>ith</i> element in vector vX and <img src="../images/Create_2D_Kernel_Density/math-cc693045aa2161426c9f2b97f77a6a49.png?v=0" title="\text{vY}_i" alt="\text{vY}_i" class="tex"/> is <i>ith</i> element in vector vY. <img src="../images/Create_2D_Kernel_Density/math-4a5d1969fe1ef947082a32d547c247d7.png?v=0" title="w_x" alt="w_x" class="tex"/> and <img src="../images/Create_2D_Kernel_Density/math-e939f0323d8d49a8482b30a5284c8374.png?v=0" title="w_y" alt="w_y" class="tex"/> is the optimal bandwidths values.
</p>
<h5><a name="Binned_Approximate_Estimation"></a><span class="mw-headline">Binned Approximate Estimation</span></h5>
<p>Speed up the density calculation by an approximation to the exact estimation of 2D kernel density.
</p><p>First 2D binning is performed on the (x, y) points to obtain a matrix with the bin counts.  Then 2D Fast Fourier Transform is utilized to perform discrete convolutions for calculating density values of each grid. 
</p><p>4th root of density values is calculated to map the density scale to the color scale
</p>
<h4><a name="Bandwidth_Methods"></a><span class="mw-headline">Bandwidth Methods</span></h4>
<h5><a name="Bivariate_Kernel_Density_Estimator"></a><span class="mw-headline">Bivariate Kernel Density Estimator</span></h5>
<p>Calculate bandwidth based on linear diffusion process.
</p>
<h5><a name="Rule_of_Thumb"></a><span class="mw-headline">Rule of Thumb</span></h5>
<p>The estimation of <i>wx</i> and <i>wy</i> simply can be calculated by:
</p>
<dl><dd><img src="../images/Create_2D_Kernel_Density/math-cec7115d5d7539d52893269c30efe6e0.png?v=0" title="w_x = \frac{\sigma_x}{2n^{1/6}}" alt="w_x = \frac{\sigma_x}{2n^{1/6}}" class="tex"/></dd>
<dd><img src="../images/Create_2D_Kernel_Density/math-10e70e705a9ba4b7186d81a054f0ae60.png?v=0" title="w_y = \frac{\sigma_y}{2n^{1/6}}" alt="w_y = \frac{\sigma_y}{2n^{1/6}}" class="tex"/></dd></dl>
<p>where <i>n</i> is the size of vector vX or vY, <img src="../images/Create_2D_Kernel_Density/math-5bd0825b15108cd960569affb725147c.png?v=0" title="\sigma_x" alt="\sigma_x" class="tex"/> is the sample standard variation for dataset vX, and <img src="../images/Create_2D_Kernel_Density/math-ba323dc814191392965d1fa1728664fc.png?v=0" title="\sigma_y" alt="\sigma_y" class="tex"/> for dataset vY accordingly.
</p><p><br />
</p>
<h4><a name="Interpolate_Density_Points"></a><span class="mw-headline">Interpolate Density Points</span></h4>
<p>Specify the calculation method to decide which points to superimpose on the density image. 
</p><p>If the option is selected, kernel density of points are calculated by the interpolation on the density matrix for defined XY grids. If number of source data is very large, selecting the option can greatly improve the speed.
</p><p>If the option is not selected, the density values will be calculated by the <a href="#Exact_Estimation">Exact Estimation method</a>.
</p>





