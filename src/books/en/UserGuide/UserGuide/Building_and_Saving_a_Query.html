<h1 class="firstHeading">6.9.1 Building and Saving a Query</h1><p class='urlname' style='display: none'>ImpDatabase-BuildSave-Query</p>
<p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Connecting_to_a_Datasource"><span class="tocnumber">1</span> <span class="toctext">Connecting to a Datasource</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Connection_String"><span class="tocnumber">1.1</span> <span class="toctext">Connection String</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#OBDC_data_source"><span class="tocnumber">1.2</span> <span class="toctext">OBDC data source</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#ODBC_driver"><span class="tocnumber">1.3</span> <span class="toctext">ODBC driver</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Windows_.22Data_Link_Properties.22_dialog"><span class="tocnumber">1.4</span> <span class="toctext">Windows "Data Link Properties" dialog</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#OLE_DB"><span class="tocnumber">1.5</span> <span class="toctext">OLE DB</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Building_a_query"><span class="tocnumber">2</span> <span class="toctext">Building a query</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Saving_a_query"><span class="tocnumber">3</span> <span class="toctext">Saving a query</span></a></li>
</ul>
</div>

<h2><a name="Connecting_to_a_Datasource"></a><span class="mw-headline">Connecting to a Datasource</span></h2>
<p>To import SQL data, start with the <b>Data: Connect to Database</b> menu command:
</p>
<ul><li> To open a saved connection (ODS) or query (ODQ) file, click <b>Open</b>. If your connection is valid, this opens <a href="../../UserGuide/UserGuide/The_SQL_Editor_Dialog_Box.html" title="UserGuide:The SQL Editor Dialog Box">the <b>SQL Editor</b> dialog box</a>.</li>
<li> If you have <i>not</i> previously connected to your datasource, you will need to set up a connection. </li></ul>
<dl><dd><ol><li>Click <b>New</b> to open the <b>Database Connector</b> dialog. </li></ol>
<dl><dd><a  class="image"><img alt="DB database connector dialog.png" src="../images/Building_and_Saving_a_Query/DB_database_connector_dialog.png?v=85732" width="327"  /></a></dd></dl>
<ul><li> <b>Connection string</b>: Select this if you already have a text-based connection string for a given data source (ODBC or OLE DB).</li>
<li> <b>ODBC data source</b>: Select this if you have defined an ODBC data source via the Windows <b>ODBC Data Source Administrator</b> applet.</li>
<li> <b>ODBC driver</b>: Select this if you have an ODBC driver and want to create a data source applicable to this data connector instance.</li>
<li> <b>Windows Data Link Properties dialog</b>: Select this if you are using an OLE DB-based data source such as some SQL Server or Access client libraries.</li></ul></dd></dl>
<h3><a name="Connection_String"></a><span class="mw-headline">Connection String</span></h3>
<p>Connection Strings are a useful method for quickly establishing a new connection from an existing connection.
</p>
<ol><li> If you already have a valid connection string to an ODBC or OLE DB datasource, choose this option and enter your connection string.</li>
<li> If the authentication/login info in a connection string is encrypted, you will be asked to re-enter this information.  If your connection string is valid, this opens <a href="../../UserGuide/UserGuide/The_SQL_Editor_Dialog_Box.html" title="UserGuide:The SQL Editor Dialog Box">the <b>SQL Editor</b> dialog box</a>.</li></ol>
<h3><a name="OBDC_data_source"></a><span class="mw-headline">OBDC data source</span></h3>
<p>To establish a new connection to an ODBC data source, choose this option:
</p>
<dl><dd><a  class="image"><img alt="UG database connector dialog.png" src="../images/Building_and_Saving_a_Query/UG_database_connector_dialog.png?v=85728" width="678"  /></a></dd></dl>
<ol><li> In the Database Connector dialog box, choose <b>ODBC data source</b> and click <b>OK</b>. </li>
<li> <b>Select a Data Source (DSN)</b> and enter connection parameters in the <b>Connect by ODBC</b> dialog box.</li></ol>
<h3><a name="ODBC_driver"></a><span class="mw-headline">ODBC driver</span></h3>
<p>Select this if you have an ODBC driver and want to create a data source applicable to this data connector instance.
</p>
<dl><dd><a  class="image"><img alt="DB ODBC Driver.png" src="../images/Building_and_Saving_a_Query/DB_ODBC_Driver.png?v=85720" width="709"  /></a></dd></dl>
<h3><a name="Windows_.22Data_Link_Properties.22_dialog"></a><span class="mw-headline">Windows "Data Link Properties" dialog</span></h3>
<h3><a name="OLE_DB"></a><span class="mw-headline">OLE DB</span></h3>
<dl><dd><dl><dd><a  class="image"><img alt="DB Database Connector Data Link Properties dialog.png" src="../images/Building_and_Saving_a_Query/DB_Database_Connector_Data_Link_Properties_dialog.png?v=85702" width="327"  /></a></dd></dl></dd></dl>
<ol>
<li>In the Database Connector dialog box, choose <b>Windows "Data Link Properties" dialog".</li></b>
<li>On the <b>Provider</b> tab, select an OLE DB Provider, then click <b>Next</b> to go to <b>Connection</b> tab.</li>
<p><a  class="image"><img alt="DB Data Link Properties.png" src="../images/Building_and_Saving_a_Query/DB_Data_Link_Properties.png?v=85701" width="363"  /></a>
</p>
<li><b>Select or enter a server name</b> (If the server is not listed, simply type its name).</li>
<li>Enter <b>User name</b> and <b>Password</b>.</li>
<li>Click <b>OK</b> (other tab controls are optional) to connect to your data source.</li>
</ol>
<h2><a name="Building_a_query"></a><span class="mw-headline">Building a query</span></h2>
<p>Once you have established a connection to your data source, you will see a list of objects on the left panel (Table List) of the <b>SQL Editor</b> dialog. 
</p><p>Double-clicking on a table node will add the table node to the SQL statement edit box on right panel. Or you can directly paste the SQL query into the SQL statement edit box.
</p>
<dl><dd><a  class="image"><img alt="Sqleditor.png" src="../images/Building_and_Saving_a_Query/Sqleditor.png?v=84550" width="740"  /></a></dd></dl>
<p>For a working example of building a query, see this OriginLab blog post on <a class="external text" href="http://blog.originlab.com/connecting-to-a-database-and-importing-data" target="_blank"><b>Connecting to a Database and Importing Data</b></a>.
</p>
<h2><a name="Saving_a_query"></a><span class="mw-headline">Saving a query</span></h2>
<p>You can save a query to a workbook or an ODQ file by going to the SQL Editor menu and selecting either <b>File: Save to Active Worksheet</b> or <b>File&#160;: Save Connection and Query as...</b>.  In addition, clicking the <b>Import</b> button in the <b>SQL Editor</b> dialog box will automatically save the query in the target worksheet.
</p><p>Saving a query to workbook (<b>File: Save Window As</b>) allows you to preview the data on the workbook and import the data at any time you want.  The workbook can be saved as a template (<b>File: Save Template As</b>), which can also store information on the formatting of the workbook.  Next time you open the template, you will have a formatted workbook with a customized query saved in it.  By clicking the Database Connector icon <a  class="image"><img alt="Button database connector icon.png" src="../images/Building_and_Saving_a_Query/Button_database_connector_icon.png?v=85692" width="19"  /></a> in the upper left corner of the template, you can <b>Import</b> and fill the formatted workbook with data acquired from the data source.  To view or modify a query saved in active worksheet, click the Database Connector icon and choose <b>SQL Editor</b>. 
</p><p>Saved query (ODQ) files can be loaded by clicking <b>Data: Connect to Database: Open</b> and browsing for the file or by clicking one of the saved files in the recently-used list. After an *.ODQ file is loaded, you can preview or import it to the active workbook.  This is useful when you want to apply the query to multiple workbooks.
</p>





