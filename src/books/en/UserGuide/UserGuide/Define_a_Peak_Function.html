<h1 class="firstHeading">15.3.4.4.8 Defining a Peak Function</h1><p class='urlname' style='display: none'>PeakAnalyzer-DefinePeakFunc</p>
<p><br />
When you use the <b>Peak Analyzer</b> to fit peaks ( OriginPro ), you can select a built-in function for each peak in the <b>Peak Fit Parameters</b> dialog, or you can create a user-defined function with the <b><a href="../../UserGuide/UserGuide/The_Fitting_Function_Organizer_Dialog_Box.html" title="UserGuide:The Fitting Function Organizer Dialog Box">Fitting Function Organizer</a></b> or <b><a href="../../UserGuide/Category/The_Fitting_Function_Builder.html" title="Category:The Fitting Function Builder">Fitting Function Builder</a></b>. Defining a peak function is much like creating any <a href="../../UserGuide/UserGuide/User-Defined_Fitting_Functions.html" title="UserGuide:User-Defined Fitting Functions">user-defined fitting function</a>, with these added <i>caveats</i>:
</p>
<ul><li> To be used in the Peak Analyzer, the function should be in the <b>PFW</b> category and the <b>Peak Function</b> check box should be selected when defining the function.</li>
<li> To make existing fitting functions in other categories available for peak fitting, choose <b>Tools: Fitting Function Organizer</b>. Right-click on a function and choose <b>Move to</b> or <b>Share to</b> and in the dialog that opens, select <b>PFW</b> as the drop-down list option.</li>
<li> To make peak functions available for  <a href="../../UserGuide/UserGuide/Quick_Peaks_Gadget.html" title="UserGuide:Quick Peaks Gadget">Quick Peaks Gadget</a> or <a href="../../UserGuide/UserGuide/Fitting_Multiple_Peaks_with_the_Multiple_Peak_Fit_Tool.html" title="UserGuide:Fitting Multiple Peaks with the Multiple Peak Fit Tool">Multiple Peak Fit tool</a>, you should select <b>Peak Function</b> category.</li>
<li> If you want to define a function to fit your baseline in <b>Peak Analyzer</b> (OriginPro only), you must put the user-defined function into the <b>Baseline</b> category. </li>
<li> At minimum, the function must have four parameters that correspond to different peak characteristics. The parameter attributes are set with the <b>Peak Attributes</b> column on <a href="../../UserGuide/UserGuide/The_Function_Body_Page.html#Dialog_Box_Controls" title="UserGuide:The Function Body Page">the <b>Function Body</b> page</a> of Fitting Function Builder. The first parameter should be named <b>y0</b> and should be assigned the attribute <b>Offset/Baseline</b>. The other parameters may be assigned arbitrary names, but should be assigned attributes of <b>X Center</b>, <b>X Width</b> and <b>Amplitude/Area</b>.</li></ul>
<table class="noborder"><tr>
	<td style="vertical-align:top" width="60"><img src="../images/Define_a_Peak_Function/Tip_icon.png?v=9614" width="57"  border="0" /></td><td><p>If a colleague has shared an FDF file (Origin Function Definition File) with you, you can add it to your Origin installation by simply dropping it onto your Origin workspace:
</p>
<ul><li> Beginning with Origin 2018, category information is saved into the FDF file. When dropping this file onto Origin, the category is automatically assigned to the author's designated category.</li>
<li> In earlier versions, as you drop the FDF file onto the Origin workspace, a <b>Select Category to Add Function</b> dilaog will open, allowing you to assign a category.</li></ul>
</td></tr></table>
<h2><a name="Example_1:_Origin_C"></a><span class="mw-headline">Example 1: Origin C</span></h2>
<p>The following example demonstrates how to define a peak function named AsymmetricGauss and use it in <b>Peak Analyzer</b>.
</p><p>The peak function to be defined is expressed as below:
</p>
<dl><dd><i>double B,sig;</i></dd>
<dd><i>B=A/(0.5*(sig1+sig2)*sqrt(2*pi));</i></dd>
<dd><i>sig = x&lt;xc&#160;? sig1:sig2;</i></dd>
<dd><i>y = y0 + B * exp(-0.5 *((x-xc)/sig)^2);</i></dd></dl>
<p>where <i>x</i> is independent variable, <i>y</i> is dependent variable, <i>y0</i>, <i>sig1</i>, <i>sig2</i>, <i>xc</i> are parameters corresponding to attributes offset, peak area, left peak width, right peak width, peak center, respectively.
</p><p><br />
There are general 7 steps in defining a peak function for fitting in <b>Peak Analyzer</b>:
</p><p>1. Hit <b>F8</b> key or go to menu <b>Tools: Fitting Function Builder</b> to open.
</p><p>2. Click <b>Next</b> to go to the <b>Name and Type</b> page, select <b>PFW</b> category from <b>Select or create a Category</b> drop-down list, input <i>AsymmetricGauss</i> as <b>Function Name</b>. Select <b>Origin C</b> from  <b>Function Type</b> panel.
</p><p>3. Click <b>Next</b> to go to the <b>Variables and Parameters</b> page, input variables and parameters as shown below and check <b>Peak Function</b> check box:
</p>
<dl><dd><dl><dd><a  class="image"><img alt="Define Peak Function 01.png" src="../images/Define_a_Peak_Function/Define_Peak_Function_01.png?v=65516" width="788"  /></a></dd></dl></dd></dl>
<p>4. Click <b>Next</b> to go to the <b>Origin C Fitting Function</b> page. Click on each cell in <b>Peak Attribute</b> column to set peak attributes for each parameter. Enter initial parameter values. Input meaning for each parameter. Enter function equations in <b>Function Body</b> edit box and do a quick check at <i>x = 1120</i> to make sure the expression is written correctly as shown below:
</p>
<dl><dd><dl><dd><a  class="image"><img alt="Define Peak Function 02.png" src="../images/Define_a_Peak_Function/Define_Peak_Function_02.png?v=65517" width="788"  /></a></dd></dl></dd></dl>
<p>5. Click <b>Next</b> button to go to the <b>Parameter Initialization Code</b> page, and enter the following codes into the <b>Initialization Code</b> edit box as shown below:
</p>
<dl><dd><dl><dd><a  class="image"><img alt="Define Peak Function 03.png" src="../images/Define_a_Peak_Function/Define_Peak_Function_03.png?v=65518" width="788"  /></a></dd></dl></dd></dl>
<p>6. Click <b>Next</b> button to go to the <b>Bounds and General Linear Constraints</b> page. Double click in cells in &lt; or &lt;= column(s) to toggle operators and then enter lower and upper bounds. Setting bounds for each parameter will confine the fitted results in sensible range as show below:
</p>
<dl><dd><dl><dd><a  class="image"><img alt="Define Peak Function 04.png" src="../images/Define_a_Peak_Function/Define_Peak_Function_04.png?v=65519" width="788"  /></a></dd></dl></dd></dl>
<p>7. Click <b>Finish</b> button and the peak function is created and placed in <b>PFW</b> category.
</p><p>After this, you can perform peak fitting with this function in <b>Peak Analyzer</b> by choosing it from the <b>Peak Type</b> drop-down list in the <b>Peak Fit Parameters</b> dialog.
</p>
<dl><dd><a  class="image"><img alt="Define Peak Function 05.png" src="../images/Define_a_Peak_Function/Define_Peak_Function_05.png?v=82841" width="712"  /></a></dd></dl>
<h2><a name="Example_2:_Python"></a><span class="mw-headline">Example 2: Python</span></h2>
<p>Starting with <b>Origin 2021b</b>, you can define peak fitting functions using Python. These functions can then be used in the Peak Analyzer, the <a href="../../UserGuide/UserGuide/Fitting_Multiple_Peaks_with_the_Multiple_Peak_Fit_Tool.html" title="UserGuide:Fitting Multiple Peaks with the Multiple Peak Fit Tool">Multiple Peak Fit tool</a> and the <a href="../../UserGuide/UserGuide/Fitting_Multiple_Peaks_with_Replicas.html" title="UserGuide:Fitting Multiple Peaks with Replicas">NLFit dialog</a>.
</p>
<ol>
<li>Open Fitting Function Builder (<b>Tools: Fitting Function Builder</b> or <b>F8</b>), select the <b>Create a New Function</b> radio button, then click <b>Next</b>.</li>
<li>Set <b>Select or create a Category</b> = <i>PFW</i> and enter <b>Function Name</b> = <i>MyPyGaussV</i>. Set <b>Function Model</b> = <b>Explicit</b> and <b>Function Type</b> = <b>Python Function (Vector)</b>.</li>
<li> Enter <b>Independent Variables</b> = <i>x</i>, <b>Dependent Variables</b> = <i>y</i>, and in the <b>Parameters</b> box, enter <i>y0</i>, <i>xc</i>, <i>A</i>, <i>w</i> (should be comma-separated). </li>
<li> Check the <b>Peak Function</b> box and click <b>Next</b>.</li>
<li> Enter the following information, making sure to set the <b>Peak Attribute</b> drop-down list for each row (each <b>Param</b>):</li>
<dl><dd><a  class="image"><img alt="FFB Mult Equations PythonV.png" src="../images/Define_a_Peak_Function/FFB_Mult_Equations_PythonV.png?v=89311" width="630"  /></a></dd>
<dd> <i><b>Python Function (Vector)</b></i></dd></dl>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">from</span> numpy <span style="color: #ff7700;font-weight:bold;">import</span> pi<span style="color: #000;">,</span> sqrt<span style="color: #000;">,</span> log<span style="color: #000;">,</span> exp
<span style="color: #ff7700;font-weight:bold;">def</span> pyGaussVector<span style="color: #000;">&#40;</span>xvalues<span style="color: #000;">,</span>y0<span style="color: #000;">,</span>xc<span style="color: #000;">,</span>A<span style="color: #000;">,</span>w<span style="color: #000;">&#41;</span>:
	<span style="color: #d00; font-style: italic;"># The same definition as in the built-in Gaussian.FDF:</span>
	<span style="color: #d00; font-style: italic;">#yvalues = [y0 + A/(w*sqrt(pi/(4*log(2)))) * exp(-4*log(2)*(x-xc)*(x-xc)/(w*w)) for x in xvalues]</span>
	fct <span style="color: #000;">=</span> A/<span style="color: #000;">&#40;</span>w*sqrt<span style="color: #000;">&#40;</span>pi/<span style="color: #000;">&#40;</span><span style="color: #000;">4</span>*log<span style="color: #000;">&#40;</span><span style="color: #000;">2</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>
	inexp <span style="color: #000;">=</span> -<span style="color: #000;">4</span>*log<span style="color: #000;">&#40;</span><span style="color: #000;">2</span><span style="color: #000;">&#41;</span>/<span style="color: #000;">&#40;</span>w*w<span style="color: #000;">&#41;</span>
	yvalues <span style="color: #000;">=</span> <span style="color: #000;">&#91;</span>y0 + fct * exp<span style="color: #000;">&#40;</span>inexp*<span style="color: #000;">&#40;</span>x-xc<span style="color: #000;">&#41;</span>*<span style="color: #000;">&#40;</span>x-xc<span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span> <span style="color: #ff7700;font-weight:bold;">for</span> x <span style="color: #ff7700;font-weight:bold;">in</span> xvalues<span style="color: #000;">&#93;</span>
	<span style="color: #ff7700;font-weight:bold;">return</span> yvalues</pre>
<dl><dd> <i><b>Function Body</b></i></dd></dl>
<pre class="python" style="font-family:monospace;">y <span style="color: #000;">=</span> pyGaussVector<span style="color: #000;">&#40;</span>x<span style="color: #000;">,</span>y0<span style="color: #000;">,</span>xc<span style="color: #000;">,</span>A<span style="color: #000;">,</span>w<span style="color: #000;">&#41;</span></pre>
<dl><dd> <i>The next page -- the <b>Script Before Install</b> page -- is a Python-only page where you specify LabTalk code used to check the user's system for Python packages required by the function. Note that it cannot be left blank.</i> </dd></dl>
<li>Click <b>Next</b> to go to the <b>Script Before Install</b> page and add the following:
<dl><dd><a  class="image"><img alt="FFB Package Check PythonV.png" src="../images/Define_a_Peak_Function/FFB_Package_Check_PythonV.png?v=89312" width="607"  /></a></dd>
<dd> <i><b>Python Package Check (LabTalk Script)</b></i></dd></dl>
<pre class="lt" style="font-family:monospace;">if<span style="color: #000000;">&#40;</span>Python.<span style="color: #000080;">chk</span><span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;pandas cv2(opencv-python)&quot;</span><span style="color: #000000;">&#41;</span> <span style="color: #000080;">&gt;</span> <span style="color: #0000dd;">1</span><span style="color: #000000;">&#41;</span>
  return <span style="color: #0000dd;">1</span>;<span style="color: #008000;">//should not install FDF</span>

return <span style="color: #0000dd;">0</span>;<span style="color: #008000;">//proceed</span></pre>
<li>Since there is nothing further that we need to set, click <b>Finish</b> to save your function and close the dialog.</li>
<li>Choose <b>Data: Connect to File: Text/CSV</b>, browse to <i>&lt;Origin Program&gt;\Samples\Curve Fitting</i>, select <b>MultiplePeaks.dat</b>, accept default import options and click <b>OK</b> to import the file.</li>
<li> Click on the column <b>D(Y)</b> heading to select the column and click the <b>Scatter</b> button <a  class="image"><img alt="Button Scatter.png" src="../images/Define_a_Peak_Function/Button_Scatter.png?v=68669" width="22"  /></a> to create a scatter plot.</li>
<li>Click <b>Analysis: Peaks and Baseline: Peak Analyzer: Open Dialog</b>.</li>
</li>On the <b>Goal</b> page, click <b>Fit Peaks (Pro)</b>, then click <b>Next</b> four times to arrive at the <b>Fit Peaks (Pro)</b> page:</li>
<li>Click the <b>Fit Control</b> button at the bottom of the page. In the middle of the <b>Peak Fit Parameters</b> dialog that opens, change <i>Gaussian</i> to <i>MyPyGaussV (User)</i> and click <b>OK</b> to close this dialog.</li>
<li>Click the <b>Finish</b> button to fit multiple peaks using your user-defined Python function.</li>
<dl><dd><a  class="image"><img alt="FFB PythonV Results.png" src="../images/Define_a_Peak_Function/FFB_PythonV_Results.png?v=89315" width="604"  /></a></dd></dl>
</li></ol>


