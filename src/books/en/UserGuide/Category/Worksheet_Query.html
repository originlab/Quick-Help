<h1 class="firstHeading">4.4.17 Worksheet Query - Quick Start</h1><p class='urlname' style='display: none'>Wks-Query-QS</p>
<p><br />
</p><p>The <b>Worksheet Query</b> dialog is used for row-wise selection, extraction or color-marking of worksheet data, according to a user-specified logical expression.
</p><p><span class='headerInParagraph'>To open the Worksheet Query dialog box:</span>
</p>
<ol><li> Activate the worksheet and from the main menu choose <b>Worksheet: Worksheet Query</b>. </li></ol>
<p><br />
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Setting_Dialog_Box_Controls"><span class="tocnumber">1</span> <span class="toctext">Setting Dialog Box Controls</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Notes_on_Spreadsheet_Cell_Notation.2C_Use_Alias_and_Column_Naming"><span class="tocnumber">1.1</span> <span class="toctext">Notes on Spreadsheet Cell Notation, Use Alias and Column Naming</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Simple_Tutorial"><span class="tocnumber">1.2</span> <span class="toctext">Simple Tutorial</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#What_Can_I_Enter_in_Condition_Text_Box.3F"><span class="tocnumber">2</span> <span class="toctext">What Can I Enter in Condition Text Box?</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Numeric_Data"><span class="tocnumber">2.1</span> <span class="toctext">Numeric Data</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#String_Data"><span class="tocnumber">2.2</span> <span class="toctext">String Data</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Date_Data"><span class="tocnumber">2.3</span> <span class="toctext">Date Data</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#Advanced_Scripting_Controls_on_Data_Extraction"><span class="tocnumber">3</span> <span class="toctext">Advanced Scripting Controls on Data Extraction</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Quick_Examples"><span class="tocnumber">4</span> <span class="toctext">Quick Examples</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#Delete_Rows_with_Missing_Values"><span class="tocnumber">4.1</span> <span class="toctext">Delete Rows with Missing Values</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Extract_Every_Nth_Row"><span class="tocnumber">4.2</span> <span class="toctext">Extract Every Nth Row</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Mask_Outliers"><span class="tocnumber">4.3</span> <span class="toctext">Mask Outliers</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#See_Also"><span class="tocnumber">5</span> <span class="toctext">See Also</span></a></li>
</ul>
</div>

<h2><a name="Setting_Dialog_Box_Controls"></a><span class="mw-headline">Setting Dialog Box Controls</span></h2>
<p>The following image shows the order in which you set controls in the <b>Worksheet Query</b> dialog box. Note that if either of the following is TRUE, you will need to perform <b>Step1a</b>:
</p>
<dl><dd><ul><li> <a href="../../UserGuide/UserGuide/Column_Short_Name_Restriction.html" title="UserGuide:Column Short Name Restriction">Spreadsheet Cell Notation</a> is turned OFF in the workbook.</li>
<li> Spreadsheet Cell Notation is turned ON in the workbook but you have opted to check the <b>Use Alias</b> box in the upper-right corner of the dialog box.</li></ul></dd></dl>
<dl><dd><a  class="image"><img alt="Extract Worksheet Data 05.png" src="../images/Worksheet_Query/Extract_Worksheet_Data_05.png?v=81903" width="737"  /></a></dd></dl>
<table class="note">
<tr>
<td><b>Note:</b>For the columns' information listed horizontally in the left panel, you can right-click any place within this panel to select the <a href="../../UserGuide/UserGuide/Extract_Worksheet_Data.html#Left_Panel" title="UserGuide:Extract Worksheet Data">items</a> you desired to show, such as Column Index, Short Name or Long Name of columns.
</td></tr></table>
<h3><a name="Notes_on_Spreadsheet_Cell_Notation.2C_Use_Alias_and_Column_Naming"></a><span class="mw-headline">Notes on Spreadsheet Cell Notation, Use Alias and Column Naming</span></h3>
<p>This tool predates the introduction of <a href="../../UserGuide/UserGuide/Column_Short_Name_Restriction.html" title="UserGuide:Column Short Name Restriction"><b>Spreadsheet Cell Notation (SCN)</b></a> in Origin 2017. Previously, the use of an alias to represent the data column was an efficient alternative to use of actual column names. Aliases could be a single letter, whereas references to even the column Short Name required use of the <b>col()</b> function (e.g. "M&lt;=0" vs. "Col(A)&lt;=0"). The introduction of SCN meant that you no longer had to use the <b>col()</b> function to enclose column Short Name in <a href="../../UserGuide/UserGuide/Quick_Start_SetColumnValues.html" title="UserGuide:Quick Start SetColumnValues">the <b>Set Values</b> dialog</a> or in <a href="../../UserGuide/UserGuide/Using_Formulae_to_Set_Cell_Values.html" title="UserGuide:Using Formulae to Set Cell Values">cell formulas</a>. 
</p><p>Beginning with Origin 2019b, when SCN is ON (default) and <b>Use Alias</b> is cleared, you can use the column Short Name directly in your <b>If</b> expression in Worksheet Query. This change simply adds more options for building your <b>If</b> expression. There is no "right" way to build your expressions but the following may help you decide what works best for you:
</p>
<ul><li> If you have SCN turned OFF in the workbook (e.g. you have an older project file with customized column Short Names), you can continue to work as you always did. The Worksheet Query tool will look and work just as it always has.</li>
<li> If you have SCN turned ON in the workbook (the default for all new workbooks in Origin versions 2017 or later), you will now see a <b>Use Alias</b> box in the upper-right corner of Worksheet Query. If you are familiar with Worksheet Query and like the alias option, you can check <b>Use Alias</b> and use the dialog as you did in versions prior to Origin 2019b.</li>
<li> If you have SCN turned ON in the workbook and you prefer to use column Short Names or Long Names directly in your <b>If</b> expression, without declaring an alias, leave <b>Use Alias</b> <i>unchecked</i> and use the following forms:</li></ul>
<dl><dd><ul><li> Use "A" instead of "col(A)". Expressions using "col(A)" will work but use of the <b>col()</b> function is unnecessary.</li>
<li> To use column Long Names in your expression, you must enclose them with the <b>col()</b> function. If the Long Name contains spaces, you must enclose the Long Name in double-quotes (e.g. col("Population Density")&lt;=100).</li>
<li> If you like using the <b>Add...</b> button to add conditions to your <b>If</b> expression, check <b>Use Alias</b>, since <b>Add...</b> picks up whatever you have highlighted in the <b>Select Column Variables for If Test</b> field.</li></ul></dd></dl>
<h3><a name="Simple_Tutorial"></a><span class="mw-headline">Simple Tutorial</span></h3>
<ol><li> Use the <span class="db">Import Wizard</span> to import the file <i>\Samples\Data Manipulation\US Metropolitan Area Population.dat</i>. The destination worksheet contains four columns: <i><b>Population</b></i>, <i><b>Sq.Mi.</b></i>, <i><b>Density</b></i>, and <i><b>Metropolitan Area</b></i>.</li>
<li> Select <span class="menu">Worksheet: Worksheet Query</span> from the Origin menu to open <b>Worksheet Query</b> dialog box.</li>
<li> If SCN is ON, or you have not selected <b>Use Alias</b>, skip this step. If SCN is OFF <i>or</i> if you have selected the <b>Use Alias</b> box, hold down the CTRL key and select <b>Density</b> and <b>Metropolitan Area</b> in the <b>Columns:</b> panel. Click the <b>=&gt;</b> button to move these columns to the <b>Select Column Variables for If Test</b> panel. Note that aliases <b>D</b> and <b>M</b> are assigned to the columns respectively. </li>
<li>Clear the check box before <b>Sq.Mi.</b> in the <b>Columns:</b> panel so that this column will not be included in the extracted result.</li>
<li> Enter ONE of the following formulas in the <b>Condition</b> box, depending on whether the <b>Use Alias</b> box is checked. Note: You can click the <b>AND</b> button instead of typing out A-N-D: 
<dl><dd>D &gt; 100 AND M == "* CA*" or D &gt; 100 AND M = "* CA*" (SCN OFF or Use Alias IS checked, use Alias to represent data)</dd>
<dd>C &gt; 100 AND D == "* CA*" or C &gt; 100 AND D = "* CA*" (SCN ON, Use Alias NOT checked, use Short Name to represent data) </dd>
<dd>In both cases, this condition looks for population densities &gt; 100 for all areas in California ("CA"). Note that this tool supports the wildcard symbol <b>*</b> inside strings.</dd></dl></li>
<li>Click the <b>Test -- select if true</b> button. Notice that the number of found rows under the <b>Condition</b> box has been updated, and some rows in the worksheet are highlighted. </li>
<li>Select <b>Auto</b> from <b>Recalculate</b> drop-down list to auto update the results if data changes.</li>
<li>Select the <b>Extract to New Worksheet</b> radio button in <b>Output:</b> panel and then click the <b>OK</b> button. You will see that the extracted results are stored in a new worksheet in the source workbook.</li></ol>
<h2><a name="What_Can_I_Enter_in_Condition_Text_Box.3F"></a><span class="mw-headline">What Can I Enter in Condition Text Box?</span></h2>
<p>You can use column Names or Aliases and relational operators (&gt;, &lt;=,&#160;!=, etc.), arithmetic operators (+, -, *, /, ^) and logical operators (&amp;&amp; (AND), || (OR)) to construct your <b>Condition</b> (see this <a href="../../UserGuide/UserGuide/Extract_Worksheet_Data.html#Condition" title="UserGuide:Extract Worksheet Data">table</a>).
You can also insert <a class="external text" href="../../LabTalk/Script/LabTalk-Supported_Functions.html">built-in functions</a> using the <b>Function</b> menu; or you can <a href="../../UserGuide/UserGuide/Create_a_User_Defined_Function_for_Set_Column_Values.html" title="UserGuide:Create a User Defined Function for Set Column Values">create a user-defined function</a>.
</p>
<h5><a name="Numeric_Data"></a><span class="mw-headline">Numeric Data</span></h5>
<table class="simple">
<tr>
<th width="35%">Examples
</th>
<th width="65%">Descriptions
</th></tr>
<tr>
<td> <b>T &gt; 0</b>
</td>
<td> To extract rows with values of column Alias "T" that are greater than 0
</td></tr>
<tr>
<td> <b>col("Population Density") &gt; 1000</b>
</td>
<td> To extract rows with values of column Long Name "Population Density" that are greater than 1000
</td></tr>
<tr>
<td> <b>A &gt; 0</b>
</td>
<td> To extract rows with values of column Short Name "A" that are greater than 0
<p>Note: The following syntax also works: <b>col(A) &gt; 0</b> or <b>col(<i>index</i>) &gt; 0</b> (where <i><b>index</b></i> is column index number).
</p>
</td></tr>
<tr>
<td> <b>A.top(10)</b>
</td>
<td> To extract rows by the 10 largest values in column Short Name "A".
</td></tr>
<tr>
<td> <b>N^2&#160;!= F</b>
</td>
<td> To extract rows with the square of values in column "N" (Alias or Short Name) not equal to values in column "F" (Alias or Short Name).
</td></tr>
<tr>
<td> <b> A&#160;!= --</b> (or <b>A&#160;!= NANUM</b>)
</td>
<td> To extract rows with no missing values and no text strings in column "A" (Alias or Short Name).
</td></tr>
<tr>
<td> <b>mod(i, 3) == 0</b>
</td>
<td> To extract every 3rd row for all selected rows using <a class="external text" href="../../LabTalk/LabTalk/Mod_(function).html"><b>mod()</b></a> function, where "i" is the row index variable.
</td></tr></table>
<h5><a name="String_Data"></a><span class="mw-headline">String Data</span></h5>
<table class="simple">
<tr>
<th width="35%">Examples
</th>
<th width="65%">Descriptions
</th></tr>
<tr>
<td> <b>B == "*CA*" </b> (or <b>B = "*ca*")</b>
</td>
<td> To extract rows containing "CA" within the string, in a cell in column with Alias or Short Name "B". Note wildcard symbols such as <b>*</b> (string of characters) and <b>?</b> (single character) are supported and string search is not case-sensitive.
</td></tr>
<tr>
<td> <b>NOT(A="Tom" OR A="James")</b>
</td>
<td> To extract all rows except those that contain "Tom" or "James" in column A.
</td></tr>
<tr>
<td>
<p><b>A&#160;!= NANUM</b>
<br />
<b>OR A == "--"</b>
<br />
<b>OR A == ""</b>
</p>
</td>
<td> To highlight rows contain numeric data, string "--" and empty space in column with alias "A". Use the ENTER key to break expressions into multiple lines.
</td></tr>
<tr>
<td> <b>isText(B)</b>
</td>
<td> To extract only rows that contain text strings in column with Alias or Short Name "B" using <a class="external text" href="../../LabTalk/LabTalk/IsText_(function).html"><b>isText()</b></a> function.
</td></tr></table>
<h5><a name="Date_Data"></a><span class="mw-headline">Date Data</span></h5>
<table class="simple">
<tr>
<th width="35%">Examples
</th>
<th width="65%">Descriptions
</th></tr>
<tr>
<td> <b>frac(B) &gt; Time(10:00:00) AND frac(B) &lt; Time(11:00:00)</b>
</td>
<td> To extract data within time period 10:00 ~ 11:00 in column "B" using <a class="external text" href="../../LabTalk/LabTalk/Frac_(function).html"><b>frac()</b></a> and <a class="external text" href="../../LabTalk/LabTalk/Time_(function).html"><b>Time()</b></a> functions.
</td></tr>
<tr>
<td> <b>int(A) &gt; Date(01/24/2004)</b>
</td>
<td> To extract data later than date 2004/01/24 in column "A" using <a class="external text" href="../../LabTalk/LabTalk/Int_(function).html"><b>int()</b></a> and <a class="external text" href="../../LabTalk/LabTalk/Date_(function).html"><b>Date()</b></a> functions.
</td></tr></table>
<h2><a name="Advanced_Scripting_Controls_on_Data_Extraction"></a><span class="mw-headline">Advanced Scripting Controls on Data Extraction</span></h2>
<dl><dd><dl><dd><a  class="image"><img alt="Wks query script menu.png" src="../images/Worksheet_Query/Wks_query_script_menu.png?v=81973" width="502"  /></a></dd></dl></dd></dl>
<p>While its usage is optional, scripting increases the power of the <b>Worksheet Query</b> dialog. This box (<b>Scripts: Edit...</b>) takes one or more lines of LabTalk script and runs them before the expression in the <b>Condition</b> box is executed. This makes possible such things as pre-processing of input data, defining functions, variables and constants for use in the <b>Condition</b> box, etc.
</p><p>Origin actually runs the data query routine as follows: 
</p>
<ol><li>Run the <b>Script Before Select Data Loop</b>. </li>
<li>Loop over all rows defined by the start and end values provided by user. For each column whose row index is <i>i</i>:
<ol><li>Run the <b>Script Before If Condition</b>;</li>
<li>Test the condition, for data in row <i><b>i</b></i>;</li>
<li>Extract data if the condition is true; </li>
<li>End query; </li></ol></li>
<li>End loop; </li></ol>
<p>To show the query running routine, you can run the example below which is used to extract data in column A using indices in column B.
</p>
<ol><li> Enter commands as shown below in <b>Script Before Select Data Loop</b>, <b>Script Before If Condition</b> and <b>Condition:</b> text boxes as shown in figure below. </li>
<li> Click <b>Test--select if true</b> button and Origin will highlight row 1, 4, and 7 as illustrated.</li></ol>
<dl><dd><a  class="image"><img alt="Extract Worksheet Data 08.png" src="../images/Worksheet_Query/Extract_Worksheet_Data_08.png?v=78079" width="741"  /></a></dd></dl>
<h2><a name="Quick_Examples"></a><span class="mw-headline">Quick Examples</span></h2>
<h3><a name="Delete_Rows_with_Missing_Values"></a><span class="mw-headline">Delete Rows with Missing Values</span></h3>
<ol><li> Use <a  class="image"><img alt="Extract Worksheet Data 2.png" src="../images/Worksheet_Query/Extract_Worksheet_Data_2.png?v=16898" width="20"  /></a> button to add column "Time" to <b>Select Column Variables for If Test</b> box.</li>
<li> Input <i><b>T == NANUM</b> (NANUM denotes missing values) in <b>Condition</b> box.</i></li>
<li> Click <b>Test--select if true</b> button to highlight rows with missing values in column "Time".</li>
<li> Right click on any of the highlighted rows and select <b>Delete</b> from shortcut menu.</li></ol>
<dl><dd><a  class="image"><img alt="Extract Worksheet Data 09.png" src="../images/Worksheet_Query/Extract_Worksheet_Data_09.png?v=78080" width="417"  /></a></dd></dl>
<h3><a name="Extract_Every_Nth_Row"></a><span class="mw-headline">Extract Every Nth Row</span></h3>
<ol><li> Input <i>mod(i, 3) == 0</i> in <b>Condition:</b> text box where <i><b>i</b></i> is built-in row index variable and <a class="external text" href="../../LabTalk/LabTalk/Mod_(function).html"><b>mod(m,n)</b></a> returns the integer modulus of m divided by n.</li>
<li> Click <b>Test--select if true</b> button to highlight and <b>OK</b> button to extract to new workbook.</li></ol>
<dl><dd><a  class="image"><img alt="Extract Worksheet Data 12.png" src="../images/Worksheet_Query/Extract_Worksheet_Data_12.png?v=78081" width="589"  /></a></dd></dl>
<p><br />
</p>
<h3><a name="Mask_Outliers"></a><span class="mw-headline">Mask Outliers</span></h3>
<p>This example is to show how to mask outliers using 25th and 75th percentiles.
<br />
1. Enter commands below in <b>Script Before Select Data Loop</b> text box.
</p>
<pre class="lt" style="font-family:monospace;">pct <span style="color: #000080;">=</span> <span style="color: #000000;">&#123;</span><span style="color: #0000dd;">25</span>, <span style="color: #0000dd;">75</span><span style="color: #000000;">&#125;</span>;
Q1 <span style="color: #000080;">=</span> percentile<span style="color: #000000;">&#40;</span>col<span style="color: #000000;">&#40;</span>B<span style="color: #000000;">&#41;</span>,pct<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span>;
Q3 <span style="color: #000080;">=</span> percentile<span style="color: #000000;">&#40;</span>col<span style="color: #000000;">&#40;</span>B<span style="color: #000000;">&#41;</span>,pct<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#91;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#93;</span>;
IQR <span style="color: #000080;">=</span> Q3 <span style="color: #000080;">-</span> Q1;
UIF <span style="color: #000080;">=</span> Q3 <span style="color: #000080;">+</span> <span style="color: #0000dd;">1.5</span><span style="color: #000080;">*</span>IQR;
LIF <span style="color: #000080;">=</span> Q1 <span style="color: #000080;">-</span> <span style="color: #0000dd;">1.5</span><span style="color: #000080;">*</span>IQR;</pre>
<p>2. Enter <i>Y &lt; LIF OR Y &gt; UIF</i> in <b>Condition:</b> text box.
<br />
3. Click <b>Test--select if true</b> button to highlight found outliers.
<br />
4. Right click on one of the highlighted rows and select <b>Mask: Apply</b> from appeared context menu.
<br />
</p>
<dl><dd><a  class="image"><img alt="Extract Worksheet Data 11.png" src="../images/Worksheet_Query/Extract_Worksheet_Data_11.png?v=78083" width="621"  /></a></dd></dl>
<p><br />
</p>
<h2><a name="See_Also"></a><span class="mw-headline">See Also</span></h2>
<ul><li> <a href="../../UserGuide/UserGuide/Extract_Worksheet_Data.html" title="UserGuide:Extract Worksheet Data">Worksheet Query Menu Options and Dialog Controls</a></li>
<li> <a class="external text" href="../../Tutorial/Tutorial/Extract_Worksheet_Data.html">How to extract worksheet data?</a></li>
<li> <a class="external text" href="../../QuickHelp/QuickHelp/How_to_Plot_Multiple_Blocks_of_Data_from_Same_Column_as_Separate_Data_Plots.html">How to Plot Multiple Blocks of Data from Same Column as Separate Data Plots?</a></li>
<li> <img src="../images/Worksheet_Query/Video_Image_2016.png?v=61345" style='margin-right: 5px;'/><a class="external text" href="http://www.originlab.com/index.aspx?go=Products/Origin/DataManagement/WorkbooksAndWorksheets&amp;ss=chm&amp;pid=1161" target="_blank">Worksheet Query</a></li></ul>


