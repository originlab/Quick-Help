<h1 class="firstHeading">6 Sample Projects with attached Python Code</h1><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Samples_using_Origin_Projects"><span class="tocnumber">1</span> <span class="toctext">Samples using Origin Projects</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Batch_Peak_Analysis_of_Multiple_Files"><span class="tocnumber">1.1</span> <span class="toctext">Batch Peak Analysis of Multiple Files</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Travelling_Salesperson_Problem"><span class="tocnumber">1.2</span> <span class="toctext">Travelling Salesperson Problem</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Logistic_Regression"><span class="tocnumber">1.3</span> <span class="toctext">Logistic Regression</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Bayesian_Regression"><span class="tocnumber">1.4</span> <span class="toctext">Bayesian Regression</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Friedman.27s_Super_Smoother"><span class="tocnumber">1.5</span> <span class="toctext">Friedman's Super Smoother</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Hyperspectral_Image_Stack_and_PCA"><span class="tocnumber">1.6</span> <span class="toctext">Hyperspectral Image Stack and PCA</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Extract_Image_Colors"><span class="tocnumber">1.7</span> <span class="toctext">Extract Image Colors</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Lomb-Scargle_Periodogram"><span class="tocnumber">1.8</span> <span class="toctext">Lomb-Scargle Periodogram</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Export_all_Graphs"><span class="tocnumber">1.9</span> <span class="toctext">Export all Graphs</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#Image_Thinning"><span class="tocnumber">1.10</span> <span class="toctext">Image Thinning</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Peak_Movement"><span class="tocnumber">1.11</span> <span class="toctext">Peak Movement</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="#Fit_Summation"><span class="tocnumber">1.12</span> <span class="toctext">Fit Summation</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-14"><a href="#How_to_Execute_Python_Code_from_a_Button"><span class="tocnumber">2</span> <span class="toctext">How to Execute Python Code from a Button</span></a>
<ul>
<li class="toclevel-2 tocsection-15"><a href="#The_Show_Code_Button"><span class="tocnumber">2.1</span> <span class="toctext">The Show Code Button</span></a></li>
</ul>
</li>
</ul>
</div>

<p><br />
</p>
<h2><a name="Samples_using_Origin_Projects"></a><span class="mw-headline">Samples using Origin Projects</span></h2>
<p>This page lists Python examples added in Origin/OrignPro version 2021 that are based on Origin Project files. The Python code file is attached to the project. The projects also have buttons to run the code and to open the code in Code Builder to view, run and debug.
</p><p>The projects can be found in the \Samples\Python sub folder.
</p><p>A brief description of each sample and the code associated with the sample are provided below. This will give you an overall idea as to how easy it is to work with the new originpro package for embedded Python in Origin.
</p>
<h3><a name="Batch_Peak_Analysis_of_Multiple_Files"></a><span class="mw-headline">Batch Peak Analysis of Multiple Files</span></h3>
<p>In this example, batch peak analysis is performed by importing one data file at a time. Baseline subtraction and peak fitting is performed on the data. The peak parameters are placed on a graph displaying the data and the fit results. The graph is then exported as a png image file.
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #000;">os</span>

path <span style="color: #000;">=</span> op.<span style="color: #000;">path</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'e'</span><span style="color: #000;">&#41;</span> + <span style="color: #0a0;">&quot;samples<span style="color: #000099; font-weight: bold;">\\</span>Batch2<span style="color: #000099; font-weight: bold;">\\</span>&quot;</span> 

<span style="color: #ff7700;font-weight:bold;">for</span> <span style="color: #900090;">file</span> <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #000;">os</span>.<span style="color: #000;">listdir</span><span style="color: #000;">&#40;</span>path<span style="color: #000;">&#41;</span>: 
    fullpath <span style="color: #000;">=</span> <span style="color: #000;">os</span>.<span style="color: #000;">path</span>.<span style="color: #000;">join</span><span style="color: #000;">&#40;</span>path<span style="color: #000;">,</span> <span style="color: #900090;">file</span><span style="color: #000;">&#41;</span>
    wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span>ref<span style="color: #000;">=</span><span style="color: #0a0;">'Book1'</span><span style="color: #000;">&#41;</span>
    wks.<span style="color: #000;">from_file</span><span style="color: #000;">&#40;</span>fullpath<span style="color: #000;">&#41;</span>
    
    op.<span style="color: #000;">wait</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span> <span style="color: #d00; font-style: italic;"># wait until operation is done</span>
    op.<span style="color: #000;">wait</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'s'</span><span style="color: #000;">,</span> <span style="color: #000;">0.05</span><span style="color: #000;">&#41;</span><span style="color: #d00; font-style: italic;">#wait further for graph to update</span>
    
    weight <span style="color: #000;">=</span> wks.<span style="color: #000;">get_label</span><span style="color: #000;">&#40;</span><span style="color: #000;">1</span><span style="color: #000;">,</span><span style="color: #0a0;">'C'</span><span style="color: #000;">&#41;</span> <span style="color: #d00; font-style: italic;"># get column comment for export graph name</span>
    gp <span style="color: #000;">=</span> op.<span style="color: #000;">find_graph</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">&quot;Graph1&quot;</span><span style="color: #000;">&#41;</span>
    graphpath <span style="color: #000;">=</span> gp.<span style="color: #000;">save_fig</span><span style="color: #000;">&#40;</span>op.<span style="color: #000;">path</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>+f<span style="color: #0a0;">'weight - {weight}.png'</span><span style="color: #000;">,</span> width<span style="color: #000;">=</span><span style="color: #000;">800</span><span style="color: #000;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: #000;">&#40;</span>graphpath<span style="color: #000;">&#41;</span>
    
<span style="color: #000;">os</span>.<span style="color: #000;">startfile</span><span style="color: #000;">&#40;</span>op.<span style="color: #000;">path</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span> <span style="color: #d00; font-style: italic;"># open folder containing exported graphs</span></pre>
<h3><a name="Travelling_Salesperson_Problem"></a><span class="mw-headline">Travelling Salesperson Problem</span></h3>
<p>This example uses scikit-opt package to find optimal solution for the Travelling Salesperson problem. US airport data with latitude and longitude values is used for the destination points. The randomly selected airport locations and the optimized path are displayed in a graph over Google map image.
</p><p><a  class="image"><img alt="Tsp result.png" src="../images/Sample_Projects_with_Attached_Python_Codes/800px-Tsp_result.png?v=52609" width="800"   /></a>
</p><p>Code for picking a random set of cities (worksheet rows):
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
<span style="color: #d00; font-style: italic;">#transfer data from sheet &quot;All Airports&quot; sheet to a DataFrame</span>
<span style="color: #d00; font-style: italic;">#then randomly choose 10 cities to put to sheet name &quot;Selected&quot;</span>
wksSource <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'w'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'[Book2]&quot;All Airports&quot;'</span><span style="color: #000;">&#41;</span>
df <span style="color: #000;">=</span> wksSource.<span style="color: #000;">to_df</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>
<span style="color: #d00; font-style: italic;">#no need to put quotes around sheet name if it has no space</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span>ref<span style="color: #000;">=</span><span style="color: #0a0;">'[Book2]Selected'</span><span style="color: #000;">&#41;</span>
wks.<span style="color: #000;">clear</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">&#40;</span>df.<span style="color: #000;">sample</span><span style="color: #000;">&#40;</span><span style="color: #000;">10</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span></pre>
<p>Code for optimizing distance:
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #d00; font-style: italic;"># Python code to solve Travelling Salesperson Problem using scikit_opt</span>
<span style="color: #d00; font-style: italic;"># Optimization code based on the example in this page: https://pypi.org/project/scikit-opt/</span>
    
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #000;">sys</span>
<span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
    
<span style="color: #d00; font-style: italic;"># Get to the &quot;Selected&quot; sheet and retrieve data</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span>ref<span style="color: #000;">=</span><span style="color: #0a0;">'[Book2]Selected'</span><span style="color: #000;">&#41;</span>
lat <span style="color: #000;">=</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'LATITUDE'</span><span style="color: #000;">&#41;</span>
lon <span style="color: #000;">=</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'LONGITUDE'</span><span style="color: #000;">&#41;</span>
coordinates <span style="color: #000;">=</span> <span style="color: #900090;">list</span><span style="color: #000;">&#40;</span><span style="color: #900090;">zip</span><span style="color: #000;">&#40;</span>lat<span style="color: #000;">,</span> lon<span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;"># Get number of airports/points from column length</span>
num_points <span style="color: #000;">=</span> <span style="color: #900090;">len</span><span style="color: #000;">&#40;</span>coordinates<span style="color: #000;">&#41;</span>

<span style="color: #ff7700;font-weight:bold;">from</span> scipy <span style="color: #ff7700;font-weight:bold;">import</span> spatial
distance_matrix <span style="color: #000;">=</span> spatial.<span style="color: #000;">distance</span>.<span style="color: #000;">cdist</span><span style="color: #000;">&#40;</span>coordinates<span style="color: #000;">,</span> coordinates<span style="color: #000;">,</span> metric<span style="color: #000;">=</span><span style="color: #0a0;">'euclidean'</span><span style="color: #000;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">def</span> cal_total_distance<span style="color: #000;">&#40;</span>routine<span style="color: #000;">&#41;</span>:
    <span style="color: #0a0;">'''The objective function. input routine, return total distance.
    cal_total_distance(np.arange(num_points))
    '''</span>
    num_points<span style="color: #000;">,</span> <span style="color: #000;">=</span> routine.<span style="color: #000;">shape</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #900090;">sum</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#91;</span>distance_matrix<span style="color: #000;">&#91;</span>routine<span style="color: #000;">&#91;</span>i&#160;% num_points<span style="color: #000;">&#93;</span><span style="color: #000;">,</span> routine<span style="color: #000;">&#91;</span><span style="color: #000;">&#40;</span>i + <span style="color: #000;">1</span><span style="color: #000;">&#41;</span>&#160;% num_points<span style="color: #000;">&#93;</span><span style="color: #000;">&#93;</span> <span style="color: #ff7700;font-weight:bold;">for</span> i <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #900090;">range</span><span style="color: #000;">&#40;</span>num_points<span style="color: #000;">&#41;</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#41;</span>


<span style="color: #d00; font-style: italic;"># Do optimization</span>
<span style="color: #ff7700;font-weight:bold;">from</span> sko.<span style="color: #000;">GA</span> <span style="color: #ff7700;font-weight:bold;">import</span> GA_TSP

ga_tsp <span style="color: #000;">=</span> GA_TSP<span style="color: #000;">&#40;</span>func<span style="color: #000;">=</span>cal_total_distance<span style="color: #000;">,</span> n_dim<span style="color: #000;">=</span>num_points<span style="color: #000;">,</span> size_pop<span style="color: #000;">=</span><span style="color: #000;">50</span><span style="color: #000;">,</span> max_iter<span style="color: #000;">=</span><span style="color: #000;">500</span><span style="color: #000;">,</span> prob_mut<span style="color: #000;">=</span><span style="color: #000;">1</span><span style="color: #000;">&#41;</span>
best_points<span style="color: #000;">,</span> best_distance <span style="color: #000;">=</span> ga_tsp.<span style="color: #000;">run</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;"># Convert best_points to a list</span>
order<span style="color: #000;">=</span>best_points.<span style="color: #000;">tolist</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;"># Loop over to build the row order list</span>
row_order <span style="color: #000;">=</span> <span style="color: #000;">&#91;</span><span style="color: #000;">0</span><span style="color: #000;">&#93;</span> * num_points
count<span style="color: #000;">=</span><span style="color: #000;">0</span>
<span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #000;">&#40;</span>count<span style="color: #000;">&lt;</span>num_points<span style="color: #000;">&#41;</span>:
    row_order<span style="color: #000;">&#91;</span>order<span style="color: #000;">&#91;</span>count<span style="color: #000;">&#93;</span><span style="color: #000;">&#93;</span><span style="color: #000;">=</span>count+<span style="color: #000;">1</span>
    count<span style="color: #000;">=</span>count+<span style="color: #000;">1</span>

<span style="color: #d00; font-style: italic;"># Put the row order into 1st column of the worksheet, sort worksheet by first column</span>
wks.<span style="color: #000;">from_list</span><span style="color: #000;">&#40;</span><span style="color: #000;">0</span><span style="color: #000;">,</span> row_order<span style="color: #000;">&#41;</span>
wks.<span style="color: #000;">sort</span><span style="color: #000;">&#40;</span><span style="color: #000;">0</span><span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;"># copy first row and append to the end to close the loop on the graph</span>
row1 <span style="color: #000;">=</span> wks.<span style="color: #000;">to_list2</span><span style="color: #000;">&#40;</span><span style="color: #000;">0</span><span style="color: #000;">,</span><span style="color: #000;">0</span><span style="color: #000;">&#41;</span>
wks.<span style="color: #000;">from_list2</span><span style="color: #000;">&#40;</span>row1<span style="color: #000;">,</span>num_points<span style="color: #000;">&#41;</span></pre>
<h3><a name="Logistic_Regression"></a><span class="mw-headline">Logistic Regression</span></h3>
<p>This example performs Logistic Regression Analysis of the data from he worksheet. The parameter values and 95% Confidence Intervals from the analysis are output to a new worksheet. A message is displayed in script window with information on the optimization process.
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #d00; font-style: italic;">#This example requires to install statsmodels module</span>

<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd
<span style="color: #ff7700;font-weight:bold;">import</span> statsmodels.<span style="color: #000;">api</span> <span style="color: #ff7700;font-weight:bold;">as</span> sm

<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op

<span style="color: #d00; font-style: italic;">#Send active worksheet data to Python's DataFrame</span>
<span style="color: #d00; font-style: italic;">#Columns C and D in the worksheet are categorical columns </span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span> <span style="color: #0a0;">'w'</span> <span style="color: #000;">&#41;</span>
df <span style="color: #000;">=</span> wks.<span style="color: #000;">to_df</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;">#Perfrom Logistic Regression in Python</span>
cat_columns <span style="color: #000;">=</span> df.<span style="color: #000;">select_dtypes</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#91;</span><span style="color: #0a0;">'category'</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#41;</span>.<span style="color: #000;">columns</span>
df<span style="color: #000;">&#91;</span>cat_columns<span style="color: #000;">&#93;</span> <span style="color: #000;">=</span> df<span style="color: #000;">&#91;</span>cat_columns<span style="color: #000;">&#93;</span>.<span style="color: #000;">apply</span><span style="color: #000;">&#40;</span><span style="color: #ff7700;font-weight:bold;">lambda</span> x: x.<span style="color: #000;">cat</span>.<span style="color: #000;">codes</span><span style="color: #000;">&#41;</span>
df<span style="color: #000;">&#91;</span><span style="color: #0a0;">'intercept'</span><span style="color: #000;">&#93;</span> <span style="color: #000;">=</span> <span style="color: #000;">1.0</span>

logit <span style="color: #000;">=</span> sm.<span style="color: #000;">Logit</span><span style="color: #000;">&#40;</span>df<span style="color: #000;">&#91;</span><span style="color: #0a0;">'Career_Change'</span><span style="color: #000;">&#93;</span><span style="color: #000;">,</span> df<span style="color: #000;">&#91;</span><span style="color: #000;">&#91;</span><span style="color: #0a0;">'Age'</span><span style="color: #000;">,</span><span style="color: #0a0;">'Salary'</span><span style="color: #000;">,</span><span style="color: #0a0;">'Gender'</span><span style="color: #000;">,</span><span style="color: #0a0;">'intercept'</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#41;</span>

result <span style="color: #000;">=</span> logit.<span style="color: #000;">fit</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;">#Merge two DataFrames by index: result.params (Convert Series to DataFrame first) and result.conf_int()</span>
res_df <span style="color: #000;">=</span> pd.<span style="color: #000;">merge</span><span style="color: #000;">&#40;</span> result.<span style="color: #000;">params</span>.<span style="color: #000;">to_frame</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span><span style="color: #000;">,</span> result.<span style="color: #000;">conf_int</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span><span style="color: #000;">,</span> right_index<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">,</span> left_index<span style="color: #000;">=</span><span style="color: #900090;">True</span> <span style="color: #000;">&#41;</span>
res_df.<span style="color: #000;">columns</span> <span style="color: #000;">=</span> <span style="color: #000;">&#91;</span><span style="color: #0a0;">'Fitted Parameter'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'95% CI Lower'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'95% CI Upper'</span><span style="color: #000;">&#93;</span>

<span style="color: #d00; font-style: italic;">#Send result to a new worksheet in Origin</span>
wksR <span style="color: #000;">=</span> op.<span style="color: #000;">new_sheet</span><span style="color: #000;">&#40;</span> <span style="color: #0a0;">'w'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'Logistic Regression Result'</span> <span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;">#Send DataFrame (res_df) to worksheet (wksR)</span>
<span style="color: #d00; font-style: italic;">#res_df includes three columns, and its index is row names, which should also be set to worksheet.</span>

<span style="color: #d00; font-style: italic;">#Send DataFrame values to worksheet, and first column for DataFrame index.</span>
wksR.<span style="color: #000;">from_df</span><span style="color: #000;">&#40;</span> res_df<span style="color: #000;">,</span> <span style="color: #000;">0</span><span style="color: #000;">,</span> <span style="color: #900090;">True</span> <span style="color: #000;">&#41;</span></pre>
<p><br />
</p>
<h3><a name="Bayesian_Regression"></a><span class="mw-headline">Bayesian Regression</span></h3>
<p>This example demonstrates Bayesian Ridge Regression by calling the BayesianRidge model from the sklearn package.
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #d00; font-style: italic;"># This example requires to install sklearn package.</span>

<span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
<span style="color: #ff7700;font-weight:bold;">from</span> sklearn <span style="color: #ff7700;font-weight:bold;">import</span> linear_model


<span style="color: #d00; font-style: italic;"># Find the worksheet ExpGrowth</span>
<span style="color: #d00; font-style: italic;"># and get the 1st and 2nd columns data to X and y respectively</span>
ws <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'w'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'ExpGrowth'</span><span style="color: #000;">&#41;</span>
X <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span>ws.<span style="color: #000;">to_list</span><span style="color: #000;">&#40;</span><span style="color: #000;">0</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>  <span style="color: #d00; font-style: italic;"># Get the first column's data as numpy array</span>
y <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span>ws.<span style="color: #000;">to_list</span><span style="color: #000;">&#40;</span><span style="color: #000;">1</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>.<span style="color: #000;">ravel</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>  <span style="color: #d00; font-style: italic;"># Get the second column's data as numpy array</span>

<span style="color: #d00; font-style: italic;"># Create BayesianRidge object, with parameters:</span>
<span style="color: #d00; font-style: italic;"># tol=1e-6, tolerance is 1e-6</span>
<span style="color: #d00; font-style: italic;"># fit_intercept=True, to fit with intercept</span>
<span style="color: #d00; font-style: italic;"># compute_score=True, compute the log marginal likelihood at each iteration of the optimization</span>
<span style="color: #d00; font-style: italic;"># alpha_init=1, initial value for alpha of gamma distribution</span>
<span style="color: #d00; font-style: italic;"># lambda_init=1e-3, initial value for lambda of gamma distribution</span>
blr <span style="color: #000;">=</span> linear_model.<span style="color: #000;">BayesianRidge</span><span style="color: #000;">&#40;</span>tol<span style="color: #000;">=</span><span style="color: #000;">1e-6</span><span style="color: #000;">,</span> fit_intercept<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">,</span> compute_score<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">,</span> alpha_init<span style="color: #000;">=</span><span style="color: #000;">1</span><span style="color: #000;">,</span> lambda_init<span style="color: #000;">=</span><span style="color: #000;">1e-3</span><span style="color: #000;">&#41;</span>

degree <span style="color: #000;">=</span> <span style="color: #000;">10</span>  <span style="color: #d00; font-style: italic;"># Degree for getting Vandermonde matrix</span>

<span style="color: #d00; font-style: italic;"># Expand X to Vandermonde matrix with degree of 10</span>
<span style="color: #d00; font-style: italic;"># then fit the BayesianRidge model</span>
blr.<span style="color: #000;">fit</span><span style="color: #000;">&#40;</span>np.<span style="color: #000;">vander</span><span style="color: #000;">&#40;</span>X<span style="color: #000;">,</span> degree<span style="color: #000;">&#41;</span><span style="color: #000;">,</span> y<span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;"># Predict y from the same Vandermonde matrix of X, also return standard deviation</span>
ymean<span style="color: #000;">,</span> ystd <span style="color: #000;">=</span> blr.<span style="color: #000;">predict</span><span style="color: #000;">&#40;</span>np.<span style="color: #000;">vander</span><span style="color: #000;">&#40;</span>X<span style="color: #000;">,</span> degree<span style="color: #000;">&#41;</span><span style="color: #000;">,</span> return_std<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;"># Find worksheet for output results</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'w'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'Results'</span><span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;"># Output coefficients, because X is expanded with 10 degree of Vandermonde matrix</span>
<span style="color: #d00; font-style: italic;"># so there are 10 coefficients</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">&#40;</span>pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">&#40;</span>blr.<span style="color: #000;">coef_</span><span style="color: #000;">,</span> columns<span style="color: #000;">=</span><span style="color: #000;">&#91;</span><span style="color: #0a0;">'Coefficients'</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#41;</span><span style="color: #000;">,</span> <span style="color: #000;">0</span><span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;"># Output intercept</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">&#40;</span>pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">&#40;</span>np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#91;</span>blr.<span style="color: #000;">intercept_</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#41;</span><span style="color: #000;">,</span> columns<span style="color: #000;">=</span><span style="color: #000;">&#91;</span><span style="color: #0a0;">'Intercept'</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#41;</span><span style="color: #000;">,</span> <span style="color: #000;">1</span><span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;"># Output alpha and lambda of gamma distribution</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">&#40;</span>pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">&#40;</span>np.<span style="color: #000;">c_</span><span style="color: #000;">&#91;</span><span style="color: #000;">&#91;</span><span style="color: #0a0;">'Alpha'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'Lambda'</span><span style="color: #000;">&#93;</span><span style="color: #000;">,</span> <span style="color: #000;">&#91;</span>blr.<span style="color: #000;">alpha_</span><span style="color: #000;">,</span> blr.<span style="color: #000;">lambda_</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#93;</span><span style="color: #000;">,</span> columns<span style="color: #000;">=</span><span style="color: #000;">&#91;</span><span style="color: #0a0;">'Gamma Parameters'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'Gamma Parameter Values'</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#41;</span><span style="color: #000;">,</span> <span style="color: #000;">2</span><span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;"># Output score of each interation</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">&#40;</span>pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">&#40;</span>np.<span style="color: #000;">c_</span><span style="color: #000;">&#91;</span>np.<span style="color: #000;">arange</span><span style="color: #000;">&#40;</span><span style="color: #000;">0</span><span style="color: #000;">,</span> blr.<span style="color: #000;">n_iter_</span>+<span style="color: #000;">1</span><span style="color: #000;">&#41;</span><span style="color: #000;">,</span> blr.<span style="color: #000;">scores_</span><span style="color: #000;">&#93;</span><span style="color: #000;">,</span> columns<span style="color: #000;">=</span><span style="color: #000;">&#91;</span><span style="color: #0a0;">'Iteration'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'Score'</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#41;</span><span style="color: #000;">,</span> <span style="color: #000;">4</span><span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;"># Output independent and predicted dependent, and standard deviation</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">&#40;</span>pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">&#40;</span>np.<span style="color: #000;">c_</span><span style="color: #000;">&#91;</span>X<span style="color: #000;">,</span> ymean<span style="color: #000;">,</span> ystd<span style="color: #000;">&#93;</span><span style="color: #000;">,</span> columns<span style="color: #000;">=</span><span style="color: #000;">&#91;</span><span style="color: #0a0;">'Indep'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'Predicted Y'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'STD'</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#41;</span><span style="color: #000;">,</span> <span style="color: #000;">6</span><span style="color: #000;">&#41;</span></pre>
<h3><a name="Friedman.27s_Super_Smoother"></a><span class="mw-headline">Friedman's Super Smoother</span></h3>
<p>In this example, data with noise is smoothed using the Friedman's Super Smoother method.
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #d00; font-style: italic;">#This example requires to install supersmoother and pandas packages</span>
<span style="color: #ff7700;font-weight:bold;">from</span> supersmoother <span style="color: #ff7700;font-weight:bold;">import</span> SuperSmoother

<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
<span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd

<span style="color: #d00; font-style: italic;">#Get data from the active worksheet</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'w'</span><span style="color: #000;">&#41;</span>
cx <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">&#40;</span> <span style="color: #000;">0</span> <span style="color: #000;">&#41;</span> <span style="color: #000;">&#41;</span>
cy <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">&#40;</span> <span style="color: #000;">1</span> <span style="color: #000;">&#41;</span> <span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;">#Perfrom Friedman's Super Smoother</span>
<span style="color: #d00; font-style: italic;">#alpha: smoothing level, (0 &lt; alpha &lt; 10)</span>
smoother <span style="color: #000;">=</span> SuperSmoother<span style="color: #000;">&#40;</span> alpha <span style="color: #000;">=</span> <span style="color: #000;">2</span> <span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;">#Fit the smoother</span>
smoother.<span style="color: #000;">fit</span><span style="color: #000;">&#40;</span> cx<span style="color: #000;">,</span> cy <span style="color: #000;">&#41;</span><span style="color: #000;">;</span>

<span style="color: #d00; font-style: italic;">#Predict the smoothed function for inpit x</span>
yfit <span style="color: #000;">=</span> smoother.<span style="color: #000;">predict</span><span style="color: #000;">&#40;</span> cx <span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;">#Output the smoothed result to worksheet in Origin.</span>
df <span style="color: #000;">=</span> pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">&#40;</span> <span style="color: #000;">&#123;</span><span style="color: #0a0;">'Smoothed'</span>: yfit<span style="color: #000;">&#125;</span> <span style="color: #000;">&#41;</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">&#40;</span> df<span style="color: #000;">,</span> <span style="color: #000;">2</span> <span style="color: #000;">&#41;</span></pre>
<h3><a name="Hyperspectral_Image_Stack_and_PCA"></a><span class="mw-headline">Hyperspectral Image Stack and PCA</span></h3>
<p>This example demonstrates how to reduce image stack data using Principal Component Analysis (PCA).
</p><p>The data is hyperspectral image data over a range of wavelengths, from a MATLAB .mat file. The data size is reduced using PCA but still keeping as much useful information as possible.
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
<span style="color: #ff7700;font-weight:bold;">from</span> sklearn.<span style="color: #000;">preprocessing</span> <span style="color: #ff7700;font-weight:bold;">import</span> StandardScaler
<span style="color: #ff7700;font-weight:bold;">from</span> sklearn.<span style="color: #000;">decomposition</span> <span style="color: #ff7700;font-weight:bold;">import</span> PCA


<span style="color: #ff7700;font-weight:bold;">if</span> __name__ <span style="color: #000;">==</span> <span style="color: #0a0;">'__main__'</span>:
    <span style="color: #d00; font-style: italic;"># Find matrix sheet named MBook1, this sheet includes 200 matrix objects as image stacks, for 200 bands hyperspectral data</span>
    msX <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'m'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'MBook1'</span><span style="color: #000;">&#41;</span>
    
    <span style="color: #d00; font-style: italic;"># Get the 200 bands data from matrix sheet as 3d numpy array</span>
    <span style="color: #d00; font-style: italic;"># dstack=True is to use dstack, so the data is in the shape of (rows, cols, depths)</span>
    <span style="color: #d00; font-style: italic;"># here depths should be 200, mean 200 bands, </span>
    <span style="color: #d00; font-style: italic;"># rows and cols are number of rows and cols of image for each band</span>
    X <span style="color: #000;">=</span> msX.<span style="color: #000;">to_np3d</span><span style="color: #000;">&#40;</span>dstack<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">&#41;</span>

    <span style="color: #d00; font-style: italic;"># Reshape X to 2d matrix, here is (-1, X.shape[2])</span>
    <span style="color: #d00; font-style: italic;"># -1 means not care the first dimension's size, and X.shape[2] is depths</span>
    <span style="color: #d00; font-style: italic;"># this equals to X = np.reshape(X, (X.shape[0]*X.shape[1], X.shape[2]))</span>
    <span style="color: #d00; font-style: italic;"># after reshape to 2d matrix, one row of matrix has 200 band values</span>
    <span style="color: #d00; font-style: italic;"># that is one pixel of matrix includes 200 values along depth for 200 stacked images</span>
    X <span style="color: #000;">=</span> X.<span style="color: #000;">reshape</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#40;</span>-<span style="color: #000;">1</span><span style="color: #000;">,</span> X.<span style="color: #000;">shape</span><span style="color: #000;">&#91;</span><span style="color: #000;">2</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>
    
    <span style="color: #d00; font-style: italic;"># Find matrix sheet named MBook2</span>
    <span style="color: #d00; font-style: italic;"># this sheet includes the ground truth data with 16 classes (from 1 to 16)</span>
    <span style="color: #d00; font-style: italic;"># and 0 is not a valid class</span>
    msY <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'m'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'MBook2'</span><span style="color: #000;">&#41;</span>
    
    <span style="color: #d00; font-style: italic;"># Get the ground truth data from matrix sheet as numpy array</span>
    <span style="color: #d00; font-style: italic;"># and then reshape it as matrix with only one column</span>
    <span style="color: #d00; font-style: italic;"># (-1, 1) means not care the first dimension's size, but with only one column</span>
    mY <span style="color: #000;">=</span> msY.<span style="color: #000;">to_np3d</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>.<span style="color: #000;">reshape</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#40;</span>-<span style="color: #000;">1</span><span style="color: #000;">,</span> <span style="color: #000;">1</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>
    
    X <span style="color: #000;">=</span> X<span style="color: #000;">&#91;</span>mY.<span style="color: #000;">ravel</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span> <span style="color: #000;">!=</span> <span style="color: #000;">0</span><span style="color: #000;">,</span>&#160;:<span style="color: #000;">&#93;</span>  <span style="color: #d00; font-style: italic;"># Remove the pixels (rows in X) where class is 0 (0 means invalid class)</span>
    
    <span style="color: #d00; font-style: italic;"># The original number of bands is 220</span>
    <span style="color: #d00; font-style: italic;"># but the number of bands in corrected data is 200</span>
    <span style="color: #d00; font-style: italic;"># those bands covering the region of water absorption are [104-108], [150-163], 220</span>
    <span style="color: #d00; font-style: italic;"># so available bands should exclude these 20 bands</span>
    bands <span style="color: #000;">=</span> np.<span style="color: #000;">append</span><span style="color: #000;">&#40;</span>np.<span style="color: #000;">append</span><span style="color: #000;">&#40;</span>np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span><span style="color: #900090;">range</span><span style="color: #000;">&#40;</span><span style="color: #000;">1</span><span style="color: #000;">,</span> <span style="color: #000;">104</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span><span style="color: #000;">,</span> np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span><span style="color: #900090;">range</span><span style="color: #000;">&#40;</span><span style="color: #000;">109</span><span style="color: #000;">,</span> <span style="color: #000;">150</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span><span style="color: #000;">,</span> np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span><span style="color: #900090;">range</span><span style="color: #000;">&#40;</span><span style="color: #000;">164</span><span style="color: #000;">,</span> <span style="color: #000;">220</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>

    <span style="color: #d00; font-style: italic;"># Create StandardScaler object, and then fit and transform X data</span>
    <span style="color: #d00; font-style: italic;"># this is for scaling the data to avoid the problem of different scales of the data</span>
    scaledX <span style="color: #000;">=</span> StandardScaler<span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>.<span style="color: #000;">fit_transform</span><span style="color: #000;">&#40;</span>X<span style="color: #000;">&#41;</span>
    
    <span style="color: #d00; font-style: italic;"># Create DataFrame using scaled X data</span>
    <span style="color: #d00; font-style: italic;"># by assigning bands as column header</span>
    scaledX <span style="color: #000;">=</span> pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">&#40;</span>scaledX<span style="color: #000;">,</span> columns<span style="color: #000;">=</span>bands<span style="color: #000;">&#41;</span>  <span style="color: #d00; font-style: italic;"># Though column header is assigned, not very useful here</span>
    
    n_components <span style="color: #000;">=</span> <span style="color: #000;">50</span>  <span style="color: #d00; font-style: italic;"># The data have 200 features (waves for one sample), here use 50 to reduce the dimension from 200 to 50</span>
    pca <span style="color: #000;">=</span> PCA<span style="color: #000;">&#40;</span>n_components<span style="color: #000;">=</span>n_components<span style="color: #000;">,</span> svd_solver<span style="color: #000;">=</span><span style="color: #0a0;">'randomized'</span><span style="color: #000;">,</span> whiten<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">,</span> random_state<span style="color: #000;">=</span><span style="color: #000;">100</span><span style="color: #000;">,</span> <span style="color: #000;">copy</span><span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">&#41;</span>  <span style="color: #d00; font-style: italic;"># Create PCA object</span>
    
    <span style="color: #d00; font-style: italic;"># Use the pca object to fit and transform the scaledX data</span>
    <span style="color: #d00; font-style: italic;"># now the data has 50 columns, with the same number of rows</span>
    pcaX <span style="color: #000;">=</span> pca.<span style="color: #000;">fit_transform</span><span style="color: #000;">&#40;</span>scaledX<span style="color: #000;">&#41;</span>

    <span style="color: #d00; font-style: italic;"># Print the sum of percentage of variance explained by each of the 50 components</span>
    <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: #000;">&#40;</span>np.<span style="color: #900090;">sum</span><span style="color: #000;">&#40;</span>pca.<span style="color: #000;">explained_variance_ratio_</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>

    ws <span style="color: #000;">=</span> op.<span style="color: #000;">new_sheet</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'w'</span><span style="color: #000;">&#41;</span>  <span style="color: #d00; font-style: italic;"># Create worksheet for output data</span>
    
    <span style="color: #d00; font-style: italic;"># Create DataFrame using the PCA result data, pcaX</span>
    <span style="color: #d00; font-style: italic;"># column header is the explained variance ratio for each component</span>
    df <span style="color: #000;">=</span> pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">&#40;</span>pcaX<span style="color: #000;">,</span> columns<span style="color: #000;">=</span>pca.<span style="color: #000;">explained_variance_ratio_</span>.<span style="color: #000;">astype</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'str'</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>
    ws.<span style="color: #000;">from_df</span><span style="color: #000;">&#40;</span>df<span style="color: #000;">&#41;</span>  <span style="color: #d00; font-style: italic;"># Put DataFrame to worksheet</span></pre>
<h3><a name="Extract_Image_Colors"></a><span class="mw-headline">Extract Image Colors</span></h3>
<p>This example lets you pick all colors from an image such as a graph from a publication. The RGB values and the Origin color value for each color is output to a worksheet.
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> extcolors
<span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op

file_path <span style="color: #000;">=</span> op.<span style="color: #000;">file_dialog</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'*.png;*.jpg;*.bmp'</span><span style="color: #000;">,</span><span style="color: #0a0;">'Select an Image'</span><span style="color: #000;">&#41;</span>
<span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #900090;">len</span><span style="color: #000;">&#40;</span>file_path<span style="color: #000;">&#41;</span> <span style="color: #000;">==</span><span style="color: #000;">0</span>:
    <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #900090;">ValueError</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'user cancel'</span><span style="color: #000;">&#41;</span>
    
colors<span style="color: #000;">,</span> pixel_count <span style="color: #000;">=</span> extcolors.<span style="color: #000;">extract_from_path</span><span style="color: #000;">&#40;</span>file_path<span style="color: #000;">&#41;</span>

colors <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span>colors<span style="color: #000;">&#41;</span>
<span style="color: #d00; font-style: italic;">#rgb = colors[:,0]</span>
rgb<span style="color: #000;">,</span>pixel <span style="color: #000;">=</span> <span style="color: #900090;">map</span><span style="color: #000;">&#40;</span><span style="color: #900090;">list</span><span style="color: #000;">,</span> <span style="color: #900090;">zip</span><span style="color: #000;">&#40;</span>*colors<span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>
<span style="color: #d00; font-style: italic;">#print(rgb)</span>
r <span style="color: #000;">=</span> <span style="color: #000;">&#91;</span><span style="color: #000;">&#93;</span>
g <span style="color: #000;">=</span> <span style="color: #000;">&#91;</span><span style="color: #000;">&#93;</span>
b <span style="color: #000;">=</span> <span style="color: #000;">&#91;</span><span style="color: #000;">&#93;</span>
<span style="color: #ff7700;font-weight:bold;">for</span> row <span style="color: #ff7700;font-weight:bold;">in</span> rgb:
    r.<span style="color: #000;">append</span><span style="color: #000;">&#40;</span>row<span style="color: #000;">&#91;</span><span style="color: #000;">0</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#41;</span>
    g.<span style="color: #000;">append</span><span style="color: #000;">&#40;</span>row<span style="color: #000;">&#91;</span><span style="color: #000;">1</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#41;</span>
    b.<span style="color: #000;">append</span><span style="color: #000;">&#40;</span>row<span style="color: #000;">&#91;</span><span style="color: #000;">2</span><span style="color: #000;">&#93;</span><span style="color: #000;">&#41;</span>
<span style="color: #d00; font-style: italic;">#output colors</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'w'</span><span style="color: #000;">&#41;</span>
wks.<span style="color: #000;">from_list</span><span style="color: #000;">&#40;</span><span style="color: #000;">0</span><span style="color: #000;">,</span> r<span style="color: #000;">&#41;</span>
wks.<span style="color: #000;">from_list</span><span style="color: #000;">&#40;</span><span style="color: #000;">1</span><span style="color: #000;">,</span> g<span style="color: #000;">&#41;</span>
wks.<span style="color: #000;">from_list</span><span style="color: #000;">&#40;</span><span style="color: #000;">2</span><span style="color: #000;">,</span> b<span style="color: #000;">&#41;</span></pre>
<h3><a name="Lomb-Scargle_Periodogram"></a><span class="mw-headline">Lomb-Scargle Periodogram</span></h3>
<p>This example computes Lomb-Scargle periodgram on a signal with non-uniform spacing.
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #d00; font-style: italic;">#This example requires to install scipy, pandas packages.</span>

<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op

<span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">from</span> scipy.<span style="color: #000;">signal</span> <span style="color: #ff7700;font-weight:bold;">import</span> lombscargle

<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd

<span style="color: #d00; font-style: italic;">#use Active worksheet, get col A, B data</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>
t <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">&#40;</span> <span style="color: #000;">0</span> <span style="color: #000;">&#41;</span> <span style="color: #000;">&#41;</span>
y <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">&#40;</span> <span style="color: #000;">1</span> <span style="color: #000;">&#41;</span> <span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;">#Calculate angular frequency as input for lombscargle function</span>
n <span style="color: #000;">=</span> t.<span style="color: #000;">size</span>
ofac <span style="color: #000;">=</span> <span style="color: #000;">4</span>  <span style="color: #d00; font-style: italic;"># Oversampling factor</span>
hifac <span style="color: #000;">=</span> <span style="color: #000;">1</span>
T <span style="color: #000;">=</span> t<span style="color: #000;">&#91;</span>-<span style="color: #000;">1</span><span style="color: #000;">&#93;</span> - t<span style="color: #000;">&#91;</span><span style="color: #000;">0</span><span style="color: #000;">&#93;</span>
Ts <span style="color: #000;">=</span> T / <span style="color: #000;">&#40;</span>n - <span style="color: #000;">1</span><span style="color: #000;">&#41;</span>
nout <span style="color: #000;">=</span> np.<span style="color: #900090;">round</span><span style="color: #000;">&#40;</span><span style="color: #000;">0.5</span> * ofac * hifac * n<span style="color: #000;">&#41;</span> 
f <span style="color: #000;">=</span> np.<span style="color: #000;">arange</span><span style="color: #000;">&#40;</span><span style="color: #000;">1</span><span style="color: #000;">,</span> nout+<span style="color: #000;">1</span><span style="color: #000;">&#41;</span> / <span style="color: #000;">&#40;</span>n * Ts * ofac<span style="color: #000;">&#41;</span>
f_ang <span style="color: #000;">=</span> f * <span style="color: #000;">2</span> * np.<span style="color: #000;">pi</span>

<span style="color: #d00; font-style: italic;">#Perform Lomb-Scargle periodogram analysis</span>
pxx <span style="color: #000;">=</span> lombscargle<span style="color: #000;">&#40;</span>t<span style="color: #000;">,</span> y<span style="color: #000;">,</span> f_ang<span style="color: #000;">,</span> precenter<span style="color: #000;">=</span><span style="color: #900090;">True</span><span style="color: #000;">&#41;</span>
pxx <span style="color: #000;">=</span> pxx * <span style="color: #000;">2</span> / n /f<span style="color: #000;">&#91;</span>-<span style="color: #000;">1</span><span style="color: #000;">&#93;</span>

<span style="color: #d00; font-style: italic;">#f unit: mHz, PSD unit: dB/Hz</span>
f <span style="color: #000;">=</span> <span style="color: #000;">1000</span>*f
pxx <span style="color: #000;">=</span> <span style="color: #000;">10</span>*np.<span style="color: #000;">log10</span><span style="color: #000;">&#40;</span> pxx <span style="color: #000;">&#41;</span> 
    
df <span style="color: #000;">=</span> pd.<span style="color: #000;">DataFrame</span><span style="color: #000;">&#40;</span> <span style="color: #000;">&#123;</span><span style="color: #0a0;">'Frequency'</span>:f<span style="color: #000;">,</span> <span style="color: #0a0;">'Power/Frequency'</span>:pxx<span style="color: #000;">&#125;</span> <span style="color: #000;">&#41;</span>
<span style="color: #d00; font-style: italic;">#Send Python's DataFrame to the worksheet starting from column 3</span>
wks.<span style="color: #000;">from_df</span><span style="color: #000;">&#40;</span> df<span style="color: #000;">,</span> <span style="color: #000;">2</span> <span style="color: #000;">&#41;</span></pre>
<h3><a name="Export_all_Graphs"></a><span class="mw-headline">Export all Graphs</span></h3>
<p>This example exports all graphs in the Origin project. This project has two subfolders with one graph in each. The graphs have been previously exported and export settings were automatically saved in each graph. 
</p><p>Clicking the <b>Run Code</b> button runs the LabTalk script displayed below. The script opens a GetN dialog box allowing user to specify export path and other settings. 
</p>
<pre class="lt" style="font-family:monospace;">string path<span style="color: #000080;">$</span> <span style="color: #000080;">=</span> <span style="color: #ff00ff;">&quot;&quot;</span>;
int fmt<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>;
double dWidth <span style="color: #000080;">=</span> <span style="color: #0000dd;">500</span>;
int bWidth <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
GetN	
<span style="color: #000000;">&#40;</span>Leave path empty and Format Auto to use settings in each graph<span style="color: #000000;">&#41;</span> <span style="color: #000080;">$</span><span style="color: #000000;">:</span>@HL
<span style="color: #000000;">&#40;</span>Export Path<span style="color: #000000;">&#41;</span> path<span style="color: #000080;">$</span><span style="color: #000000;">:</span>@BBPath
<span style="color: #000000;">&#40;</span>Format<span style="color: #000000;">&#41;</span> fmt<span style="color: #000000;">:</span>r<span style="color: #000000;">&#40;</span><span style="color: #ff00ff;">&quot;Auto|png&quot;</span><span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#40;</span>Change Width<span style="color: #000000;">&#41;</span> bWidth<span style="color: #000000;">:</span>2s1
<span style="color: #000000;">&#40;</span>New Width<span style="color: #000000;">&#41;</span> dWidth
<span style="color: #000000;">&#40;</span>Graph Export Options<span style="color: #000000;">&#41;</span>;

if<span style="color: #000000;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: #000080;">==</span>bWidth<span style="color: #000000;">&#41;</span> dWidth <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;

py.@expall<span style="color: #000000;">&#40;</span>path<span style="color: #000080;">$</span>, dWidth, fmt<span style="color: #000000;">&#41;</span>;</pre>
<p>The last line of the script calls the Python function for exporting the graphs. The special notation <b>py.@expall()</b> is used to indicate that the function <b>expall()</b> is contained in the file <b>exp.py</b> which is attached to the project.
</p><p>Listed below is the Python function code:
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #000;">os</span>
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op

<span style="color: #ff7700;font-weight:bold;">def</span> expall<span style="color: #000;">&#40;</span>fpath<span style="color: #000;">,</span> imgw<span style="color: #000;">,</span> usepng<span style="color: #000;">&#41;</span>:
    <span style="color: #d00; font-style: italic;">#find all the graphs in project, embedded excluded</span>
    <span style="color: #900090;">list</span> <span style="color: #000;">=</span> op.<span style="color: #000;">graph_list</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'p'</span><span style="color: #000;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">for</span> graph <span style="color: #ff7700;font-weight:bold;">in</span> <span style="color: #900090;">list</span>:
        <span style="color: #ff7700;font-weight:bold;">if</span> usepng<span style="color: #000;">==</span><span style="color: #000;">0</span> <span style="color: #ff7700;font-weight:bold;">and</span> imgw<span style="color: #000;">==</span><span style="color: #000;">0</span>:
            <span style="color: #d00; font-style: italic;">#use saved theme in graph, only change path if fpath not empty, </span>
            <span style="color: #d00; font-style: italic;">#if not, each graph remembers its own path</span>
            result <span style="color: #000;">=</span> graph.<span style="color: #000;">save_fig</span><span style="color: #000;">&#40;</span>fpath<span style="color: #000;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">else</span>:
            result <span style="color: #000;">=</span> graph.<span style="color: #000;">save_fig</span><span style="color: #000;">&#40;</span>path<span style="color: #000;">=</span>fpath<span style="color: #000;">,</span> <span style="color: #900090;">type</span><span style="color: #000;">=</span><span style="color: #0a0;">'png'</span><span style="color: #000;">,</span> width<span style="color: #000;">=</span>imgw<span style="color: #000;">&#41;</span>
        <span style="color: #ff7700;font-weight:bold;">print</span><span style="color: #000;">&#40;</span>result<span style="color: #000;">&#41;</span>
        
    <span style="color: #d00; font-style: italic;">#if from LT path was given</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #900090;">len</span><span style="color: #000;">&#40;</span>fpath<span style="color: #000;">&#41;</span>:
        <span style="color: #000;">os</span>.<span style="color: #000;">startfile</span><span style="color: #000;">&#40;</span>fpath<span style="color: #000;">&#41;</span></pre>
<h3><a name="Image_Thinning"></a><span class="mw-headline">Image Thinning</span></h3>
<p>This example demonstrates how to perform thinning of an image using the opencv package.
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #d00; font-style: italic;">#original code from https://theailearner.com/tag/thinning-opencv/</span>
<span style="color: #d00; font-style: italic;">#pip install opencv-python;// from script window to install cv2</span>
<span style="color: #ff7700;font-weight:bold;">import</span> cv2
<span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op

<span style="color: #d00; font-style: italic;">#load our source image into a numpy array 'img'</span>
m1 <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'m'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'MBook1'</span><span style="color: #000;">&#41;</span>
img <span style="color: #000;">=</span> m1.<span style="color: #000;">to_np2d</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>

<span style="color: #d00; font-style: italic;"># Structuring Element</span>
kernel <span style="color: #000;">=</span> cv2.<span style="color: #000;">getStructuringElement</span><span style="color: #000;">&#40;</span>cv2.<span style="color: #000;">MORPH_CROSS</span><span style="color: #000;">,</span><span style="color: #000;">&#40;</span><span style="color: #000;">3</span><span style="color: #000;">,</span><span style="color: #000;">3</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>
<span style="color: #d00; font-style: italic;"># Create an empty output image to hold values</span>
thin <span style="color: #000;">=</span> np.<span style="color: #000;">zeros</span><span style="color: #000;">&#40;</span>img.<span style="color: #000;">shape</span><span style="color: #000;">,</span>dtype<span style="color: #000;">=</span><span style="color: #0a0;">'uint8'</span><span style="color: #000;">&#41;</span>
 
<span style="color: #d00; font-style: italic;"># Loop until erosion leads to an empty set or max</span>
<span style="color: #900090;">max</span> <span style="color: #000;">=</span> <span style="color: #000;">50</span>
<span style="color: #ff7700;font-weight:bold;">while</span> <span style="color: #000;">&#40;</span>cv2.<span style="color: #000;">countNonZero</span><span style="color: #000;">&#40;</span>img<span style="color: #000;">&#41;</span><span style="color: #000;">!=</span><span style="color: #000;">0</span><span style="color: #000;">&#41;</span>:
    <span style="color: #d00; font-style: italic;"># Erosion</span>
    erode <span style="color: #000;">=</span> cv2.<span style="color: #000;">erode</span><span style="color: #000;">&#40;</span>img<span style="color: #000;">,</span>kernel<span style="color: #000;">&#41;</span>
    <span style="color: #d00; font-style: italic;"># Opening on eroded image</span>
    opening <span style="color: #000;">=</span> cv2.<span style="color: #000;">morphologyEx</span><span style="color: #000;">&#40;</span>erode<span style="color: #000;">,</span>cv2.<span style="color: #000;">MORPH_OPEN</span><span style="color: #000;">,</span>kernel<span style="color: #000;">&#41;</span>
    <span style="color: #d00; font-style: italic;"># Subtract these two</span>
    subset <span style="color: #000;">=</span> erode - opening
    <span style="color: #d00; font-style: italic;"># Union of all previous sets</span>
    thin <span style="color: #000;">=</span> cv2.<span style="color: #000;">bitwise_or</span><span style="color: #000;">&#40;</span>subset<span style="color: #000;">,</span>thin<span style="color: #000;">&#41;</span>
    <span style="color: #d00; font-style: italic;"># Set the eroded image for next iteration</span>
    img <span style="color: #000;">=</span> erode.<span style="color: #000;">copy</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>
    <span style="color: #900090;">max</span> -<span style="color: #000;">=</span> <span style="color: #000;">1</span>
    <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #900090;">max</span> <span style="color: #000;">==</span> <span style="color: #000;">0</span>:
        <span style="color: #ff7700;font-weight:bold;">break</span>

m2 <span style="color: #000;">=</span> op.<span style="color: #000;">new_sheet</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'m'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'Thinned Result'</span><span style="color: #000;">&#41;</span>
m2.<span style="color: #000;">from_np</span><span style="color: #000;">&#40;</span>thin<span style="color: #000;">&#41;</span>
m2.<span style="color: #000;">show_image</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span></pre>
<h3><a name="Peak_Movement"></a><span class="mw-headline">Peak Movement</span></h3>
<p>In this example, data from sequential columns in a worksheet are plotted one by one, so user can visualize how the data is evolving as a function of the measurement parameter.
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op
<span style="color: #ff7700;font-weight:bold;">import</span> pandas <span style="color: #ff7700;font-weight:bold;">as</span> pd

<span style="color: #d00; font-style: italic;">#find by book name</span>
wksSource <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'w'</span><span style="color: #000;">,</span> <span style="color: #0a0;">'Waterfall]'</span><span style="color: #000;">&#41;</span>
df <span style="color: #000;">=</span> wksSource.<span style="color: #000;">to_df</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>
<span style="color: #d00; font-style: italic;">#also find by range notation</span>
wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span>ref<span style="color: #000;">=</span><span style="color: #0a0;">&quot;[Book1]1!&quot;</span><span style="color: #000;">&#41;</span>

<span style="color: #ff7700;font-weight:bold;">for</span> key<span style="color: #000;">,</span> value <span style="color: #ff7700;font-weight:bold;">in</span> df.<span style="color: #000;">iteritems</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>: 
    wks.<span style="color: #000;">from_list</span><span style="color: #000;">&#40;</span>key<span style="color: #000;">!=</span><span style="color: #0a0;">'X'</span><span style="color: #000;">,</span> <span style="color: #900090;">list</span><span style="color: #000;">&#40;</span>value<span style="color: #000;">&#41;</span><span style="color: #000;">,</span> comments<span style="color: #000;">=</span>key<span style="color: #000;">&#41;</span>
    op.<span style="color: #000;">wait</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'s'</span><span style="color: #000;">,</span> <span style="color: #000;">0.05</span><span style="color: #000;">&#41;</span></pre>
<h3><a name="Fit_Summation"></a><span class="mw-headline">Fit Summation</span></h3>
<p>This example is to fit data to a function with multiple summation series. The Nelder-Mead Simplex algorithm is used to obtain the fitting parameters in a vector form.
<a  class="image"><img alt="FitSummation1.png" src="../images/Sample_Projects_with_Attached_Python_Codes/400px-FitSummation1.png?v=52973" width="400"   /></a>
</p>
<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> numpy <span style="color: #ff7700;font-weight:bold;">as</span> np
<span style="color: #ff7700;font-weight:bold;">from</span> scipy.<span style="color: #000;">optimize</span> <span style="color: #ff7700;font-weight:bold;">import</span> minimize
<span style="color: #ff7700;font-weight:bold;">import</span> originpro <span style="color: #ff7700;font-weight:bold;">as</span> op

<span style="color: #ff7700;font-weight:bold;">def</span> fitfunc<span style="color: #000;">&#40;</span>a<span style="color: #000;">&#41;</span>:
    y1 <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span>y<span style="color: #000;">&#41;</span>  
    y1 <span style="color: #000;">=</span> y1.<span style="color: #000;">reshape</span><span style="color: #000;">&#40;</span><span style="color: #000;">1</span><span style="color: #000;">,</span><span style="color: #900090;">len</span><span style="color: #000;">&#40;</span>y1<span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>
    <span style="color: #ff7700;font-weight:bold;">return</span> <span style="color: #900090;">sum</span><span style="color: #000;">&#40;</span>np.<span style="color: #000;">square</span><span style="color: #000;">&#40;</span><span style="color: #900090;">sum</span><span style="color: #000;">&#40;</span>C_csk<span style="color: #000;">&#40;</span>a<span style="color: #000;">,</span> x<span style="color: #000;">&#41;</span> - y1<span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span> 
    
<span style="color: #ff7700;font-weight:bold;">def</span> C_csk<span style="color: #000;">&#40;</span>a<span style="color: #000;">,</span> x<span style="color: #000;">&#41;</span>:
    <span style="color: #0a0;">&quot;&quot;&quot;
    D:DD
    &quot;&quot;&quot;</span>
    a <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span>a<span style="color: #000;">&#41;</span>
    a <span style="color: #000;">=</span> a.<span style="color: #000;">reshape</span><span style="color: #000;">&#40;</span><span style="color: #900090;">len</span><span style="color: #000;">&#40;</span>a<span style="color: #000;">&#41;</span><span style="color: #000;">,</span><span style="color: #000;">1</span><span style="color: #000;">&#41;</span>
    g <span style="color: #000;">=</span> a<span style="color: #000;">&#91;</span><span style="color: #000;">0</span>:<span style="color: #900090;">int</span><span style="color: #000;">&#40;</span><span style="color: #900090;">len</span><span style="color: #000;">&#40;</span>a<span style="color: #000;">&#41;</span>/<span style="color: #000;">2</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#93;</span>
    d <span style="color: #000;">=</span> a<span style="color: #000;">&#91;</span><span style="color: #900090;">int</span><span style="color: #000;">&#40;</span><span style="color: #900090;">len</span><span style="color: #000;">&#40;</span>a<span style="color: #000;">&#41;</span>/<span style="color: #000;">2</span><span style="color: #000;">&#41;</span>:<span style="color: #000;">&#93;</span>
    x1 <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span>x<span style="color: #000;">&#41;</span>
    x1 <span style="color: #000;">=</span> x1.<span style="color: #000;">reshape</span><span style="color: #000;">&#40;</span><span style="color: #000;">1</span><span style="color: #000;">,</span><span style="color: #900090;">len</span><span style="color: #000;">&#40;</span>x1<span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>    
    m0 <span style="color: #000;">=</span> g*np.<span style="color: #000;">exp</span><span style="color: #000;">&#40;</span>-d/x1<span style="color: #000;">&#41;</span>
    m1 <span style="color: #000;">=</span> g*d*np.<span style="color: #000;">exp</span><span style="color: #000;">&#40;</span>-d/x1<span style="color: #000;">&#41;</span>
    m2 <span style="color: #000;">=</span> g*np.<span style="color: #000;">square</span><span style="color: #000;">&#40;</span>d<span style="color: #000;">&#41;</span>*np.<span style="color: #000;">exp</span><span style="color: #000;">&#40;</span>-d/x1<span style="color: #000;">&#41;</span>
    sm <span style="color: #000;">=</span> <span style="color: #000;">&#40;</span>m0.<span style="color: #900090;">sum</span><span style="color: #000;">&#40;</span>axis<span style="color: #000;">=</span><span style="color: #000;">0</span><span style="color: #000;">&#41;</span>*m2.<span style="color: #900090;">sum</span><span style="color: #000;">&#40;</span>axis<span style="color: #000;">=</span><span style="color: #000;">0</span><span style="color: #000;">&#41;</span> - np.<span style="color: #000;">square</span><span style="color: #000;">&#40;</span>m1.<span style="color: #900090;">sum</span><span style="color: #000;">&#40;</span>axis<span style="color: #000;">=</span><span style="color: #000;">0</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>/np.<span style="color: #000;">square</span><span style="color: #000;">&#40;</span>m0.<span style="color: #900090;">sum</span><span style="color: #000;">&#40;</span>axis<span style="color: #000;">=</span><span style="color: #000;">0</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>*<span style="color: #000;">8.314</span>/x1/x1
    <span style="color: #ff7700;font-weight:bold;">return</span> sm.<span style="color: #900090;">sum</span><span style="color: #000;">&#40;</span>axis<span style="color: #000;">=</span><span style="color: #000;">0</span><span style="color: #000;">&#41;</span>  

<span style="color: #ff7700;font-weight:bold;">def</span> fitSummation<span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>:
    <span style="color: #ff7700;font-weight:bold;">global</span> x<span style="color: #000;">,</span> y
    wks <span style="color: #000;">=</span> op.<span style="color: #000;">find_sheet</span><span style="color: #000;">&#40;</span><span style="color: #000;">&#41;</span>
    x <span style="color: #000;">=</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">&#40;</span><span style="color: #000;">0</span><span style="color: #000;">&#41;</span>
    y <span style="color: #000;">=</span> wks.<span style="color: #000;">to_list</span><span style="color: #000;">&#40;</span><span style="color: #000;">1</span><span style="color: #000;">&#41;</span>
    a0 <span style="color: #000;">=</span> np.<span style="color: #000;">array</span><span style="color: #000;">&#40;</span>wks.<span style="color: #000;">to_list</span><span style="color: #000;">&#40;</span><span style="color: #000;">2</span><span style="color: #000;">&#41;</span><span style="color: #000;">&#41;</span>
    res <span style="color: #000;">=</span> minimize<span style="color: #000;">&#40;</span>fitfunc<span style="color: #000;">,</span> a0<span style="color: #000;">,</span> method<span style="color: #000;">=</span><span style="color: #0a0;">'nelder-mead'</span><span style="color: #000;">,</span> options<span style="color: #000;">=</span><span style="color: #000;">&#123;</span><span style="color: #0a0;">'xatol'</span>: <span style="color: #000;">1e-8</span><span style="color: #000;">,</span> <span style="color: #0a0;">'disp'</span>: <span style="color: #900090;">True</span><span style="color: #000;">&#125;</span><span style="color: #000;">&#41;</span>
    wks.<span style="color: #000;">from_list</span><span style="color: #000;">&#40;</span><span style="color: #000;">3</span><span style="color: #000;">,</span> res.<span style="color: #000;">x</span><span style="color: #000;">&#41;</span></pre>
<h2><a name="How_to_Execute_Python_Code_from_a_Button"></a><span class="mw-headline">How to Execute Python Code from a Button</span></h2>
<p>LabTalk script can be set up to execute from graph objects such as text labels. Script can be made to execute on events such as clicking, moving and resizing. 
</p><p>The examples described in previous sections use text labels set up as buttons, to execute LabTalk script. The script then executes Python code attached to the project. The following mini tutorial will show you how.
</p>
<ol><li> Open Code Builder from Origin (menu: <b>View-&gt;Code Builder</b>).</li>
<li> Use the menu <b>File-&gt;New...</b> and in the dialog select <b>Python File</b>, and give it the name <b>test</b> and click <b>OK</b>.</li>
<li> In the editor on the right side, enter the Python code:<pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">print</span><span style="color: #000;">&#40;</span><span style="color: #0a0;">'Hello from Python!'</span><span style="color: #000;">&#41;</span></pre> and click the <b>Save</b> button to save the file.</li>
<li> In the left panel of Code Builder, right-click on the <b>Project</b> node and select the context menu <b>Add File...</b>. Select the file <b>test.py</b> that you created, and click OK. The file is now attached to the project.</li>
<li> Go back to Origin. </li>
<li> Make a graph or worksheet window active.</li>
<li> Select the <b>Text</b> tool <a  class="image"><img alt="Button Text Tool.png" src="../images/Sample_Projects_with_Attached_Python_Codes/Button_Text_Tool.png?v=52954" width="23"  /></a> from the <b>Tools</b> toolbar to the left side of the Origin interface. </li>
<li> Click on an open space on your graph or worksheet. This will put you into text edit mode.  Type <b>Run Code</b> in the text object and click outside the object. </li>
<li> Now hold down the <b>ALT</b> key while double-clicking on the text object that you just created.  The Object Properties dialog opens to the <b>Programming</b> tab.</li>
<li> Change the <b>Script Run After</b> drop-down to <b>Button Up</b>.</li>
<li> In the lower text box, enter this script: <pre class="lt" style="font-family:monospace;">run <span style="color: #000080;">-</span>pyp test.<span style="color: #000080;">py</span>;</pre>. This line of script tells Origin to execute the Python code contained in the file test.py which is attached to the project.</li>
<li> Click <b>OK</b> to close the dialog.</li>
<li> Note that the text label is now a button. Click on the button. The Script Window will open and show the output from the Python print statement.</li>
<li> You can now save the project and the python code file attached to the project will be saved with it.</li></ol>
<p>Note that the Origin Project samples shipped with the installation have multiple buttons to <b>Run Code</b>, <b>Show Code</b>, <b>Install Required Packages</b> etc. You can hold down the ALT key and double-click on those buttons to view the script.
</p>
<h3><a name="The_Show_Code_Button"></a><span class="mw-headline">The Show Code Button</span></h3>
<p>The above projects have a <b>Show Code</b> button that, when clicked, opens the Python code in the Code Builder IDE. IF there is only one .py file attached to the project, you can open that file in the IDE with a simple line of script:
</p>
<pre class="lt" style="font-family:monospace;">ed.<span style="color: #000080;">open</span><span style="color: #000000;">&#40;</span>py.@<span style="color: #000000;">&#41;</span></pre>
<p>When there are multiple files attached to the project, you can open a specific file using ...
</p>
<pre class="lt" style="font-family:monospace;">ed.<span style="color: #000080;">open</span><span style="color: #000000;">&#40;</span>py.@filename<span style="color: #000000;">&#41;</span></pre>
<p>You can see how the <b>Show Code</b> button is set up to execute this script by pressing ALT and double-clicking on the button.
</p><p><b>See Also:</b>
</p>
<ul><li> <a class="external text" href="https://www.originlab.com/python/doc/originpro/annotated.html" target="_blank">Python originpro Reference</a></li></ul>






