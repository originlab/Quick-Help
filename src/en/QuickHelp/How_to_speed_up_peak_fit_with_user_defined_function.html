<h1 class="firstHeading">3.137 FAQ-808 Why my peak fitting with user-defined function is slow? How to speed it up?</h1><p class='urlname' style='display: none'>Speedup-UserDefined-PeakFit</p>
<p class='faqID'>Last Update: 7/29/2018</p>
<p>The main reason of the slowness is <b>Peak Gravity Center</b> under <b>Result: Configure Report: Peak Properties</b> of Fit Peaks page of <b>Peak Analyzer</b> dialog. This option is checked by default. Origin's built-in peak fitting functions provide analytic solutions and thus calculates the <b>Peak Gravity Center</b>. However, user-defined fitting function doesn't have an analytic solution so it calculates <b>Peak Gravity Center</b> in a numeric way, which makes the fitting process slow.
</p><p>Another reason is <b>Fitted Peak Area</b> under <b>Result: Configure Report: Peak Properties</b> of Fit Peaks page. Origin uses zero Moment to calculate the analytic area, which is also time-consuming.
</p><p>To speed up the fitting process, you can uncheck <b>Peak Gravity Center</b> and <b>Fitted Peak Area</b> in <b>Peak Analyzer</b>. It will be very fast then. If you know the analytic solution for <b>Peak Gravity Center</b> and <b>Fitted Peak Area</b>, you can add a section in FDF file manually. Take the following fitting function for example,
<img src="../images/How_to_speed_up_peak_fit_with_user_defined_function/math-2ff2101feb19c319629768bbefb6dab5.png?v=0" title="y = y0+ f \frac{A}{\frac{2w}{1+e^{s(x-x_c)}}}*\sqrt{4\frac{Ln2}{\pi}}*e^{-4Ln({\frac{x-x_c}{\frac{2w}{1+e^{s(x-x_c)}}})^2}}+&#10;(1-f)\frac{\frac{2A}{\pi*(\frac{2w}{1+e^{s(x-x_c)}})}}&#10;{1+4(\frac{x-x_c}{\frac{2w}{1+e^{s(x-x_c)}}})^2}" alt="y = y0+ f \frac{A}{\frac{2w}{1+e^{s(x-x_c)}}}*\sqrt{4\frac{Ln2}{\pi}}*e^{-4Ln({\frac{x-x_c}{\frac{2w}{1+e^{s(x-x_c)}}})^2}}+&#10;(1-f)\frac{\frac{2A}{\pi*(\frac{2w}{1+e^{s(x-x_c)}})}}&#10;{1+4(\frac{x-x_c}{\frac{2w}{1+e^{s(x-x_c)}}})^2}" class="tex"/>
</p><p><b>Peak Gravity Center</b> and <b>Fitted Peak Area</b> are <i>x_c</i> and <i>A</i> respectively. So you can add following section to the end of FDF file: 
</p>
<pre class="lt" style="font-family:monospace;"><span style="color: #000000;">&#91;</span>Moments<span style="color: #000000;">&#93;</span> 
mz0 <span style="color: #000080;">=</span> A 
mz1 <span style="color: #000080;">=</span> xc
mc2 <span style="color: #000080;">=</span> N.<span style="color: #000080;">A</span>.
<span style="color: #000080;">mc3</span> <span style="color: #000080;">=</span> N.<span style="color: #000080;">A</span>.
<span style="color: #000080;">mc4</span> <span style="color: #000080;">=</span> N.<span style="color: #000080;">A</span>.</pre>
<p><br />
</p>
<table class="note">

<tr>
<td><b>Notes:</b> Note that selecting the Peak Properties,<b>Peak Skew</b>, <b>Peak Excess</b>, <b>3rd Order Moment</b>, <b>4th Order Moment</b>, may also be time-consuming. Please pay attention when you are using a user-defined function
</td></tr></table>
<hr class='keywordshr'><p><span class='keywords'>Keywords:</span><span class='keywordsInput'>User defined fitting function, slow, peak analyzer, speed up</span></p>






