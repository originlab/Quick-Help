<h1 class="firstHeading">3.142 FAQ-858 How to build up a summation fitting function or a double integral fitting funtion?</h1><p class='urlname' style='display: none'>Summation-DoubleIntegral-Func</p>
<p class='faqID'>Last Update: 10/12/2017</p>
<p>You can create your user-defined summation or double integral fitting function by LabTalk scripts or Origin C codes, in <b>Tools: Fitting Function Organizer</b>.
</p>
<h2><a name="summation_fitting_function"></a><span class="mw-headline">summation fitting function</span></h2>
<p>You can define the fitting function with an embedded <b>For</b> loop in the function definition box. Take the following function as an example.
</p><p><img src="../images/How_to_build_up_summation_or_double_integral_fitting_funtion/math-45e5bd7a44a0155e3ee7419c9d48fd72.png?v=0" title="y=\sum_{i=1}^{10}a \cdot x^2" alt="y=\sum_{i=1}^{10}a \cdot x^2" class="tex"/>
</p><p>Suppose you define the fitting function in the <b>Function</b> box as follow:
</p>
<pre class="lt" style="font-family:monospace;">y <span style="color: #000080;">=</span> sum<span style="color: #000000;">&#40;</span>x, a, n<span style="color: #000000;">&#41;</span>; <span style="color: #008000;">//n is a constant, and n=10</span></pre>
<p>Then define the user-defined LabTalk functions <i>sum</i> in the <b>LabTalk Functions Definition and Initializations</b> box as follow:
</p>
<pre class="lt" style="font-family:monospace;">function double sum<span style="color: #000000;">&#40;</span>double x, double a, int n<span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
    double bb <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
    for<span style="color: #000000;">&#40;</span>ii <span style="color: #000080;">=</span><span style="color: #0000dd;">1</span>; ii<span style="color: #000080;">&lt;=</span>n; ii<span style="color: #000080;">++</span><span style="color: #000000;">&#41;</span>
    <span style="color: #000000;">&#123;</span>
    	bb <span style="color: #000080;">=</span> a <span style="color: #000080;">*</span> x <span style="color: #000080;">*</span> x <span style="color: #000080;">+</span> bb;
    <span style="color: #000000;">&#125;</span>
    return bb;
<span style="color: #000000;">&#125;</span></pre>
<h2><a name="double_integral_fitting_function"></a><span class="mw-headline">double integral fitting function</span></h2>
<p>You can define an Origin C fitting function in which NAG functions are called to perform the integration. Take the following function as an example.
</p><p><img src="../images/How_to_build_up_summation_or_double_integral_fitting_funtion/math-a24fb58509ff124bdd2be944ec80b8b0.png?v=0" title="y=\int_{amp}^x \int_{amp}^x (z_{1}+z_{2})dz_{1}dz_{2}" alt="y=\int_{amp}^x \int_{amp}^x (z_{1}+z_{2})dz_{1}dz_{2}" class="tex"/>
</p>
<ol>
<li>Click the button next to the <b>Function</b> edit box to open the <b>Code Builder</b>.
<li>Scroll up to go to line
<pre class="oc" style="font-family:monospace;"><span style="color: #008000;">//add the header file for the NAG functions here.</span></pre>
<p>and add the header file for the NAG functions below this line:
</p>
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">#include</span> <span style="color: #000080;">&lt;</span>OC_nag.<span style="color: #000000;">h</span><span style="color: #000080;">&gt;</span></pre>
<li>Define your fitting model.
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">static</span> <span style="color: #0000ff;">double</span> NAG_CALL f<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">int</span> n, <span style="color: #0000ff;">double</span> z<span style="color: #000000;">&#91;</span><span style="color: #000000;">&#93;</span>, Nag_User <span style="color: #000040;">*</span>comm<span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #0000ff;">int</span> <span style="color: #000040;">*</span>use_comm <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span><span style="color: #0000ff;">int</span> <span style="color: #000040;">*</span><span style="color: #000000;">&#41;</span>comm<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>p;
	<span style="color: #0000ff;">double</span> dUserSuppliedFunction;
	dUserSuppliedFunction <span style="color: #000080;">=</span> z<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: #000000;">&#93;</span> <span style="color: #000040;">+</span> z<span style="color: #000000;">&#91;</span>n<span style="color: #000040;">-</span><span style="color: #0000dd;">1</span><span style="color: #000000;">&#93;</span>;
	<span style="color: #0000ff;">return</span> dUserSuppliedFunction;
<span style="color: #000000;">&#125;</span></pre>
<li>Edit your fitting function.
<pre class="oc" style="font-family:monospace;"><span style="color: #0000ff;">void</span> _nlsfnag_double_integral_fitting<span style="color: #000000;">&#40;</span>
<span style="color: #008000;">// Fit Parameter(s):</span>
<span style="color: #0000ff;">double</span> amp,
<span style="color: #008000;">// Independent Variable(s):</span>
<span style="color: #0000ff;">double</span> x,
<span style="color: #008000;">// Dependent Variable(s):</span>
<span style="color: #0000ff;">double</span><span style="color: #000040;">&amp;</span> y<span style="color: #000000;">&#41;</span>
<span style="color: #000000;">&#123;</span>
	<span style="color: #008000;">// Beginning of editable part</span>
        <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">int</span> use_comm;
	<span style="color: #0000ff;">int</span> ndim <span style="color: #000080;">=</span> <span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// the integral dimension</span>
	<span style="color: #0000ff;">int</span> maxpts <span style="color: #000080;">=</span> <span style="color: #0000dd;">1000</span><span style="color: #000040;">*</span><span style="color: #0000dd;">2</span>;  <span style="color: #008000;">// maximum number of function evaluation </span>
	<span style="color: #0000ff;">double</span> a<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#93;</span>, b<span style="color: #000000;">&#91;</span><span style="color: #0000dd;">2</span><span style="color: #000000;">&#93;</span>;
	
	<span style="color: #0000ff;">static</span> NagError fail;
	<span style="color: #0000ff;">double</span> finval;
	<span style="color: #0000ff;">int</span> minpts;
	<span style="color: #0000ff;">double</span> acc, eps;
	Nag_User comm;
	comm.<span style="color: #000000;">p</span> <span style="color: #000080;">=</span> <span style="color: #000000;">&#40;</span>Pointer<span style="color: #000000;">&#41;</span><span style="color: #000040;">&amp;</span>use_comm; <span style="color: #008000;">// For communication with user-supplied functions</span>
	
	<span style="color: #0000ff;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #0000ff;">int</span> k<span style="color: #000080;">=</span><span style="color: #0000dd;">0</span>; k <span style="color: #000080;">&lt;</span> ndim; <span style="color: #000040;">++</span>k<span style="color: #000000;">&#41;</span>  <span style="color: #008000;">// integration interval</span>
	<span style="color: #000000;">&#123;</span>
	  a<span style="color: #000000;">&#91;</span>k<span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> amp;
	  b<span style="color: #000000;">&#91;</span>k<span style="color: #000000;">&#93;</span> <span style="color: #000080;">=</span> x;
	<span style="color: #000000;">&#125;</span>
	eps <span style="color: #000080;">=</span> <span style="color: #0000dd;">0.0001</span>; <span style="color: #008000;">// set the precision</span>
	minpts <span style="color: #000080;">=</span> <span style="color: #0000dd;">0</span>;
		
	d01wcc<span style="color: #000000;">&#40;</span>ndim, f, a, b, <span style="color: #000040;">&amp;</span>minpts, maxpts, eps, <span style="color: #000040;">&amp;</span>finval, <span style="color: #000040;">&amp;</span>acc, <span style="color: #000040;">&amp;</span>comm, <span style="color: #000040;">&amp;</span>fail<span style="color: #000000;">&#41;</span>;
	
	y <span style="color: #000080;">=</span> finval;
	<span style="color: #008000;">// End of editable part</span>
<span style="color: #000000;">&#125;</span></pre>
<li>Click <b>Compile</b> button to compile.
</ol>
<p><br />
We provide several tutorials of user-defined integral functions. Refer to the corresponding topic for detailed steps if needed:
</p>
<ul><li><a href="../../Tutorial/Tutorial/Fitting_with_Integral_using_NAG_Library.html" title="Tutorial:Fitting with Integral using NAG Library">Using Origin C and NAG library functions</a></li>
<li><a href="../../Tutorial/Tutorial/Fitting_with_Integral_using_LabTalk_Function.html" title="Tutorial:Fitting with Integral using LabTalk Function">Using LabTalk script</a></li>
<li><a href="../../Tutorial/Tutorial/Fitting_with_Two_Integrals_using_LabTalk_Function.html" title="Tutorial:Fitting with Two Integrals using LabTalk Function">Fitting with Two Integrals using LabTalk Function</a></li>
<li><a href="../../Tutorial/Tutorial/Fitting_with_Summation.html" title="Tutorial:Fitting with Summation">Fitting with Summation</a></li></ul>
<hr class='keywordshr'><p><span class='keywords'>Keywords:</span><span class='keywordsInput'> integrate, integral, fitting, Origin C, LabTalk, NAG, summation, double integral </span></p>






